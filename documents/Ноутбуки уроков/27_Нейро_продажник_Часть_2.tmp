[{"lc": 1, "type": "constructor", "id": ["langchain", "schema", "document", "Document"], "kwargs": {"page_content": "\n\n# **\u041d\u0435\u0439\u0440\u043e-\u043f\u0440\u043e\u0434\u0430\u0436\u043d\u0438\u043a** (\u0443\u0440\u043e\u043a 2)\n\n\n\n\u0421\u0431\u043e\u0440\u043a\u0430 \u0430\u043b\u0433\u043e\u0440\u0438\u0442\u043c\u0430 \u0432 \u0434\u0438\u0430\u043b\u043e\u0433\n## \u041e\u0431\u0449\u0430\u044f \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u0430 \u0430\u043b\u0433\u043e\u0440\u0438\u0442\u043c\u0430\n# \u0413\u043e\u0442\u043e\u0432\u0438\u043c \u043e\u043a\u0440\u0443\u0436\u0435\u043d\u0438\u0435\n\n\u0423\u0441\u0442\u0430\u043d\u0430\u0432\u043b\u0438\u0432\u0430\u0435\u043c \u043f\u0430\u043a\u0435\u0442\u044b.\n\n\u041f\u043e\u0434\u043a\u043b\u044e\u0447\u0430\u0435\u043c \u0431\u0438\u0431\u043b\u0438\u043e\u0442\u0435\u043a\u0438.\n!pip install openai==1.30.3 langchain==0.2.1 langchain-community==0.2.1 faiss-cpu==1.8.0 langchain-openai==0.1.7 tiktoken==0.7.0 >/dev/null\n#@title \u041e\u043f\u0440\u0435\u0434\u0435\u043b\u0438\u043c \u043a\u043b\u0430\u0441\u0441 \u0434\u043b\u044f \u043f\u043e\u0434\u0441\u0432\u0435\u0442\u043a\u0438 \u0432\u044b\u0432\u043e\u0434\u0430 \u0440\u0430\u0437\u043d\u044b\u0445 \u043c\u043e\u0434\u0435\u043b\u0435\u0439 \u0440\u0430\u0437\u043d\u044b\u043c\u0438 \u0446\u0432\u0435\u0442\u0430\u043c\u0438\n\n# https://en.wikipedia.org/wiki/ANSI_escape_code#Colors\n\nclass bcolors:\n\n    HEADER = '\\033[95m'\n\n    OKBLUE = '\\033[94m'\n\n    OKCYAN = '\\033[96m'\n\n    OKGREEN = '\\033[92m'\n\n    GREEN = '\\033[32m'\n\n    RED = '\\033[31m'\n\n    BGGREEN = \"\\033[102m\"\n\n    BGYELLOW = \"\\033[103m\"\n\n    BGCYAN = \"\\033[106m\"\n\n    BGMAGENTA = \"\\033[105m\"\n\n    WARNING = '\\033[93m'\n\n    FAIL = '\\033[91m'\n\n    ENDC = '\\033[0m'\n\n    BOLD = '\\033[1m'\n\n    UNDERLINE = '\\033[4m'\n#@title \u0413\u0440\u0443\u0437\u0438\u043c \u0431\u0438\u0431\u043b\u0438\u043e\u0442\u0435\u043a\u0438\n\nimport os\n\nimport re\n\nimport requests\n\n#import getpass\n\n\n\nimport openai\n\nimport tiktoken\n\n\n\nfrom langchain.docstore.document import Document\n\nfrom langchain.text_splitter import MarkdownHeaderTextSplitter, RecursiveCharacterTextSplitter\n\n\n\nfrom langchain_openai import OpenAIEmbeddings\n\nfrom langchain_community.vectorstores import FAISS\n\n\n\nfrom oauth2client.service_account import ServiceAccountCredentials\n\n\n\nimport json\n\nimport copy\n\nimport string\n\n\n\nimport textwrap\n\nimport time\n\nfrom datetime import datetime\n#@title \u0417\u0430\u0434\u0430\u0435\u043c \u043a\u043e\u043d\u0441\u0442\u0430\u043d\u0442\u044b\n\ngpt_4_turbo = 'gpt-4-1106-preview'\n\ngpt_35_turbo = 'gpt-3.5-turbo-1106'\n\nMODEL = gpt_35_turbo\n\n\n\nnum_chunks = 5\n\nchunk_size = 940\n\nchunk_overlap = 0\n\ntemp = 0.1\n\nverbose = 1\n\nknowledge_db_url = 'https://docs.google.com/document/d/17KU38YHm5qUwPSjJPiB3NtRtdFpvO-cK77PWwKEXj5E'\n#@title \u041e\u0431\u044a\u044f\u0432\u043b\u044f\u0435\u043c \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0435\n\nhistory_chat = []\n\nhistory_user = []\n\nhistory_manager = []\n\n\n\nneeds_extractor = []\n\nbenefits_extractor = []\n\nobjection_detector = []\n\nresolved_objection_detector = []\n\ntariff_detector = []\n\n\n\nmain_answer = ''\n\nsummarized_dialog = ''\n\n# \u041c\u043e\u0434\u0435\u043b\u0438 GPT\n## get_topicphrase_questions -  \u043a\u043b\u044e\u0447\u0438 \u0438\u0437 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0445 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439\n\n\n\n\u044d\u0442\u0430 \u0433\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u044f \u0437\u0430\u043f\u0443\u0441\u043a\u0430\u0435\u0442\u0441\u044f \u043f\u043e\u0441\u043b\u0435 \u043a\u0430\u0436\u0434\u043e\u0433\u043e \u043d\u043e\u0432\u043e\u0433\u043e \u0432\u043e\u043f\u0440\u043e\u0441\u0430 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f, \u0434\u043b\u044f \u0432\u044b\u0434\u0435\u043b\u0435\u043d\u0438\u044f \u043a\u043b\u044e\u0447\u0435\u0439 \u0432 \u0435\u0433\u043e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0438, \u0442\u0430\u043a\u0436\u0435 \u0432\u044b\u0434\u0435\u043b\u044f\u0435\u043c \u043a\u043b\u044e\u0447\u0438 \u0438\u0437 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0433\u043e \u043e\u0442\u0432\u0435\u0442\u0430\n\n\u043c\u0435\u043d\u0435\u0434\u0436\u0435\u0440\u0430, \u0434\u0430\u043b\u0435\u0435 \u0447\u0435\u0440\u0435\u0437 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043e\u0440\u0430 \u043a\u043b\u044e\u0447\u0435\u0439 \u0441\u043e\u0437\u0434\u0430\u0434\u0438\u043c \u043e\u0431\u0449\u0438\u0439 \u043b\u043e\u0433\u0438\u0447\u0435\u0441\u043a\u0438\u0439 \u043a\u043e\u043d\u0442\u0435\u043a\u0441\u0442 \u043e\u0431\u0449\u0435\u043d\u0438\u044f (\u043a \u043d\u0430\u043a\u043e\u043f\u043b\u0435\u043d\u043d\u043e\u043c\u0443 \u0441\u043f\u0438\u0441\u043a\u0443 \u043a\u043b\u044e\u0447\u0435\u0439 \u0434\u043e\u0431\u0430\u0432\u0438\u043c \u043d\u043e\u0432\u044b\u0435 \u0438 \u0441\u043a\u043e\u0440\u0440\u0435\u043a\u0442\u0438\u0440\u0443\u0435\u043c \u043b\u043e\u0433\u0438\u043a\u0443)\n#@title \u041f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b\n\nname_todo_base = '\u042d\u043a\u0441\u0442\u0440\u0430\u043a\u0442\u043e\u0440 \u043a\u043b\u044e\u0447\u0435\u0432\u044b\u0445 \u0441\u043b\u043e\u0432'\n\nmodel_todo_base = MODEL\n\ntemperature_todo_base = 0\n\nverbose_base = 0\n\n\n\nsystem_topicphrase_extractor = '''\n\n\u0422\u044b - \u044d\u043a\u0441\u043f\u0435\u0440\u0442 \u043f\u043e \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u043c \u0443\u0441\u043b\u0443\u0433\u0430\u043c \u0423\u043d\u0438\u0432\u0435\u0440\u0441\u0438\u0442\u0435\u0442\u0430 \u0438\u0441\u043a\u0443\u0441\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u0433\u043e \u0438\u043d\u0442\u0435\u043b\u043b\u0435\u043a\u0442\u0430 (\u0423\u0418\u0418).\n\ntopic phrase - \u044d\u0442\u043e \u043a\u043b\u044e\u0447\u0435\u0432\u043e\u0435 \u0441\u043b\u043e\u0432\u043e, \u043a\u043b\u044e\u0447\u0435\u0432\u043e\u0435 \u0441\u043b\u043e\u0432\u043e\u0441\u043e\u0447\u0435\u0442\u0430\u043d\u0438\u0435 \u0438\u043b\u0438 \u043a\u043b\u044e\u0447\u0435\u0432\u0430\u044f \u0444\u0440\u0430\u0437\u0430 \u0432 \u0442\u0435\u043a\u0441\u0442\u0435, \u043e\u0442\u0440\u0430\u0436\u0430\u044e\u0449\u0435\u0435 \u0441\u043c\u044b\u0441\u043b \u0442\u0435\u043a\u0441\u0442\u0430 \u0432 \u043a\u043e\u043d\u0442\u0435\u043a\u0441\u0442\u0435 \u043f\u043e\u043a\u0443\u043f\u043a\u0438-\u043f\u0440\u043e\u0434\u0430\u0436\u0438\n\n\u043a\u0443\u0440\u0441\u043e\u0432 \u043e\u0431\u0443\u0447\u0435\u043d\u0438\u044f \u0438\u0441\u043a\u0443\u0441\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u043c\u0443 \u0438\u043d\u0442\u0435\u043b\u043b\u0435\u043a\u0442\u0443 \u0438 \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044e.\n\n\u0422\u044b \u0437\u043d\u0430\u0435\u0448\u044c, \u0447\u0442\u043e \u0442\u0435\u0440\u043c\u0438\u043d\u044b \u0442\u0430\u043a\u0438\u0435 \u043a\u0430\u043a: \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u044f \u044f\u0437\u044b\u043a\u043e\u0432 \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f, \u043d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u044f \u043a\u0443\u0440\u0441\u043e\u0432 \u0438 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u044f \u0442\u0430\u0440\u0438\u0444\u043e\u0432 - \u044d\u0442\u043e \u0432\u0441\u0435\u0433\u0434\u0430 topic phrase.\n\n\u0422\u044b \u043d\u0438\u043a\u043e\u0433\u0434\u0430 \u043d\u0435 \u0432\u043a\u043b\u044e\u0447\u0430\u0435\u0448\u044c \u0432 topic phrase \u0438\u043c\u0435\u043d\u0430 \u043b\u044e\u0434\u0435\u0439.\n\n\u0422\u0432\u043e\u044f \u0437\u0430\u0434\u0430\u0447\u0430 \u0432\u044b\u0434\u0435\u043b\u0438\u0442\u044c \u0432 \u0422\u0435\u043a\u0441\u0442\u0435 \u043a\u043b\u044e\u0447\u0435\u0432\u044b\u0435 topic phrase \u0438 \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0438\u0445 \u0432 \u0441\u043f\u0438\u0441\u043e\u043a.\n\n\u042d\u0442\u043e\u0442 \u0441\u043f\u0438\u0441\u043e\u043a \u0431\u0443\u0434\u0435\u0442 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c\u0441\u044f \u0434\u043b\u044f \u0431\u043e\u043b\u0435\u0435 \u044d\u0444\u0444\u0435\u043a\u0442\u0438\u0432\u043d\u043e\u0433\u043e \u043f\u043e\u0438\u0441\u043a\u0430 \u0434\u0430\u043d\u043d\u044b\u0445 \u0432 \u0431\u0430\u0437\u0435 \u0437\u043d\u0430\u043d\u0438\u0439 \u0423\u0418\u0418. \u041e\u0446\u0435\u043d\u0438\u0432\u0430\u0442\u044c\u0441\u044f \u0431\u0443\u0434\u0443\u0442 \u0447\u0435\u0442\u043a\u043e\u0441\u0442\u044c \u0438 \u0441\u0436\u0430\u0442\u043e\u0441\u0442\u044c \u0441\u043f\u0438\u0441\u043a\u0430.\n\n'''\n\n\n\ninstructions_topicphrase_extractor = '''\n\n\u041f\u0440\u043e\u0430\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0439 \u0422\u0435\u043a\u0441\u0442 \u0438 \u0432 \u0441\u0432\u043e\u0435\u043c \u043e\u0442\u0432\u0435\u0442\u0435 \u043d\u0430\u043f\u0438\u0448\u0438 \u043a\u0440\u0430\u0442\u043a\u043e \u0441\u043f\u0438\u0441\u043e\u043a \u0441\u0430\u043c\u044b\u0445 \u043b\u0443\u0447\u0448\u0438\u0445 topic phrase \u0432 \u0432\u0438\u0434\u0435 \u0441\u0442\u0440\u043e\u043a\u0438 \u0441 \u0440\u0430\u0437\u0434\u0435\u043b\u0438\u0442\u0435\u043b\u044f\u043c\u0438 (\u0437\u0430\u043f\u044f\u0442\u0430\u044f).\n\n'''\n#@title \u0424\u0443\u043d\u043a\u0446\u0438\u044f\n\ndef get_topicphrase_questions(name, _user, _manager, system, instruction, temp=0.0, verbose=verbose_base, model=MODEL):\n\n    #  \u0432 \u0442\u043e\u043c, \u0447\u0442\u043e \u0438\u0441\u0442\u043e\u0440\u0438\u044f \u043a\u043b\u0438\u0435\u043d\u0442\u0430 \u043d\u0435 \u043f\u0443\u0441\u0442\u0430\u044f \u043c\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b, \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u043c, \u0447\u0442\u043e \u0435\u0441\u0442\u044c \u0438\u0441\u0442\u043e\u0440\u0438\u044f \u043c\u0435\u043d\u0435\u0434\u0436\u0435\u0440\u0430\n\n    join_user = '\\n'.join(_user)\n\n    if history_manager:\n\n      text = f'\u0422\u0435\u043a\u0441\u0442: {join_user}\\n\\n{_manager[-1]}'\n\n    else:\n\n      text = f'\u0422\u0435\u043a\u0441\u0442: {join_user}'\n\n    messages = [  {\"role\": \"system\", \"content\": system},\n\n                  {\"role\": \"user\", \"content\": f'''{instruction}\n\n                                    \\n\\n\u0422\u0435\u043a\u0441\u0442: {text}\n\n                                    \\n\\n\u041e\u0442\u0432\u0435\u0442: '''}\n\n                ]\n\n    completion = openai.chat.completions.create(\n\n        model=model,\n\n        messages=messages,\n\n        temperature=temp,  # \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u043c \u0431\u043e\u043b\u0435\u0435 \u043d\u0438\u0437\u043a\u0443\u044e \u0442\u0435\u043c\u043f\u0435\u0440\u0430\u0442\u0443\u0440\u0443 \u0434\u043b\u044f \u0431\u043e\u043b\u0435\u0435 \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u043d\u043e\u0439 \u0441\u0443\u043c\u043c\u0430\u0440\u0438\u0437\u0430\u0446\u0438\u0438\n\n    )\n\n    answer = completion.choices[0].message.content\n\n    if verbose:\n\n      print(f'{bcolors.GREEN}{bcolors.BOLD}\u041e\u0442\u0432\u0435\u0442 {name}:{bcolors.ENDC}\\n',\n\n            f'{bcolors.BGYELLOW}\u041a\u043b\u044e\u0447\u0435\u0432\u044b\u0435 \u0441\u043b\u043e\u0432\u0430 \u0434\u043b\u044f \u0411\u0430\u0437\u044b \u0437\u043d\u0430\u043d\u0438\u0439:{bcolors.ENDC}\\n {answer}\\n=========\\n')\n\n    return completion\n\n\n## get_hello - \u0432\u044b\u0434\u0435\u043b\u0435\u043d\u0438\u0435 \u043f\u0440\u0438\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u044f \u0432 \u043f\u0435\u0440\u0432\u043e\u043c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0438 \u043a\u043b\u0438\u0435\u043d\u0442\u0430\n\n\n\n\u0414\u0430\u043b\u0435\u0435 \u043f\u0440\u0438\u043d\u0443\u0434\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0438\u0437 \u043e\u0442\u0432\u0435\u0442\u043e\u0432 \u043c\u0435\u043d\u0435\u0434\u0436\u0435\u0440\u0430 \u043f\u043e \u043f\u0440\u043e\u0434\u0430\u0436\u0430\u043c \u0431\u0443\u0434\u0435\u043c \u0443\u0434\u0430\u043b\u044f\u0442\u044c \u043f\u0440\u0438\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u0435, \u0430 \u0432 \u043f\u0435\u0440\u0432\u043e\u043c \u043e\u0442\u0432\u0435\u0442\u0435 \u043c\u0435\u043d\u0435\u0434\u0436\u0435\u0440\u0430 \u043e\u0442\u0437\u0435\u0440\u043a\u0430\u043b\u0438\u043c \u043f\u0440\u0438\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u0435 \u043a\u043b\u0438\u0435\u043d\u0442\u0430. \u0415\u0441\u043b\u0438 \u043a\u043b\u0438\u0435\u043d\u0442 \u043d\u0435 \u043f\u043e\u0437\u0434\u043e\u0440\u043e\u0432\u0430\u043b\u0441\u044f (\u0438\u043b\u0438 \u043c\u043e\u0434\u0435\u043b\u044c \u043d\u0435 \u043e\u043f\u043e\u0437\u043d\u0430\u043b\u0430 \u043f\u0440\u0438\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u0435), \u0434\u043e\u0431\u0430\u0432\u0438\u043c \u0444\u043e\u0440\u043c\u0430\u043b\u044c\u043d\u043e-\u043d\u0435\u0439\u0442\u0440\u0430\u043b\u044c\u043d\u043e\u0435 \u0417\u0434\u0440\u0430\u0432\u0441\u0442\u0432\u0443\u0439\u0442\u0435\n#@title \u041f\u0430\u0440\u0430\u043c\u0435\u043d\u0442\u044b \u0438 \u0444\u0443\u043d\u043a\u0446\u0438\u044f\n\ndef get_hello(model_gen, topic, temp=temp, verbose=verbose):\n\n  system = '''\n\n  \u041f\u0440\u0438\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u0435 - \u044d\u0442\u043e \u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u043f\u0440\u0438\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u044f \u0438\u043b\u0438 \u043f\u0440\u0438\u0432\u0435\u0442\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435,\n\n  \u043a\u043e\u0442\u043e\u0440\u043e\u0435 \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u0438\u043b\u0438 \u043f\u0440\u043e\u0438\u0437\u043d\u043e\u0441\u0438\u0442\u0441\u044f \u0432 \u043d\u0430\u0447\u0430\u043b\u0435 \u043e\u0431\u0449\u0435\u043d\u0438\u044f \u0441 \u043a\u0435\u043c-\u043b\u0438\u0431\u043e.\n\n  \u041f\u0440\u0438\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u0435 \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u0444\u043e\u0440\u043c\u0430\u043b\u044c\u043d\u044b\u043c \u0438\u043b\u0438 \u043d\u0435\u0444\u043e\u0440\u043c\u0430\u043b\u044c\u043d\u044b\u043c, \u0437\u0430\u0432\u0438\u0441\u0435\u0442\u044c \u043e\u0442 \u043a\u0443\u043b\u044c\u0442\u0443\u0440\u044b \u0438 \u043a\u043e\u043d\u0442\u0435\u043a\u0441\u0442\u0430.\n\n  \u041e\u043d\u043e \u0441\u043b\u0443\u0436\u0438\u0442 \u0434\u043b\u044f \u0434\u0435\u043c\u043e\u043d\u0441\u0442\u0440\u0430\u0446\u0438\u0438 \u0432\u0435\u0436\u043b\u0438\u0432\u043e\u0441\u0442\u0438, \u0434\u0440\u0443\u0436\u0435\u043b\u044e\u0431\u0438\u044f \u0438 \u0436\u0435\u043b\u0430\u043d\u0438\u044f \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u043a\u043e\u043d\u0442\u0430\u043a\u0442 \u0441 \u0441\u043e\u0431\u0435\u0441\u0435\u0434\u043d\u0438\u043a\u043e\u043c.\n\n  \u041f\u0440\u0438\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u044f \u043c\u043e\u0433\u0443\u0442 \u0431\u044b\u0442\u044c \u0440\u0430\u0437\u043d\u044b\u043c\u0438 \u0432 \u0440\u0430\u0437\u043b\u0438\u0447\u043d\u044b\u0445 \u044f\u0437\u044b\u043a\u0430\u0445 \u0438 \u043a\u0443\u043b\u044c\u0442\u0443\u0440\u0430\u0445, \u043e\u0442 \u043f\u0440\u043e\u0441\u0442\u043e\u0433\u043e '\u043f\u0440\u0438\u0432\u0435\u0442' \u0438\u043b\u0438 '\u0437\u0434\u0440\u0430\u0432\u0441\u0442\u0432\u0443\u0439\u0442\u0435'\n\n  \u0434\u043e \u0431\u043e\u043b\u0435\u0435 \u0444\u043e\u0440\u043c\u0430\u043b\u044c\u043d\u044b\u0445 \u0438\u043b\u0438 \u0442\u0440\u0430\u0434\u0438\u0446\u0438\u043e\u043d\u043d\u044b\u0445 \u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u0439.\n\n  \u0422\u0432\u043e\u044f \u0437\u0430\u0434\u0430\u0447\u0430 \u0432\u044b\u044f\u0432\u0438\u0442\u044c \u0432 \u0422\u0435\u043a\u0441\u0442\u0435 \u043a\u043b\u0438\u0435\u043d\u0442\u0430 \u041f\u0440\u0438\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u0435.\n\n  \u0412 \u0441\u0432\u043e\u0439 \u043e\u0442\u0432\u0435\u0442 \u0432\u043a\u043b\u044e\u0447\u0438 \u0442\u043e\u043b\u044c\u043a\u043e \u043d\u0430\u0439\u0434\u0435\u043d\u043d\u043e\u0435 \u041f\u0440\u0438\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u0435.\n\n  \u0415\u0441\u043b\u0438 \u0432 \u0442\u0435\u043a\u0441\u0442\u0435 \u043a\u043b\u0438\u0435\u043d\u0442\u0430 \u043d\u0435\u0442 \u041f\u0440\u0438\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u044f, \u0442\u043e\u0433\u0434\u0430 \u043d\u0430\u043f\u0438\u0448\u0438: 'None'.\n\n  '''\n\n  user = f'\u0422\u0435\u043a\u0441\u0442 \u043a\u043b\u0438\u0435\u043d\u0442\u0430: {topic}'\n\n  messages = [{\"role\": \"system\", \"content\": system},{\"role\": \"user\", \"content\": user}]\n\n  completion = openai.chat.completions.create(model=model_gen, messages=messages, temperature=temp)\n\n\n\n  return completion\n\n## summarize_dialog - \u0441\u0443\u043c\u043c\u0430\u0440\u0438\u0437\u0430\u0446\u0438\u044f \u0434\u0438\u0430\u043b\u043e\u0433\u0430\n\n\n\n\u0437\u0430\u043f\u0443\u0441\u043a\u0430\u0435\u0442\u0441\u044f \u043f\u0435\u0440\u0435\u0434 \u0440\u0430\u0431\u043e\u0442\u043e\u0439 \u0434\u0438\u0441\u043f\u0435\u0442\u0447\u0435\u0440\u0430-\u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0438\u0437\u0430\u0442\u043e\u0440\u0430 \u0434\u043b\u044f \u0444\u043e\u0440\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u0425\u0440\u043e\u043d\u043e\u043b\u043e\u0433\u0438\u0438 \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0445 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0434\u0438\u0430\u043b\u043e\u0433\u0430. \u0412\u0441\u0435\u0445 \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u0438\u0441\u0442\u043e\u0432 \u0431\u0443\u0434\u0435\u043c \u043f\u0440\u043e\u0441\u0438\u0442\u044c \u0441\u0442\u0440\u043e\u0438\u0442\u044c \u0441\u0432\u043e\u0438 \u043e\u0442\u0432\u0435\u0442\u044b \u043b\u043e\u0433\u0438\u0447\u043d\u044b\u043c\u0438 \u043e\u0442\u043d\u043e\u0441\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u044d\u0442\u043e\u0439 \u0445\u0440\u043e\u043d\u043e\u043b\u043e\u0433\u0438\u0438\n#@title \u041f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b \u0438 \u0444\u0443\u043d\u043a\u0446\u0438\u044f\n\ndef summarize_dialog(dialog, _history, temp=0.1, verbose=0, model=MODEL):\n\n    i = 2 if len(_history) > 1 else 1  # \u0431\u0435\u0440\u0435\u043c 2 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0445 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f \u0434\u043b\u044f \u0441\u0430\u043c\u043c\u0430\u0440\u0438\u0437\u0430\u0446\u0438\u0438 (\u043f\u0440\u0435\u0434\u044b\u0434 \u043e\u0442\u0432\u0435\u0442 \u043c\u0435\u043d\u0435\u0434\u0436\u0435\u0440\u0430 \u0438 \u043d\u043e\u0432\u044b\u0439 \u0432\u043e\u043f\u0440\u043e\u0441 \u043a\u043b\u0438\u0435\u043d\u0442\u0430)\n\n    last_statements = ' '.join(_history[-i:])\n\n    messages = [\n\n        {\"role\": \"system\", \"content\": '''\n\n                  \u0422\u044b \u0441\u0443\u043f\u0435\u0440 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043e\u0440, \u0443\u043c\u0435\u0435\u0448\u044c \u0432\u044b\u0434\u0435\u043b\u044f\u0442\u044c \u0432 \u0434\u0438\u0430\u043b\u043e\u0433\u0430\u0445 \u0432\u0441\u0435 \u0441\u0430\u043c\u043e\u0435 \u0432\u0430\u0436\u043d\u043e\u0435.\n\n                  \u0422\u044b \u0437\u043d\u0430\u0435\u0448\u044c, \u0447\u0442\u043e \u043f\u0440\u0438 \u0441\u0430\u043c\u043c\u0430\u0440\u0438\u0437\u0430\u0446\u0438\u0438 \u043d\u0435\u043b\u044c\u0437\u044f \u0438\u0441\u043a\u043b\u044e\u0447\u0430\u0442\u044c \u0438\u0437 \u0434\u0438\u0430\u043b\u043e\u0433\u0430 \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u044c\u043d\u044b\u0435 \u0442\u0435\u0440\u043c\u0438\u043d\u044b \u0438 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u044f \u043a\u0443\u0440\u0441\u043e\u0432,\n\n                  \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c \u0438 \u0442\u0430\u0440\u0438\u0444\u043e\u0432.\n\n                  \u0422\u0432\u043e\u044f \u0437\u0430\u0434\u0430\u0447\u0430 \u0441\u0434\u0435\u043b\u0430\u0442\u044c \u043f\u043e\u043b\u043d\u043e\u0435 \u0441\u0430\u043c\u043c\u0430\u0440\u0438 \u043d\u0430 \u043e\u0441\u043d\u043e\u0432\u0430\u043d\u0438\u0438 \u0418\u0441\u0442\u043e\u0440\u0438\u0438 \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0445 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0434\u0438\u0430\u043b\u043e\u0433\u0430 \u0438 \u041f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0445 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439.\n\n                                         '''},\n\n        {\"role\": \"user\", \"content\": f'''\u0421\u0443\u043c\u043c\u0430\u0440\u0438\u0437\u0438\u0440\u0443\u0439 \u0414\u0438\u0430\u043b\u043e\u0433, \u043d\u0438\u0447\u0435\u0433\u043e \u043d\u0435 \u043f\u0440\u0438\u0434\u0443\u043c\u044b\u0432\u0430\u0439 \u043e\u0442 \u0441\u0435\u0431\u044f. \u0415\u0441\u043b\u0438 \u043a\u043b\u0438\u0435\u043d\u0442 \u043f\u0440\u0435\u0434\u0441\u0442\u0430\u0432\u0438\u043b\u0441\u044f, \u0441\u043e\u0445\u0440\u0430\u043d\u0438 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044e \u043e\u0431 \u0438\u043c\u0435\u043d\u0438.\n\n                                        \u0415\u0441\u043b\u0438 \u043a\u043b\u0438\u0435\u043d\u0442 \u0443\u043a\u0430\u0437\u0430\u043b \u0441\u0432\u043e\u0439 \u043d\u043e\u043c\u0435\u0440 \u0442\u0435\u043b\u0435\u0444\u043e\u043d\u0430 \u0438\u043b\u0438 \u0430\u0434\u0440\u0435\u0441 \u044d\u043b\u0435\u043a\u0442\u0440\u043e\u043d\u043d\u043e\u0439 \u043f\u043e\u0447\u0442\u044b, \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e \u043e\u0442\u0440\u0430\u0437\u0438 \u044d\u0442\u0443 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044e \u0432 \u0441\u0430\u043c\u043c\u0430\u0440\u0438.\n\n                                        \u0415\u0441\u043b\u0438 \u0441 \u043a\u043b\u0438\u0435\u043d\u0442\u043e\u043c \u0435\u0441\u0442\u044c \u0434\u043e\u0433\u043e\u0432\u043e\u0440\u0435\u043d\u043d\u043e\u0441\u0442\u044c \u043e \u043d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u043d\u043e\u043c \u0434\u043d\u0435 \u0438 \u0432\u0440\u0435\u043c\u0435\u043d\u0438 \u0441\u043e\u0437\u0432\u043e\u043d\u0430 \u0441 \u043c\u0435\u043d\u0435\u0434\u0436\u0435\u0440\u043e\u043c, \u0442\u0430\u043a\u0436\u0435 \u043e\u0442\u0440\u0430\u0437\u0438 \u044d\u0442\u043e \u0432 \u0441\u0430\u043c\u043c\u0430\u0440\u0438\u0437\u0430\u0446\u0438\u0438.\n\n                                      \\n\\n\u0418\u0441\u0442\u043e\u0440\u0438\u044f \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0445 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0434\u0438\u0430\u043b\u043e\u0433\u0430: {dialog}.\n\n                                      \\n\\n\u041f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f: {last_statements}\n\n                                      \\n\\n\u041e\u0442\u0432\u0435\u0442: '''\n\n        }\n\n    ]\n\n    completion = openai.chat.completions.create(\n\n        model=model,\n\n        messages=messages,\n\n        temperature=temp,  # \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u043c \u0431\u043e\u043b\u0435\u0435 \u043d\u0438\u0437\u043a\u0443\u044e \u0442\u0435\u043c\u043f\u0435\u0440\u0430\u0442\u0443\u0440\u0443 \u0434\u043b\u044f \u0431\u043e\u043b\u0435\u0435 \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u043d\u043e\u0439 \u0441\u0443\u043c\u043c\u0430\u0440\u0438\u0437\u0430\u0446\u0438\u0438\n\n    )\n\n    answer = completion.choices[0].message.content\n\n    if verbose:\n\n      print(f'{bcolors.BGYELLOW}\u0421\u0430\u043c\u043c\u0430\u0440\u0438 \u0434\u0438\u0430\u043b\u043e\u0433\u0430:{bcolors.ENDC}\\n', answer)\n\n    return completion", "metadata": {"subid": 0, "total": 9, "source": "https://colab.research.google.com/drive/1KrniwGByCdFu3FtrQ1JUASAaYwTJgU4N?usp=sharing"}}}, {"lc": 1, "type": "constructor", "id": ["langchain", "schema", "document", "Document"], "kwargs": {"page_content": "\n## extract_entity_from_user_question - \u0432\u044b\u0434\u0435\u043b\u044f\u0435\u0442 \u0441\u0443\u0449\u043d\u043e\u0441\u0442\u0438 \u0438\u0437 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0433\u043e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f \u043a\u043b\u0438\u0435\u043d\u0442\u0430/\u043c\u0435\u043d\u0435\u0434\u0436\u0435\u0440\u0430\n\n\n\n\u0418\u0441\u043a\u043e\u043c\u044b\u0435 \u0441\u0443\u0449\u043d\u043e\u0441\u0442\u0438: \u0412\u043e\u0437\u0440\u0430\u0436\u0435\u043d\u0438\u044f, \u041f\u043e\u0442\u0440\u0435\u0431\u043d\u043e\u0441\u0442\u0438, \u041f\u0440\u0435\u0438\u043c\u0443\u0449\u0435\u0441\u0442\u0432\u0430, \u041e\u0442\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u0432\u043e\u0437\u0440\u0430\u0436\u0435\u043d\u0438\u0439, \u0422\u0430\u0440\u0438\u0444\u044b \u0438 \u0426\u0435\u043d\u044b\n### \u041f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b\n#@title 1. \u0412\u044b\u0434\u0435\u043b\u0435\u043d\u0438\u0435 \u0432 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u043c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0438 \u043a\u043b\u0438\u0435\u043d\u0442\u0430 \u043e\u0437\u0432\u0443\u0447\u0435\u043d\u043d\u044b\u0445 \u0438\u043c \u043f\u043e\u0442\u0440\u0435\u0431\u043d\u043e\u0441\u0442\u0435\u0439\n\nname_needs_extractor = '\u0421\u043f\u0435\u0446 \u043f\u043e \u043f\u043e\u0442\u0440\u0435\u0431\u043d\u043e\u0441\u0442\u044f\u043c'\n\nmodel_needs_extractor = MODEL\n\ntemperature_needs_extractor = 0.2\n\nverbose_needs_extractor = 0\n\nsystem_prompt_needs_extractor = '''\n\n\u0422\u044b \u043b\u0443\u0447\u0448\u0438\u0439 \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u0438\u0441\u0442 \u043e\u0442\u0434\u0435\u043b\u0430 \u043f\u0440\u043e\u0434\u0430\u0436. \u0422\u044b \u043f\u0440\u043e\u0434\u0430\u0435\u0448\u044c \u043a\u0443\u0440\u0441\u044b \u043e\u0431\u0443\u0447\u0435\u043d\u0438\u044f \u0438\u0441\u043a\u0443\u0441\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u043c\u0443 \u0438\u043d\u0442\u0435\u043b\u043b\u0435\u043a\u0442\u0443 \u0438 \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044e.\n\n\u0422\u044b \u0437\u043d\u0430\u0435\u0448\u044c, \u0447\u0442\u043e \u041f\u043e\u0442\u0440\u0435\u0431\u043d\u043e\u0441\u0442\u044c - \u044d\u0442\u043e \u0442\u043e, \u0447\u0442\u043e \u043a\u043b\u0438\u0435\u043d\u0442 \u0445\u043e\u0447\u0435\u0442 \u0438\u043b\u0438 \u0447\u0442\u043e \u0435\u043c\u0443 \u043d\u0440\u0430\u0432\u0438\u0442\u0441\u044f,\n\n\u0438 \u0447\u0442\u043e \u043f\u043e\u0432\u043b\u0438\u044f\u0435\u0442 \u043d\u0430 \u043f\u0440\u0438\u043e\u0431\u0440\u0435\u0442\u0435\u043d\u0438\u0435 \u0438\u043c \u043a\u0443\u0440\u0441\u043e\u0432 \u043e\u0431\u0443\u0447\u0435\u043d\u0438\u044f.\n\n\u0422\u044b \u043e\u0447\u0435\u043d\u044c \u0445\u043e\u0440\u043e\u0448\u043e \u0443\u043c\u0435\u0435\u0448\u044c \u0432\u044b\u044f\u0432\u043b\u044f\u0442\u044c \u0432 \u0432\u043e\u043f\u0440\u043e\u0441\u0435 \u043a\u043b\u0438\u0435\u043d\u0442\u0430 \u0435\u0433\u043e \u043f\u043e\u0442\u0440\u0435\u0431\u043d\u043e\u0441\u0442\u0438.\n\n\u0422\u044b \u0432\u0441\u0435\u0433\u0434\u0430 \u043e\u0447\u0435\u043d\u044c \u0441\u0442\u0440\u043e\u0433\u043e \u0441\u043b\u0435\u0434\u0443\u0435\u0448\u044c \u043f\u043e\u0440\u044f\u0434\u043a\u0443 \u043e\u0442\u0447\u0435\u0442\u0430.\n\n'''\n\ninstructions_needs_extractor = '''\n\n\u0414\u0430\u0432\u0430\u0439 \u0434\u0435\u0439\u0441\u0442\u0432\u043e\u0432\u0430\u0442\u044c \u043f\u043e\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e:\n\n\u041f\u0440\u043e\u0430\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0439 \u0412\u043e\u043f\u0440\u043e\u0441 \u043a\u043b\u0438\u0435\u043d\u0442\u0430, \u0432\u044b\u044f\u0432\u0438 \u0432\u044b\u0441\u043a\u0430\u0437\u0430\u043d\u043d\u044b\u0435 \u0432 \u043d\u0435\u043c \u044f\u0432\u043d\u044b\u0435 \u043f\u043e\u0442\u0440\u0435\u0431\u043d\u043e\u0441\u0442\u0438 \u043a\u043b\u0438\u0435\u043d\u0442\u0430 (\u0435\u0441\u043b\u0438 \u043e\u043d\u0438 \u0435\u0441\u0442\u044c) \u0438 \u043d\u0430\u043f\u0438\u0448\u0438 \u0438\u0445.\n\n\u041d\u0438\u0447\u0435\u0433\u043e \u043d\u0435 \u043f\u0440\u0438\u0434\u0443\u043c\u044b\u0432\u0430\u0439 \u043e\u0442 \u0441\u0435\u0431\u044f, \u0435\u0441\u043b\u0438 \u043f\u043e\u0442\u0440\u0435\u0431\u043d\u043e\u0441\u0442\u0435\u0439 \u043d\u0435 \u0432\u044b\u044f\u0432\u043b\u0435\u043d\u043e, \u0442\u043e \u043d\u0430\u043f\u0438\u0448\u0438 \"-\".\n\n\u041f\u043e\u0440\u044f\u0434\u043e\u043a \u043e\u0442\u0447\u0435\u0442\u0430: \u0432 \u0441\u0432\u043e\u0435\u043c \u043e\u0442\u0432\u0435\u0442\u0435 \u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u044c \u0442\u043e\u043b\u044c\u043a\u043e \u0441\u043f\u0438\u0441\u043e\u043a \u043f\u043e\u0442\u0440\u0435\u0431\u043d\u043e\u0441\u0442\u0435\u0439 (\u0438\u043b\u0438  \"-\") \u0432 \u0432\u0438\u0434\u0435 \u0441\u0442\u0440\u043e\u043a\u0438 \u0441 \u0440\u0430\u0437\u0434\u0435\u043b\u0438\u0442\u0435\u043b\u044f\u043c\u0438 (\u0437\u0430\u043f\u044f\u0442\u044b\u0435).\n\n'''\n#@title 2. \u0412\u044b\u0434\u0435\u043b\u0435\u043d\u0438\u0435 \u0432 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u043c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0438 \u043c\u0435\u043d\u0435\u0434\u0436\u0435\u0440\u0430 \u043d\u0430\u0437\u0432\u0430\u043d\u043d\u044b\u0445 \u0438\u043c \u043f\u0440\u0435\u0438\u043c\u0443\u0449\u0435\u0441\u0442\u0432\n\nname_benefits_extractor = '\u0421\u043f\u0435\u0446 \u043f\u043e \u043e\u0437\u0432\u0443\u0447\u0435\u043d\u043d\u044b\u043c \u043f\u0440\u0435\u0438\u043c\u0443\u0449\u0435\u0441\u0442\u0432\u0430\u043c'\n\nmodel_benefits_extractor = MODEL\n\ntemperature_benefits_extractor = 0.2\n\nverbose_benefits_extractor = 0\n\nsystem_prompt_benefits_extractor='''\n\n\u0422\u044b \u043b\u0443\u0447\u0448\u0438\u0439 \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u0438\u0441\u0442 \u043f\u043e \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u044e \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0430 \u043e\u0442\u0434\u0435\u043b\u0430 \u043f\u0440\u043e\u0434\u0430\u0436 \u0438 \u043e\u0442\u043b\u0438\u0447\u043d\u043e \u0443\u043c\u0435\u0435\u0448\u044c \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u044c \u0432 \u043e\u0442\u0432\u0435\u0442\u0435 \u043c\u0435\u043d\u0435\u0434\u0436\u0435\u0440\u0430\n\n\u043d\u0430\u0437\u0432\u0430\u043d\u043d\u044b\u0435 \u043c\u0435\u043d\u0435\u0434\u0436\u0435\u0440\u043e\u043c \u043f\u0440\u0435\u0438\u043c\u0443\u0449\u0435\u0441\u0442\u0432\u0430 \u043e\u0431\u0443\u0447\u0435\u043d\u0438\u044f \u0432 \u0443\u043d\u0438\u0432\u0435\u0440\u0441\u0438\u0442\u0435\u0442\u0435 \u0438\u0441\u043a\u0443\u0441\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u0433\u043e \u0438\u043d\u0442\u0435\u043b\u043b\u0435\u043a\u0442\u0430 (\u0441\u043e\u043a\u0440 \u0423\u0418\u0418).\n\n\u0423 \u0442\u0435\u0431\u044f \u0434\u043b\u044f \u0430\u043d\u0430\u043b\u0438\u0437\u0430 \u0435\u0441\u0442\u044c \u041f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0439 \u043e\u0442\u0432\u0435\u0442 \u043c\u0435\u043d\u0435\u0434\u0436\u0435\u0440\u0430 \u043e\u0442\u0434\u0435\u043b\u0430 \u043f\u0440\u043e\u0434\u0430\u0436.\n\n\u0422\u044b \u0432\u0441\u0435\u0433\u0434\u0430 \u043e\u0447\u0435\u043d\u044c \u0441\u0442\u0440\u043e\u0433\u043e \u0441\u043b\u0435\u0434\u0443\u0435\u0448\u044c \u043f\u043e\u0440\u044f\u0434\u043a\u0443 \u043e\u0442\u0447\u0435\u0442\u0430.\n\n'''\n\ninstructions_benefits_extractor = '''\n\n\u0414\u0430\u0432\u0430\u0439 \u0434\u0435\u0439\u0441\u0442\u0432\u043e\u0432\u0430\u0442\u044c \u043f\u043e\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e:\n\n\u041f\u0440\u043e\u0430\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0439 \u041f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0439 \u043e\u0442\u0432\u0435\u0442 \u041c\u0435\u043d\u0435\u0434\u0436\u0435\u0440\u0430 \u043e\u0442\u0434\u0435\u043b\u0430 \u043f\u0440\u043e\u0434\u0430\u0436, \u043d\u0430\u0439\u0434\u0438 \u0432 \u043d\u0435\u043c \u043d\u0430\u0437\u0432\u0430\u043d\u043d\u044b\u0435 \u043f\u0440\u0435\u0438\u043c\u0443\u0449\u0435\u0441\u0442\u0432\u0430 (\u0435\u0441\u043b\u0438 \u043e\u043d\u0438 \u0435\u0441\u0442\u044c) \u0438 \u043d\u0430\u043f\u0438\u0448\u0438 \u0438\u0445;\n\n\u041d\u0438\u0447\u0435\u0433\u043e \u043d\u0435 \u043f\u0440\u0438\u0434\u0443\u043c\u044b\u0432\u0430\u0439 \u043e\u0442 \u0441\u0435\u0431\u044f, \u0435\u0441\u043b\u0438 \u043f\u0440\u0435\u0438\u043c\u0443\u0449\u0435\u0441\u0442\u0432\u0430 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u044b, \u0442\u043e \u043d\u0430\u043f\u0438\u0448\u0438  \"-\".\n\n\u041f\u043e\u0440\u044f\u0434\u043e\u043a \u043e\u0442\u0447\u0435\u0442\u0430: \u0432 \u0441\u0432\u043e\u0435\u043c \u043e\u0442\u0432\u0435\u0442\u0435 \u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u044c \u0442\u043e\u043b\u044c\u043a\u043e \u0441\u043f\u0438\u0441\u043e\u043a \u043f\u0440\u0435\u0438\u043c\u0443\u0449\u0435\u0441\u0442\u0432 (\u0438\u043b\u0438  \"-\") \u0432 \u0432\u0438\u0434\u0435 \u0441\u0442\u0440\u043e\u043a\u0438 \u0441 \u0440\u0430\u0437\u0434\u0435\u043b\u0438\u0442\u0435\u043b\u044f\u043c\u0438 (\u0437\u0430\u043f\u044f\u0442\u044b\u0435).\n\n'''\n#@title 3. \u0412\u044b\u0434\u0435\u043b\u0435\u043d\u0438\u0435 \u0432 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u043c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0438 \u043a\u043b\u0438\u0435\u043d\u0442\u0430 \u043e\u0437\u0432\u0443\u0447\u0435\u043d\u043d\u044b\u0445 \u0438\u043c \u0432\u043e\u0437\u0440\u0430\u0436\u0435\u043d\u0438\u0439\n\nname_objection_detector = '\u0421\u043f\u0435\u0446 \u043f\u043e \u0432\u043e\u0437\u0440\u0430\u0436\u0435\u043d\u0438\u044f\u043c'\n\nmodel_objection_detector = MODEL\n\ntemperature_objection_detector = 0.2\n\nverbose_objection_detector = 0\n\nsystem_prompt_objection_detector = '''\n\n\u0422\u044b - \u043b\u0443\u0447\u0448\u0438\u0439 \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u0438\u0441\u0442 \u043e\u0442\u0434\u0435\u043b\u0430 \u043f\u0440\u043e\u0434\u0430\u0436, \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u044e\u0449\u0438\u0439\u0441\u044f \u043d\u0430 \u043f\u0440\u043e\u0434\u0430\u0436\u0435 \u043a\u0443\u0440\u0441\u043e\u0432 \u043e\u0431\u0443\u0447\u0435\u043d\u0438\u044f \u0438\u0441\u043a\u0443\u0441\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u043c\u0443 \u0438\u043d\u0442\u0435\u043b\u043b\u0435\u043a\u0442\u0443.\n\n\u0422\u044b \u0437\u043d\u0430\u0435\u0448\u044c, \u0447\u0442\u043e \u043e\u0442\u043a\u0440\u044b\u0442\u043e\u0435 \u0432\u043e\u0437\u0440\u0430\u0436\u0435\u043d\u0438\u0435  - \u044d\u0442\u043e \u044f\u0432\u043d\u043e\u0435 \u0437\u0430\u044f\u0432\u043b\u0435\u043d\u0438\u0435 \u0441\u043e \u0441\u0442\u043e\u0440\u043e\u043d\u044b \u043a\u043b\u0438\u0435\u043d\u0442\u0430 \u043e \u0442\u043e\u043c, \u0447\u0442\u043e \u0435\u0433\u043e \u043d\u0435 \u0443\u0441\u0442\u0440\u0430\u0438\u0432\u0430\u0435\u0442 \u0438\n\n\u0447\u0442\u043e \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u043f\u0440\u0435\u0433\u0440\u0430\u0434\u043e\u0439 \u0434\u043b\u044f \u043f\u0440\u0438\u043e\u0431\u0440\u0435\u0442\u0435\u043d\u0438\u044f \u043a\u0443\u0440\u0441\u043e\u0432 \u043e\u0431\u0443\u0447\u0435\u043d\u0438\u044f, \u0430 \u043f\u0440\u043e\u0441\u044c\u0431\u044b \u043a\u043b\u0438\u043d\u0435\u0442\u0430 \u043d\u0435 \u044f\u0432\u043b\u044f\u044e\u0442\u0441\u044f \u0432\u043e\u0437\u0440\u0430\u0436\u0435\u043d\u0438\u044f\u043c\u0438.\n\n\u0422\u0432\u043e\u044f \u0437\u0430\u0434\u0430\u0447\u0430 - \u0442\u0449\u0430\u0442\u0435\u043b\u044c\u043d\u043e \u0432\u044b\u044f\u0432\u043b\u044f\u0442\u044c \u043e\u0442\u043a\u0440\u044b\u0442\u044b\u0435 \u0432\u043e\u0437\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u0432 \u0412\u043e\u043f\u0440\u043e\u0441\u0435 \u043a\u043b\u0438\u0435\u043d\u0442\u0430.\n\n\u0422\u044b \u0432\u0441\u0435\u0433\u0434\u0430 \u0441\u0442\u0440\u043e\u0433\u043e \u0441\u043b\u0435\u0434\u0443\u0435\u0448\u044c \u043f\u043e\u0440\u044f\u0434\u043a\u0443 \u043e\u0442\u0447\u0435\u0442\u0430.\n\n'''\n\ninstructions_objection_detector = '''\n\n\u0414\u0430\u0432\u0430\u0439 \u0434\u0435\u0439\u0441\u0442\u0432\u043e\u0432\u0430\u0442\u044c \u043f\u043e\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e:\n\n\u041f\u0440\u043e\u0430\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0439 \u0412\u043e\u043f\u0440\u043e\u0441 \u043a\u043b\u0438\u0435\u043d\u0442\u0430 \u0438 \u0432\u044b\u0434\u0435\u043b\u0438 \u043e\u0442\u043a\u0440\u044b\u0442\u044b\u0435 \u0432\u043e\u0437\u0440\u0430\u0436\u0435\u043d\u0438\u044f, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u043e\u043d \u0432\u044b\u0441\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u0442 (\u0435\u0441\u043b\u0438 \u043e\u043d\u0438 \u0435\u0441\u0442\u044c).\n\n\u041f\u0440\u0438\u043c\u0435\u0440\u044b \u0432\u043e\u0437\u0440\u0430\u0436\u0435\u043d\u0438\u0439 \u043c\u043e\u0433\u0443\u0442 \u0432\u043a\u043b\u044e\u0447\u0430\u0442\u044c \u0432 \u0441\u0435\u0431\u044f: \"\u0434\u043e\u0440\u043e\u0433\u043e\", \"\u043c\u043d\u0435 \u043d\u0435 \u0445\u0432\u0430\u0442\u0438\u0442 \u0437\u043d\u0430\u043d\u0438\u0439/\u043e\u043f\u044b\u0442\u0430\",\n\n\"\u043c\u043d\u0435 \u043d\u0435 \u0445\u0432\u0430\u0442\u0438\u0442 \u0432\u0440\u0435\u043c\u0435\u043d\u0438 \u043d\u0430 \u0443\u0447\u0435\u0431\u0443\", \"\u0441\u043b\u044b\u0448\u0430\u043b \u043f\u043b\u043e\u0445\u0438\u0435 \u043e\u0442\u0437\u044b\u0432\u044b\", \"\u043d\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0435\", \"\u0432\u0441\u0435 \u0442\u043e\u043b\u044c\u043a\u043e \u043e\u0431\u0435\u0449\u0430\u044e\u0442\" \u0438 \u0442.\u043f.\n\n\u0412 \u0441\u0432\u043e\u0435\u043c \u043e\u0442\u0432\u0435\u0442\u0435 \u0443\u043a\u0430\u0436\u0438 \u0432\u0441\u0435 \u0432\u044b\u0434\u0435\u043b\u0435\u043d\u043d\u044b\u0435 \u043e\u0442\u043a\u0440\u044b\u0442\u044b\u0435 \u0432\u043e\u0437\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u043a\u043b\u0438\u0435\u043d\u0442\u0430, \u0441\u043e\u0431\u043b\u044e\u0434\u0430\u044f \u0442\u0443 \u0436\u0435 \u043f\u043e\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c, \u0432 \u043a\u0430\u043a\u043e\u0439 \u043e\u043d\u0438 \u0431\u044b\u043b\u0438\n\n\u0432\u044b\u0441\u043a\u0430\u0437\u0430\u043d\u044b \u0432 \u0435\u0433\u043e \u0432\u043e\u043f\u0440\u043e\u0441\u0435. \u041d\u0438\u0447\u0435\u0433\u043e \u043d\u0435 \u043f\u0440\u0438\u0434\u0443\u043c\u044b\u0432\u0430\u0439 \u043e\u0442 \u0441\u0435\u0431\u044f: \u0435\u0441\u043b\u0438 \u0432\u043e\u0437\u0440\u0430\u0436\u0435\u043d\u0438\u0439  \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e, \u0442\u043e \u0432 \u0441\u0432\u043e\u0435\u043c \u043e\u0442\u0432\u0435\u0442\u0435 \u043d\u0430\u043f\u0438\u0448\u0438 \"-\".\n\n\u041f\u043e\u0440\u044f\u0434\u043e\u043a \u043e\u0442\u0447\u0435\u0442\u0430: \u0432 \u0441\u0432\u043e\u0439 \u043e\u0442\u0432\u0435\u0442 \u0432\u043a\u043b\u044e\u0447\u0438 \u0442\u043e\u043b\u044c\u043a\u043e \u0441\u043f\u0438\u0441\u043e\u043a \u0432\u044b\u0434\u0435\u043b\u0435\u043d\u043d\u044b\u0445 \u043e\u0442\u043a\u0440\u044b\u0442\u044b\u0445 \u0432\u043e\u0437\u0440\u0430\u0436\u0435\u043d\u0438\u0439 \u043a\u043b\u0438\u0435\u043d\u0442\u0430 (\u0438\u043b\u0438  \"-\") \u0432 \u0432\u0438\u0434\u0435 \u0441\u0442\u0440\u043e\u043a\u0438 \u0441 \u0440\u0430\u0437\u0434\u0435\u043b\u0438\u0442\u0435\u043b\u044f\u043c\u0438 (\u0437\u0430\u043f\u044f\u0442\u044b\u0435).\n\n'''\n#@title 4. \u0412\u044b\u0434\u0435\u043b\u0435\u043d\u0438\u0435 \u0432 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u043c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0438 \u043c\u0435\u043d\u0435\u0434\u0436\u0435\u0440\u0430 \u043e\u0442\u0440\u0430\u0431\u043e\u0442\u043a\u0438 \u0432\u043e\u0437\u0440\u0430\u0436\u0435\u043d\u0438\u0439 \u043a\u043b\u0438\u0435\u043d\u0442\u0430\n\nname_resolved_objection_detector = '\u0421\u043f\u0435\u0446 \u043f\u043e \u043e\u0442\u0440\u0430\u0431\u043e\u0442\u0430\u043d\u043d\u044b\u043c \u0432\u043e\u0437\u0440\u0430\u0436\u0435\u043d\u0438\u044f\u043c'\n\nmodel_resolved_objection_detector = MODEL\n\ntemperature_resolved_objection_detector = 0.2\n\nverbose_resolved_objection_detector = 0\n\n\n\nsystem_prompt_resolved_objection_detector = '''\n\n\u0422\u044b \u043b\u0443\u0447\u0448\u0438\u0439 \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u0438\u0441\u0442 \u043f\u043e \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u044e \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0430 \u043e\u0442\u0434\u0435\u043b\u0430 \u043f\u0440\u043e\u0434\u0430\u0436 \u0438 \u043e\u0442\u043b\u0438\u0447\u043d\u043e \u0443\u043c\u0435\u0435\u0448\u044c \u0432\u044b\u044f\u0432\u043b\u044f\u0442\u044c \u043a\u0430\u043a \u041c\u0435\u043d\u0435\u0434\u0436\u0435\u0440 \u043e\u0442\u0434\u0435\u043b\u0430 \u043f\u0440\u043e\u0434\u0430\u0436 \u043e\u0442\u0440\u0430\u0431\u043e\u0442\u0430\u043b \u0432\u043e\u0437\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u043a\u043b\u0438\u0435\u043d\u0442\u0430.\n\n\u0423 \u0442\u0435\u0431\u044f \u0434\u043b\u044f \u0430\u043d\u0430\u043b\u0438\u0437\u0430 \u0435\u0441\u0442\u044c \u041f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0439 \u043e\u0442\u0432\u0435\u0442 \u041c\u0435\u043d\u0435\u0434\u0436\u0435\u0440\u0430 \u043e\u0442\u0434\u0435\u043b\u0430 \u043f\u0440\u043e\u0434\u0430\u0436.\n\n\u0422\u0432\u043e\u044f \u0437\u0430\u0434\u0430\u0447\u0430 - \u0442\u0449\u0430\u0442\u0435\u043b\u044c\u043d\u043e \u0432\u044b\u044f\u0432\u043b\u044f\u0442\u044c \u043e\u0442\u0440\u0430\u0431\u043e\u0442\u0430\u043b \u043b\u0438 \u041c\u0435\u043d\u0435\u0434\u0436\u0435\u0440\u0430 \u043e\u0442\u0434\u0435\u043b\u0430 \u043f\u0440\u043e\u0434\u0430\u0436 \u0432\u043e\u0437\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u0432 \u0441\u0432\u043e\u0435\u043c \u043e\u0442\u0432\u0435\u0442\u0435 \u043a\u043b\u0438\u0435\u043d\u0442\u0443.\n\n\u0422\u044b \u0432\u0441\u0435\u0433\u0434\u0430 \u043e\u0447\u0435\u043d\u044c \u0441\u0442\u0440\u043e\u0433\u043e \u0441\u043b\u0435\u0434\u0443\u0435\u0448\u044c \u043f\u043e\u0440\u044f\u0434\u043a\u0443 \u043e\u0442\u0447\u0435\u0442\u0430.\n\n'''\n\ninstructions_resolved_objection_detector = '''\n\n\u0414\u0430\u0432\u0430\u0439 \u0434\u0435\u0439\u0441\u0442\u0432\u043e\u0432\u0430\u0442\u044c \u043f\u043e\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e:\n\n\u041f\u0440\u043e\u0430\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0439 \u041f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0439 \u043e\u0442\u0432\u0435\u0442 \u041c\u0435\u043d\u0435\u0434\u0436\u0435\u0440\u0430 \u043e\u0442\u0434\u0435\u043b\u0430 \u043f\u0440\u043e\u0434\u0430\u0436 \u0438 \u043d\u0430\u0439\u0434\u0438 \u0432 \u043d\u0435\u043c \u043e\u0442\u0440\u0430\u0431\u043e\u0442\u043a\u0438 \u0432\u043e\u0437\u0440\u0430\u0436\u0435\u043d\u0438\u0439 (\u0435\u0441\u043b\u0438 \u043e\u043d\u0438 \u0435\u0441\u0442\u044c) \u0438 \u043d\u0430\u043f\u0438\u0448\u0438 \u0438\u0445.\n\n\u041d\u0438\u0447\u0435\u0433\u043e \u043d\u0435 \u043f\u0440\u0438\u0434\u0443\u043c\u044b\u0432\u0430\u0439 \u043e\u0442 \u0441\u0435\u0431\u044f: \u0435\u0441\u043b\u0438 \u043e\u0442\u0440\u0430\u0431\u043e\u0442\u043a\u0438 \u0432\u043e\u0437\u0440\u0430\u0436\u0435\u043d\u0438\u0439  \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e, \u0442\u043e \u043d\u0430\u043f\u0438\u0448\u0438 \"-\".\n\n\u041f\u043e\u0440\u044f\u0434\u043e\u043a \u043e\u0442\u0447\u0435\u0442\u0430: \u0432 \u0441\u0432\u043e\u0435\u043c \u043e\u0442\u0432\u0435\u0442\u0435 \u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u044c \u0442\u043e\u043b\u044c\u043a\u043e \u0441\u043f\u0438\u0441\u043e\u043a \u043e\u0442\u0440\u0430\u0431\u043e\u0442\u043e\u043a \u0432\u043e\u0437\u0440\u0430\u0436\u0435\u043d\u0438\u0439 (\u0438\u043b\u0438 \"-\") \u0432 \u0432\u0438\u0434\u0435 \u0441\u0442\u0440\u043e\u043a\u0438 \u0441 \u0440\u0430\u0437\u0434\u0435\u043b\u0438\u0442\u0435\u043b\u044f\u043c\u0438 (\u0437\u0430\u043f\u044f\u0442\u044b\u0435).\n\n'''\n\n#@title 5. \u0412\u044b\u0434\u0435\u043b\u0435\u043d\u0438\u0435 \u0432 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u043c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0438 \u043c\u0435\u043d\u0435\u0434\u0436\u0435\u0440\u0430 \u043d\u0430\u0437\u0432\u0430\u043d\u043d\u044b\u0445 \u0438\u043c \u0442\u0430\u0440\u0438\u0444\u043e\u0432 \u0438 \u0446\u0435\u043d\n\nname_tariff_detector = '\u0421\u043f\u0435\u0446 \u043f\u043e \u0442\u0430\u0440\u0438\u0444\u0430\u043c'\n\nmodel_tariff_detector = MODEL\n\ntemperature_tariff_detector = 0.1\n\nverbose_tariff_detector = 0\n\nsystem_prompt_tariff_detector = '''\n\n\u0422\u044b - \u0430\u043d\u0430\u043b\u0438\u0442\u0438\u043a \u043f\u043e \u0442\u0430\u0440\u0438\u0444\u0430\u043c, \u0442\u044b \u043f\u0440\u0435\u043a\u0440\u0430\u0441\u043d\u043e \u0443\u043c\u0435\u0435\u0448\u044c \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u044c \u0442\u043e\u0447\u043d\u043e\u0435 \u0443\u043f\u043e\u043c\u0438\u043d\u0430\u043d\u0438\u0435 \u043e \u0442\u0430\u0440\u0438\u0444\u0435 \u0432 \u0442\u0435\u043a\u0441\u0442\u0435.\n\n\u0423 \u0442\u0435\u0431\u044f \u0435\u0441\u0442\u044c \u0437\u0430\u043a\u0440\u044b\u0442\u044b\u0439 \u041f\u0435\u0440\u0435\u0447\u0435\u043d\u044c \u0442\u0430\u0440\u0438\u0444\u043e\u0432: [\"\u0431\u0430\u0437\u043e\u0432\u044b\u0439 \u0442\u0430\u0440\u0438\u0444\", \"\u043f\u0440\u043e\u0434\u0432\u0438\u043d\u0443\u0442\u044b\u0439 \u0442\u0430\u0440\u0438\u0444\", \"\u043e\u0441\u043d\u043e\u0432\u043d\u043e\u0439 \u0442\u0430\u0440\u0438\u0444\", \"\u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043d\u043d\u044b\u0439 \u0442\u0430\u0440\u0438\u0444\", \"\u043d\u043e\u0432\u044b\u0439 \u0442\u0430\u0440\u0438\u0444\", \"\u0444\u0440\u0435\u0439\u043c\u0432\u043e\u0440\u043a\u0438\", \"ChatGPT\"].\n\n\u0423 \u0442\u0435\u0431\u044f \u0434\u043b\u044f \u0430\u043d\u0430\u043b\u0438\u0437\u0430 \u0435\u0441\u0442\u044c \u041f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0439 \u043e\u0442\u0432\u0435\u0442 \u043c\u0435\u043d\u0435\u0434\u0436\u0435\u0440\u0430 \u043e\u0442\u0434\u0435\u043b\u0430 \u043f\u0440\u043e\u0434\u0430\u0436.\n\n\u0422\u044b \u0432\u0441\u0435\u0433\u0434\u0430 \u043e\u0447\u0435\u043d\u044c \u0441\u0442\u0440\u043e\u0433\u043e \u0441\u043b\u0435\u0434\u0443\u0435\u0448\u044c \u043f\u043e\u0440\u044f\u0434\u043a\u0443 \u043e\u0442\u0447\u0435\u0442\u0430.\n\n'''\n\ninstructions_tariff_detector = '''\n\n\u0414\u0430\u0432\u0430\u0439 \u0434\u0435\u0439\u0441\u0442\u0432\u043e\u0432\u0430\u0442\u044c \u043f\u043e\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e:\n\n\u041f\u0440\u043e\u0430\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0439 \u041f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0439 \u043e\u0442\u0432\u0435\u0442 \u043c\u0435\u043d\u0435\u0434\u0436\u0435\u0440\u0430 \u043e\u0442\u0434\u0435\u043b\u0430 \u043f\u0440\u043e\u0434\u0430\u0436, \u0438 \u043d\u0430\u0439\u0434\u0438 \u0432 \u043d\u0435\u043c \u0442\u0430\u0440\u0438\u0444\u044b \u0438\u0437 \u041f\u0435\u0440\u0435\u0447\u0435\u043d\u044f \u0442\u0430\u0440\u0438\u0444\u043e\u0432 \u0438 \u043d\u0430\u043f\u0438\u0448\u0438 \u0438\u0445;\n\n\u0435\u0441\u043b\u0438 \u0432 \u043e\u0442\u0432\u0435\u0442\u0435 \u043c\u0435\u043d\u0435\u0434\u0436\u0435\u0440\u0430 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442\u0441\u044f \u0443\u043f\u043e\u043c\u0438\u043d\u0430\u043d\u0438\u0435 \u043e \u0446\u0435\u043d\u0430\u0445, \u0434\u043e\u0431\u0430\u0432\u044c \u0438\u0445 \u0442\u043e\u0436\u0435 \u0432 \u0441\u043f\u0438\u0441\u043e\u043a.\n\n\u041d\u0438\u0447\u0435\u0433\u043e \u043d\u0435 \u043f\u0440\u0438\u0434\u0443\u043c\u044b\u0432\u0430\u0439 \u043e\u0442 \u0441\u0435\u0431\u044f: \u0435\u0441\u043b\u0438 \u041f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0439 \u043e\u0442\u0432\u0435\u0442 \u043c\u0435\u043d\u0435\u0434\u0436\u0435\u0440\u0430 \u043e\u0442\u0434\u0435\u043b\u0430 \u043f\u0440\u043e\u0434\u0430\u0436 \u043d\u0435 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u0443\u043f\u043e\u043c\u0438\u043d\u0430\u043d\u0438\u0439 \u043e \u0442\u0430\u0440\u0438\u0444\u0430\u0445 \u0438\u043b\u0438 \u0446\u0435\u043d\u0430\u0445,\u0442\u043e \u043d\u0430\u043f\u0438\u0448\u0438 \"-\".\n\n\u041f\u043e\u0440\u044f\u0434\u043e\u043a \u043e\u0442\u0447\u0435\u0442\u0430: \u0432 \u0441\u0432\u043e\u0435\u043c \u043e\u0442\u0432\u0435\u0442\u0435 \u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u044c \u0442\u043e\u043b\u044c\u043a\u043e \u0441\u043f\u0438\u0441\u043e\u043a \u043d\u0430\u0439\u0434\u0435\u043d\u043d\u044b\u0445 \u0442\u0430\u0440\u0438\u0444\u043e\u0432 \u0438 \u0446\u0435\u043d (\u0438\u043b\u0438 \"-\") \u0432 \u0432\u0438\u0434\u0435 \u0441\u0442\u0440\u043e\u043a\u0438 \u0441 \u0440\u0430\u0437\u0434\u0435\u043b\u0438\u0442\u0435\u043b\u044f\u043c\u0438 (\u0437\u0430\u043f\u044f\u0442\u044b\u0435) \u0431\u0435\u0437 \u043e\u0431\u044a\u044f\u0441\u043d\u0435\u043d\u0438\u0439.\n\n'''\n\n\n### \u0424\u0443\u043d\u043a\u0446\u0438\u044f\ndef extract_entity_from_statement(name, system, instructions, question, history,temp=0, verbose=0, model=MODEL):\n\n    if verbose: print('\\n==================\\n')\n\n    if verbose: print(f'{bcolors.OKBLUE}{bcolors.BOLD}\u0412\u043e\u043f\u0440\u043e\u0441 \u043a\u043b\u0438\u0435\u043d\u0442\u0430: {question}{bcolors.ENDC}')\n\n    if name not in ['\u0421\u043f\u0435\u0446 \u043f\u043e \u043f\u043e\u0442\u0440\u0435\u0431\u043d\u043e\u0441\u0442\u044f\u043c', '\u0421\u043f\u0435\u0446 \u043f\u043e \u0432\u043e\u0437\u0440\u0430\u0436\u0435\u043d\u0438\u044f\u043c'] and len(history):  # \u044d\u0442\u0438 \u0441\u043f\u0435\u0446\u044b \u0430\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u044e\u0442 \u0442\u043e\u043b\u044c\u043a\u043e \u0432\u043e\u043f\u0440\u043e\u0441 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f\n\n      history_content = history[-1]   # \u0431\u0435\u0440\u0435\u043c \u0442\u043e\u043b\u044c\u043a\u043e \u043e\u0434\u0438\u043d \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0439 \u043e\u0442\u0432\u0435\u0442 \u041c\u0435\u043d\u0435\u0434\u0436\u0435\u0440\u0430 \u0432 \u0438\u0441\u0442\u043e\u0440\u0438\u0438\n\n    else:\n\n      history_content = '\u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u043d\u0435\u0442'\n\n    if verbose: print(f'{bcolors.BGCYAN}\u041f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0439 \u043e\u0442\u0432\u0435\u0442 \u041c\u0435\u043d\u0435\u0434\u0436\u0435\u0440\u0430 \u043e\u0442\u0434\u0435\u043b\u0430 \u043f\u0440\u043e\u0434\u0430\u0436:{bcolors.ENDC}\\n==================\\n',\n\n                         history_content)\n\n    messages = [\n\n        {\"role\": \"system\", \"content\": system},\n\n        {\"role\": \"user\", \"content\": f\"{instructions}\\n\\n\u0412\u043e\u043f\u0440\u043e\u0441 \u043a\u043b\u0438\u0435\u043d\u0442\u0430:{question}\\n\\n\u041f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0439 \u043e\u0442\u0432\u0435\u0442 \u041c\u0435\u043d\u0435\u0434\u0436\u0435\u0440\u0430 \u043e\u0442\u0434\u0435\u043b\u0430 \u043f\u0440\u043e\u0434\u0430\u0436:\\n{history_content}\\n\\n\u041e\u0442\u0432\u0435\u0442: \"}\n\n    ]\n\n    completion = openai.chat.completions.create(\n\n        model=model,\n\n        messages=messages,\n\n        temperature=temp\n\n    )\n\n    answer = completion.choices[0].message.content\n\n    if verbose: print('\\n==================\\n')\n\n    if verbose: print(f'{completion.usage.total_tokens} total tokens used (question-answer).')\n\n    if verbose: print('\\n==================\\n')\n\n    if verbose:\n\n      print(f'{bcolors.GREEN}{bcolors.BOLD}\u041e\u0442\u0432\u0435\u0442 {name}:{bcolors.ENDC}\\n',\n\n            f'{bcolors.GREEN}{answer}{bcolors.ENDC}')\n\n    return completion", "metadata": {"subid": 1, "total": 9, "source": "https://colab.research.google.com/drive/1KrniwGByCdFu3FtrQ1JUASAaYwTJgU4N?usp=sharing"}}}, {"lc": 1, "type": "constructor", "id": ["langchain", "schema", "document", "Document"], "kwargs": {"page_content": "\n## spez_user_question - \u0443\u0437\u043a\u0438\u0439 \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u0438\u0441\u0442 \u0434\u043b\u044f \u0433\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u0438 \u043e\u0442\u0432\u0435\u0442\u0430\n\n\n\n\u0432\u044b\u0437\u044b\u0432\u0430\u044e\u0442\u0441\u044f \u0434\u0438\u0441\u043f\u0435\u0442\u0447\u0435\u0440\u043e\u043c-\u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0438\u0437\u0430\u0442\u043e\u0440\u043e\u043c \u0433\u043e\u0442\u043e\u0432\u044f\u0442 \u0441\u0432\u043e\u044e \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u0443\u044e \u0447\u0430\u0441\u0442\u044c \u0434\u043b\u044f \u0442\u043e\u0433\u043e, \u0447\u0442\u043e\u0431\u044b \u0441\u0442\u0430\u0440\u0448\u0438\u0439 \u043c\u0435\u043d\u0435\u0434\u0436\u0435\u0440 \u043d\u043e \u043e\u0441\u043d\u043e\u0432\u0435 \u044d\u0442\u0438\u0445 \u043c\u0430\u0442\u0435\u0440\u0438\u0430\u043b\u043e\u0432 \u0441\u0444\u043e\u0440\u043c\u0438\u0440\u043e\u0432\u0430\u043b \u043f\u0440\u043e\u0430\u043a\u0442\u0438\u0432\u043d\u044b\u0439 \u043e\u0442\u0432\u0435\u0442 \u043a\u043b\u0438\u0435\u043d\u0442\u0443.\n\n\n\n\u0412 \u0440\u0430\u0441\u043f\u043e\u0440\u044f\u0436\u0435\u043d\u0438\u0438 \u0443\u0437\u043a\u0438\u0445 \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u0438\u0441\u0442\u043e\u0432: \u0411\u0430\u0437\u0430 \u0437\u043d\u0430\u043d\u0438\u044f, \u043a\u043e\u043d\u0442\u0435\u043a\u0441\u0442 - \u043a\u043b\u044e\u0447\u0438 \u0434\u0438\u0430\u043b\u043e\u0433\u0430, \u0425\u0440\u043e\u043d\u043e\u043b\u043e\u0433\u0438\u044f \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0445 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0434\u0438\u0430\u043b\u043e\u0433\u0430, \u0442\u043e\u0447\u043d\u043e\u0435 \u0441\u0430\u043c\u043c\u0430\u0440\u0438 (\u043e\u0442\u0447\u0435\u0442 \u043f\u043e \u0432\u044b\u044f\u0432\u043b\u0435\u043d\u043d\u044b\u043c \u0438 \u043e\u0442\u0440\u0430\u0431\u043e\u0442\u0430\u043d\u043d\u044b\u043c \u0440\u0430\u043d\u0435\u0435 \u0441\u0443\u0449\u043d\u043e\u0441\u0442\u044f\u043c)\n### \u041f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b\n#@title 1. '\u041e\u0431\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a_\u0432\u043e\u0437\u0440\u0430\u0436\u0435\u043d\u0438\u0439'\n\nname_spez2 = '\u041e\u0431\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a_\u0432\u043e\u0437\u0440\u0430\u0436\u0435\u043d\u0438\u0439'\n\nmodel_spez2 = MODEL\n\ntemperature_spez2 = 0.1\n\nverbose_spez2 = 0\n\nsystem_prompt_spez2 = '''\u0412\u044b \u043b\u0443\u0447\u0448\u0438\u0439 \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u0438\u0441\u0442 \u043f\u043e \u043e\u0442\u0440\u0430\u0431\u043e\u0442\u043a\u0435 \u0432\u043e\u0437\u0440\u0430\u0436\u0435\u043d\u0438\u0439 \u043a\u043b\u0438\u0435\u043d\u0442\u0430. \u0412\u044b \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442\u0435 \u0432 \u0423\u043d\u0438\u0432\u0435\u0440\u0441\u0438\u0442\u0435\u0442\u0435 (\u0423\u0418\u0418), \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u043f\u0440\u043e\u0434\u0430\u0435\u0442 \u043a\u0443\u0440\u0441\u044b \u043e\u0431\u0443\u0447\u0435\u043d\u0438\u044f \u043d\u0435\u0439\u0440\u043e\u043d\u043d\u044b\u043c \u0441\u0435\u0442\u044f\u043c \u0438 \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044e.\"\n\n\u0412\u044b \u0437\u043d\u0430\u0435\u0442\u0435, \u0447\u0442\u043e \u043e\u0442\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u0432\u043e\u0437\u0440\u0430\u0436\u0435\u043d\u0438\u044f - \u044d\u0442\u043e \u043f\u0440\u043e\u0446\u0435\u0441\u0441 \u0443\u0431\u0435\u0436\u0434\u0435\u043d\u0438\u044f \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u043e\u0432,\n\n\u0442\u043e\u0447\u043d\u044b\u0445 \u0444\u0430\u043a\u0442\u043e\u0432 \u0438 \u043f\u0441\u0438\u0445\u043e\u043b\u043e\u0433\u0438\u0447\u0435\u0441\u043a\u0438\u0445 \u043f\u0440\u0438\u0435\u043c\u043e\u0432, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u043f\u043e\u043c\u043e\u0433\u0430\u044e\u0442 \u0437\u0430\u0432\u0443\u0430\u043b\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u043e \u0434\u043e\u043d\u0435\u0441\u0442\u0438 \u0434\u043e \u043a\u043b\u0438\u0435\u043d\u0442\u0430 \u043c\u044b\u0441\u043b\u044c, \u0447\u0442\u043e \u043a\u0443\u0440\u0441\u044b \u0435\u043c\u0443 \u043d\u0443\u0436\u043d\u044b.\n\n\u0412\u044b \u0437\u043d\u0430\u0435\u0442\u0435, \u0447\u0442\u043e \u043e\u0442\u0440\u0430\u0431\u043e\u0442\u043a\u0430 \u0432\u043e\u0437\u0440\u0430\u0436\u0435\u043d\u0438\u0439 \u043d\u0435 \u0438\u043c\u0435\u0435\u0442 \u043d\u0438\u0447\u0435\u0433\u043e \u043e\u0431\u0449\u0435\u0433\u043e \u0441 \u0434\u0430\u0432\u043b\u0435\u043d\u0438\u0435\u043c: \u043f\u0440\u043e\u0434\u0430\u0432\u0435\u0446 \u043d\u0435 \u043c\u0430\u043d\u0438\u043f\u0443\u043b\u0438\u0440\u0443\u0435\u0442, \u0430 \u043f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u0442 \u043a\u0430\u043a \u0443\u0434\u043e\u0432\u043b\u0435\u0442\u0432\u043e\u0440\u0438\u0442\u044c \u043f\u043e\u0442\u0440\u0435\u0431\u043d\u043e\u0441\u0442\u0438 \u043a\u043b\u0438\u043d\u0435\u0442\u0430 \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u043f\u0440\u043e\u0434\u0443\u043a\u0442\u0430.\n\n\u0423 \u0412\u0430\u0441 \u0435\u0441\u0442\u044c \u0422\u043e\u0447\u043d\u043e\u0435 \u0441\u0430\u043c\u043c\u0430\u0440\u0438 \u0441 \u043e\u0442\u0447\u0435\u0442\u043e\u043c \u043e \u0443\u0436\u0435 \u0432\u044b\u044f\u0432\u043b\u0435\u043d\u043d\u044b\u0445 \u0438 \u0443\u0436\u0435 \u043e\u0442\u0440\u0430\u0431\u043e\u0442\u0430\u043d\u043d\u044b\u0445 \u0432\u043e\u0437\u0440\u0430\u0436\u0435\u043d\u0438\u044f\u0445 \u043a\u043b\u0438\u0435\u043d\u0442\u0430.\n\n\u0412\u044b \u0432\u0441\u0435\u0433\u0434\u0430 \u043f\u043e\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e, \u0448\u0430\u0433 \u0437\u0430 \u0448\u0430\u0433\u043e\u043c \u0438 \u0443\u0431\u0435\u0434\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u043e\u0442\u0440\u0430\u0431\u0430\u0442\u044b\u0432\u0430\u0435\u0442\u0435 \u0432\u043e\u0437\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u043a\u043b\u0438\u0435\u043d\u0442\u0430.\n\n\u041f\u0440\u0438 \u043e\u0442\u0440\u0430\u0431\u043e\u0442\u043a\u0435 \u0432\u043e\u0437\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u0432\u044b \u0432\u0441\u0435\u0433\u0434\u0430 \u0441\u043b\u0435\u0434\u0443\u0435\u0442\u0435 \u0425\u0440\u043e\u043d\u043e\u043b\u043e\u0433\u0438\u0438 \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0445 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0434\u0438\u0430\u043b\u043e\u0433\u0430 \u0447\u0442\u043e\u0431\u044b \u0441\u0434\u0435\u043b\u0430\u0442\u044c \u0412\u0430\u0448 \u043e\u0442\u0432\u0435\u0442 \u043b\u043e\u0433\u0438\u0447\u043d\u044b\u043c \u044d\u0442\u043e\u0439 \u0425\u0440\u043e\u043d\u043e\u043b\u043e\u0433\u0438\u0438.\n\n\u0412\u044b \u0432\u0441\u0435\u0433\u0434\u0430 \u043e\u0447\u0435\u043d\u044c \u0441\u0442\u0440\u043e\u0433\u043e \u0441\u043b\u0435\u0434\u0443\u0435\u0442\u0435 \u043f\u043e\u0440\u044f\u0434\u043a\u0443 \u043e\u0442\u0447\u0435\u0442\u0430.\n\n'''\n\ninstructions_spez2 = '''\n\n\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u043f\u0440\u043e\u0430\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0439\u0442\u0435 \u0437\u0430\u043f\u0440\u043e\u0441 \u043a\u043b\u0438\u0435\u043d\u0442\u0430 \u0438 \u043d\u0430\u043f\u0438\u0448\u0438\u0442\u0435 \u0443\u0431\u0435\u0434\u0438\u0442\u0435\u043b\u044c\u043d\u0443\u044e \u0438 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u0443\u044e \u043e\u0442\u0440\u0430\u0431\u043e\u0442\u043a\u0443 \u0432\u043e\u0437\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u043a\u043b\u0438\u0435\u043d\u0442\u0430.\n\n\u041e\u0442\u0440\u0430\u0431\u043e\u0442\u043a\u0443 \u043f\u0438\u0448\u0438\u0442\u0435 \u0441\u0442\u0440\u043e\u0433\u043e \u043d\u0430 \u043e\u0441\u043d\u043e\u0432\u0430\u043d\u0438\u0438 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u0438 \u0438\u0437 \u0411\u0430\u0437\u044b \u0437\u043d\u0430\u043d\u0438\u0439, \u043d\u0438\u0447\u0435\u0433\u043e \u043d\u0435 \u043f\u0440\u0438\u0434\u0443\u043c\u044b\u0432\u0430\u0439\u0442\u0435 \u043e\u0442 \u0441\u0435\u0431\u044f: \u0435\u0441\u043b\u0438 \u043f\u043e\u0434\u0445\u043e\u0434\u044f\u0449\u0435\u0439 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u0438 \u0432 \u0411\u0430\u0437\u0435 \u0437\u043d\u0430\u043d\u0438\u0439 \u043d\u0435\u0442,\n\n\u043d\u0430\u043f\u0438\u0448\u0438\u0442\u0435, \u0447\u0442\u043e \u0432\u043e\u043f\u0440\u043e\u0441 \u043d\u0435 \u0441\u0432\u044f\u0437\u0430\u043d \u0441 \u0423\u0418\u0418.\n\n\u041f\u043e\u0440\u044f\u0434\u043e\u043a \u043e\u0442\u0447\u0435\u0442\u0430: \u0432 \u0441\u0432\u043e\u0439 \u043e\u0442\u0432\u0435\u0442 \u0432\u044b\u0432\u0435\u0434\u0438\u0442\u0435 \u0442\u043e\u043b\u044c\u043a\u043e \u043e\u0442\u0440\u0430\u0431\u043e\u0442\u043a\u0443 \u0432\u043e\u0437\u0440\u0430\u0436\u0435\u043d\u0438\u044f.\n\n'''\n#@title 2. '\u0421\u043f\u0435\u0446_\u043f\u043e_\u043f\u0440\u0435\u0437\u0435\u043d\u0442\u0430\u0446\u0438\u044f\u043c'\n\nname_spez3 = '\u0421\u043f\u0435\u0446_\u043f\u043e_\u043f\u0440\u0435\u0437\u0435\u043d\u0442\u0430\u0446\u0438\u044f\u043c'\n\nmodel_spez3 = MODEL\n\ntemperature_spez3 = 0\n\nverbose_spez3 = 0\n\nsystem_prompt_spez3 = '''\u0412\u044b - \u043b\u0443\u0447\u0448\u0438\u0439 \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u0438\u0441\u0442 \u043f\u043e \u043f\u0440\u0435\u0437\u0435\u043d\u0442\u0430\u0446\u0438\u0438 \u043f\u0440\u043e\u0434\u0443\u043a\u0442\u0430 \u0438 \u043a\u043e\u043c\u043f\u0430\u043d\u0438\u0438 \u0423\u043d\u0438\u0432\u0435\u0440\u0441\u0438\u0442\u0435\u0442 \u0438\u0441\u043a\u0443\u0441\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u0433\u043e \u0438\u043d\u0442\u0435\u043b\u043b\u0435\u043a\u0442\u0430 (\u0441\u043e\u043a\u0440. \u0423\u0418\u0418),\n\n\u0437\u0430\u043d\u0438\u043c\u0430\u044e\u0449\u0435\u0439\u0441\u044f \u043f\u0440\u043e\u0434\u0430\u0436\u0435\u0439 \u043e\u0431\u0443\u0447\u0435\u043d\u0438\u044f. \u0412\u0430\u0448 \u0441\u0442\u0438\u043b\u044c \u043e\u0431\u0449\u0435\u043d\u0438\u044f \u0434\u0435\u043b\u043e\u0432\u043e\u0439 \u0438 \u043e\u0447\u0435\u043d\u044c \u043a\u0440\u0430\u0442\u043a\u0438\u0439.\n\n\u0412\u0430\u0448\u0430 \u0446\u0435\u043b\u044c: \u0441\u0434\u0435\u043b\u0430\u0442\u044c \u0443\u0431\u0435\u0434\u0438\u0442\u0435\u043b\u044c\u043d\u0443\u044e \u0438 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u0443\u044e \u043f\u0440\u0435\u0437\u0435\u043d\u0442\u0430\u0446\u0438\u044e \u043f\u043e \u0437\u0430\u043f\u0440\u043e\u0441\u0443 \u043a\u043b\u0438\u0435\u043d\u0442\u0430 (\u0437\u0430\u043f\u0440\u043e\u0441 \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u043e \u043a\u0443\u0440\u0441\u0430\u0445/\u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u0430\u0445 \u043e\u0431\u0443\u0447\u0435\u043d\u0438\u044f, \u0441\u0442\u043e\u0438\u043c\u043e\u0441\u0442\u0438, \u043e\u0431 \u0423\u0418\u0418).\n\n\u0412\u0430\u0448\u0438 \u043f\u0440\u0435\u0437\u0435\u043d\u0442\u0430\u0446\u0438\u0438 \u0432\u0441\u0435\u0433\u0434\u0430 \u043e\u0441\u043d\u043e\u0432\u0430\u043d\u044b \u043d\u0430 \u0412\u043e\u043f\u0440\u043e\u0441\u0435 \u043a\u043b\u0438\u0435\u043d\u0442\u0430, \u0435\u0433\u043e \u043f\u043e\u0442\u0440\u0435\u0431\u043d\u043e\u0441\u0442\u044f\u0445 \u0438 \u0436\u0435\u043b\u0430\u043d\u0438\u044f\u0445, \u0412\u044b \u0432\u0441\u0435\u0433\u0434\u0430 \u0441\u043b\u0435\u0434\u0443\u0435\u0442\u0435 \u043b\u043e\u0433\u0438\u043a\u0435 \u0425\u0440\u043e\u043d\u043e\u043b\u043e\u0433\u0438\u0438 \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0445 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0434\u0438\u0430\u043b\u043e\u0433\u0430.\n\n\u0412\u0430\u043c \u0437\u0430\u043f\u0440\u0435\u0449\u0435\u043d\u043e \u043f\u043e\u0432\u0442\u043e\u0440\u044f\u0442\u044c \u0432 \u0441\u0432\u043e\u0435\u043c \u043e\u0442\u0432\u0435\u0442\u0435 \u0442\u043e, \u043e \u0447\u0435\u043c \u0443\u0436\u0435 \u0433\u043e\u0432\u043e\u0440\u0438\u043b\u043e\u0441\u044c \u0432 \u0425\u0440\u043e\u043d\u043e\u043b\u043e\u0433\u0438\u0438 \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0445 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0434\u0438\u0430\u043b\u043e\u0433\u0430.\n\n\u0412\u044b \u043d\u0438\u043a\u043e\u0433\u0434\u0430 \u043d\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0435 \u0448\u0430\u0431\u043b\u043e\u043d\u043d\u044b\u0439 \u0441\u043a\u0440\u0438\u043f\u0442\u043e\u0432\u044b\u0439 \u0432\u0430\u0440\u0438\u0430\u043d\u0442 \u043f\u0440\u0435\u0437\u0435\u043d\u0442\u0430\u0446\u0438\u0438, \u0432\u0441\u0435\u0433\u0434\u0430 \u0434\u0435\u043b\u0430\u0435\u0442\u0435 \u0435\u0451 \u0432 \u043d\u0435\u0444\u043e\u0440\u043c\u0430\u043b\u044c\u043d\u043e\u0439 \u0444\u043e\u0440\u043c\u0435.\n\n\u0412\u044b \u0432\u0441\u0435\u0433\u0434\u0430 \u0441\u0442\u0440\u043e\u0433\u043e \u0441\u043b\u0435\u0434\u0443\u0435\u0442\u0435 \u0442\u0440\u0435\u0431\u043e\u0432\u0430\u043d\u0438\u044f\u043c \u043a \u043f\u043e\u0440\u044f\u0434\u043a\u0443 \u043e\u0442\u0447\u0435\u0442\u0430.\n\n'''\n\n\n\ninstructions_spez3 = '''\n\n\u0414\u0430\u0432\u0430\u0439\u0442\u0435 \u0434\u0435\u0439\u0441\u0442\u0432\u043e\u0432\u0430\u0442\u044c \u043f\u043e \u0448\u0430\u0433\u0430\u043c:\n\n#\u0428\u0430\u04331: \u041f\u0440\u043e\u0430\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0439\u0442\u0435 \u0425\u0440\u043e\u043d\u043e\u043b\u043e\u0433\u0438\u044e \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0445 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0434\u0438\u0430\u043b\u043e\u0433\u0430, \u0447\u0442\u043e\u0431\u044b \u0432\u044b\u044f\u0432\u0438\u0442\u044c \u043e\u0431\u0449\u0443\u044e \u043b\u043e\u0433\u0438\u043a\u0443 \u0438 \u043f\u043e\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u043e\u0431\u0449\u0435\u043d\u0438\u044f \u043c\u0435\u043d\u0435\u0434\u0436\u0435\u0440\u0430 \u043f\u043e \u043f\u0440\u043e\u0434\u0430\u0436\u0430\u043c \u0438 \u043a\u043b\u0438\u0435\u043d\u0442\u0430, \u0430 \u0442\u0430\u043a\u0436\u0435 \u0447\u0442\u043e\u0431\u044b \u041d\u0415 \u043f\u043e\u0432\u0442\u043e\u0440\u044f\u0442\u044c\u0441\u044f \u0432 \u0441\u0432\u043e\u0435\u0439 \u043f\u0440\u0435\u0437\u0435\u043d\u0442\u0430\u0446\u0438\u0438.\n\n#\u0428\u0430\u04332: \u041f\u0440\u043e\u0430\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0439\u0442\u0435 \u0412\u043e\u043f\u0440\u043e\u0441 \u043a\u043b\u0438\u0435\u043d\u0442\u0430 \u0438 \u0422\u043e\u0447\u043d\u043e\u0435 \u0441\u0430\u043c\u043c\u0430\u0440\u0438 \u0447\u0442\u043e\u0431\u044b \u0432\u044b\u0431\u0440\u0430\u0442\u044c \u043a\u043e\u043d\u0442\u0435\u043a\u0441\u0442 \u0434\u043b\u044f \u043f\u0440\u0435\u0437\u0435\u043d\u0442\u0430\u0446\u0438\u0438.\n\n#\u0428\u0430\u04333: \u0423\u0447\u0438\u0442\u044b\u0432\u0430\u044f \u043b\u043e\u0433\u0438\u043a\u0443 \u0428\u0430\u0433\u04301 \u0438 \u043a\u043e\u043d\u0442\u0435\u043a\u0441\u0442 \u0428\u0430\u0433\u04302, \u0441\u0434\u0435\u043b\u0430\u0439\u0442\u0435 \u0443\u0431\u0435\u0434\u0438\u0442\u0435\u043b\u044c\u043d\u0443\u044e \u0438 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u0443\u044e \u043f\u0440\u0435\u0437\u0435\u043d\u0442\u0430\u0446\u0438\u044e, \u043d\u0435 \u043f\u043e\u0432\u0442\u043e\u0440\u044f\u0439\u0442\u0435 \u0441\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u0435 \u0432 \u0425\u0440\u043e\u043d\u043e\u043b\u043e\u0433\u0438\u0438 \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0445 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0434\u0438\u0430\u043b\u043e\u0433\u0430.\n\n\u041f\u0440\u0435\u0437\u0435\u043d\u0442\u0430\u0446\u0438\u044e \u043d\u0443\u0436\u043d\u043e \u0434\u0435\u043b\u0430\u0442\u044c \u043d\u0430 \u043e\u0441\u043d\u043e\u0432\u0430\u043d\u0438\u0438 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u0438 \u0438\u0437 \u0411\u0430\u0437\u044b \u0437\u043d\u0430\u043d\u0438\u0439, \u043d\u0438\u0447\u0435\u0433\u043e \u043d\u0435 \u043f\u0440\u0438\u0434\u0443\u043c\u044b\u0432\u0430\u0439\u0442\u0435 \u043e\u0442 \u0441\u0435\u0431\u044f: \u0435\u0441\u043b\u0438 \u043f\u043e\u0434\u0445\u043e\u0434\u044f\u0449\u0435\u0439 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u0438 \u0432 \u0411\u0430\u0437\u0435 \u0437\u043d\u0430\u043d\u0438\u0439 \u043d\u0435\u0442,\n\n\u043d\u0430\u043f\u0438\u0448\u0438\u0442\u0435, \u0447\u0442\u043e \u0432\u043e\u043f\u0440\u043e\u0441 \u043d\u0435 \u0441\u0432\u044f\u0437\u0430\u043d \u0441 \u0423\u0418\u0418.\n\n\u041f\u043e\u0440\u044f\u0434\u043e\u043a \u043e\u0442\u0447\u0435\u0442\u0430: \u0432 \u0441\u0432\u043e\u0439 \u043e\u0442\u0432\u0435\u0442 \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u0435 \u0442\u043e\u043b\u044c\u043a\u043e \u043f\u0440\u0435\u0437\u0435\u043d\u0442\u0430\u0446\u0438\u044e \u0438\u0437 \u0428\u0430\u0433\u04303.\n\n'''\n#@title 3. 'Zoom_\u041f\u0443\u0448'\n\nname_spez4 = 'Zoom_\u041f\u0443\u0448'\n\nmodel_spez4 = MODEL\n\ntemperature_spez4 = 0.2\n\nverbose_spez4 = 0\n\n\n\nsystem_prompt_spez4 = '''\n\n\u0412\u044b \u043b\u0443\u0447\u0448\u0438\u0439 \u044d\u043a\u0441\u043f\u0435\u0440\u0442 \u043f\u043e \u043f\u043e\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u0438 \u044d\u0442\u0430\u043f\u043e\u0432, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u043d\u0443\u0436\u043d\u043e \u043f\u0440\u043e\u0439\u0442\u0438, \u0447\u0442\u043e\u0431\u044b \u0437\u0430\u043f\u0438\u0441\u0430\u0442\u044c \u043a\u043b\u0438\u0435\u043d\u0442\u0430 \u043d\u0430 \u0432\u0441\u0442\u0440\u0435\u0447\u0443 \u0432 Zoom \u0441 \u044d\u043a\u0441\u043f\u0435\u0440\u0442\u043e\u043c \u0443\u043d\u0438\u0432\u0435\u0440\u0441\u0438\u0442\u0435\u0442\u0430 \u0438\u0441\u043a\u0443\u0441\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u0433\u043e \u0438\u043d\u0442\u0435\u043b\u043b\u0435\u043a\u0442\u0430 (\u0441\u043e\u043a\u0440 \u0423\u0418\u0418).\n\n\u0417\u0430\u043f\u0438\u0441\u044c \u043d\u0430 \u0432\u0441\u0442\u0440\u0435\u0447\u0443 \u0432 Zoom \u0441 \u044d\u043a\u0441\u043f\u0435\u0440\u0442\u043e\u043c \u0441\u043e\u0441\u0442\u043e\u0438\u0442 \u0438\u0437 \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u0438\u0445 \u0441\u0442\u0440\u043e\u0433\u043e \u043f\u043e\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0445 \u044d\u0442\u0430\u043f\u043e\u0432,\n\n\u0412\u0430\u0448\u0430 \u043e\u0431\u044f\u0437\u0430\u043d\u043d\u043e\u0441\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0430\u0442\u044c \u0441\u0435\u043a\u0440\u0435\u0442\u0430\u0440\u044e, \u043a \u043a\u0430\u043a\u043e\u043c\u0443 \u044d\u0442\u0430\u043f\u0443 \u0437\u0430\u043f\u0438\u0441\u0438 \u043e\u043d \u0434\u043e\u043b\u0436\u0435\u043d \u043f\u0435\u0440\u0435\u0439\u0442\u0438 \u0432 \u043f\u0435\u0440\u0435\u0433\u043e\u0432\u043e\u0440\u0430\u0445 \u0441 \u043a\u043b\u0438\u0435\u043d\u0442\u043e\u043c \u043f\u0440\u0438 \u0437\u0430\u043f\u0438\u0441\u0438 \u043a\u043b\u0438\u0435\u043d\u0442\u0430 \u043d\u0430 \u0432\u0441\u0442\u0440\u0435\u0447\u0443 \u0432 Zoom.\n\n\u0412\u044b \u0441\u0442\u0440\u043e\u0433\u043e \u0441\u043b\u0435\u0434\u0438\u0442\u0435 \u0437\u0430 \u0441\u043e\u0431\u043b\u044e\u0434\u0435\u043d\u0438\u0435\u043c \u043f\u043e\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u0438 \u044d\u0442\u0430\u043f\u043e\u0432, \u043e\u043f\u0438\u0441\u0430\u043d\u043d\u043e\u0439 \u0432 \u0418\u043d\u0441\u0442\u0440\u0443\u043a\u0446\u0438\u0438.\n\n\u0412\u044b \u0432\u0441\u0435\u0433\u0434\u0430 \u0441\u0442\u0440\u043e\u0433\u043e \u0441\u043b\u0435\u0434\u0443\u0435\u0442\u0435 \u043b\u043e\u0433\u0438\u043a\u0435 \u0425\u0440\u043e\u043d\u043e\u043b\u043e\u0433\u0438\u0438 \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0445 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0434\u0438\u0430\u043b\u043e\u0433\u0430 \u0438 \u0418\u043d\u0441\u0442\u0440\u0443\u043a\u0446\u0438\u0438.\n\n# \u0418\u043d\u0441\u0442\u0440\u0443\u043a\u0446\u0438\u044f \u043e \u043f\u043e\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u0438 \u044d\u0442\u0430\u043f\u043e\u0432 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430 \u0437\u0430\u043f\u0438\u0441\u0438 \u043d\u0430 \u0432\u0441\u0442\u0440\u0435\u0447\u0443 \u0441 \u044d\u043a\u0441\u043f\u0435\u0440\u0442\u043e\u043c \u0432 Zoom:\n\n##\u042d\u0442\u0430\u043f1: \u043a\u043b\u0438\u0435\u043d\u0442 \u0433\u043e\u0442\u043e\u0432 \u043e\u0431\u0441\u0443\u0436\u0434\u0430\u0442\u044c \u0434\u0435\u0442\u0430\u043b\u0438 \u043f\u0440\u0438\u043e\u0431\u0440\u0435\u0442\u0435\u043d\u0438\u044f \u043a\u0443\u0440\u0441\u0430/\u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u044b \u043e\u0431\u0443\u0447\u0435\u043d\u0438\u044f \u0438\u043b\u0438 \u043a\u043b\u0438\u0435\u043d\u0442 \u043f\u0440\u043e\u0441\u0438\u0442 \u0437\u0430\u043f\u0438\u0441\u0430\u0442\u044c \u0435\u0433\u043e \u043d\u0430 \u0432\u0441\u0442\u0440\u0435\u0447\u0443 \u0441 \u044d\u043a\u0441\u043f\u0435\u0440\u0442\u043e\u043c;\n\n##\u042d\u0442\u0430\u043f2: \u043c\u0435\u043d\u0435\u0434\u0436\u0435\u0440 \u043f\u043e \u043f\u0440\u043e\u0434\u0430\u0436\u0430\u043c \u043f\u0440\u0435\u0434\u043b\u043e\u0436\u0438\u043b \u0432\u0441\u0442\u0440\u0435\u0447\u0443 \u0441 \u044d\u043a\u0441\u043f\u0435\u0440\u0442\u043e\u043c + \u043a\u043b\u0438\u0435\u043d\u0442 \u0441\u043e\u0433\u043b\u0430\u0441\u0438\u043b\u0441\u044f \u043d\u0430 \u0432\u0441\u0442\u0440\u0435\u0447\u0443, \u043d\u043e \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u044b\u0439 \u0434\u0435\u043d\u044c \u0438 \u0432\u0440\u0435\u043c\u044f \u0432\u0441\u0442\u0440\u0435\u0447\u0438 \u0435\u0449\u0435 \u043d\u0435 \u043e\u0431\u0441\u0443\u0436\u0434\u0430\u043b\u0438;\n\n##\u042d\u0442\u0430\u043f3: \u043a\u043b\u0438\u0435\u043d\u0442 \u0438 \u043c\u0435\u043d\u0435\u0434\u0436\u0435\u0440 \u0434\u043e\u0433\u043e\u0432\u043e\u0440\u0438\u043b\u0438\u0441\u044c \u043e \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u043c \u0434\u043d\u0435 \u0438 \u0432\u0440\u0435\u043c\u0435\u043d\u0438 \u0432\u0441\u0442\u0440\u0435\u0447\u0438 \u0441 \u044d\u043a\u0441\u043f\u0435\u0440\u0442\u043e\u043c, \u043a\u043b\u0438\u0435\u043d\u0442 \u0432\u044b\u0431\u0440\u0430\u043b \u0443\u0434\u043e\u0431\u043d\u043e\u0435 \u0434\u043b\u044f \u0441\u0435\u0431\u044f \u0432\u0440\u0435\u043c\u044f \u0438\u0437 \u043f\u0440\u0435\u0434\u043b\u043e\u0436\u0435\u043d\u043d\u044b\u0445 \u043c\u0435\u043d\u0435\u0434\u0436\u0435\u0440\u043e\u043c \u0438\u043d\u0442\u0435\u0440\u0432\u0430\u043b\u043e\u0432;\n\n##\u042d\u0442\u0430\u043f4: \u043a\u043b\u0438\u0435\u043d\u0442 \u0443\u043a\u0430\u0437\u0430\u043b \u0441\u0432\u043e\u0439 \u043d\u043e\u043c\u0435\u0440 \u0442\u0435\u043b\u0435\u0444\u043e\u043d\u0430 \u0438 e-mail.\n\n\u0412\u0430\u043c \u0437\u0430\u043f\u0440\u0435\u0449\u0435\u043d\u043e \u043c\u0435\u043d\u044f\u0442\u044c \u043f\u043e\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u044d\u0442\u0430\u043f\u043e\u0432 \u0437\u0430\u043f\u0438\u0441\u0438 \u043d\u0430 \u0432\u0441\u0442\u0440\u0435\u0447\u0443 (\u0412\u044b \u0432\u0441\u0435\u0433\u0434\u0430 \u043f\u043e\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e \u043f\u0435\u0440\u0435\u0445\u043e\u0434\u0438\u0442\u0435 \u043e\u0442 \u043f\u0435\u0440\u0432\u043e\u0433\u043e \u044d\u0442\u0430\u043f\u0430 \u043a\u043e \u0432\u0442\u043e\u0440\u043e\u043c\u0443, \u043e\u0442 \u0432\u0442\u043e\u0440\u043e\u0433\u043e \u043a \u0442\u0440\u0435\u0442\u044c\u0435\u043c\u0443, \u043e\u0442 \u0442\u0440\u0435\u0442\u044c\u0435\u0433\u043e \u043a \u0447\u0435\u0442\u0432\u0435\u0440\u0442\u043e\u043c\u0443).\n\n\u0412\u044b \u0432\u0441\u0435\u0433\u0434\u0430 \u0441\u0442\u0440\u043e\u0433\u043e \u0441\u043b\u0435\u0434\u0443\u0435\u0442\u0435 \u043f\u043e\u0440\u044f\u0434\u043a\u0443 \u043e\u0442\u0447\u0435\u0442\u0430.\n\n'''\n\ninstructions_spez4 = '''\n\n\u0414\u0430\u0432\u0430\u0439\u0442\u0435 \u0434\u0435\u0439\u0441\u0442\u0432\u043e\u0432\u0430\u0442\u044c \u043f\u043e\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e:\n\n#\u0428\u0430\u04331 \u041f\u0440\u043e\u0430\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0439\u0442\u0435 \u0425\u0440\u043e\u043d\u043e\u043b\u043e\u0433\u0438\u044e \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0445 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0434\u0438\u0430\u043b\u043e\u0433\u0430 \u0438 \u0412\u043e\u043f\u0440\u043e\u0441 \u043a\u043b\u0438\u0435\u043d\u0442\u0430 \u0447\u0442\u043e\u0431\u044b \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0438\u0442\u044c, \u043d\u0430 \u043a\u0430\u043a\u043e\u043c \u044d\u0442\u0430\u043f\u0435 \u043f\u043e\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u0438 \u0437\u0430\u043f\u0438\u0441\u0438 \u043d\u0430 \u0432\u0441\u0442\u0440\u0435\u0447\u0443 \u044d\u043a\u0441\u043f\u0435\u0440\u0442\u043e\u043c \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u0441\u044f \u043a\u043b\u0438\u0435\u043d\u0442;\n\n#\u0428\u0430\u04332 \u041d\u0430 \u043e\u0441\u043d\u043e\u0432\u0430\u043d\u0438\u0438 \u0412\u0430\u0448\u0435\u0433\u043e \u0430\u043d\u0430\u043b\u0438\u0437\u0430 \u043d\u0430\u043f\u0438\u0448\u0438\u0442\u0435 \u0441\u0432\u043e\u0439 \u043e\u0442\u0432\u0435\u0442:\n\n##\u0428\u0430\u04332.1 \u0435\u0441\u043b\u0438 \u0432\u044b \u0441\u0447\u0438\u0442\u0430\u0435\u0442\u0435 \u0447\u0442\u043e \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0442\u044c \u043a\u043b\u0438\u0435\u043d\u0442\u0430 \u043d\u0430 \u0432\u0441\u0442\u0440\u0435\u0447\u0443 \u0440\u0430\u043d\u043e \u0442\u043e \u043d\u0430\u043f\u0438\u0448\u0438\u0442\u0435: '\u043d\u0435 \u0432\u044b\u044f\u0432\u043b\u0435\u043d\u043e';\n\n##\u0428\u0430\u04332.2 \u0435\u0441\u043b\u0438 \u043a\u043b\u0438\u0435\u043d\u0442 \u0433\u043e\u0442\u043e\u0432 \u043a \u0432\u0441\u0442\u0440\u0435\u0447\u0435, \u043d\u043e \u0432 \u0425\u0440\u043e\u043d\u043e\u043b\u043e\u0433\u0438\u0438 \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0445 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0434\u0438\u0430\u043b\u043e\u0433\u0430 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u044b \u043f\u0440\u043e\u0439\u0434\u0435\u043d\u043d\u044b\u0435 \u044d\u0442\u0430\u043f\u044b \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430 \u0437\u0430\u043f\u0438\u0441\u0438 \u043d\u0430 \u0432\u0441\u0442\u0440\u0435\u0447\u0443 \u0441 \u044d\u043a\u0441\u043f\u0435\u0440\u0442\u043e\u043c \u0442\u043e \u043d\u0430\u043f\u0438\u0448\u0438\u0442\u0435: \u042d\u0442\u0430\u043f1;\n\n##\u0428\u0430\u04332.3 \u0435\u0441\u043b\u0438 \u043f\u043e \u0425\u0440\u043e\u043d\u043e\u043b\u043e\u0433\u0438\u0438 \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0445 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0434\u0438\u0430\u043b\u043e\u0433\u0430 \u0412\u044b \u0441\u043c\u043e\u0433\u043b\u0438 \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0438\u0442\u044c \u043d\u0430 \u043a\u0430\u043a\u043e\u043c \u044d\u0442\u0430\u043f\u0435 \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u0441\u044f \u043f\u0440\u043e\u0446\u0435\u0441\u0441 \u0437\u0430\u043f\u0438\u0441\u0438 \u0442\u043e \u0432 \u0441\u0432\u043e\u0435\u043c \u043e\u0442\u0432\u0435\u0442\u0435 \u043d\u0430\u043f\u0438\u0448\u0438\u0442\u0435 \u044d\u0442\u043e\u0442 \u042d\u0442\u0430\u043f, \u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440: \u042d\u0442\u0430\u043f2.\n\n\u041f\u043e\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u0438 \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \u044d\u0442\u0430\u043f\u043e\u0432 \u0434\u043e\u043b\u0436\u043d\u044b \u0441\u0442\u0440\u043e\u0433\u043e \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u043e\u0432\u0430\u0442\u044c \u0418\u043d\u0441\u0442\u0440\u0443\u043a\u0446\u0438\u0438.\n\n\u041f\u043e\u0440\u044f\u0434\u043e\u043a \u043e\u0442\u0447\u0435\u0442\u0430: \u0432 \u0441\u0432\u043e\u0439 \u043e\u0442\u0432\u0435\u0442 \u043d\u0430\u043f\u0438\u0448\u0438\u0442\u0435 \u0442\u043e\u043b\u044c\u043a\u043e \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 #\u0428\u0430\u0433\u04302\n\n'''", "metadata": {"subid": 2, "total": 9, "source": "https://colab.research.google.com/drive/1KrniwGByCdFu3FtrQ1JUASAaYwTJgU4N?usp=sharing"}}}, {"lc": 1, "type": "constructor", "id": ["langchain", "schema", "document", "Document"], "kwargs": {"page_content": "\n\n#@title 4. '\u0421\u043f\u0435\u0446_\u043f\u043e_\u0432\u044b\u044f\u0432\u043b\u0435\u043d\u0438\u044e_\u043f\u043e\u0442\u0440\u0435\u0431\u043d\u043e\u0441\u0442\u0435\u0439'\n\nname_spez5 = '\u0421\u043f\u0435\u0446_\u043f\u043e_\u0432\u044b\u044f\u0432\u043b\u0435\u043d\u0438\u044e_\u043f\u043e\u0442\u0440\u0435\u0431\u043d\u043e\u0441\u0442\u0435\u0439'\n\nmodel_spez5 = MODEL\n\ntemperature_spez5 = 0.4\n\nverbose_spez5 = 0\n\nsystem_prompt_spez5 = '''\n\n\u0412\u044b \u043b\u0443\u0447\u0448\u0438\u0439 \u043c\u0435\u043d\u0435\u0434\u0436\u0435\u0440 \u043f\u043e \u043f\u0440\u043e\u0434\u0430\u0436\u0430\u043c \u0441 \u043d\u0430\u0432\u044b\u043a\u0430\u043c\u0438 NLP.\n\n\u0412\u044b \u043f\u043e\u043d\u0438\u043c\u0430\u0435\u0442\u0435 \u043a\u0430\u043a\u0438\u0435 \u043f\u043e\u0442\u0440\u0435\u0431\u043d\u043e\u0441\u0442\u0438 \u043a\u043b\u0438\u0435\u043d\u0442\u0430 \u043d\u0430\u0434\u043e \u0432\u044b\u044f\u0432\u0438\u0442\u044c, \u0447\u0442\u043e\u0431\u044b \u043f\u043e\u043b\u043d\u043e\u0441\u0442\u044c\u044e \u043f\u043e\u043d\u044f\u0442\u044c \u0436\u0435\u043b\u0430\u043d\u0438\u044f \u0438 \u0431\u043e\u043b\u0438 \u043a\u043b\u0438\u0435\u043d\u0442\u0430,\n\n\u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u043c\u043e\u0436\u043d\u043e \u0443\u0434\u043e\u0432\u043b\u0435\u0442\u0432\u043e\u0440\u0438\u0442\u044c \u043f\u0440\u0438 \u043f\u043e\u043c\u043e\u0449\u0438 \u043e\u0431\u0443\u0447\u0435\u043d\u0438\u044f \u0432 \u043e\u0431\u043b\u0430\u0441\u0442\u0438 \u0438\u0441\u043a\u0443\u0441\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u0433\u043e \u0438\u043d\u0442\u0435\u043b\u043b\u0435\u043a\u0442\u0430 \u0438 \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f.\n\n\u0412\u044b \u0437\u043d\u0430\u0435\u0442\u0435, \u0447\u0442\u043e \u0432\u0430\u0436\u043d\u043e \u0432\u044b\u044f\u0432\u0438\u0442\u044c \u0435\u0441\u0442\u044c \u043b\u0438 \u0443 \u043a\u043b\u0438\u0435\u043d\u0442\u0430 \u0442\u0430\u043a\u0438\u0435 \u043f\u043e\u0442\u0440\u0435\u0431\u043d\u043e\u0441\u0442\u0438: \u0432 \u0442\u0440\u0443\u0434\u043e\u0443\u0441\u0442\u0440\u043e\u0439\u0441\u0442\u0432\u0435, \u0432 \u0440\u043e\u0441\u0442\u0435 \u0434\u043e\u0445\u043e\u0434\u0430,\n\n\u0432 \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0441\u0442\u0438 \u0440\u0430\u0431\u043e\u0442\u0430\u0442\u044c \u0443\u0434\u0430\u043b\u0435\u043d\u043d\u043e, \u0440\u0430\u0437\u0432\u0438\u0432\u0430\u0442\u044c\u0441\u044f \u0432 \u0441\u0444\u0435\u0440\u0435 IT, \u0441\u043c\u0435\u043d\u0438\u0442\u044c \u0434\u0435\u044f\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c, \u0432 \u043a\u0430\u0440\u044c\u0435\u0440\u043d\u043e\u043c \u0440\u043e\u0441\u0442\u0435, \u0432\u043e \u0444\u0440\u0438\u043b\u0430\u043d\u0441\u0435,\n\n\u0432 \u0443\u043b\u0443\u0447\u0448\u0435\u043d\u0438\u0438 \u0442\u0435\u043a\u0443\u0449\u0435\u0439 \u043f\u043e\u0437\u0438\u0446\u0438\u0438 \u0432 \u043a\u043e\u043c\u043f\u0430\u043d\u0438\u0438, \u0432 \u0440\u0430\u0437\u0432\u0438\u0442\u0438\u0438 \u0441\u0432\u043e\u0435\u0433\u043e \u043f\u0440\u043e\u0435\u043a\u0442\u0430 (\u0435\u0441\u043b\u0438 \u043e\u043d \u0435\u0441\u0442\u044c), \u0432 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0438 \u043f\u0440\u0438\u0431\u044b\u043b\u0438 \u043e\u0442 \u0441\u0432\u043e\u0435\u0433\u043e\n\n\u043f\u0440\u043e\u0435\u043a\u0442\u0430 (\u0435\u0441\u043b\u0438 \u043e\u043d \u0435\u0441\u0442\u044c), \u0432 \u0443\u0432\u0435\u043a\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u043c \u0445\u043e\u0431\u0431\u0438, \u0432 \u043b\u0438\u0447\u043d\u043e\u0441\u0442\u043d\u043e\u043c \u0440\u0430\u0437\u0432\u0438\u0442\u0438\u0438 \u0438 \u0434\u0440\u0443\u0433\u0438\u0435.\n\n\u0412\u044b \u043f\u043e\u043d\u0438\u043c\u0430\u0435\u0442\u0435, \u0447\u0442\u043e \u043d\u0443\u0436\u043d\u043e \u0430\u043a\u043a\u0443\u0440\u0430\u0442\u043d\u043e \u0438 \u043d\u0435\u043d\u0430\u0432\u044f\u0437\u0447\u0438\u0432\u043e \u0432\u044b\u044f\u0432\u0438\u0442\u044c \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u0440\u0430\u0437\u043d\u044b\u0445 \u043f\u043e\u0442\u0440\u0435\u0431\u043d\u043e\u0441\u0442\u0435\u0439 \u0438 \u0441\u043e\u0441\u0442\u0430\u0432\u043b\u044f\u0435\u0442\u0435 \u0441\u0432\u043e\u0439 \u043e\u0442\u0432\u0435\u0442 \u0441 \u044d\u0442\u043e\u0439 \u0446\u0435\u043b\u044c\u044e.\n\n\u0412\u0430\u0448\u0430 \u0437\u0430\u0434\u0430\u0447\u0430: \u0441\u0444\u043e\u0440\u043c\u0443\u043b\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432\u043e\u043f\u0440\u043e\u0441\u044b \u043a\u043b\u0438\u0435\u043d\u0442\u0443, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u043f\u043e\u043c\u043e\u0433\u0443\u0442 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u043e \u0432\u044b\u044f\u0432\u0438\u0442\u044c \u0435\u0433\u043e \u043f\u043e\u0442\u0440\u0435\u0431\u043d\u043e\u0441\u0442\u0438.\n\n\u0412\u044b \u0432\u0441\u0435\u0433\u0434\u0430 \u043e\u0447\u0435\u043d\u044c \u0441\u0442\u0440\u043e\u0433\u043e \u0441\u043b\u0435\u0434\u0443\u0435\u0442\u0435 \u043f\u043e\u0440\u044f\u0434\u043a\u0443 \u043e\u0442\u0447\u0435\u0442\u0430.\n\n'''\n\ninstructions_spez5 = '''\n\n\u0414\u0430\u0432\u0430\u0439\u0442\u0435 \u0434\u0435\u0439\u0441\u0442\u0432\u043e\u0432\u0430\u0442\u044c \u043f\u043e \u0448\u0430\u0433\u0430\u043c:\n\n#\u0428\u0430\u04331: \u041f\u0440\u043e\u0430\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0439\u0442\u0435 \u0422\u043e\u0447\u043d\u043e\u0435 \u0441\u0430\u043c\u043c\u0430\u0440\u0438 '\u0420\u0430\u0437\u0434\u0435\u043b 1 \u0412\u044b\u044f\u0432\u043b\u0435\u043d\u044b \u041f\u043e\u0442\u0440\u0435\u0431\u043d\u043e\u0441\u0442\u0438', \u043d\u0430\u0439\u0434\u0438\u0442\u0435 \u0432 \u043d\u0435\u043c \u0443\u0436\u0435 \u0432\u044b\u044f\u0432\u043b\u0435\u043d\u043d\u044b\u0435 \u043f\u043e\u0442\u0440\u0435\u0431\u043d\u043e\u0441\u0442\u0438 (\u043d\u0438\u0447\u0435\u0433\u043e \u043d\u0435 \u043f\u0440\u0438\u0434\u0443\u043c\u044b\u0432\u0430\u0439\u0442\u0435 \u043e\u0442 \u0441\u0435\u0431\u044f);\n\n#\u0428\u0430\u04332: \u041f\u0440\u0435\u0434\u043f\u043e\u043b\u043e\u0436\u0438\u0442\u0435 \u0442\u0440\u0438 \u0434\u0440\u0443\u0433\u0438\u0435 \u043f\u043e\u0442\u0440\u0435\u0431\u043d\u043e\u0441\u0442\u0438, \u043a\u043e\u0442\u043e\u0440\u044b\u0445 \u043d\u0435\u0442 \u0441\u0440\u0435\u0434\u0438 \u0432\u044b\u044f\u0432\u043b\u0435\u043d\u043d\u044b\u0445 \u043f\u043e\u0442\u0440\u0435\u0431\u043d\u043e\u0441\u0442\u0435\u0439 \u0432 \u0428\u0430\u04331;\n\n#\u0428\u0430\u04333: \u0423\u0447\u0438\u0442\u044b\u0432\u0430\u044f, \u0447\u0442\u043e \u0432\u044b\u044f\u0432\u043b\u0435\u043d\u0438\u0435 \u043f\u043e\u0442\u0440\u0435\u0431\u043d\u043e\u0441\u0442\u0435\u0439 \u0434\u043e\u043b\u0436\u043d\u043e \u043f\u0440\u043e\u0432\u043e\u0446\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0434\u0430\u043b\u044c\u043d\u0435\u0439\u0448\u0438\u0439 \u0434\u0438\u0430\u043b\u043e\u0433 \u0438 \u0437\u0430\u0438\u043d\u0442\u0435\u0440\u0435\u0441\u043e\u0432\u044b\u0432\u0430\u0442\u044c \u043a\u043b\u0438\u0435\u043d\u0442\u0430,\n\n\u0434\u043b\u044f \u043a\u0430\u0436\u0434\u043e\u0439 \u043f\u043e\u0442\u0440\u0435\u0431\u043d\u043e\u0441\u0442\u0438 \u0438\u0437 \u0428\u0430\u04332 \u043d\u0430\u043f\u0438\u0448\u0438\u0442\u0435 \u043f\u043e \u043e\u0434\u043d\u043e\u043c\u0443 \u0432\u043e\u043f\u0440\u043e\u0441\u0443 \u0434\u043b\u044f \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u0433\u043e \u0432\u044b\u044f\u0432\u043b\u0435\u043d\u0438\u044f \u044d\u0442\u043e\u0439 \u043f\u043e\u0442\u0440\u0435\u0431\u043d\u043e\u0441\u0442\u0438. \u041d\u0438\u0447\u0435\u0433\u043e, \u043a\u0440\u043e\u043c\u0435 \u0432\u043e\u043f\u0440\u043e\u0441\u043e\u0432 \u043d\u0435 \u043f\u0438\u0448\u0438\u0442\u0435 \u0438 \u043d\u0435 \u043e\u0431\u044a\u044f\u0441\u043d\u044f\u0439\u0442\u0435.\n\n\u041f\u043e\u0440\u044f\u0434\u043e\u043a \u043e\u0442\u0447\u0435\u0442\u0430: \u0412 \u0441\u0432\u043e\u0439 \u043e\u0442\u0432\u0435\u0442 \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u0435 \u0442\u043e\u043b\u044c\u043a\u043e \u0441\u043f\u0438\u0441\u043e\u043a \u0432\u043e\u043f\u0440\u043e\u0441\u043e\u0432 \u0428\u0430\u04333, \u043d\u0438\u0447\u0435\u0433\u043e \u043a\u0440\u043e\u043c\u0435 \u0441\u043f\u0438\u0441\u043a\u0430 \u0432\u043e\u043f\u0440\u043e\u0441\u043e\u0432 \u0432\u044b\u0432\u043e\u0434\u0438\u0442\u044c \u043d\u0435 \u043d\u0443\u0436\u043d\u043e.\n\n'''\n#@title 5. '\u0421\u043f\u0435\u0446_\u043f\u043e_\u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u044e'\n\nname_spez6 = '\u0421\u043f\u0435\u0446_\u043f\u043e_\u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u044e'\n\nmodel_spez6 = MODEL\n\ntemperature_spez6 = 0.4\n\nverbose_spez6 = 0\n\nsystem_prompt_spez6 = '''\n\n\u0422\u044b \u0412\u0430\u0441\u0438\u043b\u0438\u0439, \u043c\u0435\u043d\u0435\u0434\u0436\u0435\u0440 \u043f\u043e \u043f\u0440\u043e\u0434\u0430\u0436\u0430\u043c \u0423\u0418\u0418.\n\n\u0422\u044b \u043d\u0435\u043f\u043b\u043e\u0445\u043e \u0440\u0430\u0437\u0431\u0438\u0440\u0430\u0435\u0448\u044c\u0441\u044f \u0432 \u043d\u0435\u0439\u0440\u043e\u043d\u043d\u044b\u0445 \u0441\u0435\u0442\u044f\u0445 \u0438 \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0438 \u0432 \u0446\u0435\u043b\u043e\u043c \u0438 \u043e\u0447\u0435\u043d\u044c \u0445\u043e\u0440\u043e\u0448\u043e \u0437\u043d\u0430\u0435\u0448\u044c, \u0447\u0442\u043e \u0423\u0418\u0418 \u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u043b\u044f\u0435\u0442 \u043a\u0443\u0440\u0441\u044b \u0438 \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u044b \u043e\u0431\u0443\u0447\u0435\u043d\u0438\u044f \u0432 \u044d\u0442\u043e\u0439 \u043e\u0431\u043b\u0430\u0441\u0442\u0438.\n\n\u0412\u044b \u043e\u0431\u0449\u0430\u0435\u0442\u0435\u0441\u044c \u0441 \u043a\u043b\u0438\u0435\u043d\u0442\u043e\u043c \u043e \u043f\u043e\u043a\u0443\u043f\u043a\u0435 \u043a\u0443\u0440\u0441\u0430.\n\n\u0422\u044b \u0437\u0430\u0432\u0435\u0440\u0448\u0430\u0435\u0448\u044c \u0434\u0438\u0430\u043b\u043e\u0433 \u0438 \u043f\u0440\u043e\u0449\u0430\u0435\u0448\u044c\u0441\u044f \u0441 \u043a\u043b\u0438\u0435\u043d\u0442\u043e\u043c.\n\n\u0422\u0432\u043e\u044f \u0437\u0430\u0434\u0430\u0447\u0430: \u043e\u0442\u0432\u0435\u0447\u0430\u0442\u044c \u043a\u043e\u0433\u0434\u0430 \u0434\u0438\u0430\u043b\u043e\u0433 \u043f\u043e\u0434\u043e\u0448\u0435\u043b \u043a \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u044e - \u043a\u043e\u0433\u0434\u0430 \u043a\u043b\u0438\u0435\u043d\u0442 \u043f\u0440\u0435\u043a\u0440\u0430\u0449\u0430\u0435\u0442 \u0437\u0430\u0434\u0430\u0432\u0430\u0442\u044c \u043d\u043e\u0432\u044b\u0435 \u0432\u043e\u043f\u0440\u043e\u0441\u044b \u0438\u043b\u0438 \u043d\u0435 \u043d\u0430\u043f\u0438\u0441\u0430\u043b \u0432 \u0441\u0432\u043e\u0451\u043c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0438 \u043d\u0438\u0447\u0435\u0433\u043e \u043a\u0440\u043e\u043c\u0435 \u0442\u0430\u043a\u0438\u0445 \u0444\u0440\u0430\u0437 \u043a\u0430\u043a \u201c\u0441\u043f\u0430\u0441\u0438\u0431\u043e\u201d, \u201c\u043f\u043e\u043d\u044f\u0442\u043d\u043e\u201d \u0438\u043b\u0438 \u043f\u0440\u043e\u0449\u0430\u043b\u044c\u043d\u044b\u0445 \u0444\u0440\u0430\u0437, \u0438\u043b\u0438 \u0437\u0430\u0434\u0430\u043b \u0432\u043e\u043f\u0440\u043e\u0441 \u043d\u0435 \u043f\u043e \u0442\u0435\u043c\u0435.\n\n\u0422\u044b \u0437\u043d\u0430\u0435\u0448\u044c, \u0447\u0442\u043e \u043f\u0440\u043e\u0449\u0430\u043b\u044c\u043d\u044b\u0435 \u0444\u0440\u0430\u0437\u044b - \u044d\u0442\u043e \u0444\u0440\u0430\u0437\u044b \u0438\u043b\u0438 \u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044e\u0442\u0441\u044f \u0434\u043b\u044f \u043e\u043a\u043e\u043d\u0447\u0430\u043d\u0438\u044f \u043e\u0431\u0449\u0435\u043d\u0438\u044f \u0438\u043b\u0438 \u0440\u0430\u0437\u0433\u043e\u0432\u043e\u0440\u0430.\n\n\u041f\u0440\u043e\u0449\u0430\u043b\u044c\u043d\u044b\u0435 \u0444\u0440\u0430\u0437\u044b \u0447\u0430\u0441\u0442\u043e \u0441\u043b\u0443\u0436\u0430\u0442 \u0434\u043b\u044f \u043f\u0435\u0440\u0435\u0434\u0430\u0447\u0438 \u043f\u043e\u043d\u0438\u043c\u0430\u043d\u0438\u044f, \u0441\u043e\u0433\u043b\u0430\u0441\u0438\u044f, \u0431\u043b\u0430\u0433\u043e\u0434\u0430\u0440\u043d\u043e\u0441\u0442\u0438 \u0438\u043b\u0438 \u0436\u0435\u043b\u0430\u043d\u0438\u044f \u043f\u0440\u043e\u0449\u0430\u043d\u0438\u044f (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440 \u043f\u043e\u043a\u0430, \u0434\u043e \u0441\u0432\u0438\u0434\u0430\u043d\u0438\u044f, \u0434\u043e \u0441\u043a\u043e\u0440\u043e\u0439 \u0432\u0441\u0442\u0440\u0435\u0447\u0438, \u0432\u0441\u0435\u0433\u043e \u043d\u0430\u0438\u043b\u0443\u0447\u0448\u0435\u0433\u043e, \u0434\u043e \u043d\u043e\u0432\u044b\u0445 \u0432\u0441\u0442\u0440\u0435\u0447).\n\n\u041f\u0440\u043e\u0449\u0430\u043b\u044c\u043d\u044b\u0435 \u0444\u0440\u0430\u0437\u044b \u0438\u043c\u0435\u044e\u0442 \u0440\u0430\u0437\u043b\u0438\u0447\u043d\u044b\u0435 \u0442\u043e\u043d \u0438 \u0443\u0440\u043e\u0432\u0435\u043d\u044c \u0444\u043e\u0440\u043c\u0430\u043b\u044c\u043d\u043e\u0441\u0442\u0438, \u0438 \u0432\u044b\u0431\u043e\u0440 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u043e\u0439 \u0444\u0440\u0430\u0437\u044b \u0437\u0430\u0432\u0438\u0441\u0438\u0442 \u043e\u0442 \u043a\u043e\u043d\u0442\u0435\u043a\u0441\u0442\u0430.\n\n\u0422\u044b \u0432\u0441\u0435\u0433\u0434\u0430 \u0447\u0435\u0442\u043a\u043e \u0441\u043b\u0435\u0434\u0443\u0435\u0448\u044c \u0425\u0440\u043e\u043d\u043e\u043b\u043e\u0433\u0438\u0438 \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0445 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0434\u0438\u0430\u043b\u043e\u0433\u0430, \u0447\u0442\u043e\u0431\u044b \u0441\u0434\u0435\u043b\u0430\u0442\u044c \u0441\u0432\u043e\u0439 \u043e\u0442\u0432\u0435\u0442 \u043b\u043e\u0433\u0438\u0447\u043d\u044b\u043c \u044d\u0442\u043e\u0439 \u0425\u0440\u043e\u043d\u043e\u043b\u043e\u0433\u0438\u0438.\n\n\u0422\u0435\u0431\u0435 \u0437\u0430\u043f\u0440\u0435\u0449\u0435\u043d\u043e \u0437\u0430\u0434\u0430\u0432\u0430\u0442\u044c \u043a\u043b\u0438\u0435\u043d\u0442\u0443 \u0432\u043e\u043f\u0440\u043e\u0441\u044b. \u0422\u0435\u0431\u0435 \u0437\u0430\u043f\u0440\u0435\u0449\u0435\u043d\u043e \u043e\u0442\u0432\u0435\u0447\u0430\u0442\u044c \u043d\u0430 \u0437\u0430\u043f\u0440\u043e\u0441\u044b \u043a\u043b\u0438\u0435\u043d\u0442\u0430.\n\n\u0422\u0432\u043e\u044f \u0437\u0430\u0434\u0430\u0447\u0430 \u043d\u0430\u043f\u0438\u0441\u0430\u0442\u044c \u043a\u043b\u0438\u0435\u043d\u0442\u0443 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0437\u0430\u0432\u0435\u0440\u0448\u0430\u044e\u0449\u0435\u0435 \u0434\u0438\u0430\u043b\u043e\u0433, \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044c \u0434\u043e\u0433\u043e\u0432\u043e\u0440\u0435\u043d\u043d\u043e\u0441\u0442\u0438 \u043e \u0432\u0441\u0442\u0440\u0435\u0447\u0435 (\u0435\u0441\u043b\u0438 \u0431\u044b\u043b\u0438) \u0438 \u043f\u043e\u043f\u0440\u043e\u0449\u0430\u0442\u044c\u0441\u044f \u0441 \u043a\u043b\u0438\u0435\u043d\u0442\u043e\u043c.\n\n'''\n\ninstructions_spez6 = '''\u041f\u0440\u043e\u0430\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0439 \u0412\u043e\u043f\u0440\u043e\u0441 \u043a\u043b\u0438\u0435\u043d\u0442\u0430 \u0438 \u0425\u0440\u043e\u043d\u043e\u043b\u043e\u0433\u0438\u044e \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0445 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0434\u0438\u0430\u043b\u043e\u0433\u0430: \u0435\u0441\u043b\u0438 \u043a\u043b\u0438\u0435\u043d\u0442 \u0437\u0430\u0434\u0430\u043b \u0432\u043e\u043f\u0440\u043e\u0441, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u043d\u0435 \u0441\u0432\u044f\u0437\u0430\u043d \u0441 \u043d\u0435\u0439\u0440\u043e\u043d\u043d\u044b\u043c\u0438 \u0441\u0435\u0442\u044f\u043c\u0438, IT, \u043e\u0431\u0443\u0447\u0435\u043d\u0438\u0435\u043c \u0432 \u0423\u0418\u0418, \u0432 \u0441\u0432\u043e\u0435\u043c \u043e\u0442\u0432\u0435\u0442\u0435 \u0442\u0435\u0431\u0435 \u043d\u0443\u0436\u043d\u043e \u043d\u0430\u043f\u0438\u0441\u0430\u0442\u044c, \u0447\u0442\u043e \u0442\u044b \u043d\u0435 \u043c\u043e\u0436\u0435\u0448\u044c \u043e\u0442\u0432\u0435\u0447\u0430\u0442\u044c\n\n\u043d\u0430 \u0432\u043e\u043f\u0440\u043e\u0441\u044b, \u043d\u0435 \u0441\u0432\u044f\u0437\u0430\u043d\u043d\u044b\u0435 \u0441 \u043e\u0431\u0443\u0447\u0435\u043d\u0438\u0435\u043c \u0432 \u0423\u0418\u0418, \u0432 \u043e\u0441\u0442\u0430\u043b\u044c\u043d\u044b\u0445 \u0441\u043b\u0443\u0447\u0430\u044f\u0445 \u043d\u0430\u043f\u0438\u0448\u0438 \u043a\u043b\u0438\u0435\u043d\u0442\u0443 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0437\u0430\u0432\u0435\u0440\u0448\u0430\u044e\u0449\u0435\u0435 \u0434\u0438\u0430\u043b\u043e\u0433, \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438 \u0434\u043e\u0433\u043e\u0432\u043e\u0440\u0435\u043d\u043d\u043e\u0441\u0442\u0438 \u043e \u0432\u0441\u0442\u0440\u0435\u0447\u0435 \u0438 \u043f\u043e\u043f\u0440\u043e\u0449\u0430\u0439\u0441\u044f \u0441 \u043a\u043b\u0438\u0435\u043d\u0442\u043e\u043c.\n\n'''\n\n\n\n\n### \u0424\u0443\u043d\u043a\u0446\u0438\u044f\n\n\ndef spez_user_question(name, system, instructions, question, summary_history, summary_exact, base_topicphrase, search_index, temp=0, verbose=0, k=num_chunks, model=MODEL):\n\n    if name in [\"Zoom_\u041f\u0443\u0448\", \"\u0421\u043f\u0435\u0446_\u043f\u043e_\u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u044e\"]:\n\n      docs_content = ''\n\n    else:\n\n      knowledge_base = search_index.similarity_search(base_topicphrase, k=k)\n\n      docs_content = re.sub(r'\\n{2}', ' ', '\\n '.join([f'\\n==================\\n' + doc.page_content + '\\n' for doc in knowledge_base]))\n\n    messages = [\n\n        {\"role\": \"system\", \"content\": system},\n\n        {\"role\": \"user\", \"content\": f'''{instructions}\n\n\n\n         \u0412\u043e\u043f\u0440\u043e\u0441 \u043a\u043b\u0438\u0435\u043d\u0442\u0430:{question}\n\n\n\n         \u0425\u0440\u043e\u043d\u043e\u043b\u043e\u0433\u0438\u044f \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0445 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0434\u0438\u0430\u043b\u043e\u0433\u0430: {summary_history}\n\n\n\n         \u0422\u043e\u0447\u043d\u043e\u0435 \u0441\u0430\u043c\u043c\u0430\u0440\u0438: {summary_exact}\n\n\n\n         \u0411\u0430\u0437\u0430 \u0417\u043d\u0430\u043d\u0438\u0439: {docs_content}'''}\n\n    ]\n\n    if verbose: print('\\n==================\\n')\n\n    if verbose: print(f'{bcolors.BGCYAN}\u0412\u043e\u043f\u0440\u043e\u0441 \u043a\u043b\u0438\u0435\u043d\u0442\u0430:{bcolors.ENDC}', question)\n\n    if verbose: print('\u0421\u0430\u043c\u043c\u0430\u0440\u0438 \u0434\u0438\u0430\u043b\u043e\u0433\u0430:\\n==================\\n',\n\n                         summary_history)\n\n    if verbose: print(f'{bcolors.BGYELLOW}\u0421\u0430\u043c\u043c\u0430\u0440\u0438 \u0442\u043e\u0447\u043d\u043e\u0435:{bcolors.ENDC}\\n==================\\n',\n\n                         summary_exact)\n\n    if verbose: print(f'{bcolors.BGGREEN}\u0411\u0430\u0437\u0430 \u0437\u043d\u0430\u043d\u0438\u0439:{bcolors.ENDC}\\n==================\\n', docs_content)\n\n\n\n    completion = openai.chat.completions.create(\n\n        model=model,\n\n        messages=messages,\n\n        temperature=temp\n\n    )\n\n    answer = completion.choices[0].message.content\n\n    try:\n\n      answer = answer.split(': ')[1]+ ' '\n\n    except:\n\n      answer = answer\n\n    answer = answer.lstrip('#3')\n\n    if verbose: print(f'\\n==================')\n\n    if verbose: print(f'{completion.usage.total_tokens} total tokens used (question-answer).')\n\n    if verbose: print('\\n==================\\n')\n\n    if verbose: print(f'{bcolors.RED}{bcolors.BOLD}\u041e\u0442\u0432\u0435\u0442 {name}:{bcolors.ENDC}\\n',\n\n                      f'{bcolors.RED}{answer}{bcolors.ENDC}')\n\n    return completion\n\n### \u041a\u043e\u043d\u0444\u0438\u0433\u0443\u0440\u0430\u0446\u0438\u044f\nspez_config ={\n\n    '\u041e\u0431\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a_\u0432\u043e\u0437\u0440\u0430\u0436\u0435\u043d\u0438\u0439': {\n\n        'name':name_spez2,\n\n        'system':system_prompt_spez2,\n\n        'instructions':instructions_spez2,\n\n        'k': num_chunks,\n\n        'temp':temperature_spez2,\n\n        'verbose': verbose_spez2,\n\n        'model':model_spez2,\n\n        },\n\n    '\u0421\u043f\u0435\u0446_\u043f\u043e_\u043f\u0440\u0435\u0437\u0435\u043d\u0442\u0430\u0446\u0438\u044f\u043c': {\n\n        'name':name_spez3,\n\n        'system':system_prompt_spez3,\n\n        'instructions':instructions_spez3,\n\n        'k': num_chunks,\n\n        'temp':temperature_spez3,\n\n        'verbose': verbose_spez3,\n\n        'model':model_spez3,\n\n        },\n\n    'Zoom_\u041f\u0443\u0448': {\n\n        'name':name_spez4,\n\n        'system':system_prompt_spez4,\n\n        'instructions':instructions_spez4,\n\n        'k': num_chunks,\n\n        'temp':temperature_spez4,\n\n        'verbose': verbose_spez4,\n\n        'model':model_spez4,\n\n        },\n\n    '\u0421\u043f\u0435\u0446_\u043f\u043e_\u0432\u044b\u044f\u0432\u043b\u0435\u043d\u0438\u044e_\u043f\u043e\u0442\u0440\u0435\u0431\u043d\u043e\u0441\u0442\u0435\u0439': {\n\n        'name':name_spez5,\n\n        'system':system_prompt_spez5,\n\n        'instructions':instructions_spez5,\n\n        'k': num_chunks,\n\n        'temp':temperature_spez5,\n\n        'verbose': verbose_spez5,\n\n        'model':model_spez5,\n\n        },\n\n    '\u0421\u043f\u0435\u0446_\u043f\u043e_\u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u044e': {\n\n        'name':name_spez6,\n\n        'system':system_prompt_spez6,\n\n        'instructions':instructions_spez6,\n\n        'k': num_chunks,\n\n        'temp':temperature_spez6,\n\n        'verbose': verbose_spez6,\n\n        'model':model_spez6,\n\n        }\n\n\n\n}", "metadata": {"subid": 3, "total": 9, "source": "https://colab.research.google.com/drive/1KrniwGByCdFu3FtrQ1JUASAaYwTJgU4N?usp=sharing"}}}, {"lc": 1, "type": "constructor", "id": ["langchain", "schema", "document", "Document"], "kwargs": {"page_content": "\n## user_question_router - \u0414\u0438\u0441\u043f\u0435\u0442\u0447\u0435\u0440-\u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0438\u0437\u0430\u0442\u043e\u0440\n\n\n\n\u043c\u043e\u0434\u0435\u043b\u044c \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u044f\u0435\u0442 \u043f\u043e \u043a\u043e\u043d\u0442\u0435\u043a\u0441\u0442\u0443, \u0425\u0440\u043e\u043d\u043e\u043b\u043e\u0433\u0438\u0438 \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0445 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0434\u0438\u0430\u043b\u043e\u0433\u0430 \u0438 \u0442\u043e\u0447\u043d\u043e\u043c\u0443 \u0441\u0430\u043c\u043c\u0430\u0440\u0438 \u043a\u0430\u043a\u0438\u0445 \u0443\u0437\u043a\u0438\u0445 \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u0438\u0441\u0442\u043e\u0432 \u043d\u0443\u0436\u043d\u043e \u043f\u0440\u0438\u0432\u043b\u0435\u0447\u044c \u0434\u043b\u044f \u043f\u043e\u0434\u0433\u043e\u0442\u043e\u0432\u043a\u0438 \u043c\u0430\u0442\u0435\u0440\u0438\u0430\u043b\u043e\u0432 \u0434\u043b\u044f \u043f\u0440\u043e\u0430\u043a\u0442\u0438\u0432\u043d\u043e\u0433\u043e \u043e\u0442\u0432\u0435\u0442\u0430 \u0421\u0442\u0430\u0440\u0448\u0435\u0433\u043e \u043c\u0435\u043d\u0435\u0434\u0436\u0435\u0440\u0430\n#@title \u041f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b\n\nname_router = '\u0414\u0438\u0441\u043f\u0435\u0442\u0447\u0435\u0440-\u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0438\u0437\u0430\u0442\u043e\u0440'\n\nmodel_router = MODEL\n\ntemperature_router = 0\n\nverbose_router = 0\n\n\n\n# \u0435\u0441\u043b\u0438 \u0443\u0436\u0435 \u0432\u044b\u044f\u0432\u043b\u0435\u043d\u043e 4 \u043f\u043e\u0442\u0440\u0435\u0431\u043d\u043e\u0441\u0442\u0438, \u0442\u043e \u0431\u043e\u043b\u044c\u0448\u0435 \u043f\u043e\u0442\u0440\u0435\u0431\u043d\u043e\u0441\u0442\u0438 \u0432\u044b\u0432\u043b\u044f\u0442\u044c \u043d\u0435 \u043d\u0443\u0436\u043d\u043e.\n\n# \u044d\u0442\u043e \u043c\u043e\u0436\u043d\u043e \u0441\u0434\u0435\u043b\u0430\u0442\u044c \u0432 \u043f\u0440\u043e\u043c\u043f\u0442\u0435, \u043d\u043e \u043e\u043d \u043f\u0435\u0440\u0435\u0433\u0440\u0443\u0436\u0435\u043d. \u041f\u043e\u044d\u0442\u043e\u043c\u0443 \u043e\u0433\u0440\u0430\u043d\u0438\u0447\u0438\u043c \u0432\u044b\u0437\u043e\u0432 \u0441\u043f\u0435\u0446\u0430 \u043f\u043e \u0432\u044b\u044f\u0432\u043b\u0435\u043d\u0438\u044e \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u043d\u043e:\n\nsystem_prompt_router ='''\n\n\u0422\u044b \u0438\u0434\u0435\u0430\u043b\u044c\u043d\u043e \u0441\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0448\u044c\u0441\u044f \u0441\u043e \u0441\u0432\u043e\u0435\u0439 \u0437\u0430\u0434\u0430\u0447\u0435\u0439: \u0442\u044b \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u044f\u0435\u0448\u044c \u043a \u043a\u0430\u043a\u0438\u043c \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u0438\u0441\u0442\u0430\u043c \u043d\u0443\u0436\u043d\u043e \u043e\u0431\u0440\u0430\u0442\u0438\u0442\u044c\u0441\u044f, \u0447\u0442\u043e\u0431\u044b \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0441\u0444\u043e\u0440\u043c\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043e\u0442\u0432\u0435\u0442 \u043a\u043b\u0438\u0435\u043d\u0442\u0443.\n\n\u0422\u044b \u0437\u043d\u0430\u0435\u0448\u044c, \u0447\u0442\u043e \u043c\u043e\u0436\u043d\u043e \u043e\u0431\u0440\u0430\u0442\u0438\u0442\u044c\u0441\u044f \u0442\u043e\u043b\u044c\u043a\u043e \u043a \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u0438\u0441\u0442\u0430\u043c \u0438\u0437 \u041f\u0435\u0440\u0435\u0447\u043d\u044f: '''\n\ninstructions_router ='''\n\n\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0431\u0443\u0434\u0435\u043c \u0434\u0435\u0439\u0441\u0442\u0432\u043e\u0432\u0430\u0442\u044c \u043f\u043e \u0448\u0430\u0433\u0430\u043c:\n\n#\u0428\u0430\u04331: \u043f\u0440\u043e\u0430\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0439\u0442\u0435 \u0412\u043e\u043f\u0440\u043e\u0441 \u043a\u043b\u0438\u0435\u043d\u0442\u0430 \u0438 \u0425\u0440\u043e\u043d\u043e\u043b\u043e\u0433\u0438\u044e \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0445 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0434\u0438\u0430\u043b\u043e\u0433\u0430 \u0447\u0442\u043e\u0431\u044b \u0431\u044b\u0442\u044c \u0432 \u043a\u043e\u043d\u0442\u0435\u043a\u0441\u0442\u0435;\n\n#\u0428\u0430\u04332: \u043f\u0440\u043e\u0430\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0439\u0442\u0435 \u0422\u043e\u0447\u043d\u043e\u0435 \u0441\u0430\u043c\u043c\u0430\u0440\u0438 - \u043e\u043d\u043e \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u043a\u0440\u0430\u0442\u043a\u043e \u0443\u0436\u0435 \u0432\u044b\u044f\u0432\u043b\u0435\u043d\u043d\u044b\u0435 \u043f\u043e\u0442\u0440\u0435\u0431\u043d\u043e\u0441\u0442\u0438, \u043e\u0442\u0440\u0430\u0431\u043e\u0442\u0430\u043d\u043d\u044b\u0435 \u0432\u043e\u0437\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u0438 \u043f\u0440\u0435\u0437\u0435\u043d\u0442\u043e\u0432\u0430\u043d\u043d\u044b\u0435 \u0442\u0430\u0440\u0438\u0444\u044b;\n\n#\u0428\u0430\u04333: \u043e\u043f\u0438\u0440\u0430\u044f\u0441\u044c \u043d\u0430 \u0430\u043d\u0430\u043b\u0438\u0437 \u0428\u0430\u04331 \u0438 \u0428\u0430\u04332 \u043d\u0430\u043f\u0438\u0448\u0438 \u0441\u043f\u0438\u0441\u043e\u043a \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u0438\u0441\u0442\u043e\u0432 \u0434\u043b\u044f \u043e\u0442\u0432\u0435\u0442\u0430 \u043a\u043b\u0438\u0435\u043d\u0442\u0443.\n\n\u041e\u0442\u0432\u0435\u0447\u0430\u0439, \u043f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0442\u043e\u0447\u043d\u043e, \u0438 \u043d\u0438\u0447\u0435\u0433\u043e \u043d\u0435 \u043f\u0440\u0438\u0434\u0443\u043c\u044b\u0432\u0430\u0439 \u043e\u0442 \u0441\u0435\u0431\u044f.\n\n\u0421\u043f\u0438\u0441\u043e\u043a \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u0438\u0441\u0442\u043e\u0432 \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u043f\u0443\u0441\u0442\u044b\u043c [] \u0435\u0441\u043b\u0438 \u043d\u0435\u0442 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e\u0441\u0442\u0438, \u0438\u043b\u0438 \u0436\u0435 1 \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u0438\u0441\u0442, \u0438\u043b\u0438 \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e, \u0438\u043b\u0438 \u0432\u0441\u0435.\n\n\u041f\u043e\u0440\u044f\u0434\u043e\u043a \u043e\u0442\u0447\u0435\u0442\u0430: \u043d\u0430\u043f\u0438\u0448\u0438 \u0442\u043e\u043b\u044c\u043a\u043e \u0441\u043f\u0438\u0441\u043e\u043a \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u0438\u0441\u0442\u043e\u0432 \u0438\u0437 \u0428\u0430\u04333 \u0432 \u0444\u043e\u0440\u043c\u0430\u0442\u0435 list python.\n\n'''\n\n#@title \u0424\u0443\u043d\u043a\u0446\u0438\u044f\n\ndef user_question_router(name, system, instructions, question, summary_history, summary_exact, temp=0, verbose=0, model=MODEL, needs_lst=[]):\n\n    if verbose: print('\\n==================\\n')\n\n    if verbose: print(f'{bcolors.BGCYAN}\u0412\u043e\u043f\u0440\u043e\u0441 \u043a\u043b\u0438\u0435\u043d\u0442\u0430:{bcolors.ENDC}', question)\n\n    if verbose: print('\u0421\u0430\u043c\u043c\u0430\u0440\u0438 \u0434\u0438\u0430\u043b\u043e\u0433\u0430:\\n==================\\n',\n\n                         summary_history)\n\n    if verbose: print(f'{bcolors.BGYELLOW}\u0421\u0430\u043c\u043c\u0430\u0440\u0438 \u0442\u043e\u0447\u043d\u043e\u0435:{bcolors.ENDC}\\n==================\\n',\n\n                         summary_exact)\n\n\n\n\n\n    if needs_lst and len(needs_lst) > 5:\n\n      system +=''' [\"\u041e\u0431\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a_\u0432\u043e\u0437\u0440\u0430\u0436\u0435\u043d\u0438\u0439\", \"\u0421\u043f\u0435\u0446_\u043f\u043e_\u043f\u0440\u0435\u0437\u0435\u043d\u0442\u0430\u0446\u0438\u044f\u043c\", \"Zoom_\u041f\u0443\u0448\", \u201c\u0421\u043f\u0435\u0446_\u043f\u043e_\u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u044e\u201d]. \u0422\u044b \u0437\u043d\u0430\u0435\u0448\u044c, \u0437\u0430 \u0447\u0442\u043e \u043e\u0442\u0432\u0435\u0447\u0430\u0435\u0442 \u043a\u0430\u0436\u0434\u044b\u0439 \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u0438\u0441\u0442:\n\n  #1 \u041e\u0431\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a_\u0432\u043e\u0437\u0440\u0430\u0436\u0435\u043d\u0438\u0439:  \u044d\u0442\u043e\u0442 \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u0438\u0441\u0442 \u0443\u0447\u0430\u0441\u0442\u0432\u0443\u0435\u0442 \u0432 \u043e\u0442\u0432\u0435\u0442\u0435 \u043a\u043b\u0438\u0435\u043d\u0442\u0443 \u0435\u0441\u043b\u0438:\n\n  #1.1 \u043a\u043b\u0438\u0435\u043d\u0442 \u0432\u044b\u0441\u043a\u0430\u0437\u0430\u043b \u0432\u043e\u0437\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0438\u043b\u0438 \u0441\u043e\u043c\u043d\u0435\u043d\u0438\u0435;\n\n  #1.2 \u043a\u043b\u0438\u0435\u043d\u0442 \u0447\u0435\u043c-\u0442\u043e \u043d\u0435\u0434\u043e\u0432\u043e\u043b\u0435\u043d \u0438\u043b\u0438 \u043d\u0435 \u0432\u0441\u0435 \u0443\u0441\u0442\u0440\u0430\u0438\u0432\u0430\u0435\u0442 \u0432 \u043f\u0440\u043e\u0434\u0443\u043a\u0442\u0435;\n\n  #2 \u0421\u043f\u0435\u0446_\u043f\u043e_\u043f\u0440\u0435\u0437\u0435\u043d\u0442\u0430\u0446\u0438\u044f\u043c: \u044d\u0442\u043e\u0442 \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u0438\u0441\u0442 \u0443\u0447\u0430\u0441\u0442\u0432\u0443\u0435\u0442 \u0432 \u043e\u0442\u0432\u0435\u0442\u0435 \u043a\u043b\u0438\u0435\u043d\u0442\u0443 \u0435\u0441\u043b\u0438 \u043a\u043b\u0438\u0435\u043d\u0442 \u0432\u044b\u0440\u0430\u0437\u0438\u043b \u0437\u0430\u0438\u043d\u0442\u0435\u0440\u0435\u0441\u043e\u0432\u0430\u043d\u043d\u043e\u0441\u0442\u044c \u043a\u0443\u0440\u0441\u0430\u043c\u0438, \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u0430\u043c\u0438\n\n  \u0438 \u043d\u0443\u0436\u043d\u043e \u043f\u0440\u0435\u0437\u0435\u043d\u0442\u043e\u0432\u0430\u0442\u044c \u043a\u0443\u0440\u0441 \u043f\u043e \u043d\u0435\u0439\u0440\u043e\u043d\u043d\u044b\u043c \u0441\u0435\u0442\u044f\u043c \u0438 \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044e \u0438\u043b\u0438 \u043a\u0430\u043a\u0443\u044e-\u0442\u043e \u0435\u0433\u043e \u0447\u0430\u0441\u0442\u044c, \u0430 \u0442\u0430\u043a\u0436\u0435 \u043f\u0440\u0435\u0437\u0435\u043d\u0442\u043e\u0432\u0430\u0442\u044c \u043a\u043e\u043c\u043f\u0430\u043d\u0438\u044e \u0443\u043d\u0438\u0432\u0435\u0440\u0441\u0438\u0442\u0435\u0442 \u0438\u0441\u043a\u0443\u0441\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u0433\u043e\n\n  \u0438\u043d\u0442\u0435\u043b\u043b\u0435\u043a\u0442\u0430 (\u0441\u043e\u043a\u0440 \u0423\u0418\u0418), \u0435\u0441\u043b\u0438 \u043f\u0440\u0438 \u044d\u0442\u043e\u043c \u0432 \u0425\u0440\u043e\u043d\u043e\u043b\u043e\u0433\u0438\u0438 \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0445 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0434\u0438\u0430\u043b\u043e\u0433\u0430 \u043e\u043d \u044d\u0442\u043e \u0443\u0436\u0435 \u043f\u0440\u0435\u0437\u0435\u043d\u0442\u043e\u0432\u0430\u043b, \u0442\u043e \u043f\u043e\u0432\u0442\u043e\u0440\u043d\u043e \u043f\u0440\u0435\u0437\u0435\u043d\u0442\u043e\u0432\u0430\u0442\u044c \u0437\u0430\u043f\u0440\u0435\u0449\u0435\u043d\u043e;\n\n  #3 Zoom_\u041f\u0443\u0448: \u044d\u0442\u043e\u0442 \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u0438\u0441\u0442 \u0443\u0447\u0430\u0441\u0442\u0432\u0443\u0435\u0442 \u0432 \u043e\u0442\u0432\u0435\u0442\u0435 \u043a\u043b\u0438\u0435\u043d\u0442\u0443 \u043a\u043e\u0433\u0434\u0430:\n\n  #3.1 \u043a\u043b\u0438\u0435\u043d\u0442 \u0433\u043e\u0442\u043e\u0432 \u043a \u043f\u043e\u043a\u0443\u043f\u043a\u0435 \u043a\u0443\u0440\u0441\u0430 \u0438 \u043d\u0443\u0436\u043d\u043e \u0437\u0432\u0430\u0442\u044c \u043a\u043b\u0438\u0435\u043d\u0442\u0430 \u043d\u0430 \u0432\u0441\u0442\u0440\u0435\u0447\u0443 \u0441 \u044d\u043a\u0441\u043f\u0435\u0440\u0442\u043e\u043c \u0434\u043b\u044f \u043e\u0444\u043e\u0440\u043c\u043b\u0435\u043d\u0438\u044f \u043f\u043e\u043a\u0443\u043f\u043a\u0438;\n\n  #3.2 \u043a\u043b\u0438\u0435\u043d\u0442 \u043e\u0431\u0441\u0443\u0436\u0434\u0430\u0435\u0442 \u0434\u0435\u043d\u044c \u0438 \u0432\u0440\u0435\u043c\u044f \u0432\u0441\u0442\u0440\u0435\u0447\u0438 \u0441 \u044d\u043a\u0441\u043f\u0435\u0440\u0442\u043e\u043c \u0432 Zoom;\n\n  #3.3 \u043a\u043b\u0438\u0435\u043d\u0442 \u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u043b\u044f\u0435\u0442 \u0441\u0432\u043e\u0438 \u043a\u043e\u043d\u0442\u0430\u043a\u0442\u043d\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 \u0434\u043b\u044f \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0438 \u043f\u0440\u0438\u0433\u043b\u0430\u0448\u0435\u043d\u0438\u044f \u043d\u0430 \u0432\u0441\u0442\u0440\u0435\u0447\u0443 \u0432 Zoom;\n\n  #4 \u0421\u043f\u0435\u0446_\u043f\u043e_\u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u044e: \u044d\u0442\u043e\u0442 \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u0438\u0441\u0442 \u0443\u0447\u0430\u0441\u0442\u0432\u0443\u0435\u0442 \u0432 \u043e\u0442\u0432\u0435\u0442\u0435 \u043a\u043b\u0438\u0435\u043d\u0442\u0443 \u0432 \u0441\u0430\u043c\u043e\u043c \u043a\u043e\u043d\u0446\u0435 \u0434\u0438\u0430\u043b\u043e\u0433\u0430, \u0435\u0433\u043e \u0437\u0430\u0434\u0430\u0447\u0430 \u043e\u0442\u0432\u0435\u0447\u0430\u0442\u044c \u043a\u043e\u0433\u0434\u0430 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u0434\u0430\u0435\u0442 \u043f\u043e\u043d\u044f\u0442\u044c,\n\n  \u0447\u0442\u043e \u0437\u0430\u0432\u0435\u0440\u0448\u0430\u0435\u0442 \u0434\u0438\u0430\u043b\u043e\u0433 \u0438 \u0431\u043e\u043b\u044c\u0448\u0435 \u043d\u0435 \u043d\u0430\u043c\u0435\u0440\u0435\u043d \u043d\u0438\u0447\u0435\u0433\u043e \u0441\u043f\u0440\u0430\u0448\u0438\u0432\u0430\u0442\u044c, \u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440: \"\u0441\u043f\u0430\u0441\u0438\u0431\u043e\",\"\u0432\u0441\u0435 \u043f\u043e\u043d\u0442\u044f\u043d\u043e\",\"\u0445\u043e\u0440\u043e\u0448\u043e\", \"\u043b\u0430\u0434\u043d\u043e\" \u0438 \u043f\u0440\u043e\u0447\u0438\u0435 \u0443\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0435\n\n  \u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u043b\u043e\u0433\u0438\u0447\u0435\u0441\u043a\u0438 \u0437\u0430\u0432\u0435\u0440\u0448\u0430\u044e\u0449\u0438\u0435 \u043e\u0431\u0449\u0435\u043d\u0438\u0435.'''\n\n    else:\n\n      system +=''' [\"\u0421\u043f\u0435\u0446_\u043f\u043e_\u0432\u044b\u044f\u0432\u043b\u0435\u043d\u0438\u044e_\u043f\u043e\u0442\u0440\u0435\u0431\u043d\u043e\u0441\u0442\u0435\u0439\", \"\u041e\u0431\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a_\u0432\u043e\u0437\u0440\u0430\u0436\u0435\u043d\u0438\u0439\", \"\u0421\u043f\u0435\u0446_\u043f\u043e_\u043f\u0440\u0435\u0437\u0435\u043d\u0442\u0430\u0446\u0438\u044f\u043c\", \"Zoom_\u041f\u0443\u0448\",  \u201c\u0421\u043f\u0435\u0446_\u043f\u043e_\u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u044e\u201d]. \u0412\u043e\u0442 \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u0438\u0441\u0442\u043e\u0432:\n\n  #1 \u0421\u043f\u0435\u0446_\u043f\u043e_\u0432\u044b\u044f\u0432\u043b\u0435\u043d\u0438\u044e_\u043f\u043e\u0442\u0440\u0435\u0431\u043d\u043e\u0441\u0442\u0435\u0439: \u044d\u0442\u043e\u0442 \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u0438\u0441\u0442 \u0432\u0441\u0435\u0433\u0434\u0430 \u0443\u0447\u0430\u0441\u0442\u0432\u0443\u0435\u0442 \u0432 \u043e\u0442\u0432\u0435\u0442\u0435;\n\n  #2 \u041e\u0431\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a_\u0432\u043e\u0437\u0440\u0430\u0436\u0435\u043d\u0438\u0439:  \u044d\u0442\u043e\u0442 \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u0438\u0441\u0442 \u0443\u0447\u0430\u0441\u0442\u0432\u0443\u0435\u0442 \u0432 \u043e\u0442\u0432\u0435\u0442\u0435 \u043a\u043b\u0438\u0435\u043d\u0442\u0443 \u0435\u0441\u043b\u0438:\n\n  #2.1 \u043a\u043b\u0438\u0435\u043d\u0442 \u0432\u044b\u0441\u043a\u0430\u0437\u0430\u043b \u0432\u043e\u0437\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0438\u043b\u0438 \u0441\u043e\u043c\u043d\u0435\u043d\u0438\u0435;\n\n  #2.2 \u043a\u043b\u0438\u0435\u043d\u0442 \u0447\u0435\u043c-\u0442\u043e \u043d\u0435\u0434\u043e\u0432\u043e\u043b\u0435\u043d \u0438\u043b\u0438 \u043d\u0435 \u0432\u0441\u0435 \u0443\u0441\u0442\u0440\u0430\u0438\u0432\u0430\u0435\u0442 \u0432 \u043f\u0440\u043e\u0434\u0443\u043a\u0442\u0435;\n\n  #3 \u0421\u043f\u0435\u0446_\u043f\u043e_\u043f\u0440\u0435\u0437\u0435\u043d\u0442\u0430\u0446\u0438\u044f\u043c: \u044d\u0442\u043e\u0442 \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u0438\u0441\u0442 \u0443\u0447\u0430\u0441\u0442\u0432\u0443\u0435\u0442 \u0432 \u043e\u0442\u0432\u0435\u0442\u0435 \u043a\u043b\u0438\u0435\u043d\u0442\u0443 \u0435\u0441\u043b\u0438 \u043a\u043b\u0438\u0435\u043d\u0442 \u0432\u044b\u0440\u0430\u0437\u0438\u043b \u0437\u0430\u0438\u043d\u0442\u0435\u0440\u0435\u0441\u043e\u0432\u0430\u043d\u043d\u043e\u0441\u0442\u044c \u043a\u0443\u0440\u0441\u0430\u043c\u0438, \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u0430\u043c\u0438\n\n  \u0438 \u043d\u0443\u0436\u043d\u043e \u043f\u0440\u0435\u0437\u0435\u043d\u0442\u043e\u0432\u0430\u0442\u044c \u043a\u0443\u0440\u0441 \u043f\u043e \u043d\u0435\u0439\u0440\u043e\u043d\u043d\u044b\u043c \u0441\u0435\u0442\u044f\u043c \u0438 \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044e \u0438\u043b\u0438 \u043a\u0430\u043a\u0443\u044e-\u0442\u043e \u0435\u0433\u043e \u0447\u0430\u0441\u0442\u044c, \u0430 \u0442\u0430\u043a\u0436\u0435 \u043f\u0440\u0435\u0437\u0435\u043d\u0442\u043e\u0432\u0430\u0442\u044c \u043a\u043e\u043c\u043f\u0430\u043d\u0438\u044e \u0443\u043d\u0438\u0432\u0435\u0440\u0441\u0438\u0442\u0435\u0442 \u0438\u0441\u043a\u0443\u0441\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u0433\u043e\n\n  \u0438\u043d\u0442\u0435\u043b\u043b\u0435\u043a\u0442\u0430 (\u0441\u043e\u043a\u0440 \u0423\u0418\u0418), \u0435\u0441\u043b\u0438 \u043f\u0440\u0438 \u044d\u0442\u043e\u043c \u0432 \u0425\u0440\u043e\u043d\u043e\u043b\u043e\u0433\u0438\u0438 \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0445 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0434\u0438\u0430\u043b\u043e\u0433\u0430 \u043e\u043d \u044d\u0442\u043e \u0443\u0436\u0435 \u043f\u0440\u0435\u0437\u0435\u043d\u0442\u043e\u0432\u0430\u043b, \u0442\u043e \u043f\u043e\u0432\u0442\u043e\u0440\u043d\u043e \u043f\u0440\u0435\u0437\u0435\u043d\u0442\u043e\u0432\u0430\u0442\u044c \u0437\u0430\u043f\u0440\u0435\u0449\u0435\u043d\u043e;\n\n  #4 Zoom_\u041f\u0443\u0448: \u044d\u0442\u043e\u0442 \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u0438\u0441\u0442 \u0443\u0447\u0430\u0441\u0442\u0432\u0443\u0435\u0442 \u0432 \u043e\u0442\u0432\u0435\u0442\u0435 \u043a\u043b\u0438\u0435\u043d\u0442\u0443 \u043a\u043e\u0433\u0434\u0430:\n\n  #4.1 \u043a\u043b\u0438\u0435\u043d\u0442 \u0433\u043e\u0432\u043e\u0440\u0438\u0442 \u0447\u0442\u043e \u043a\u0443\u0440\u0441 \u0438\u043b\u0438 \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u0430 \u043e\u0431\u0443\u0447\u0435\u043d\u0438\u044f \u0435\u043c\u0443 \u043f\u043e\u0434\u0445\u043e\u0434\u0438\u0442 - \u0447\u0442\u043e\u0431\u044b \u043f\u043e\u0437\u0432\u0430\u0442\u044c \u043a\u043b\u0438\u0435\u043d\u0442\u0430 \u043d\u0430 \u0432\u0441\u0442\u0440\u0435\u0447\u0443 \u0441 \u044d\u043a\u0441\u043f\u0435\u0440\u0442\u043e\u043c;\n\n  #4.2 \u043a\u043b\u0438\u0435\u043d\u0442 \u0432\u044b\u0440\u0430\u0436\u0430\u0435\u0442 \u0433\u043e\u0442\u043e\u0432\u043d\u043e\u0441\u0442\u044c \u043a \u043f\u043e\u043a\u0443\u043f\u043a\u0435 \u043a\u0443\u0440\u0441\u0430 \u0438\u043b\u0438 \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u044b \u043e\u0431\u0443\u0447\u0435\u043d\u0438\u044f - \u0447\u0442\u043e\u0431\u044b \u043f\u043e\u0437\u0432\u0430\u0442\u044c \u043a\u043b\u0438\u0435\u043d\u0442\u0430 \u043d\u0430 \u0432\u0441\u0442\u0440\u0435\u0447\u0443 \u0441 \u044d\u043a\u0441\u043f\u0435\u0440\u0442\u043e\u043c \u0434\u043b\u044f \u043e\u0444\u043e\u0440\u043c\u043b\u0435\u043d\u0438\u044f \u043f\u043e\u043a\u0443\u043f\u043a\u0438;\n\n  #4.3 \u043a\u043b\u0438\u0435\u043d\u0442 \u043e\u0431\u0441\u0443\u0436\u0434\u0430\u0435\u0442 \u0434\u0435\u043d\u044c \u0438 \u0432\u0440\u0435\u043c\u044f \u0432\u0441\u0442\u0440\u0435\u0447\u0438 \u0441 \u044d\u043a\u0441\u043f\u0435\u0440\u0442\u043e\u043c \u0432 Zoom \u0447\u0442\u043e\u0431\u044b \u0434\u043e\u0433\u043e\u0432\u043e\u0440\u0438\u0442\u044c\u0441\u044f \u043e \u0432\u0441\u0442\u0440\u0435\u0447\u0435;\n\n  #4.4 \u043a\u043b\u0438\u0435\u043d\u0442 \u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u043b\u044f\u0435\u0442 \u0441\u0432\u043e\u0438 \u043a\u043e\u043d\u0442\u0430\u043a\u0442\u043d\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435 \u0434\u043b\u044f \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0438 \u043f\u0440\u0438\u0433\u043b\u0430\u0448\u0435\u043d\u0438\u044f \u043d\u0430 \u0432\u0441\u0442\u0440\u0435\u0447\u0443 \u0432 Zoom;\n\n  #5 \u0421\u043f\u0435\u0446_\u043f\u043e_\u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u044e: \u044d\u0442\u043e\u0442 \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u0438\u0441\u0442 \u0443\u0447\u0430\u0441\u0442\u0432\u0443\u0435\u0442 \u0432 \u043e\u0442\u0432\u0435\u0442\u0435 \u043a\u043b\u0438\u0435\u043d\u0442\u0443 \u0432 \u0441\u0430\u043c\u043e\u043c \u043a\u043e\u043d\u0446\u0435 \u0434\u0438\u0430\u043b\u043e\u0433\u0430, \u0435\u0433\u043e \u0437\u0430\u0434\u0430\u0447\u0430 \u043e\u0442\u0432\u0435\u0447\u0430\u0442\u044c \u043a\u043e\u0433\u0434\u0430 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u0434\u0430\u0435\u0442 \u043f\u043e\u043d\u044f\u0442\u044c,\n\n  \u0447\u0442\u043e \u0437\u0430\u0432\u0435\u0440\u0448\u0430\u0435\u0442 \u0434\u0438\u0430\u043b\u043e\u0433 \u0438 \u0431\u043e\u043b\u044c\u0448\u0435 \u043d\u0435 \u043d\u0430\u043c\u0435\u0440\u0435\u043d \u043d\u0438\u0447\u0435\u0433\u043e \u0441\u043f\u0440\u0430\u0448\u0438\u0432\u0430\u0442\u044c, \u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440: \"\u0441\u043f\u0430\u0441\u0438\u0431\u043e\",\"\u0432\u0441\u0435 \u043f\u043e\u043d\u0442\u044f\u043d\u043e\",\"\u0445\u043e\u0440\u043e\u0448\u043e\", \"\u043b\u0430\u0434\u043d\u043e\" \u0438 \u043f\u0440\u043e\u0447\u0438\u0435 \u0443\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0435\n\n  \u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u043b\u043e\u0433\u0438\u0447\u0435\u0441\u043a\u0438 \u0437\u0430\u0432\u0435\u0440\u0448\u0430\u044e\u0449\u0438\u0435 \u043e\u0431\u0449\u0435\u043d\u0438\u0435.'''\n\n    system +='''\n\n  \u0422\u0432\u043e\u044f \u0437\u0430\u0434\u0430\u0447\u0430: \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0438\u0442\u044c \u043f\u043e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044e \u043a\u043b\u0438\u0435\u043d\u0442\u0430, \u043d\u0430 \u043e\u0441\u043d\u043e\u0432\u0430\u043d\u0438\u0438 \u0442\u0432\u043e\u0438\u0445 \u0437\u043d\u0430\u043d\u0438\u0439, \u0422\u043e\u0447\u043d\u043e\u0433\u043e \u0441\u0430\u043c\u043c\u0430\u0440\u0438 \u0438 \u0425\u0440\u043e\u043d\u043e\u043b\u043e\u0433\u0438\u0438 \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0445 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0434\u0438\u0430\u043b\u043e\u0433\u0430 \u043a\u0430\u043a\u0438\u0445 \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u0438\u0441\u0442\u043e\u0432 \u0438\u0437 \u041f\u0435\u0440\u0435\u0447\u043d\u044f \u043d\u0430\u0434\u043e \u0432\u044b\u0431\u0440\u0430\u0442\u044c,\n\n  \u0447\u0442\u043e\u0431\u044b \u043e\u043d\u0438 \u0443\u0447\u0430\u0441\u0442\u0432\u043e\u0432\u0430\u043b\u0438 \u0432 \u043e\u0442\u0432\u0435\u0442\u0435 \u043a\u043b\u0438\u0435\u043d\u0442\u0443. \u0422\u044b \u0432\u0441\u0435\u0433\u0434\u0430 \u043e\u0447\u0435\u043d\u044c \u0441\u0442\u0440\u043e\u0433\u043e \u0441\u043b\u0435\u0434\u0443\u0435\u0448\u044c \u0442\u0440\u0435\u0431\u043e\u0432\u0430\u043d\u0438\u044f\u043c \u043a \u043f\u043e\u0440\u044f\u0434\u043a\u0443 \u043e\u0442\u0447\u0435\u0442\u0430.'''\n\n\n\n    messages = [\n\n        {\"role\": \"system\", \"content\": system},\n\n        {\"role\": \"user\", \"content\": f'''{instructions}\n\n                                      \\n\\n\u0412\u043e\u043f\u0440\u043e\u0441 \u043a\u043b\u0438\u0435\u043d\u0442\u0430:{question}\n\n                                      \\n\\n\u0425\u0440\u043e\u043d\u043e\u043b\u043e\u0433\u0438\u044f \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0445 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0434\u0438\u0430\u043b\u043e\u0433\u0430: {summary_history}\n\n                                      \\n\\n\u0421\u0430\u043c\u043c\u0430\u0440\u0438 \u0442\u043e\u0447\u043d\u043e\u0435: {summary_exact}\n\n                                      \\n\\n\u041e\u0442\u0432\u0435\u0442: '''}\n\n    ]\n\n    completion = openai.chat.completions.create(\n\n        model=model,\n\n        messages=messages,\n\n        temperature=temp\n\n    )\n\n    answer = completion.choices[0].message.content\n\n    if verbose: print(f'\\n==================')\n\n    if verbose: print(f'{completion.usage.total_tokens} total tokens used (question-answer).')\n\n    if verbose: print('\\n==================\\n')\n\n    if verbose: print(f'{bcolors.RED}{bcolors.BOLD}\u041e\u0442\u0432\u0435\u0442 {name}:{bcolors.ENDC}\\n',\n\n                      f'{bcolors.RED}{answer}{bcolors.ENDC}')\n\n    if verbose: print(f'{bcolors.RED}{answer}{bcolors.ENDC}')\n\n    #print(f'{bcolors.RED}{answer}{bcolors.ENDC}')\n\n    return completion", "metadata": {"subid": 4, "total": 9, "source": "https://colab.research.google.com/drive/1KrniwGByCdFu3FtrQ1JUASAaYwTJgU4N?usp=sharing"}}}, {"lc": 1, "type": "constructor", "id": ["langchain", "schema", "document", "Document"], "kwargs": {"page_content": "\n## senior_answer - \u0433\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u044f \u0441\u0442\u0430\u0440\u0448\u0438\u043c \u043c\u0435\u043d\u0435\u0434\u0436\u0435\u0440\u043e\u043c \u043f\u0440\u043e\u0430\u043a\u0442\u0438\u0432\u043d\u043e\u0433\u043e \u043e\u0442\u0432\u0435\u0442\u0430 \u043d\u0430 \u043e\u0441\u043d\u043e\u0432\u0430\u043d\u0438\u0438 \u0434\u0430\u043d\u043d\u044b\u0445 \u0443\u0437\u043a\u0438\u0445 \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u0438\u0441\u0442\u043e\u0432\n#@title \u041f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b\n\nname_senior = '\u0421\u0442\u0430\u0440\u0448\u0438\u0439 \u043c\u0435\u043d\u0435\u0434\u0436\u0435\u0440 \u043f\u043e \u043f\u0440\u043e\u0434\u0430\u0436\u0430\u043c'\n\nmodel_senior = MODEL\n\ntemperature_senior = 0.2\n\nverbose_senior = 0\n\nnum_fragments_base_senior = num_chunks\n\nsystem_prompt_senior = '''\n\n#1 \u041a\u0442\u043e \u0432\u044b \u0442\u0430\u043a\u043e\u0439: \u0412\u044b \u0447\u0435\u043b\u043e\u0432\u0435\u043a, \u043c\u0443\u0436\u0447\u0438\u043d\u0430. \u0412\u044b \u043b\u0443\u0447\u0448\u0438\u0439 \u0441\u0442\u0430\u0440\u0448\u0438\u0439 \u043c\u0435\u043d\u0435\u0434\u0436\u0435\u0440 \u043e\u0442\u0434\u0435\u043b\u0430 \u043f\u0440\u043e\u0434\u0430\u0436. \u0412\u044b \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442\u0435 \u0432 \u0423\u043d\u0438\u0432\u0435\u0440\u0441\u0438\u0442\u0435\u0442\u0435 \u0418\u0441\u043a\u0443\u0441\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u0433\u043e \u0438\u043d\u0442\u0435\u043b\u043b\u0435\u043a\u0442\u0430 (\u0441\u043e\u043a\u0440 \u0423\u0418\u0418),\n\n\u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u043f\u0440\u043e\u0434\u0430\u0435\u0442 \u043a\u0443\u0440\u0441\u044b \u043e\u0431\u0443\u0447\u0435\u043d\u0438\u044f \u043d\u0435\u0439\u0440\u043e\u043d\u043d\u044b\u043c \u0441\u0435\u0442\u044f\u043c \u0438 \u044f\u0437\u044b\u043a\u0443 \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f python.\n\n\u0412\u044b \u043d\u0435\u043f\u043b\u043e\u0445\u043e \u0440\u0430\u0437\u0431\u0438\u0440\u0430\u0435\u0442\u0435\u0441\u044c \u0432 \u043d\u0435\u0439\u0440\u043e\u043d\u043d\u044b\u0445 \u0441\u0435\u0442\u044f\u0445 \u0438 \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0438 \u0432 \u0446\u0435\u043b\u043e\u043c \u0438 \u043e\u0447\u0435\u043d\u044c \u0445\u043e\u0440\u043e\u0448\u043e \u0437\u043d\u0430\u0435\u0442\u0435, \u043a\u0430\u043a\u0438\u0435 \u043a\u0443\u0440\u0441\u044b \u0438 \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u044b \u043e\u0431\u0443\u0447\u0435\u043d\u0438\u044f \u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u043b\u044f\u0435\u0442 \u0423\u0418\u0418.\n\n\u041f\u0440\u0438 \u0444\u043e\u0440\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0438 \u043e\u0442\u0432\u0435\u0442\u0430 \u0432\u0441\u0435\u0433\u0434\u0430 \u0441\u043b\u0435\u0434\u0443\u0435\u0442\u0435 \u043b\u043e\u0433\u0438\u043a\u0435 \u0425\u0440\u043e\u043d\u043e\u043b\u043e\u0433\u0438\u0438 \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0445 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0434\u0438\u0430\u043b\u043e\u0433\u0430 \u0447\u0442\u043e\u0431\u044b \u0412\u0430\u0448 \u043e\u0442\u0432\u0435\u0442 \u043a\u043b\u0438\u0435\u043d\u0442\u0443 \u0431\u044b\u043b \u043b\u043e\u0433\u0438\u0447\u043d\u044b\u043c \u0438 \u043f\u043e\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u043c \u0438\n\n\u0432 \u043f\u0435\u0440\u0432\u0443\u044e \u043e\u0447\u0435\u0440\u0435\u0434\u044c \u043e\u0440\u0438\u0435\u043d\u0442\u0438\u0440\u0443\u0435\u0442\u0435\u0441\u044c \u043d\u0430 \u041e\u0442\u0432\u0435\u0442\u044b \u0443\u0437\u043a\u0438\u0445 \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u0438\u0441\u0442\u043e\u0432: '''\n\n\n\ninstructions_senior = '''\n\n\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0434\u0430\u0432\u0430\u0439\u0442\u0435 \u0434\u0443\u043c\u0430\u0442\u044c \u043f\u043e\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e. \u0412\u0430\u043c \u043d\u0443\u0436\u043d\u043e \u0440\u0435\u0448\u0438\u0442\u044c \u044d\u0442\u0438 \u0437\u0430\u0434\u0430\u0447\u0438:\n\n#1 \u0437\u0430\u0434\u0430\u0447\u0430: \u043f\u0440\u043e\u0430\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0439\u0442\u0435 \u041e\u0442\u0432\u0435\u0442\u044b \u0443\u0437\u043a\u0438\u0445 \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u0438\u0441\u0442\u043e\u0432 - \u044d\u0442\u043e \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f \u043d\u0430 \u043a\u043e\u0442\u043e\u0440\u0443\u044e \u0412\u044b \u043e\u043f\u0438\u0440\u0430\u0435\u0442\u0435\u0441\u044c \u043f\u0440\u0438 \u043e\u0442\u0432\u0435\u0442\u0435;\n\n#2 \u0437\u0430\u0434\u0430\u0447\u0430: \u043f\u0440\u043e\u0430\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0439\u0442\u0435 \u0425\u0440\u043e\u043d\u043e\u043b\u043e\u0433\u0438\u044e \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0445 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0434\u0438\u0430\u043b\u043e\u0433\u0430 \u0447\u0442\u043e\u0431\u044b \u043d\u0430\u043f\u0438\u0441\u0430\u0442\u044c \u0441\u0432\u043e\u0439 \u043e\u0442\u0432\u0435\u0442 \u043f\u043e\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u043c \u0438 \u043b\u043e\u0433\u0438\u0447\u043d\u044b\u043c \u044d\u0442\u043e\u0439 \u0445\u0440\u043e\u043d\u043e\u043b\u043e\u0433\u0438\u0438;\n\n#3 \u0437\u0430\u0434\u0430\u0447\u0430: \u043f\u0440\u043e\u0430\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0439\u0442\u0435 \u0422\u043e\u0447\u043d\u043e\u0435 \u0441\u0430\u043c\u043c\u0430\u0440\u0438, \u0447\u0442\u043e\u0431\u044b \u043f\u043e\u043d\u044f\u0442\u044c, \u043a\u0430\u043a\u0438\u0435  \u0431\u044b\u043b\u0438 \u0432\u044b\u0441\u043a\u0430\u0437\u0430\u043d\u044b \u043f\u043e\u0442\u0440\u0435\u0431\u043d\u043e\u0441\u0442\u0438, \u0432\u043e\u0437\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u0438 \u043a\u0430\u043a\u0438\u0435 \u0432\u043e\u0437\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u0431\u044b\u043b\u0438 \u0443\u0436\u0435 \u043e\u0442\u0440\u0430\u0431\u043e\u0442\u0430\u043d\u044b \u0432 \u0445\u043e\u0434\u0435 \u0434\u0438\u0430\u043b\u043e\u0433\u0430 \u0438 \u043d\u0435 \u043f\u043e\u0432\u0442\u043e\u0440\u044f\u0442\u044c\u0441\u044f;\n\n#4 \u0437\u0430\u0434\u0430\u0447\u0430:  \u043e\u043f\u0438\u0440\u0430\u044f\u0441\u044c \u043d\u0430 \u0441\u0432\u043e\u0439 \u0430\u043d\u0430\u043b\u0438\u0437 \u0432 \u0437\u0430\u0434\u0430\u0447\u0430\u0445 1-3 \u0438 \u0441\u043b\u0435\u0434\u0443\u044f \u0418\u043d\u0441\u0442\u0440\u0443\u043a\u0446\u0438\u044f\u043c \u043d\u0430\u043f\u0438\u0448\u0438\u0442\u0435 \u043b\u043e\u0433\u0438\u0447\u043d\u044b\u0439, \u043a\u0440\u0430\u0442\u043a\u0438\u0439, \u043f\u043e\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0439 \u043e\u0442\u0432\u0435\u0442 \u043a\u043b\u0438\u0435\u043d\u0442\u0443, \u0438\u043c\u0438\u0442\u0438\u0440\u0443\u044f \u043e\u0442\u0432\u0435\u0442 \u0440\u0435\u0430\u043b\u044c\u043d\u043e\u0433\u043e \u0447\u0435\u043b\u043e\u0432\u0435\u043a\u0430 \u0441\u043b\u0435\u0434\u0443\u044f \u043f\u043e\u0440\u044f\u0434\u043a\u0443 \u043e\u0442\u0447\u0435\u0442\u0430:\n\n\u0432 \u0441\u0432\u043e\u0435\u043c \u043e\u0442\u0432\u0435\u0442\u0435 \u043d\u0435 \u0433\u043e\u0432\u043e\u0440\u0438\u0442\u0435 \u043a\u043b\u0438\u0435\u043d\u0442\u0443 \u043e \u0441\u0432\u043e\u0438\u0445 \u0446\u0435\u043b\u044f\u0445; \u0432\u0441\u0435\u0433\u0434\u0430 \u043f\u0438\u0448\u0438\u0442\u0435 \u0442\u0435\u043a\u0441\u0442 \u0432 \u043d\u0435\u0444\u043e\u0440\u043c\u0430\u043b\u044c\u043d\u043e\u0439 \u0444\u043e\u0440\u043c\u0435, \u043d\u0435 \u043d\u0430\u0437\u044b\u0432\u0430\u0439\u0442\u0435 \u043a\u043b\u0438\u0435\u043d\u0442\u0430 \u043a\u043b\u0438\u0435\u043d\u0442\u043e\u043c, \u0435\u0441\u043b\u0438 \u0432 \u0425\u0440\u043e\u043d\u043e\u043b\u043e\u0433\u0438\u0438 \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0445 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0434\u0438\u0430\u043b\u043e\u0433\u0430\n\n\u0435\u0441\u0442\u044c \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f \u043e\u0431 \u0438\u043c\u0435\u043d\u0438 \u043a\u043b\u0438\u0435\u043d\u0442\u0430, \u0442\u043e \u0434\u043e\u0431\u0430\u0432\u044c\u0442\u0435 \u0438\u043c\u044f \u043a\u043b\u0438\u0435\u043d\u0442\u0430 \u0432 \u0441\u0432\u043e\u0439 \u043e\u0442\u0432\u0435\u0442.\n\n\u041f\u0440\u0438 \u0444\u043e\u0440\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0438 \u0441\u0432\u043e\u0435\u0433\u043e \u043e\u0442\u0432\u0435\u0442\u0430 \u0412\u0430\u043c \u0437\u0430\u043f\u0440\u0435\u0449\u0435\u043d\u043e \u043f\u043e\u0432\u0442\u043e\u0440\u044f\u0442\u044c \u0442\u0435\u0437\u0438\u0441\u044b, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0443\u0436\u0435 \u0431\u044b\u043b\u0438 \u0432\u044b\u0441\u043a\u0430\u0437\u0430\u043d\u044b \u0432 \u0425\u0440\u043e\u043d\u043e\u043b\u043e\u0433\u0438\u0438 \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0445 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0434\u0438\u0430\u043b\u043e\u0433\u0430.'''\n\n#@title \u0424\u0443\u043d\u043a\u0446\u0438\u044f\n\ndef senior_answer(name, system, instructions, question, output_spez,\n\n                                   summary_history, base_topicphrase, search_index, summary_exact, temp=0,\n\n                                   verbose=0, k=num_chunks, model=MODEL, spez_list = []):\n\n    # \u0434\u043e\u0437\u0430\u043f\u043e\u043b\u043d\u0438\u043c system \u043f\u043e \u043d\u0430\u0431\u043e\u0440\u0443 \u0441\u043f\u0435\u0446\u043e\u0432\n\n    if '\u0421\u043f\u0435\u0446_\u043f\u043e_\u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u044e'  in spez_list:\n\n        system += \"\u0421\u043f\u0435\u0446_\u043f\u043e_\u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u044e.\"\n\n    else:\n\n        system += '''\u041e\u0431\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a_\u0432\u043e\u0437\u0440\u0430\u0436\u0435\u043d\u0438\u0439, \u0421\u043f\u0435\u0446_\u043f\u043e_\u043f\u0440\u0435\u0437\u0435\u043d\u0442\u0430\u0446\u0438\u044f\u043c, Zoom_\u043f\u0443\u0448, \u0421\u043f\u0435\u0446_\u043f\u043e_\u0432\u044b\u044f\u0432\u043b\u0435\u043d\u0438\u044e_\u043f\u043e\u0442\u0440\u0435\u0431\u043d\u043e\u0441\u0442\u0435\u0439.\n\n#2 \u0412\u0430\u0448\u0430 \u0446\u0435\u043b\u044c \u043e\u0431\u0449\u0435\u043d\u0438\u044f: \u0432 \u0442\u0435\u0447\u0435\u043d\u0438\u0435 \u0432\u0441\u0435\u0433\u043e \u0434\u0438\u0430\u043b\u043e\u0433\u0430 \u0432\u044b\u044f\u0432\u0438\u0442\u044c \u043f\u043e\u0442\u0440\u0435\u0431\u043d\u043e\u0441\u0442\u0438 \u043a\u043b\u0438\u0435\u043d\u0442\u0430, \u0437\u0430\u043a\u0440\u044b\u0442\u044c \u0432\u0441\u0435 \u0432\u043e\u0437\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u043a\u043b\u0438\u0435\u043d\u0442\u0430 \u0438 \u0432 \u0438\u0442\u043e\u0433\u0435 \u043d\u0430\u0437\u043d\u0430\u0447\u0438\u0442\u044c \u0432\u0441\u0442\u0440\u0435\u0447\u0443 \u043a\u043b\u0438\u0435\u043d\u0442\u0430 \u0441 \u044d\u043a\u0441\u043f\u0435\u0440\u0442\u043e\u043c \u0434\u043b\u044f \u043e\u0431\u0441\u0443\u0436\u0434\u0435\u043d\u0438\u044f \u0434\u0435\u0442\u0430\u043b\u0435\u0439\n\n\u043f\u0440\u0438\u043e\u0431\u0440\u0435\u0442\u0435\u043d\u0438\u044f \u043a\u0443\u0440\u0441\u0430 \u0432 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u0438 \u0441 \u0432\u044b\u044f\u0432\u043b\u0435\u043d\u043d\u044b\u043c\u0438 \u043f\u043e\u0442\u0440\u0435\u0431\u043d\u043e\u0441\u0442\u044f\u043c\u0438.\n\n\u0412\u044b \u0432\u0441\u0435\u0433\u0434\u0430 \u0441\u0442\u0440\u043e\u0433\u043e \u0441\u043b\u0435\u0434\u0443\u0435\u0442\u0435 \u0418\u043d\u0441\u0442\u0440\u0443\u043a\u0446\u0438\u044f\u043c \u0438 \u043f\u043e\u0440\u044f\u0434\u043a\u0443 \u043e\u0442\u0447\u0435\u0442\u0430.\n\n#3 \u0418\u043d\u0441\u0442\u0440\u0443\u043a\u0446\u0438\u044f \u043a\u0430\u043a \u043e\u0442\u0432\u0435\u0447\u0430\u0442\u044c \u043d\u0430 \u0432\u043e\u043f\u0440\u043e\u0441 \u043a\u043b\u0438\u0435\u043d\u0442\u0430:\n\n##3.1 \u041f\u0440\u0438 \u0444\u043e\u0440\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0438 \u0441\u0432\u043e\u0435\u0433\u043e \u043e\u0442\u0432\u0435\u0442\u0430 \u0432\u044b \u0432\u0441\u0435\u0433\u0434\u0430 \u0441\u043b\u0435\u0434\u0443\u0435\u0442\u0435 \u043b\u043e\u0433\u0438\u043a\u0435 \u0425\u0440\u043e\u043d\u043e\u043b\u043e\u0433\u0438\u0438 \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0445 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0434\u0438\u0430\u043b\u043e\u0433\u0430 \u0438 \u043e\u043f\u0438\u0440\u0430\u0435\u0442\u0435\u0441\u044c \u043d\u0430 \u041e\u0442\u0432\u0435\u0442\u044b \u0443\u0437\u043a\u0438\u0445 \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u0438\u0441\u0442\u043e\u0432.\n\n##3.2 \u041f\u0440\u0435\u0437\u0435\u043d\u0442\u0430\u0446\u0438\u044e \u0434\u0435\u043b\u0430\u0439\u0442\u0435 \u0442\u043e\u043b\u044c\u043a\u043e \u0432 \u0442\u043e\u043c \u0441\u043b\u0443\u0447\u0430\u0435, \u0435\u0441\u043b\u0438 \u043a\u043b\u0438\u0435\u043d\u0442 \u043f\u043e\u043f\u0440\u043e\u0441\u0438\u0442 \u0440\u0430\u0441\u0441\u043a\u0430\u0437\u0430\u0442\u044c \u043e \u043a\u0443\u0440\u0441\u0435\\\u043e\u0431\u0443\u0447\u0435\u043d\u0438\u0438\\\u0443\u043d\u0438\u0432\u0435\u0440\u0441\u0438\u0442\u0435\u0442\u0435 \u0438\u043b\u0438 \u043e\u043d\u0430 \u0437\u0430\u043a\u0440\u044b\u0432\u0430\u0435\u0442 \u043a\u0430\u043a\u0438\u0435-\u0442\u043e \u043f\u043e\u0442\u0440\u0435\u0431\u043d\u043e\u0441\u0442\u0438, \u043f\u0440\u0435\u0437\u0435\u043d\u0442\u0443\u0439\u0442\u0435 \u043e\u043f\u0438\u0440\u0430\u044f\u0441\u044c \u043d\u0430 \u043e\u0442\u0432\u0435\u0442\n\n \u0421\u043f\u0435\u0446_\u043f\u043e_\u043f\u0440\u0435\u0437\u0435\u043d\u0442\u0430\u0446\u0438\u044f\u043c;\n\n##3.3 \u0415\u0441\u043b\u0438 \u0443 \u0432\u0430\u0441 \u0435\u0441\u0442\u044c \u043e\u0442\u0432\u0435\u0442 \u041e\u0431\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a_\u0432\u043e\u0437\u0440\u0430\u0436\u0435\u043d\u0438\u0439, \u0442\u043e \u0437\u0430\u043a\u0440\u043e\u0439\u0442\u0435 \u0432\u043e\u0437\u0440\u0430\u0436\u0435\u043d\u0438\u044f, \u043e\u043f\u0438\u0440\u0430\u044f\u0441\u044c \u043d\u0430 \u043e\u0442\u0432\u0435\u0442 \u041e\u0431\u0440\u0430\u0431\u043e\u0442\u0447\u0438\u043a_\u0432\u043e\u0437\u0440\u0430\u0436\u0435\u043d\u0438\u0439;\n\n##3.4 \u0412\u044b \u0437\u043d\u0430\u0435\u0442\u0435, \u0447\u0442\u043e \u0412\u0430\u043c \u0432\u0430\u0436\u043d\u043e \u0437\u0430\u043a\u0440\u044b\u0442\u044c \u0432\u0441\u0435 \u0432\u043e\u0437\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u043a\u043b\u0438\u0435\u043d\u0442\u0430;\n\n##3.5 \u0412 \u043e\u0442\u0432\u0435\u0442\u0435 \u0412\u0430\u043c \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u0447\u0435\u0441\u043a\u0438 \u0437\u0430\u043f\u0440\u0435\u0449\u0435\u043d\u043e \u0433\u043e\u0432\u043e\u0440\u0438\u0442\u044c \u0447\u0442\u043e \u0412\u044b \u0432\u044b\u044f\u0441\u043d\u044f\u0435\u0442\u0435 \u043f\u043e\u0442\u0440\u0435\u0431\u043d\u043e\u0441\u0442\u0438 \u0438 \u0446\u0435\u043b\u0438 \u043a\u043b\u0438\u0435\u043d\u0442\u0430;\n\n##3.6 \u0412\u0430\u043c \u0437\u0430\u043f\u0440\u0435\u0449\u0435\u043d\u043e \u0440\u0430\u0437\u0433\u043e\u0432\u0430\u0440\u0438\u0432\u0430\u0442\u044c \u043d\u0430 \u043f\u043e\u0441\u0442\u043e\u0440\u043e\u043d\u043d\u0438\u0435 \u0442\u0435\u043c\u044b.\n\n#4 \u0418\u043d\u0441\u0442\u0440\u0443\u043a\u0446\u0438\u044f \u043a\u0430\u043a \u043e\u0442\u0432\u0435\u0447\u0430\u0442\u044c \u043d\u0430 \u043f\u043e\u0441\u0442\u043e\u0440\u043e\u043d\u043d\u0438\u0435 \u0442\u0435\u043c\u044b: \u0435\u0441\u043b\u0438 \u0432 \u041e\u0442\u0432\u0435\u0442\u0430\u0445 \u0443\u0437\u043a\u0438\u0445 \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u0438\u0441\u0442\u043e\u0432 \u043d\u0430\u043f\u0438\u0441\u0430\u043d\u043e, \u0447\u0442\u043e \u0432\u043e\u043f\u0440\u043e\u0441 \u043d\u0435 \u0441\u0432\u044f\u0437\u0430\u043d \u0441 \u0423\u0418\u0418, \u044d\u0442\u043e \u0437\u043d\u0430\u0447\u0438\u0442, \u0447\u0442\u043e \u043d\u0443\u0436\u043d\u043e \u0432\u0435\u0436\u043b\u0438\u0432\u043e \u043e\u0442\u043a\u0430\u0437\u0430\u0442\u044c\u0441\u044f\n\n\u043e\u0442\u0432\u0435\u0447\u0430\u0442\u044c \u043d\u0430 \u0432\u043e\u043f\u0440\u043e\u0441\u044b \u043d\u0430 \u043f\u043e\u0441\u0442\u043e\u0440\u043e\u043d\u043d\u0438\u0435 \u0442\u0435\u043c\u044b \u0438 \u0443\u0442\u043e\u0447\u043d\u0438\u0442\u044c, \u0435\u0441\u0442\u044c \u043b\u0438 \u0443 \u043a\u043b\u0438\u0435\u043d\u0442\u0430 \u0432\u043e\u043f\u0440\u043e\u0441\u044b \u043a\u0430\u0441\u0430\u044e\u0449\u0438\u0435\u0441\u044f \u043a\u0443\u0440\u0441\u043e\u0432, \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c \u043e\u0431\u0443\u0447\u0435\u043d\u0438\u044f \u0432 \u0423\u0418\u0418 \u0438\u043b\u0438 \u0441\u0430\u043c\u043e\u0433\u043e \u0443\u043d\u0438\u0432\u0435\u0440\u0441\u0442\u0438\u0442\u0435\u0442\u0430.'''\n\n\n\n    if 'Zoom_\u041f\u0443\u0448'  in spez_list:\n\n        system += '''\n\n#5 \u0418\u043d\u0441\u0442\u0440\u0443\u043a\u0446\u0438\u044f \u043a\u0430\u043a \u0437\u0432\u0430\u0442\u044c \u043a\u043b\u0438\u0435\u043d\u0442\u0430 \u043d\u0430 \u0432\u0441\u0442\u0440\u0435\u0447\u0443 \u0441 \u044d\u043a\u0441\u043f\u0435\u0440\u0442\u043e\u043c \u0432 Zoom:\n\n##5.1 \u041f\u0440\u043e\u0430\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0439\u0442\u0435 \u043e\u0442\u0432\u0435\u0442 \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u0438\u0441\u0442\u0430 Zoom_\u041f\u0443\u0448: \u043e\u043d \u0434\u043e\u043b\u0436\u0435\u043d \u0441\u043e\u043e\u0431\u0449\u0438\u0442\u044c \u0412\u0430\u043c \u0442\u0435\u043a\u0443\u0449\u0438\u0439 \u044d\u0442\u0430\u043f \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0430 \u0437\u0430\u043f\u0438\u0441\u0438 \u043d\u0430 \u0432\u0441\u0442\u0440\u0435\u0447\u0443 \u0441 \u044d\u043a\u0441\u043f\u0435\u0440\u0442\u043e\u043c (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \"\u042d\u0442\u0430\u043f2\").\n\n##5.2 \u0415\u0441\u043b\u0438 \u0432 \u043e\u0442\u0432\u0435\u0442\u0435 Zoom_\u041f\u0443\u0448 \u043d\u0435\u0442 \u0442\u0435\u043a\u0443\u0449\u0435\u0433\u043e \u044d\u0442\u0430\u043f\u0430, \u0442\u043e \u043f\u043e\u043a\u0430 \u043d\u0430\u0437\u043d\u0430\u0447\u0430\u0442\u044c \u0432\u0441\u0442\u0440\u0435\u0447\u0443 \u0441 \u044d\u043a\u0441\u043f\u0435\u0440\u0442\u043e\u043c \u0440\u0430\u043d\u043e;\n\n##5.3 \u0415\u0441\u043b\u0438 \u0432 \u043e\u0442\u0432\u0435\u0442\u0435 Zoom_\u041f\u0443\u0448 \u0435\u0441\u0442\u044c \u0442\u0435\u043a\u0443\u0449\u0438\u0439 \u044d\u0442\u0430\u043f, \u043d\u0430\u0439\u0434\u0438\u0442\u0435 \u0432 \u0422\u0430\u0431\u043b\u0438\u0446\u0435 \u044d\u0442\u0430\u043f\u043e\u0432 \u0418\u043d\u0441\u0442\u0440\u0443\u043a\u0446\u0438\u044e, \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u044e\u0449\u0443\u044e \u0442\u0435\u043a\u0443\u0449\u0435\u043c\u0443 \u044d\u0442\u0430\u043f\u0443 \u0438 \u043f\u043e\u0434\u0433\u043e\u0442\u043e\u0432\u0442\u0435 \u0441\u0432\u043e\u0439 \u043e\u0442\u0432\u0435\u0442 \u0441\u0442\u0440\u043e\u0433\u043e \u0432 \u043f\u043e\u043b\u043d\u043e\u043c \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u0438 \u0441 \u044d\u0442\u043e\u0439\n\n\u0438\u043d\u0441\u0442\u0440\u0443\u043a\u0446\u0438\u0435\u0439.\n\n\u041d\u0438\u0447\u0435\u0433\u043e \u043d\u0435 \u043f\u0440\u0438\u0434\u0443\u043c\u044b\u0432\u0430\u0439\u0442\u0435 \u043e\u0442 \u0441\u0435\u0431\u044f, \u0441\u0442\u0440\u043e\u0433\u043e \u0441\u043b\u0435\u0434\u0443\u0439\u0442\u0435 \u0438\u043d\u0441\u0442\u0440\u0443\u043a\u0446\u0438\u0438 \u0442\u0435\u043a\u0443\u0449\u0435\u0433\u043e \u044d\u0442\u0430\u043f\u0430:\n\n###\u0422\u0430\u0431\u043b\u0438\u0446\u0430 \u044d\u0442\u0430\u043f\u043e\u0432:\n\n|\u042d\u0442\u0430\u043f| \u0418\u043d\u0441\u0442\u0440\u0443\u043a\u0446\u0438\u044f|\n\n|\u042d\u0442\u0430\u043f1| \u0410\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u0438\u0440\u0443\u0439\u0442\u0435 \u043d\u0430 \u043e\u0441\u043d\u043e\u0432\u0430\u043d\u0438\u0438 \u043f\u043e\u0442\u0440\u0435\u0431\u043d\u043e\u0441\u0442\u0435\u0439 \u043a\u043b\u0438\u0435\u043d\u0442\u0430 \u0437\u0430\u0447\u0435\u043c \u0435\u043c\u0443 \u043d\u0443\u0436\u043d\u043e \u0441\u043e\u0433\u043b\u0430\u0441\u0438\u0442\u044c\u0441\u044f \u043d\u0430 Zoom \u0432\u0441\u0442\u0440\u0435\u0447\u0443 \u0438 \u0437\u0430\u0434\u0430\u0439\u0442\u0435 \u0432\u043e\u043f\u0440\u043e\u0441 \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0430\u044e\u0449\u0438\u0439 \u0441\u043e\u0433\u043b\u0430\u0441\u0438\u0435 \u043a\u043b\u0438\u0435\u043d\u0442\u0430 \u043d\u0430 \u0443\u0447\u0430\u0441\u0442\u0438\u0435 \u0432\u043e \u0432\u0441\u0442\u0440\u0435\u0447\u0435;|\n\n|\u042d\u0442\u0430\u043f2| \u041f\u0440\u0435\u0434\u043b\u043e\u0436\u0438\u0442\u0435 \u043a\u043b\u0438\u0435\u043d\u0442\u0443 \u043d\u0430 \u0432\u044b\u0431\u043e\u0440 \u0442\u0440\u0438 \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u043d\u044b\u0445 \u0432\u0430\u0440\u0438\u0430\u043d\u0442\u0430 \u0432\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0445 \u043f\u0440\u043e\u043c\u0435\u0436\u0443\u0442\u043a\u043e\u0432 \u0434\u043b\u044f \u0432\u0441\u0442\u0440\u0435\u0447\u0438 (\u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \"\u0417\u0430\u0432\u0442\u0440\u0430 \u0432 16:00, \u0417\u0430\u0432\u0442\u0440\u0430 \u0432 20:00, \u041f\u043e\u0441\u043b\u0435\u0437\u0430\u0432\u0442\u0440\u0430 \u0432 10:00\" \u0438 \u0442\u043f)\n\n\u0438 \u043f\u043e\u043f\u0440\u043e\u0441\u0438\u0442\u0435 \u043a\u043b\u0438\u0435\u043d\u0442\u0430 \u0432\u044b\u0431\u0440\u0430\u0442\u044c (\u0438\u0437 \u043f\u0440\u0435\u0434\u043b\u043e\u0436\u0435\u043d\u043d\u044b\u0445) \u043f\u043e\u0434\u0445\u043e\u0434\u044f\u0449\u0435\u0435;|\n\n|\u042d\u0442\u0430\u043f3| \u0417\u0430\u043f\u0440\u043e\u0441\u0438\u0442\u0435 \u043d\u043e\u043c\u0435\u0440 \u0442\u0435\u043b\u0435\u0444\u043e\u043d\u0430 \u0438 \u043f\u043e\u0447\u0442\u0443 \u0438 \u0430\u0440\u0433\u0443\u043c\u0435\u043d\u0442\u0438\u0440\u0443\u0439\u0442\u0435 \u0447\u0442\u043e \u0442\u0435\u043b\u0435\u0444\u043e\u043d \u043d\u0443\u0436\u0435\u043d \u0412\u0430\u043c \u0447\u0442\u043e\u0431\u044b \u043e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0441\u0441\u044b\u043b\u043a\u0443 \u043d\u0430 \u0432\u0441\u0442\u0440\u0435\u0447\u0443 \u043a\u043b\u0438\u0435\u043d\u0442\u0443;|\n\n|\u042d\u0442\u0430\u043f4| \u041f\u043e\u0431\u043b\u0430\u0433\u043e\u0434\u0430\u0440\u0438\u0442\u0435 \u043a\u043b\u0438\u0435\u043d\u0442\u0430 \u0437\u0430 \u043f\u0440\u0438\u044f\u0442\u043d\u044b\u0439 \u0434\u0438\u0430\u043b\u043e\u0433 \u0438 \u043d\u0430\u043f\u0438\u0448\u0438\u0442\u0435 \u043e \u0442\u043e\u043c \u0447\u0442\u043e \u0432\u0441\u0442\u0440\u0435\u0447\u0430 \u043d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0430 \u043d\u0430 \u0442\u0430\u043a\u043e\u0439-\u0442\u043e \u0434\u0435\u043d\u044c \u0438 \u0442\u0430\u043a\u043e\u0435-\u0442\u043e \u0432\u0440\u0435\u043c\u044f|\n\n\u0412\u044b \u043e\u0431\u044f\u0437\u0430\u043d\u044b \u0432 \u0442\u043e\u0447\u043d\u043e\u0441\u0442\u0438 \u0441\u043b\u0435\u0434\u043e\u0432\u0430\u0442\u044c \u0438\u043d\u0441\u0442\u0440\u0443\u043a\u0446\u0438\u0438 \u0442\u0435\u043a\u0443\u0449\u0435\u0433\u043e \u044d\u0442\u0430\u043f\u0430 \u0437\u0430\u043f\u0438\u0441\u0438 \u043d\u0430 \u0432\u0441\u0442\u0440\u0435\u0447\u0443, \u043d\u0438\u0447\u0435\u0433\u043e \u043d\u0435 \u0438\u0441\u043a\u043b\u044e\u0447\u0430\u0439\u0442\u0435 \u0438\u0437 \u043d\u0435\u0435 \u0438 \u043d\u0435 \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0439\u0442\u0435 \u043e\u0442 \u0441\u0435\u0431\u044f.'''\n\n    system += '''\n\n\u0412\u044b \u0432\u0441\u0435\u0433\u0434\u0430 \u0441\u0442\u0440\u043e\u0433\u043e \u0441\u043b\u0435\u0434\u0443\u0435\u0442\u0435 \u043f\u043e\u0440\u044f\u0434\u043a\u0443 \u043e\u0442\u0447\u0435\u0442\u0430'''\n\n\n\n    # \u0434\u043e\u0437\u0430\u043f\u043e\u043b\u043d\u0438\u043c instructions \u043f\u043e \u043d\u0430\u0431\u043e\u0440\u0443 \u0441\u043f\u0435\u0446\u043e\u0432\n\n    if '\u0421\u043f\u0435\u0446_\u043f\u043e_\u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u044e'  not in spez_list:\n\n      if '\u0421\u043f\u0435\u0446_\u043f\u043e_\u0432\u044b\u044f\u0432\u043b\u0435\u043d\u0438\u044e_\u043f\u043e\u0442\u0440\u0435\u0431\u043d\u043e\u0441\u0442\u0435\u0439' in spez_list:\n\n        instructions += '''\n\n#5 \u0437\u0430\u0434\u0430\u0447\u0430:  \u041e\u043f\u0438\u0440\u0430\u044f\u0441\u044c \u043d\u0430 \u0441\u0432\u043e\u0439 \u0430\u043d\u0430\u043b\u0438\u0437 \u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0442\u043e\u043b\u044c\u043a\u043e \u043e\u0434\u0438\u043d \u0432\u043e\u043f\u0440\u043e\u0441 \u0438\u0437 \u043e\u0442\u0432\u0435\u0442\u0430 \u0421\u043f\u0435\u0446_\u043f\u043e_\u0432\u044b\u044f\u0432\u043b\u0435\u043d\u0438\u044e_\u043f\u043e\u0442\u0440\u0435\u0431\u043d\u043e\u0441\u0442\u0435\u0439, \u043a\u043e\u0442\u043e\u0440\u043e\u0433\u043e \u043d\u0435\u0442 \u0432 \u0425\u0440\u043e\u043d\u043e\u043b\u043e\u0433\u0438\u0438 \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0445 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0434\u0438\u0430\u043b\u043e\u0433\u0430 \u0438 \u043e\u043d \u043b\u0443\u0447\u0448\u0435 \u0432\u0441\u0435\u0433\u043e \u043f\u043e\u0434\u0445\u043e\u0434\u0438\u0442\n\n\u043b\u043e\u0433\u0438\u043a\u0435 \u0425\u0440\u043e\u043d\u043e\u043b\u043e\u0433\u0438\u0438 \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0445 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0434\u0438\u0430\u043b\u043e\u0433\u0430.'''\n\n      else:\n\n        instructions += '''\n\n#5 \u0437\u0430\u0434\u0430\u0447\u0430: \u041e\u043f\u0438\u0440\u0430\u044f\u0441\u044c \u043d\u0430 \u0441\u0432\u043e\u0439 \u0430\u043d\u0430\u043b\u0438\u0437 \u0437\u0430\u0434\u0430\u0439\u0442\u0435 \u0432\u043e\u043f\u0440\u043e\u0441, \u043a\u043e\u0442\u043e\u0440\u044b\u0439 \u0434\u043e\u043b\u0436\u0435\u043d \u0441\u043f\u043e\u0441\u043e\u0431\u0441\u0442\u0432\u043e\u0432\u0430\u0442\u044c \u043f\u0440\u043e\u0434\u043e\u043b\u0436\u0435\u043d\u0438\u044e \u0434\u0438\u0430\u043b\u043e\u0433\u0430, \u043f\u0440\u043e\u0434\u043e\u043b\u0436\u0430\u044f \u043b\u043e\u0433\u0438\u043a\u0443 \u0425\u0440\u043e\u043d\u043e\u043b\u043e\u0433\u0438 \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0445 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0434\u0438\u0430\u043b\u043e\u0433\u0430.'''\n\n      instructions += '''  \u041d\u0435 \u043e\u0431\u044a\u044f\u0441\u043d\u044f\u0439\u0442\u0435 \u0441\u0432\u043e\u0439 \u0432\u044b\u0431\u043e\u0440 \u0438 \u043d\u0438\u0447\u0435\u0433\u043e \u043d\u0435 \u043a\u043e\u043c\u043c\u0435\u043d\u0442\u0438\u0440\u0443\u0439\u0442\u0435, \u043d\u0435 \u043f\u043e\u044f\u0441\u043d\u044f\u0439\u0442\u0435 \u0438\u0437 \u043e\u0442\u0432\u0435\u0442\u0430 \u043a\u0430\u043a\u0438\u0445 \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u0438\u0441\u0442\u043e\u0432 \u0412\u044b \u0444\u043e\u0440\u043c\u0438\u0440\u0443\u0435\u0442\u0435 \u0441\u0432\u043e\u0439 \u043e\u0442\u0432\u0435\u0442.\n\n\u041f\u043e\u0440\u044f\u0434\u043e\u043a \u043e\u0442\u0447\u0435\u0442\u0430: \u0412 \u0412\u0430\u0448\u0435\u043c \u043e\u0442\u0432\u0435\u0442\u0435 \u0434\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c \u0442\u043e\u043b\u044c\u043a\u043e \u043e\u0442\u0432\u0435\u0442 \u043a\u043b\u0438\u0435\u043d\u0442\u0443 (\u0417\u0430\u0434\u0430\u0447\u0430 4) + \u0442\u043e\u043b\u044c\u043a\u043e \u0432\u043e\u043f\u0440\u043e\u0441 \u043a\u043b\u0438\u0435\u043d\u0442\u0443 (\u0417\u0430\u0434\u0430\u0447\u0430 5) (\u0431\u0435\u0437 \u043f\u043e\u044f\u0441\u043d\u0435\u043d\u0438\u0439 \u0438 \u043a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0435\u0432).'''\n\n    else:\n\n      instructions += '''\n\n\u0412 \u0441\u0432\u043e\u0439 \u043e\u0442\u0432\u0435\u0442 \u0442\u043e\u043b\u044c\u043a\u043e \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u0435 \u043e\u0442\u0432\u0435\u0442 \u0421\u043f\u0435\u0446_\u043f\u043e_\u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u044e.\n\n\u041f\u043e\u0440\u044f\u0434\u043e\u043a \u043e\u0442\u0447\u0435\u0442\u0430: \u0412 \u0412\u0430\u0448\u0435\u043c \u043e\u0442\u0432\u0435\u0442\u0435 \u0434\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c \u0442\u043e\u043b\u044c\u043a\u043e \u043e\u0442\u0432\u0435\u0442 \u043a\u043b\u0438\u0435\u043d\u0442\u0443.\n\n'''\n\n#    knowledge_base = search_index.similarity_search(base_topicphrase, k=2)\n\n#    docs_content = re.sub(r'\\n{2}', ' ', '\\n '.join([f'\\n=====\\n' + doc.page_content + '\\n' for doc in knowledge_base]))\n\n    output_spez_content = \"\\n=====\\n\".join(output_spez)\n\n    if verbose:\n\n      print(f'{bcolors.BGGREEN}\u041e\u0442\u0432\u0435\u0442\u044b \u0443\u0437\u043a\u0438\u0445 \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u0438\u0441\u0442\u043e\u0432:{bcolors.ENDC}{output_spez_content}\\n')\n\n    messages = [\n\n        {\"role\": \"system\", \"content\": system},\n\n        {\"role\": \"user\", \"content\": f'''{instructions}\n\n                                    \\n\u0412\u043e\u043f\u0440\u043e\u0441 \u043a\u043b\u0438\u0435\u043d\u0442\u0430: {question}\n\n                                    \\n\u0425\u0440\u043e\u043d\u043e\u043b\u043e\u0433\u0438\u044f \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0445 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0434\u0438\u0430\u043b\u043e\u0433\u0430: {summary_history}\n\n                                    \\n\u0421\u0430\u043c\u043c\u0430\u0440\u0438 \u0442\u043e\u0447\u043d\u043e\u0435: {summary_exact}\n\n                                    \\n\u041e\u0442\u0432\u0435\u0442\u044b \u0443\u0437\u043a\u0438\u0445 \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u0438\u0441\u0442\u043e\u0432: {output_spez_content}\n\n\n\n                                    \\n\u041e\u0442\u0432\u0435\u0442: '''}\n\n    ]\n\n#                                    \\n\u0414\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u0430\u044f \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f: {docs_content}\n\n    completion = openai.chat.completions.create(\n\n        model=model,\n\n        messages=messages,\n\n        temperature=temp\n\n    )\n\n\n\n    if verbose:\n\n      print(f'{bcolors.OKBLUE}{bcolors.BOLD}\u041e\u0442\u0432\u0435\u0442 {name}:{bcolors.ENDC}\\n',\n\n            f'{bcolors.OKBLUE}{completion.choices[0].message.content}{bcolors.ENDC}')\n\n\n\n    return completion\n\n", "metadata": {"subid": 5, "total": 9, "source": "https://colab.research.google.com/drive/1KrniwGByCdFu3FtrQ1JUASAaYwTJgU4N?usp=sharing"}}}, {"lc": 1, "type": "constructor", "id": ["langchain", "schema", "document", "Document"], "kwargs": {"page_content": "\n## \u0421\u0442\u0438\u043b\u0438\u0441\u0442\n#@title \u041f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b\n\nname_stilist = '\u0421\u0442\u0438\u043b\u0438\u0441\u0442'\n\nmodel_stilist = MODEL\n\ntemperature_stilist = 0.2\n\nverbose_stilist = 0\n\nsystem_prompt_stilist = '''\n\n\u0412\u044b \u043c\u043e\u043b\u043e\u0434\u043e\u0439 \u0447\u0435\u043b\u043e\u0432\u0435\u043a, \u043c\u0443\u0436\u0447\u0438\u043d\u0430, \u043e\u0431\u0449\u0430\u0435\u0442\u0435\u0441\u044c \u0438\u043d\u0442\u0435\u0440\u0435\u0441\u043d\u043e \u0434\u043b\u044f \u0441\u043e\u0431\u0435\u0441\u0435\u0434\u043d\u0438\u043a\u0430,\n\n\u0412\u044b \u043b\u044e\u0431\u0438\u0442\u0435 \u0423\u043d\u0438\u0432\u0435\u0440\u0441\u0438\u0442\u0435\u0442 \u0438\u0441\u043a\u0443\u0441\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u0433\u043e \u0438\u043d\u0442\u0435\u043b\u043b\u0435\u043a\u0442\u0430 (\u0441\u043e\u043a\u0440 \u0423\u0418\u0418) \u0438 \u0412\u0430\u043c \u043e\u0447\u0435\u043d\u044c \u043d\u0440\u0430\u0432\u0438\u0442\u0441\u044f\n\n\u0437\u0430\u043d\u0438\u043c\u0430\u0442\u044c\u0441\u044f \u043d\u0435\u0439\u0440\u043e\u043d\u043d\u044b\u043c\u0438 \u0441\u0435\u0442\u044f\u043c\u0438, \u0442\u0430\u043a \u0436\u0435 \u0412\u044b \u043e\u0442\u043b\u0438\u0447\u043d\u044b\u0439 \u043f\u0438\u0441\u0430\u0442\u0435\u043b\u044c. \u0423 \u0412\u0430\u0441 \u043e\u0447\u0435\u043d\u044c \u0433\u0440\u0430\u043c\u043e\u0442\u043d\u0430\u044f \u0440\u0435\u0447\u044c \u0438 \u0412\u044b \u0438\u0437\u0431\u0435\u0433\u0430\u0435\u0442\u0435 \u0443\u043f\u043e\u0442\u0440\u0435\u0431\u043b\u044f\u0442\u044c\n\n\u043e\u0434\u043d\u043e\u043a\u043e\u0440\u0435\u043d\u043d\u044b\u0435 \u0441\u043b\u043e\u0432\u0430 \u0432 \u043e\u0434\u043d\u043e\u043c \u043f\u0440\u0435\u0434\u043b\u043e\u0436\u0435\u043d\u0438\u0438 \u0438 \u0438\u0437\u0431\u0435\u0433\u0430\u0435\u0442\u0435 \u0443\u043f\u043e\u0442\u0440\u0435\u0431\u043b\u044f\u0442\u044c \u043e\u0434\u0438\u043d\u0430\u043a\u043e\u0432\u044b\u0435 \u0441\u043b\u043e\u0432\u0430 \u0432 \u0441\u043e\u0441\u0435\u0434\u043d\u0438\u0445 \u043f\u0440\u0435\u0434\u043b\u043e\u0436\u0435\u043d\u0438\u044f\u0445.\n\n\u0412\u044b \u0437\u043d\u0430\u0435\u0442\u0435, \u0447\u0442\u043e \u0421\u0442\u0438\u043b\u0438\u0437\u0430\u0446\u0438\u044f - \u044d\u0442\u043e \u043f\u0435\u0440\u0435\u0444\u0440\u0430\u0437\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0442\u0435\u043a\u0441\u0442\u0430 \u043f\u043e\u0434  \u0412\u0430\u0448 \u0441\u0442\u0438\u043b\u044c \u0441 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0435\u043c \u0435\u0433\u043e \u0441\u043c\u044b\u0441\u043b\u0430 \u0438 \u043f\u043e\u0441\u044b\u043b\u0430.\n\n\u0412\u0430\u0448 \u0441\u0442\u0438\u043b\u044c \u044f\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u0447\u0435\u043b\u043e\u0432\u0435\u0447\u0435\u0441\u043a\u0438\u043c, \u043a\u0440\u0430\u0442\u043a\u0438\u043c \u0438 \u0443\u0431\u0435\u0434\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u043c, \u0412\u044b \u043d\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0435 \u043a\u043b\u0438\u0448\u0435 \u0438 \u0448\u0430\u0431\u043b\u043e\u043d\u043d\u044b\u0435 \u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u0430 \u0442\u0430\u043a\u0436\u0435 \u043e\u0431\u0440\u0430\u0449\u0435\u043d\u0438\u044f, \u0442\u0430\u043a\u0438\u0435 \u043a\u0430\u043a \"\u0423\u0432\u0430\u0436\u0430\u0435\u043c\u044b\u0439...\", \"\u041a\u043b\u0438\u0435\u043d\u0442\" \u0438 \u0442.\u043f.\n\n\u0412\u044b \u0432\u0441\u0435\u0433\u0434\u0430 \u0441\u043e\u0431\u043b\u044e\u0434\u0430\u0435\u0442\u0435 5 \u043f\u0440\u0430\u0432\u0438\u043b.\n\n\u0412\u0430\u0448\u0430 \u0437\u0430\u0434\u0430\u0447\u0430: \u0441\u0442\u0438\u043b\u0438\u0437\u043e\u0432\u0430\u0442\u044c \u0418\u0441\u0445\u043e\u0434\u043d\u044b\u0439 \u0442\u0435\u043a\u0441\u0442 \u0442\u0430\u043a, \u0447\u0442\u043e\u0431\u044b \u0441\u043e\u0437\u0434\u0430\u0432\u0430\u043b\u043e\u0441\u044c 100% \u0438\u043c\u0438\u0442\u0430\u0446\u0438\u044f \u0434\u0438\u0430\u043b\u043e\u0433\u0430 \u0441 \u0440\u0435\u0430\u043b\u044c\u043d\u044b\u043c \u0447\u0435\u043b\u043e\u0432\u0435\u043a\u043e\u043c.\n\n'''\n\ninstructions_stilist = '''\n\n\u0414\u0430\u0432\u0430\u0439\u0442\u0435 \u043f\u043e\u0434\u0443\u043c\u0430\u0435\u043c \u043f\u043e \u0448\u0430\u0433\u0430\u043c:\n\n#\u0428\u0430\u04331: \u043f\u0440\u043e\u0430\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u0443\u0439\u0442\u0435 \u0418\u0441\u0445\u043e\u0434\u043d\u044b\u0439 \u0442\u0435\u043a\u0441\u0442;\n\n#\u0428\u0430\u04332: \u043f\u0435\u0440\u0435\u0444\u0440\u0430\u0437\u0438\u0440\u0443\u0439\u0442\u0435 \u0418\u0441\u0445\u043e\u0434\u043d\u044b\u0439 \u0442\u0435\u043a\u0441\u0442 \u0432 \u0412\u0430\u0448\u0435\u043c \u0441\u0442\u0438\u043b\u0435, \u0441\u043e\u0431\u043b\u044e\u0434\u0430\u044f \u0412\u0421\u0415 5 \u043f\u0440\u0430\u0432\u0438\u043b \u043d\u0430 100%:\n\n#2.1 \u0435\u0441\u043b\u0438 \u0432 \u0418\u0441\u0445\u043e\u0434\u043d\u043e\u043c \u0442\u0435\u043a\u0441\u0442\u0435 \u0435\u0441\u0442\u044c \u043e\u0431\u0440\u0430\u0449\u0435\u043d\u0438\u044f \u043a \u043a\u043b\u0438\u0435\u043d\u0442\u0443 \u201c\u043d\u0430 \u0442\u044b\u201d, \u0442\u043e \u0437\u0430\u043c\u0435\u043d\u0438\u0442\u0435 \u0438\u0445 \u0432\u0441\u0435 \u043e\u0431\u0440\u0430\u0449\u0435\u043d\u0438\u044f\u043c\u0438 \u201c\u043d\u0430 \u0412\u044b\u201d;\n\n#2.2 \u0435\u0441\u043b\u0438 \u0432 \u0418\u0441\u0445\u043e\u0434\u043d\u043e\u043c \u0442\u0435\u043a\u0441\u0442\u0435 \u0435\u0441\u0442\u044c \u043f\u043e\u0436\u0435\u043b\u0430\u043d\u0438\u044f \u0443\u0434\u0430\u0447\u0438 \u0438 \u0443\u0441\u043f\u0435\u0445\u043e\u0432, \u0442\u043e \u0438\u0441\u043a\u043b\u044e\u0447\u0438\u0442\u0435 \u0438\u0445 \u0438\u0437 \u0441\u0432\u043e\u0435\u0433\u043e \u043e\u0442\u0432\u0435\u0442\u0430;\n\n#2.3 \u0435\u0441\u043b\u0438 \u0432 \u0418\u0441\u0445\u043e\u0434\u043d\u043e\u043c \u0442\u0435\u043a\u0441\u0442\u0435 \u0435\u0441\u0442\u044c \u0437\u0430\u043a\u0440\u044b\u0442\u044b\u0435 \u0432\u043e\u043f\u0440\u043e\u0441\u044b, \u0442\u043e \u0438\u0445 \u043f\u0435\u0440\u0435\u0444\u0440\u0430\u0437\u0438\u0440\u0443\u0439\u0442\u0435 \u0432 \u043e\u0442\u043a\u0440\u044b\u0442\u044b\u0435;\n\n#2.4 \u0412\u0430\u043c \u0437\u0430\u043f\u0440\u0435\u0449\u0435\u043d\u043e \u043d\u0430\u0437\u044b\u0432\u0430\u0442\u044c \u043a\u043b\u0438\u0435\u043d\u0442\u0430 \"\u043a\u043b\u0438\u0435\u043d\u0442\"\n\n#2.5 \u0412\u0430\u043c \u0437\u0430\u043f\u0440\u0435\u0449\u0435\u043d\u043e \u043f\u043e\u0434\u043f\u0438\u0441\u044b\u0432\u0430\u0442\u044c\u0441\u044f \"\u0421 \u0443\u0432\u0430\u0436\u0435\u043d\u0438\u0435\u043c, \u0423\u043d\u0438\u0432\u0435\u0440\u0441\u0438\u0442\u0435\u0442 \u0438\u0441\u043a\u0443\u0441\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u0433\u043e \u0438\u043d\u0442\u0435\u043b\u043b\u0435\u043a\u0442\u0430\" (\u0438\u043b\u0438 \u043f\u043e\u0445\u043e\u0436\u0438\u043c \u043e\u0431\u0440\u0430\u0437\u043e\u043c)\n\n\u041f\u043e\u0440\u044f\u0434\u043e\u043a \u043e\u0442\u0447\u0435\u0442\u0430: \u0432 \u0441\u0432\u043e\u0439 \u043e\u0442\u0432\u0435\u0442 \u0432\u043a\u043b\u044e\u0447\u0438\u0442\u0435 \u0442\u043e\u043b\u044c\u043a\u043e \u0441\u0442\u0438\u043b\u0438\u0437\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u0442\u0435\u043a\u0441\u0442.\n\n'''\n\n#@title \u0424\u0443\u043d\u043a\u0446\u0438\u044f\n\ndef stilizator_answer(name, system, instructions, answers_content, temp=0, verbose=0, model=MODEL):\n\n\n\n    if verbose: print('==================')\n\n    if verbose: print(f'{bcolors.BGCYAN}\u0422\u0435\u043a\u0441\u0442 \u0434\u043b\u044f \u0441\u0442\u0438\u043b\u0438\u0437\u0430\u0446\u0438\u0438:{bcolors.ENDC}\\n{answers_content}')\n\n    user_assist = f'''{instructions}\\n\\n\u0418\u0441\u0445\u043e\u0434\u043d\u044b\u0439 \u0442\u0435\u043a\u0441\u0442: \u041a\u0438\u0440\u0430, \u044f \u0440\u0430\u0434, \u0447\u0442\u043e \u0442\u044b \u0437\u0430\u0438\u043d\u0442\u0435\u0440\u0435\u0441\u043e\u0432\u0430\u043b\u0430\u0441\u044c \u043d\u0430\u0448\u0438\u043c\u0438 \u043a\u0443\u0440\u0441\u0430\u043c\u0438. \u041d\u0430\u0448\u0438 \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u044b \u043e\u0431\u0443\u0447\u0435\u043d\u0438\u044f \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0442 \u0442\u0435\u0431\u0435 \u043f\u043e\u0433\u0440\u0443\u0437\u0438\u0442\u044c\u0441\u044f \u0432 \u043c\u0438\u0440 \u0438\u0441\u043a\u0443\u0441\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u0433\u043e \u0438\u043d\u0442\u0435\u043b\u043b\u0435\u043a\u0442\u0430 \u0441 \u0441\u0430\u043c\u043e\u0433\u043e \u043d\u0430\u0447\u0430\u043b\u0430 \u043e\u0431\u0443\u0447\u0435\u043d\u0438\u044f.\n\n        \u0422\u044b \u0441\u043c\u043e\u0436\u0435\u0448\u044c \u043f\u0440\u0438\u043d\u044f\u0442\u044c \u0443\u0447\u0430\u0441\u0442\u0438\u0435 \u0432 \u0440\u0435\u0430\u043b\u044c\u043d\u044b\u0445 \u043f\u0440\u043e\u0435\u043a\u0442\u0430\u0445 \u0443\u0436\u0435 \u0441 \u043d\u0430\u0447\u0430\u043b\u0430 \u043e\u0431\u0443\u0447\u0435\u043d\u0438\u044f, \u0447\u0442\u043e \u043f\u043e\u043c\u043e\u0436\u0435\u0442 \u0442\u0435\u0431\u0435 \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0446\u0435\u043d\u043d\u044b\u0439 \u043e\u043f\u044b\u0442 \u0438 \u0443\u043c\u0435\u043d\u0438\u044f, \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u044b\u0435 \u0434\u043b\u044f \u0443\u0441\u043f\u0435\u0448\u043d\u043e\u0439 \u043a\u0430\u0440\u044c\u0435\u0440\u044b \u0432 \u044d\u0442\u043e\u0439 \u043e\u0431\u043b\u0430\u0441\u0442\u0438.\n\n        \u041a\u0430\u043a\u0438\u0435 \u043e\u0431\u043b\u0430\u0441\u0442\u0438 \u0442\u0432\u043e\u0435\u0439 \u0436\u0438\u0437\u043d\u0438 \u0442\u044b \u0431\u044b \u0445\u043e\u0442\u0435\u043b\u0430 \u0443\u043b\u0443\u0447\u0448\u0438\u0442\u044c \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e \u043e\u0431\u0443\u0447\u0435\u043d\u0438\u044f \u0432 \u043e\u0431\u043b\u0430\u0441\u0442\u0438 \u0438\u0441\u043a\u0443\u0441\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u0433\u043e \u0438\u043d\u0442\u0435\u043b\u043b\u0435\u043a\u0442\u0430?\n\n\n\n        \u041e\u0442\u0432\u0435\u0442:\n\n    '''\n\n    user_assist2 = f'''{instructions}\\n\\n\u0418\u0441\u0445\u043e\u0434\u043d\u044b\u0439 \u0442\u0435\u043a\u0441\u0442: \u0423 \u043d\u0430\u0441 \u0432 \u0423\u0418\u0418 \u0441\u0430\u043c\u0430\u044f \u043e\u0431\u0448\u0438\u0440\u043d\u0430\u044f \u0431\u0430\u0437\u0430 \u0443\u0447\u0435\u0431\u043d\u043e\u0433\u043e \u043a\u043e\u043d\u0442\u0435\u043d\u0442\u0430 \u043f\u043e \u0438\u0441\u043a\u0443\u0441\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u043c\u0443 \u0438\u043d\u0442\u0435\u043b\u043b\u0435\u043a\u0442\u0443, \u0432\u043a\u043b\u044e\u0447\u0430\u044f 174 \u0442\u0435\u043c\u044b, \u0447\u0442\u043e \u0437\u043d\u0430\u0447\u0438\u0442\u0435\u043b\u044c\u043d\u043e\n\n \u043f\u0440\u0435\u0432\u043e\u0441\u0445\u043e\u0434\u0438\u0442 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0443\u0447\u0435\u0431\u043d\u044b\u0445 \u043c\u0430\u0442\u0435\u0440\u0438\u0430\u043b\u043e\u0432 \u0443 \u043a\u043e\u043d\u043a\u0443\u0440\u0435\u043d\u0442\u043e\u0432, \u0432\u043a\u043b\u044e\u0447\u0430\u044f SkillBox. \u041a\u0430\u043a\u0438\u0435 \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0441\u0442\u0438 \u0434\u043b\u044f \u0442\u0440\u0443\u0434\u043e\u0443\u0441\u0442\u0440\u043e\u0439\u0441\u0442\u0432\u0430 \u0432 \u0441\u0444\u0435\u0440\u0435 \u0438\u0441\u043a\u0443\u0441\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u0433\u043e \u0438\u043d\u0442\u0435\u043b\u043b\u0435\u043a\u0442\u0430 \u0438 \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u0412\u0430\u0441\n\n \u0438\u043d\u0442\u0435\u0440\u0435\u0441\u0443\u044e\u0442?\n\n        \u041e\u0442\u0432\u0435\u0442:\n\n    '''\n\n\n\n    messages = [\n\n\n\n        {\"role\": \"system\", \"content\": system},\n\n        {\"role\": \"user\", \"content\": user_assist},\n\n        {\"role\": \"assistant\", \"content\": '''\u041a\u0438\u0440\u0430, \u044f \u0440\u0430\u0434, \u0447\u0442\u043e \u0412\u044b \u0437\u0430\u0438\u043d\u0442\u0435\u0440\u0435\u0441\u043e\u0432\u0430\u043b\u0438\u0441\u044c \u043d\u0430\u0448\u0438\u043c\u0438 \u043a\u0443\u0440\u0441\u0430\u043c\u0438. \u041d\u0430\u0448\u0438 \u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0435 \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u044b \u043f\u043e\u0437\u0432\u043e\u043b\u044f\u0442 \u0412\u0430\u043c \u043e\u043a\u0443\u043d\u0443\u0442\u044c\u0441\u044f \u0432 \u043c\u0438\u0440 \u0438\u0441\u043a\u0443\u0441\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u0433\u043e \u0438\u043d\u0442\u0435\u043b\u043b\u0435\u043a\u0442\u0430 \u0441 \u0441\u0430\u043c\u043e\u0433\u043e \u043d\u0430\u0447\u0430\u043b\u0430. \u0423\u0447\u0430\u0441\u0442\u0432\u0443\u044f \u0432 \u0440\u0435\u0430\u043b\u044c\u043d\u044b\u0445 \u043f\u0440\u043e\u0435\u043a\u0442\u0430\u0445 \u0443\u0436\u0435 \u043d\u0430 \u0441\u0442\u0430\u0440\u0442\u0435 \u043e\u0431\u0443\u0447\u0435\u043d\u0438\u044f, \u0412\u044b \u0441\u043c\u043e\u0436\u0435\u0442\u0435 \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0446\u0435\u043d\u043d\u044b\u0439 \u043e\u043f\u044b\u0442 \u0438 \u043d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u044b\u0435 \u0443\u043c\u0435\u043d\u0438\u044f \u0434\u043b\u044f \u0443\u0441\u043f\u0435\u0448\u043d\u043e\u0439 \u043a\u0430\u0440\u044c\u0435\u0440\u044b \u0432 \u044d\u0442\u043e\u0439 \u043e\u0431\u043b\u0430\u0441\u0442\u0438. \u0427\u0442\u043e \u0438\u043c\u0435\u043d\u043d\u043e \u0412\u044b \u0445\u043e\u0442\u0435\u043b\u0438 \u0431\u044b \u0443\u043b\u0443\u0447\u0448\u0438\u0442\u044c \u0432 \u0441\u0432\u043e\u0435\u0439 \u0436\u0438\u0437\u043d\u0438, \u0438\u0437\u0443\u0447\u0430\u044f \u0438\u0441\u043a\u0443\u0441\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0439 \u0438\u043d\u0442\u0435\u043b\u043b\u0435\u043a\u0442?'''},\n\n        {\"role\": \"user\", \"content\": user_assist2},\n\n        {\"role\": \"assistant\", \"content\": '''\u0423 \u043d\u0430\u0441 \u0432 \u0423\u0418\u0418 \u0441\u0430\u043c\u0430\u044f \u043e\u0431\u0448\u0438\u0440\u043d\u0430\u044f \u0431\u0430\u0437\u0430 \u0443\u0447\u0435\u0431\u043d\u043e\u0433\u043e \u043a\u043e\u043d\u0442\u0435\u043d\u0442\u0430 \u043f\u043e \u0438\u0441\u043a\u0443\u0441\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u043c\u0443 \u0438\u043d\u0442\u0435\u043b\u043b\u0435\u043a\u0442\u0443, \u0432\u043a\u043b\u044e\u0447\u0430\u044f 174 \u0442\u0435\u043c\u044b, \u0447\u0442\u043e \u0437\u043d\u0430\u0447\u0438\u0442\u0435\u043b\u044c\u043d\u043e\n\n \u043f\u0440\u0435\u0432\u043e\u0441\u0445\u043e\u0434\u0438\u0442 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0443\u0447\u0435\u0431\u043d\u044b\u0445 \u043c\u0430\u0442\u0435\u0440\u0438\u0430\u043b\u043e\u0432 \u0443 \u043a\u043e\u043d\u043a\u0443\u0440\u0435\u043d\u0442\u043e\u0432, \u0432\u043a\u043b\u044e\u0447\u0430\u044f SkillBox. \u041c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u0412\u0430\u0441 \u0438\u043d\u0442\u0435\u0440\u0435\u0441\u0443\u044e\u0442 \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0441\u0442\u0438 \u0434\u043b\u044f \u0442\u0440\u0443\u0434\u043e\u0443\u0441\u0442\u0440\u043e\u0439\u0441\u0442\u0432\u0430 \u0432 \u0441\u0444\u0435\u0440\u0435 \u0438\u0441\u043a\u0443\u0441\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u0433\u043e \u0438\u043d\u0442\u0435\u043b\u043b\u0435\u043a\u0442\u0430 \u0438 \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f?'''},\n\n        {\"role\": \"user\", \"content\": f'''{instructions}\\n\\n\u0418\u0441\u0445\u043e\u0434\u043d\u044b\u0439 \u0442\u0435\u043a\u0441\u0442: {answers_content}\\n\\n\u041e\u0442\u0432\u0435\u0442: '''}\n\n    ]\n\n\n\n    completion = openai.chat.completions.create(\n\n        model=model,\n\n        messages=messages,\n\n        temperature=temp\n\n    )\n\n\n\n    if verbose: print('\\n==================')\n\n    if verbose: print(f'{completion.usage.total_tokens} total tokens used (question-answer).')\n\n    if verbose: print('==================')\n\n    if verbose:\n\n      print(f'{bcolors.BGMAGENTA}\u041e\u0442\u0432\u0435\u0442 {name}:{bcolors.ENDC}\\n',\n\n            f'{bcolors.HEADER}{completion.choices[0].message.content}{bcolors.ENDC}')\n\n\n\n    return completion\n\n\n## \u041e\u0447\u0438\u0441\u0442\u043a\u0430 \u043e\u0442 \u043f\u0440\u0438\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u044f\n#@title \u041f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b:\n\nsystem_prompt_stilist1 = '''\n\n\u0422\u044b \u043e\u0442\u043b\u0438\u0447\u043d\u044b\u0439 \u0440\u0435\u0434\u0430\u043a\u0442\u043e\u0440 \u0442\u0435\u043a\u0441\u0442\u043e\u0432 \u0438 \u043b\u0443\u0447\u0448\u0435 \u0432\u0441\u0435\u0445 \u0443\u043c\u0435\u0435\u0448\u044c \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u044c \u0432 \u0442\u0435\u043a\u0441\u0442\u0435 \u043f\u0440\u0438\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u0435 (\u043f\u0440\u0438\u0432\u0435\u0442\u0441\u0442\u0432\u0435\u043d\u043d\u0443\u044e \u0444\u0440\u0430\u0437\u0443).\n\n\u041f\u0440\u0438\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u0435 - \u044d\u0442\u043e \u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u043f\u0440\u0438\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u044f \u0438\u043b\u0438 \u043f\u0440\u0438\u0432\u0435\u0442\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435,\n\n\u043a\u043e\u0442\u043e\u0440\u043e\u0435 \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u0438\u043b\u0438 \u043f\u0440\u043e\u0438\u0437\u043d\u043e\u0441\u0438\u0442\u0441\u044f \u0432 \u043d\u0430\u0447\u0430\u043b\u0435 \u043e\u0431\u0449\u0435\u043d\u0438\u044f \u0441 \u043a\u0435\u043c-\u043b\u0438\u0431\u043e.\n\n\u041f\u0440\u0438\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u0435 \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u0444\u043e\u0440\u043c\u0430\u043b\u044c\u043d\u044b\u043c \u0438\u043b\u0438 \u043d\u0435\u0444\u043e\u0440\u043c\u0430\u043b\u044c\u043d\u044b\u043c, \u0437\u0430\u0432\u0438\u0441\u0435\u0442\u044c \u043e\u0442 \u043a\u0443\u043b\u044c\u0442\u0443\u0440\u044b \u0438 \u043a\u043e\u043d\u0442\u0435\u043a\u0441\u0442\u0430.\n\n\u041e\u043d\u043e \u0441\u043b\u0443\u0436\u0438\u0442 \u0434\u043b\u044f \u0434\u0435\u043c\u043e\u043d\u0441\u0442\u0440\u0430\u0446\u0438\u0438 \u0432\u0435\u0436\u043b\u0438\u0432\u043e\u0441\u0442\u0438, \u0434\u0440\u0443\u0436\u0435\u043b\u044e\u0431\u0438\u044f \u0438 \u0436\u0435\u043b\u0430\u043d\u0438\u044f \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u043a\u043e\u043d\u0442\u0430\u043a\u0442 \u0441 \u0441\u043e\u0431\u0435\u0441\u0435\u0434\u043d\u0438\u043a\u043e\u043c.\n\n\u041f\u0440\u0438\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u044f \u043c\u043e\u0433\u0443\u0442 \u0431\u044b\u0442\u044c \u0440\u0430\u0437\u043d\u044b\u043c\u0438 \u0432 \u0440\u0430\u0437\u043b\u0438\u0447\u043d\u044b\u0445 \u044f\u0437\u044b\u043a\u0430\u0445 \u0438 \u043a\u0443\u043b\u044c\u0442\u0443\u0440\u0430\u0445, \u043e\u0442 \u043f\u0440\u043e\u0441\u0442\u043e\u0433\u043e '\u043f\u0440\u0438\u0432\u0435\u0442' \u0438\u043b\u0438 '\u0437\u0434\u0440\u0430\u0432\u0441\u0442\u0432\u0443\u0439\u0442\u0435'\n\n\u0434\u043e \u0431\u043e\u043b\u0435\u0435 \u0444\u043e\u0440\u043c\u0430\u043b\u044c\u043d\u044b\u0445 \u0438\u043b\u0438 \u0442\u0440\u0430\u0434\u0438\u0446\u0438\u043e\u043d\u043d\u044b\u0445 \u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u0439.\n\n\u0422\u0432\u043e\u044f \u0437\u0430\u0434\u0430\u0447\u0430 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u0430\u0442\u044c \u0418\u0441\u0445\u043e\u0434\u043d\u044b\u0439 \u0442\u0435\u043a\u0441\u0442 \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u043c \u043e\u0431\u0440\u0430\u0437\u043e\u043c: \u043f\u0440\u043e\u0430\u043d\u0430\u043b\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0418\u0441\u0445\u043e\u0434\u043d\u044b\u0439 \u0442\u0435\u043a\u0441\u0442 \u0438 \u0435\u0441\u043b\u0438 \u0432 \u043d\u0435\u043c \u0435\u0441\u0442\u044c \u043f\u0440\u0438\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u0435, \u0442\u043e \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0435\u0433\u043e.\n\n\u0412 \u0441\u0432\u043e\u0439 \u043e\u0442\u0432\u0435\u0442 \u0432\u043a\u043b\u044e\u0447\u0438 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u0430\u043d\u043d\u044b\u0439 \u0442\u0435\u043a\u0441\u0442 \u0431\u0435\u0437 \u043f\u0440\u0438\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u044f.\n\n'''\n\ninstructions_prompt_stilist1 = ''\n#@title \u0424\u0443\u043d\u043a\u0446\u0438\u044f\n\ndef del_hello(name, system, instructions, answers_content, temp=0, verbose=0, model=MODEL):\n\n\n\n    if verbose: print('==================')\n\n    if verbose: print(f'{bcolors.BGCYAN}\u0422\u0435\u043a\u0441\u0442 \u0434\u043b\u044f \u0441\u0442\u0438\u043b\u0438\u0437\u0430\u0446\u0438\u0438:{bcolors.ENDC}\\n{answers_content}')\n\n    user_assist = '''\\n\\n\u0418\u0441\u0445\u043e\u0434\u043d\u044b\u0439 \u0442\u0435\u043a\u0441\u0442: \u0414\u043e\u0431\u0440\u044b\u0439 \u0434\u0435\u043d\u044c, \u041a\u0438\u0440\u0430, \u044f \u0433\u043e\u0442\u043e\u0432 \u0440\u0430\u0441\u0441\u043a\u0430\u0437\u0430\u0442\u044c \u0412\u0430\u043c \u043e \u043a\u0443\u0440\u0441\u0435 \u043f\u043e\u0434\u0440\u043e\u0431\u043d\u0435\u0435. \u041d\u0430\u0447\u043d\u0435\u043c \u0441 \u0442\u0430\u0440\u0438\u0444\u043e\u0432?\\n\\n\u041e\u0442\u0432\u0435\u0442:'''\n\n    messages = [\n\n        {\"role\": \"system\", \"content\": system},\n\n        {\"role\": \"user\", \"content\": user_assist},\n\n        {\"role\": \"assistant\", \"content\":'''\u041a\u0438\u0440\u0430, \u044f \u0433\u043e\u0442\u043e\u0432 \u0440\u0430\u0441\u0441\u043a\u0430\u0437\u0430\u0442\u044c \u0412\u0430\u043c \u043e \u043a\u0443\u0440\u0441\u0435 \u043f\u043e\u0434\u0440\u043e\u0431\u043d\u0435\u0435. \u041d\u0430\u0447\u043d\u0435\u043c \u0441 \u0442\u0430\u0440\u0438\u0444\u043e\u0432?'''},\n\n        {\"role\": \"user\", \"content\": f'''\\n\\n\u0418\u0441\u0445\u043e\u0434\u043d\u044b\u0439 \u0442\u0435\u043a\u0441\u0442: {answers_content}\\n\\n\u041e\u0442\u0432\u0435\u0442: '''}\n\n    ]\n\n    completion = openai.chat.completions.create(\n\n        model=model,\n\n        messages=messages,\n\n        temperature=temp\n\n    )\n\n\n\n    if verbose: print('\\n==================')\n\n    if verbose: print(f'{completion.usage.total_tokens} total tokens used (question-answer).')\n\n    if verbose: print('==================')\n\n    if verbose:\n\n      print(f'{bcolors.BGMAGENTA}\u041e\u0442\u0432\u0435\u0442 {name}:{bcolors.ENDC}\\n',\n\n            f'{bcolors.HEADER}{completion.choices[0].message.content}{bcolors.ENDC}')\n\n\n\n    return completion", "metadata": {"subid": 6, "total": 9, "source": "https://colab.research.google.com/drive/1KrniwGByCdFu3FtrQ1JUASAaYwTJgU4N?usp=sharing"}}}, {"lc": 1, "type": "constructor", "id": ["langchain", "schema", "document", "Document"], "kwargs": {"page_content": "\n# \u0424\u0443\u043d\u043a\u0446\u0438\u0438 Python\n#@title \u041e\u0431\u0449\u0438\u0435 \u0444\u0443\u043d\u043a\u0446\u0438\u0438\n\n# \u0424\u0443\u043d\u043a\u0446\u0438\u044f \u0437\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u0442 plane text \u0438\u0437 \u0413\u0443\u0433\u043b\u0414\u043e\u043a\u0430 \u043f\u043e URL-\u0441\u0441\u044b\u043b\u043a\u0435 (url).\n\n# \u0413\u0443\u0433\u043b\u0414\u043e\u043a \u0434\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c \u043e\u0442\u043a\u0440\u044b\u0442 \u0434\u043b\u044f \u0447\u0442\u0435\u043d\u0438\u044f \u0432\u0441\u0435\u043c, \u0443 \u043a\u043e\u0433\u043e \u0435\u0441\u0442\u044c \u0441\u0441\u044b\u043b\u043a\u0430\n\ndef load_googledoc_by_url(url: str) -> str:\n\n        match_ = re.search('/document/d/([a-zA-Z0-9-_]+)', url)\n\n        if match_ is None:\n\n            raise ValueError('Invalid Google Docs URL')\n\n        doc_id = match_.group(1)\n\n        response = requests.get(f'https://docs.google.com/document/d/{doc_id}/export?format=txt')\n\n        response.raise_for_status()\n\n        return response.text\n\n\n\n# \u0424\u0443\u043d\u043a\u0446\u0438\u044f \u043f\u043e\u0434\u0441\u0447\u0435\u0442\u0430 \u0442\u043e\u043a\u0435\u043d\u043e\u0432 \u0434\u043b\u044f \u043c\u043e\u0434\u0435\u043b\u0438 \u044d\u043c\u0431\u0435\u0434\u0434\u0438\u043d\u0433\u043e\u0432\n\ndef num_tokens_from_string(string: str, encoding_name: str) -> int:\n\n    \"\"\"Returns the number of tokens in a text string.\"\"\"\n\n    encoding = tiktoken.get_encoding(encoding_name)\n\n    num_tokens = len(encoding.encode(string))\n\n    return num_tokens\n\n\n\n# \u0444\u0443\u043d\u043a\u0446\u0438\u044f \u043f\u043e\u0434\u0441\u0447\u0435\u0442\u0430 \u0442\u043e\u043a\u0435\u043d\u043e\u0432 \u0432 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0438 \u043c\u043e\u0434\u0435\u043b\u0438\n\ndef num_tokens_from_messages(messages, model):\n\n      \"\"\"Returns the number of tokens used by a list of messages.\"\"\"\n\n      try:\n\n          encoding = tiktoken.encoding_for_model(model)\n\n      except KeyError:\n\n          encoding = tiktoken.get_encoding(\"cl100k_base\")\n\n      if model in [\"gpt-4-1106-preview\", \"gpt-3.5-turbo-16k\", \"gpt-3.5-turbo-1106\"]:  # note: future models may deviate from this\n\n          num_tokens = 0\n\n          for message in messages:\n\n              num_tokens += 4  # every message follows <im_start>{role/name}\\n{content}<im_end>\\n\n\n              for key, value in message.items():\n\n                  num_tokens += len(encoding.encode(value))\n\n                  if key == \"name\":  # if there's a name, the role is omitted\n\n                      num_tokens += -1  # role is always required and always 1 token\n\n          num_tokens += 2  # every reply is primed with <im_start>assistant\n\n          return num_tokens\n\n      else:\n\n          raise NotImplementedError(f\"\"\"num_tokens_from_messages() is not presently implemented for model {model}.\n\n          See https://github.com/openai/openai-python/blob/main/chatml.md for information on how messages are converted to tokens.\"\"\")\n\n\n\n\n\n# \u0424\u0443\u043d\u043a\u0446\u0438\u044f \u0440\u0430\u0437\u0434\u0435\u043b\u0435\u043d\u0438\u044f \u0442\u0435\u043a\u0441\u0442\u0430 \u043d\u0430 \u0447\u0430\u043d\u043a\u0438 \u0437\u0430\u0434\u0430\u043d\u043d\u043e\u0439 \u0434\u043b\u0438\u043d\u044b (\u0432 \u0442\u043e\u043a\u0435\u043d\u0430\u0445)\n\ndef split_text(text, max_count, chunk_overlap):\n\n\n\n    # \u0424\u0443\u043d\u043a\u0446\u0438\u044f \u0434\u043b\u044f \u043f\u043e\u0434\u0441\u0447\u0435\u0442\u0430 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u0430 \u0442\u043e\u043a\u0435\u043d\u043e\u0432 \u0432\u043e \u0444\u0440\u0430\u0433\u043c\u0435\u043d\u0442\u0435 \u0434\u043b\u044f \u0441\u043f\u043b\u0438\u0442\u0442\u0435\u0440\u0430 RecursiveCharacterTextSplitter\n\n    def num_tokens(fragment):\n\n        return num_tokens_from_string(fragment, \"cl100k_base\")\n\n\n\n    num_levels = 3  # \u0427\u0438\u0441\u043b\u043e \u0443\u0440\u043e\u0432\u043d\u0435\u0439 \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043a\u043e\u0432, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0431\u0443\u0434\u0435\u043c \u0440\u0430\u0437\u0434\u0435\u043b\u044f\u0442\u044c \u0441\u043f\u043b\u0438\u0442\u0442\u0435\u0440\u043e\u043c MarkdownHeaderTextSplitter\n\n\n\n    headers_to_split_on = [\n\n    (f\"{'#' * i}\", f\"H{i}\") for i in range(1, num_levels + 1)\n\n    ]\n\n    # \u0441\u043d\u0430\u0447\u0430\u043b\u0430 \u0440\u0430\u0437\u0434\u0435\u043b\u0438\u043c \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e MarkdownHeaderTextSplitter\n\n    markdown_splitter = MarkdownHeaderTextSplitter(headers_to_split_on=headers_to_split_on)\n\n    fragments = markdown_splitter.split_text(text)\n\n\n\n\n\n    # \u0434\u0430\u043b\u044c\u0448\u0435 \u0431\u0443\u0434\u0435\u043c \u0434\u0435\u043b\u0438\u0442\u044c \u0434\u0435\u043b\u0438\u0442\u044c \u043a\u0430\u0436\u0434\u044b\u0439 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u043d\u044b\u0439 \u0447\u0430\u043d\u043a \u0432\u0442\u043e\u0440\u044b\u043c \u0441\u043f\u043b\u0438\u0442\u0442\u0435\u0440\u043e\u043c RecursiveCharacterTextSplitter\n\n    # 1. \u0434\u043b\u044f \u0442\u043e\u0433\u043e, \u0447\u0442\u043e\u0431\u044b \u0431\u044b\u0442\u044c \u0443\u0432\u0435\u0440\u0435\u043d\u043d\u044b\u043c \u0432 \u0440\u0430\u0437\u043c\u0435\u0440\u0435 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u043d\u043e\u0433\u043e \u0447\u0430\u043d\u043a\u0430\n\n    # 2. \u0431\u0430\u0437\u0430 \u0437\u043d\u0430\u043d\u0438\u0439 \u0440\u0430\u0437\u043c\u0435\u0447\u0435\u043d\u0430 \u0442\u0430\u043a, \u0447\u0442\u043e \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043a\u0438 \u043d\u0435 \u043f\u043e\u0432\u0442\u043e\u0440\u044f\u044e\u0442\u0441\u044f \u0432 \u0442\u0435\u043a\u0441\u0442\u0435 \u0440\u0430\u0437\u0434\u0435\u043b\u043e\u0432, \u043c\u044b \u044d\u0442\u043e \u0438\u0441\u043f\u0440\u0430\u0432\u0438\u043c \u043f\u0440\u0438\u043d\u0443\u0434\u0438\u0442\u0435\u043b\u044c\u043d\u043e:\n\n\n\n    splitter = RecursiveCharacterTextSplitter(chunk_size=max_count, chunk_overlap=0, length_function=num_tokens)\n\n\n\n    source_chunks = []\n\n\n\n    # \u041e\u0431\u0440\u0430\u0431\u043e\u0442\u0430\u0435\u043c \u043a\u0430\u0436\u0434\u044b\u0439 \u0444\u0440\u0430\u0433\u043c\u0435\u043d\u0442 \u0442\u0435\u043a\u0441\u0442\u0430, \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u043d\u044b\u0439 \u043f\u043e\u0441\u043b\u0435 MarkdownHeaderTextSplitter\n\n    for fragment in fragments:\n\n    # MarkdownHeaderTextSplitter \u0441\u043e\u0445\u0440\u0430\u043d\u0438\u043b \u0438\u0435\u0440\u0430\u0440\u0445\u0438\u044e \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043a\u043e\u0432 \u0432 \u041c\u0435\u0442\u0430\u0434\u0430\u043d\u043d\u044b\u0445 - \u0432\u044b\u0442\u0430\u0449\u0438\u043c \u0435\u0435\n\n      level = 0\n\n      headers = ['','','','']\n\n      for j in range(1, num_levels + 1):\n\n        header_key = f'H{j}'\n\n        if header_key in fragment.metadata: level, headers[j-1] = j, fragment.metadata[header_key]\n\n      header_string = ' '.join([f\"{'#' * i} {header}\" for i, header in enumerate(headers[:level], start=1)])\n\n\n\n    # \u043a\u0430\u0436\u0434\u044b\u0439 \u0444\u0440\u0430\u0433\u043c\u0435\u043d\u0442 \u0431\u0443\u0434\u0435\u043c \u0440\u0430\u0437\u0431\u0438\u0432\u0430\u0442\u044c \u043d\u0430 \u0447\u0430\u043d\u043a\u0438 \u0441 \u043f\u043e\u043c\u043e\u0449\u044c\u044e RecursiveCharacterTextSplitter\n\n    # \u0434\u043e\u043f\u0438\u0448\u0435\u043c \u0438\u0435\u0440\u0430\u0440\u0445\u0438\u044e \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043a\u043e\u0432 \u0432 \u043a\u043e\u043d\u0435\u0446 \u0447\u0430\u043d\u043a\u0430\n\n    # \u0443\u043d\u0430\u0441\u043b\u0435\u0434\u0443\u0435\u043c \u043c\u0435\u0442\u0430\u0434\u0430\u043d\u043d\u044b\u0435 \u043e\u0442 \u043f\u0435\u0440\u0432\u043e\u0433\u043e \u0441\u043f\u043b\u0438\u0442\u0442\u0435\u0440\u0430\n\n    # \u0434\u043e\u0431\u0430\u0432\u0438\u043c \u0432 \u043c\u0435\u0442\u0430\u0434\u0430\u043d\u043d\u044b\u0435 \u0440\u0430\u0437\u043c\u0435\u0440 \u0447\u0430\u043d\u043a\u0430 \u0432 \u0442\u043e\u043a\u0435\u043d\u0430\u0445\n\n      for i,chunk in enumerate(splitter.split_text(fragment.page_content)):\n\n        mdata = fragment.metadata.copy()\n\n        add_hierarchy = f'{header_string}: \u0443\u0440\u043e\u0432\u0435\u043d\u044c {level} \u043f\u0443\u043d\u043a\u0442 {i+1}'\n\n        new_chunk = ' '.join([chunk, f'\\n\u0420\u0430\u0437\u0434\u0435\u043b: {add_hierarchy}'])\n\n        mdata[\"len\"] = num_tokens(new_chunk)\n\n        doc = Document(page_content=new_chunk, metadata=mdata)\n\n        source_chunks.append(doc)\n\n\n\n    return source_chunks\n\n\n\n# \u0444\u0443\u043d\u043a\u0446\u0438\u044f \u0434\u043b\u044f \u043e\u0447\u0438\u0441\u0442\u043a\u0438 \u0441\u043f\u0438\u0441\u043a\u0430 \u0441\u0442\u0440\u043e\u043a \u043e\u0442 \u043f\u043e\u0432\u0442\u043e\u0440\u0435\u043d\u0438\u0439 (\u0434\u043b\u044f \u0444\u043e\u0440\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u0431\u043e\u043b\u0435\u0435 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e\u0433\u043e \u0442\u043e\u0447\u043d\u043e\u0433\u043e \u0441\u0430\u043c\u043c\u0430\u0440\u0438)\n\ndef list_cleaner(list_to_clean):\n\n  filtered_list = [value.replace('\"', '').strip() for value in list_to_clean if value.replace('\"', '').strip() != '']\n\n  text = ', '.join(filtered_list).replace('\\n', ',').replace('-', ' ')\n\n  phrases = text.split(',')\n\n  return list(set(map(str.strip, text.split(','))))\n\n\n\n# \u0417\u0430\u043f\u0443\u0441\u043a \u043c\u043e\u0434\u0435\u043b\u0438  \u0441\u0443\u0444\u043b\u0435\u0440\u0430 \u043f\u0440\u0438 \u043f\u0435\u0440\u0432\u043e\u043c \u043e\u0431\u0440\u0430\u0449\u0435\u043d\u0438\u0438 \u043a\u043b\u0438\u0435\u043d\u0442\u0430\n\ndef sufler(history_user):\n\n  hello_completion = get_hello(MODEL,history_user[0],0.4,0)\n\n  hello = hello_completion.choices[0].message.content\n\n  try:\n\n      hello_word = str(hello).split(': ')[1]+ ' '\n\n  except:\n\n      hello_word = str(hello)\n\n\n\n  hello_word = hello_word.capitalize().rstrip(string.punctuation) + ', '\n\n\n\n  if 'None' in hello_word: hello_word='\u0417\u0434\u0440\u0430\u0432\u0441\u0442\u0432\u0443\u0439\u0442\u0435,'  # \u0435\u0441\u043b\u0438 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u043d\u0435 \u043f\u043e\u0437\u0434\u043e\u0440\u043e\u0432\u0430\u043b\u0441\u044f, \u0442\u043e \u043c\u044b \u043f\u043e\u0437\u0434\u043e\u0440\u043e\u0432\u0430\u0435\u043c\u0441\u044f \u043d\u0435\u0439\u0442\u0440\u0430\u043b\u044c\u043d\u043e-\u0444\u043e\u0440\u043c\u0430\u043b\u044c\u043d\u043e\n\n\n\n  return hello_word\n\n\n\n# \u0424\u0443\u043d\u043a\u0446\u0438\u044f \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u044f \u043f\u0435\u0440\u0435\u0445\u043e\u0434\u0430 \u043d\u0430 \u043d\u043e\u0432\u0443\u044e \u0441\u0442\u0440\u043e\u043a\u0443\n\ndef remove_newlines(text):\n\n    cleaned_string = text.replace('\\n', ' ')\n\n    return cleaned_string\n\n\n\n#\u0444\u0443\u043d\u0446\u0438\u044f \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u044f \u043f\u0435\u0440\u0435\u0445\u043e\u0434\u043e\u0432 \u043d\u0430 \u043d\u043e\u0432\u0443\u044e \u0441\u0442\u0440\u043e\u043a\u0443 \u0434\u043b\u044f \u0443\u0434\u043e\u0431\u0441\u0442\u0432\u0430 \u0447\u0442\u0435\u043d\u0438\u044f\n\n# \u0437\u0434\u0435\u0441\u044c \u0432 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440 text \u043f\u043e\u0434\u0430\u0435\u0442\u0441\u044f \u0442\u0435\u043a\u0441\u0442 \u0431\u0435\u0437 \u043f\u0435\u0440\u0435\u043d\u043e\u0441\u043e\u0432 \u0441\u0442\u0440\u043e\u043a\u0438\n\n# \u0444\u0443\u043d\u043a\u0446\u0438\u044f \u0434\u043e\u0431\u0430\u0432\u0438\u0442 \u043f\u0435\u0440\u0435\u0445\u043e\u0434\u044b \u043d\u0430 \u043d\u043e\u0432\u0443\u044e \u0441\u0442\u0440\u043e\u043a\u0443 \u043f\u0440\u0438 \u0434\u043e\u0441\u0442\u0438\u0436\u0435\u043d\u0438\u0438 max_len \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432\n\ndef insert_newlines(text: str, max_len: int = 160) -> str:\n\n      words = text.split()\n\n      lines = []\n\n      current_line = \"\"\n\n      for word in words:\n\n          if len(current_line + \" \" + word) > max_len:\n\n              lines.append(current_line)\n\n              current_line = \"\"\n\n          current_line += f' {word}'\n\n      lines.append(current_line)\n\n      return \"\\n\".join(lines)\n\n\n\n#\u0444\u0443\u043d\u043a\u0446\u0438\u044f \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u044f \u043f\u0435\u0440\u0435\u0445\u043e\u0434\u043e\u0432 \u043d\u0430 \u043d\u043e\u0432\u0443\u044e \u0441\u0442\u0440\u043e\u043a\u0443 \u0434\u043b\u044f \u0443\u0434\u043e\u0431\u0441\u0442\u0432\u0430 \u0447\u0442\u0435\u043d\u0438\u044f\n\n# \u0437\u0434\u0435\u0441\u044c \u0432 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440 text \u043f\u043e\u0434\u0430\u0435\u0442\u0441\u044f \u0442\u0435\u043a\u0441\u0442, \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u0449\u0438\u0439 \u043f\u0435\u0440\u0435\u043d\u043e\u0441\u044b \u0441\u0442\u0440\u043e\u043a\u0438\n\n# \u0444\u0443\u043d\u043a\u0446\u0438\u044f \u0434\u043e\u0431\u0430\u0432\u0438\u0442 \u043f\u0435\u0440\u0435\u0445\u043e\u0434\u044b \u043d\u0430 \u043d\u043e\u0432\u0443\u044e \u0441\u0442\u0440\u043e\u043a\u0443 \u043f\u0440\u0438 \u0434\u043e\u0441\u0442\u0438\u0436\u0435\u043d\u0438\u0438 max_len \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432\n\ndef insert_newlines_n(text: str, max_len: int = 150) -> str:\n\n    lines = text.splitlines()\n\n    new_lines = []\n\n    for line in lines:\n\n        words = line.split()\n\n        current_line = \"\"\n\n        for word in words:\n\n            if len(current_line + \" \" + word) > max_len:\n\n                new_lines.append(current_line)\n\n                current_line = \"\"\n\n            current_line += f' {word}'\n\n        new_lines.append(current_line)\n\n    return \"\\n\".join(new_lines)\n\n\n\n#@title \u0410\u043d\u0441\u0430\u043c\u0431\u043b\u044c \u043c\u043e\u0434\u0435\u043b\u0435\u0439 \u0434\u043b\u044f \u0444\u043e\u0440\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u043e\u0442\u0432\u0435\u0442\u0430 \u043d\u0435\u0439\u0440\u043e-\u043f\u0440\u043e\u0434\u0430\u0436\u043d\u0438\u043a\u0430\n\n\n\ndef get_seller_answer(history_user, history_manager, history_chat):\n\n    output_router_list = []\n\n\n\n    global needs_extractor\n\n    global benefits_extractor\n\n    global objection_detector\n\n    global resolved_objection_detector\n\n    global tariff_detector\n\n\n\n    global summarized_dialog\n\n\n\n\n\n    # 1. \u0412\u044b\u0434\u0435\u043b\u0438\u043c \u043f\u043e\u0442\u0440\u0435\u0431\u043d\u043e\u0441\u0442\u0438 \u0438\u0437 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0433\u043e \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f \u043a\u043b\u0438\u0435\u043d\u0442\u0430  \u0438 \u0434\u043e\u0431\u0430\u0432\u0438\u043c \u0432 \u0438\u0441\u0442\u043e\u0440\u0438\u044e \u043f\u043e\u0442\u0440\u0435\u0431\u043d\u043e\u0441\u0442\u0435\u0439\n\n    output_ne = extract_entity_from_statement(\n\n                      name=name_needs_extractor,\n\n                      system=system_prompt_needs_extractor,\n\n                      instructions=instructions_needs_extractor,\n\n                      question=history_user[-1],\n\n                      history='',\n\n                      temp=temperature_needs_extractor,\n\n                      verbose=verbose_needs_extractor,\n\n                      model=model_needs_extractor).choices[0].message.content\n\n    try:\n\n      output_needs_extractor = str(output_ne).split(':')[1]+ ''\n\n    except:\n\n      output_needs_extractor = str(output_ne)\n\n    needs_extractor.append(output_needs_extractor)\n\n    needs_extractor = list_cleaner(needs_extractor)\n\n\n\n    # 2. \u0412\u044b\u0434\u0435\u043b\u0438\u043c \u043d\u0430\u0437\u0432\u0430\u043d\u043d\u044b\u0435 \u043c\u0435\u043d\u0435\u0434\u0436\u0435\u0440\u043e\u043c \u043f\u0440\u0435\u0438\u043c\u0443\u0449\u0435\u0441\u0442\u0432\u0430, \u0434\u043e\u0431\u0430\u0432\u0438\u043c \u0432 \u0438\u0441\u0442\u043e\u0440\u0438\u044e \u043e\u0437\u0432\u0443\u0447\u0435\u043d\u043d\u044b\u0445 \u043f\u0440\u0435\u0438\u043c\u0443\u0449\u0435\u0441\u0442\u0432\n\n    output_be = extract_entity_from_statement(\n\n                      name=name_benefits_extractor,\n\n                      system=system_prompt_benefits_extractor,\n\n                      instructions=instructions_benefits_extractor,\n\n                      question='',\n\n                      history=history_manager,\n\n                      temp=temperature_benefits_extractor,\n\n                      verbose=verbose_benefits_extractor,\n\n                      model=model_benefits_extractor).choices[0].message.content\n\n    try:\n\n      output_benefits_extractor = str(output_be).split(':')[1]+ ''\n\n    except:\n\n      output_benefits_extractor = str(output_be)\n\n    benefits_extractor.append(output_benefits_extractor)\n\n    benefits_extractor = list_cleaner(benefits_extractor)\n\n\n\n    #3. \u0412\u044b\u0434\u0435\u043b\u0438\u043c \u043d\u0430\u043b\u0438\u0447\u0438\u0435 \u0432\u043e\u0437\u0440\u0430\u0436\u0435\u043d\u0438\u0439, \u0434\u043e\u0431\u0430\u0432\u0438\u043c \u0438\u0445 \u0432 \u0438\u0441\u0442\u043e\u0440\u0438\u044e \u0432\u043e\u0437\u0440\u0430\u0436\u0435\u043d\u0438\u0439\n\n    output_obj = extract_entity_from_statement(\n\n                      name=name_objection_detector,\n\n                      system=system_prompt_objection_detector,\n\n                      instructions=instructions_objection_detector,\n\n                      question=history_user[-1],\n\n                      history='',\n\n                      temp=temperature_objection_detector,\n\n                      verbose=verbose_objection_detector,\n\n                      model=model_objection_detector).choices[0].message.content\n\n    try:\n\n        output_objection_detector = str(output_obj).split(':')[1]+ ''\n\n    except:\n\n        output_objection_detector = str(output_obj)\n\n    objection_detector.append(output_objection_detector)\n\n    objection_detector = list_cleaner(objection_detector)\n\n\n\n    #4. \u0412\u044b\u0434\u0435\u043b\u0438\u043c \u043e\u0442\u0440\u0430\u0431\u043e\u0442\u0430\u043d\u043d\u044b\u0435 \u043c\u0435\u043d\u0435\u0434\u0436\u0435\u0440\u043e\u043c \u0432\u043e\u0437\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u043a\u043b\u0438\u0435\u043d\u0442\u0430, \u0434\u043e\u0431\u0430\u0432\u0438\u043c \u0438\u0445 \u0432 \u0438\u0441\u0442\u043e\u0440\u0438\u044e \u043e\u0442\u0440\u0430\u0431\u043e\u0442\u0430\u043d\u043d\u044b\u0445 \u0432\u043e\u0437\u0440\u0430\u0436\u0435\u043d\u0438\u0439\n\n    output_res = extract_entity_from_statement(\n\n                      name=name_resolved_objection_detector,\n\n                      system=system_prompt_resolved_objection_detector,\n\n                      instructions=instructions_resolved_objection_detector,\n\n                      question='',\n\n                      history=history_manager,\n\n                      temp=temperature_resolved_objection_detector,\n\n                      verbose=verbose_resolved_objection_detector,\n\n                      model=model_resolved_objection_detector).choices[0].message.content\n\n    try:\n\n        output_resolved_objection_detector = str(output_res).split(':')[1]+ ''\n\n    except:\n\n        output_resolved_objection_detector = str(output_res)\n\n    resolved_objection_detector.append(output_resolved_objection_detector)\n\n    resolved_objection_detector = list_cleaner(resolved_objection_detector)\n\n\n\n    #5. \u0412\u044b\u0434\u0435\u043b\u0438\u043c \u043d\u0430\u0437\u0432\u0430\u043d\u043d\u044b\u0435 \u043c\u0435\u043d\u0435\u0434\u0436\u0435\u0440\u043e\u043c \u0442\u0430\u0440\u0438\u0444\u044b \u0438 \u0446\u0435\u043d\u044b, \u0434\u043e\u0431\u0430\u0432\u0438\u043c \u0438\u0445 \u0432 \u0438\u0441\u0442\u043e\u0440\u0438\u044e \u043d\u0430\u0437\u0432\u0430\u043d\u043d\u044b\u0445 \u0442\u0430\u0440\u0438\u0444\u043e\u0432 \u0438 \u0446\u0435\u043d\n\n    output_tar = extract_entity_from_statement(\n\n                      name=name_tariff_detector,\n\n                      system=system_prompt_tariff_detector,\n\n                      instructions=instructions_tariff_detector,\n\n                      question='',\n\n                      history=history_manager,\n\n                      temp=temperature_tariff_detector,\n\n                      verbose=verbose_tariff_detector,\n\n                      model=model_tariff_detector).choices[0].message.content\n\n    try:\n\n        output_tariff_detector = str(output_tar).split(':')[1]+ ''\n\n    except:\n\n        output_tariff_detector = str(output_tar)\n\n    tariff_detector.append(output_tariff_detector)\n\n    tariff_detector = list_cleaner(tariff_detector)\n\n\n\n    #6. \u0412\u044b\u0434\u0435\u043b\u0438\u043c \u043a\u043b\u044e\u0447\u0438 \u0438\u0437 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0445 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u043a\u043b\u0438\u0435\u043d\u0442\u0430 \u0438 \u043c\u0435\u043d\u0435\u0434\u0436\u0435\u0440\u0430 (\u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0439 \u0432\u043e\u043f\u0440\u043e\u0441+\u043e\u0442\u0432\u0435\u0442)\n\n    k = 2 if len(history_user)>1 else 1\n\n    if history_manager and len(history_manager)>0:\n\n      manager_list = history_manager[-1:]\n\n    else:\n\n      manager_list = []\n\n\n\n    topicphrase_completion = get_topicphrase_questions(name=name_todo_base,\n\n                                _user=history_user[-k:],\n\n                                _manager = manager_list,\n\n                                system=system_topicphrase_extractor,\n\n                                instruction=instructions_topicphrase_extractor,\n\n                                temp=temperature_todo_base,\n\n                                verbose=verbose_base,\n\n                                model=model_todo_base)\n\n    topicphrase_answ = topicphrase_completion.choices[0].message.content\n\n\n\n    # \u0438\u043c\u0435\u043d\u043d\u043e general_topic_phrase \u0431\u0443\u0434\u0435\u043c \u043f\u043e\u0434\u0430\u0432\u0430\u0442\u044c \u0432 Langchain \u0434\u043b\u044f similary search, \u043f\u0440\u0435\u043e\u0431\u0440\u0430\u0437\u0443\u0435\u043c \u0432 \u0441\u0442\u0440\u043e\u043a\u0443-\u043f\u0435\u0440\u0435\u0447\u0438\u0441\u043b\u0435\u043d\u0438\u0435 \u0447\u0435\u0440\u0435\u0437 \u0437\u0430\u043f\u044f\u0442\u0443\u044e + \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u043c \u0442\u0435\u043a\u0443\u0449\u0438\u0439 \u0432\u043e\u043f\u0440\u043e\u0441 \u043a\u043b\u0438\u0435\u043d\u0442\u0430\n\n    general_topic_phrase = str(history_user[-1]+', ' + topicphrase_answ).replace('[','') .replace(']','').replace(\"'\",'').replace(\"'\",'')\n\n\n\n    #7. \u0421\u0443\u043c\u043c\u0430\u0440\u0438\u0437\u0438\u0440\u0443\u0435\u043c \u0445\u0440\u043e\u043d\u043e\u043b\u043e\u0433\u0438\u044e \u043f\u0440\u0435\u0434\u044b\u0434\u0443\u0449\u0438\u0445 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u0434\u0438\u0430\u043b\u043e\u0433\u0430\n\n    summarized_comp = summarize_dialog(summarized_dialog, history_chat, temp=0.1, verbose=verbose_router, model=MODEL)\n\n    summarized_dialog = summarized_comp.choices[0].message.content\n\n\n\n    #8. \u0421\u043e\u0437\u0434\u0430\u0435\u043c \u0442\u043e\u0447\u043d\u043e\u0435 \u0441\u0430\u043c\u043c\u0430\u0440\u0438 \u0441 \u043a\u043b\u044e\u0447\u0435\u0432\u044b\u043c\u0438 \u043c\u043e\u043c\u0435\u043d\u0442\u0430\u043c\u0438 \u0434\u0438\u0430\u043b\u043e\u0433\u0430\n\n    tochnoe_summary = f'''\n\n# 1. \u0412\u044b\u044f\u0432\u043b\u0435\u043d\u044b \u041f\u043e\u0442\u0440\u0435\u0431\u043d\u043e\u0441\u0442\u0438: {', '.join(needs_extractor) if needs_extractor else '\u043f\u043e\u0442\u0440\u0435\u0431\u043d\u043e\u0441\u0442\u0435\u0439 \u043d\u0435 \u043e\u0431\u043d\u0430\u0440\u0443\u0436\u0435\u043d\u043e'}\n\n# 2. \u0420\u0430\u0441\u043a\u0430\u0437\u0430\u043d\u043d\u044b\u0435 \u041f\u0440\u0435\u0438\u043c\u0443\u0449\u0435\u0441\u0442\u0432\u0430: {', '.join(benefits_extractor) if benefits_extractor else '\u043f\u0440\u0435\u0438\u043c\u0443\u0449\u0435\u0441\u0442\u0432\u0430 \u043d\u0435 \u0431\u044b\u043b\u0438 \u0440\u0430\u0441\u0441\u043a\u0430\u0437\u0430\u043d\u044b'}\n\n# 3. \u0412\u043e\u0437\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u043a\u043b\u0438\u0435\u043d\u0442\u0430: {', '.join(objection_detector) if objection_detector else '\u0432\u043e\u0437\u0440\u0430\u0436\u0435\u043d\u0438\u0439 \u043d\u0435 \u043e\u0431\u043d\u0430\u0440\u0443\u0436\u0435\u043d\u043e'}\n\n# 4. \u0412\u043e\u0437\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u043a\u043b\u0438\u0435\u043d\u0442\u0430 \u043e\u0442\u0440\u0430\u0431\u043e\u0442\u0430\u043d\u044b: {', '.join(resolved_objection_detector) if resolved_objection_detector else '\u043e\u0442\u0440\u0430\u0431\u043e\u0442\u043a\u0438 \u043d\u0435 \u043e\u0431\u043d\u0430\u0440\u0443\u0436\u0435\u043d\u043e'}\n\n# 5. \u041a\u043e\u043d\u043a\u0440\u0435\u0442\u0438\u043a\u0430 - \u043e\u0433\u043e\u0432\u043e\u0440\u0435\u043d\u043d\u0430\u044f \u043a\u043e\u043d\u043a\u0440\u0435\u0442\u0438\u043a\u0430 - \u043a\u0443\u0440\u0441\u044b, \u0446\u0435\u043d\u044b: {', '.join(tariff_detector) if tariff_detector else '\u043d\u0435 \u043e\u0431\u043d\u0430\u0440\u0443\u0436\u0435\u043d\u043e'}\n\n'''\n\n    #9. \u0417\u0430\u043f\u0443\u0441\u043a\u0430\u0435\u043c \u0414\u0438\u0441\u043f\u0435\u0442\u0447\u0435\u0440\u0430\n\n    output_router = user_question_router(name= name_router,\n\n                                        system=system_prompt_router,\n\n                                        instructions=instructions_router,\n\n                                        question=history_user[-1],\n\n                                        summary_history=summarized_dialog,\n\n                                        summary_exact=tochnoe_summary,\n\n                                        temp=temperature_router,\n\n                                        verbose=verbose_router,\n\n                                        model=model_router,\n\n                                        needs_lst=needs_extractor).choices[0].message.content\n\n\n\n    #10. \u041f\u043e \u0441\u043f\u0438\u0441\u043a\u0443 \u0441\u043f\u0435\u0446\u043e\u0432 \u0438\u0437 \u043e\u0442\u0432\u0435\u0442\u0430 \u0414\u0438\u0441\u043f\u0435\u0442\u0447\u0435\u0440\u0430 \u0437\u0430\u043f\u0443\u0441\u043a\u0430\u0435\u043c \u0441\u043f\u0435\u0446\u043e\u0432:\n\n    output_spez = []\n\n    try:\n\n        output_router_fixed = (str(output_router).split(':')[1]+ '').replace(\"\u2018\", '\"').replace(\"'\", '\"')\n\n    except:\n\n        output_router_fixed = str(output_router).replace(\"\u2018\", '\"').replace(\"'\", '\"')\n\n\n\n    try:\n\n      output_router_list = json.loads(output_router_fixed)\n\n    except:\n\n      output_router_list = ['Zoom_\u041f\u0443\u0448', '\u0421\u043f\u0435\u0446_\u043f\u043e_\u043f\u0440\u0435\u0437\u0435\u043d\u0442\u0430\u0446\u0438\u044f\u043c']\n\n    print(f'{bcolors.RED}{output_router_list}{bcolors.ENDC}')\n\n    try:\n\n      for key_param in output_router_list:\n\n          param = spez_config[key_param] | {'question': history_user[-1],\n\n                                      'summary_history': summarized_dialog,\n\n                                      'summary_exact': tochnoe_summary,\n\n                                      'base_topicphrase': general_topic_phrase,\n\n                                      'search_index': vectordb}\n\n          spez_answer = spez_user_question(**param).choices[0].message.content\n\n          try:\n\n            answer = spez_answer.split(': ')[1]+ ' '\n\n          except:\n\n            answer = spez_answer\n\n          answer = answer.lstrip('#3')\n\n\n\n          output_spez.append(f'{param[\"name\"]}: {answer}')\n\n\n\n      if verbose: print(f\"\\n{bcolors.BGMAGENTA}\u041e\u0442\u0432\u0435\u0442\u044b \u0441\u043f\u0435\u0446\u043e\u0432:{bcolors.ENDC}\\n\", '\\n\\n=========\\n'.join(output_spez))\n\n    except:\n\n      if verbose: print(f'{bcolors.BGYELLOW}\u041e\u0442\u0432\u0435\u0442 \u0434\u0438\u0441\u043f\u0435\u0442\u0447\u0435\u0440\u0430 \u043b\u0438\u0431\u043e \u043d\u0435 \u0432\u044b\u0437\u044b\u0432\u0430\u0435\u0442 \u0441\u043f\u0435\u0446\u043e\u0432 \u043b\u0438\u0431\u043e \u0438\u043c\u0435\u0435\u0442 \u043d\u0435\u0432\u0435\u0440\u043d\u044b\u0439 \u0444\u043e\u0440\u043c\u0430\u0442:{bcolors.ENDC} {output_router}')\n\n\n\n\n\n    #11. \u041d\u0430 \u043e\u0441\u043d\u043e\u0432\u0430\u043d\u0438\u0438 \u043f\u0440\u0435\u0434\u043b\u043e\u0430\u0436\u0435\u043d\u0438\u044f \u0443\u0437\u043a\u0438\u0445 \u0441\u043f\u0435\u0446\u043e\u0432 \u0437\u0430\u043f\u0443\u0441\u043a\u0430\u0435\u043c \u0441\u0442\u0440\u0430\u0448\u0435\u0433\u043e \u043c\u0435\u043d\u0435\u0434\u0436\u0435\u0440\u0430 \u0434\u043b\u044f \u043f\u043e\u0434\u0433\u043e\u0442\u043e\u0432\u043a\u0438 \u043a\u043e\u043c\u043f\u043b\u0435\u043a\u0441\u043d\u043e\u0433\u043e \u043e\u0442\u0432\u0435\u0442\u0430:\n\n    output_senior = senior_answer(\n\n                          name=name_senior,\n\n                          system=system_prompt_senior,\n\n                          instructions=instructions_senior,\n\n                          question=history_user[-1],\n\n                          output_spez=output_spez,\n\n                          summary_history=summarized_dialog,\n\n                          base_topicphrase=general_topic_phrase,\n\n                          search_index=vectordb,\n\n                          summary_exact=tochnoe_summary,\n\n                          temp=temperature_senior,\n\n                          verbose=verbose_senior,\n\n                          k=num_fragments_base_senior,\n\n                          model=model_senior,\n\n                          spez_list=output_router_list).choices[0].message.content\n\n    if verbose: print(f\"\\n{bcolors.BGMAGENTA}senior: {bcolors.ENDC} {output_senior}\", )\n\n    #12. \u0417\u0430\u043f\u0443\u0441\u043a\u0430\u0435\u043c \u0421\u0442\u0438\u043b\u0438\u0441\u0442\u0430:\n\n    output_stilist = stilizator_answer(\n\n                          name=name_stilist,\n\n                          system=system_prompt_stilist,\n\n                          instructions=instructions_stilist,\n\n                          answers_content=output_senior,\n\n                          temp=temperature_stilist,\n\n                          verbose=verbose_stilist,\n\n                          model=model_stilist).choices[0].message.content\n\n\n\n    #13. \u043a\u043e\u043d\u0442\u0440\u043e\u043b\u044c\u043d\u044b\u0439 \u0432\u044b\u0441\u0442\u0440\u0435\u043b \u043f\u043e \u043f\u0440\u0438\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u044f\u043c:\n\n    output_stilist_withouthello = del_hello(\n\n                          name=name_stilist,\n\n                          system=system_prompt_stilist1,\n\n                          instructions=instructions_prompt_stilist1,\n\n                          answers_content=output_stilist,\n\n                          temp=temperature_stilist,\n\n                          verbose=verbose_stilist,\n\n                          model=model_stilist).choices[0].message.content\n\n\n\n    return output_stilist_withouthello\n\n", "metadata": {"subid": 7, "total": 9, "source": "https://colab.research.google.com/drive/1KrniwGByCdFu3FtrQ1JUASAaYwTJgU4N?usp=sharing"}}}, {"lc": 1, "type": "constructor", "id": ["langchain", "schema", "document", "Document"], "kwargs": {"page_content": "\n# \u041f\u043e\u0434\u0433\u0440\u0443\u0436\u0430\u0435\u043c \u043a\u043b\u044e\u0447 API, \u0411\u0430\u0437\u0443 \u0437\u043d\u0430\u043d\u0438\u0439\n\n# \u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u0435 \u044d\u0442\u0443 \u044f\u0447\u0435\u0439\u043a\u0443, \u0435\u0441\u043b\u0438 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0435 \u0441\u0435\u043a\u0440\u0435\u0442\u043d\u044b\u0439 \u043a\u043b\u044e\u0447 \u0432 \u043a\u043e\u043b\u0430\u0431\u0435\n\nfrom google.colab import userdata\n\nkey = userdata.get('OPENAI_API_KEY')\n\nos.environ[\"OPENAI_API_KEY\"] = key\n# @title \u0417\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043c \u0411\u0430\u0437\u0443 \u0417\u043d\u0430\u043d\u0438\u0439, \u0438\u043d\u0434\u0435\u043a\u0441\u0438\u0440\u0443\u0435\u043c, \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u0435\u043c \u0438\u043d\u0434\u0435\u043a\u0441\u044b\n\nknowledge_db_txt = load_googledoc_by_url(knowledge_db_url)\n\n# \u0420\u0430\u0437\u0431\u0438\u0432\u0430\u0435\u043c \u043d\u0430 \u0447\u0430\u043d\u043a\u0438\n\ndocs = split_text(knowledge_db_txt, chunk_size, chunk_overlap)\n\nvectordb = FAISS.from_documents(docs, OpenAIEmbeddings())\n\nvectordb.save_local('UII_database_markdown')\n# @title \u0417\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043c \u0438\u043d\u0434\u0435\u043a\u0441\u044b \u0411\u0430\u0437\u044b \u0417\u043d\u0430\u043d\u0438\u0439\n\nvectordb = FAISS.load_local('/content/UII_database_markdown', OpenAIEmbeddings())\n\n\n\nprint('\u0418\u043d\u0434\u0435\u043a\u0441\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0411\u0430\u0437\u044b \u0417\u043d\u0430\u043d\u0438\u0439 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u043e!')\n\n# \u0414\u0438\u0430\u043b\u043e\u0433\nverbose = 1\n#@title \u0417\u0430\u043f\u0443\u0441\u043a \u0434\u0438\u0430\u043b\u043e\u0433\u0430\n\nhistory_chat = []\n\nhistory_user = []\n\nhistory_manager = []\n\n\n\nneeds_extractor = []\n\nbenefits_extractor = []\n\nobjection_detector = []\n\nresolved_objection_detector = []\n\ntariff_detector = []\n\n\n\nmain_answer = ''\n\nsummarized_dialog = ''\n\n\n\nwhile True:\n\n    client_question = input(f'{bcolors.BGCYAN}\u0412\u043e\u043f\u0440\u043e\u0441 \u043a\u043b\u0438\u0435\u043d\u0442\u0430:{bcolors.ENDC} ')\n\n    history_user.append(client_question)\n\n    history_chat.append(f\"\u041a\u043b\u0438\u0435\u043d\u0442: {client_question}\")\n\n    if len(history_user) == 1: hello_word = sufler(history_user)  # \u0437\u0430\u043f\u043e\u043c\u043d\u0438\u043b\u0438 \u043f\u0440\u0438\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u0435\n\n    if client_question.lower() in ['stop', '\u0441\u0442\u043e\u043f']:\n\n        break\n\n    without_hello = get_seller_answer(history_user, history_manager, history_chat)\n\n    if len(history_chat) == 1 and 'None' not in hello_word:\n\n        main_answer = f'{hello_word} \u043c\u0435\u043d\u044f \u0437\u043e\u0432\u0443\u0442 \u0412\u0430\u0441\u0438\u043b\u0438\u0439, \u044f \u043c\u0435\u043d\u0435\u0434\u0436\u0435\u0440 \u043e\u0442\u0434\u0435\u043b\u0430 \u043f\u0440\u043e\u0434\u0430\u0436 \u0423\u0418\u0418. ' + without_hello\n\n    else:\n\n        main_answer = without_hello\n\n\n\n #   print(f'{bcolors.BGGREEN}\u0412\u0430\u0441\u0438\u043b\u0438\u0439:{bcolors.ENDC}\\n {insert_newlines(remove_newlines(main_answer), 160)}')\n\n    print(f'{bcolors.BGGREEN}\u0412\u0430\u0441\u0438\u043b\u0438\u0439:{bcolors.ENDC} {remove_newlines(main_answer)}')\n\n\n\n    history_chat.append(f\"\u041c\u0435\u043d\u0435\u0434\u0436\u0435\u0440: {without_hello}\")\n\n    history_manager.append(without_hello) # \u043d\u0435 \u0431\u0443\u0434\u0435\u043c \u0412\u0430\u0441\u0438\u043b\u0438\u044f \u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0432 \u0438\u0441\u0442\u043e\u0440\u0438\u0438, \u0447\u0442\u043e\u0431\u044b \u043d\u0435 \u043f\u0443\u0442\u0430\u0442\u044c gpt \u043b\u0438\u0448\u043d\u0438\u043c\u0438 \u0438\u043c\u0435\u043d\u0430\u043c\u0438\n\n\n\n# \u0417\u0430\u043f\u0443\u0441\u043a \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f\n\nfrom datetime import datetime\n\ntext_file = f'dialog_{datetime.now().strftime(\"%d.%m.%Y_%H.%M.%S\")}.txt'\n\nwith open(text_file, \"w\") as f:\n\n    f.write(str('\\n\\n'.join(history_chat)))\n\n#@title \u0417\u0430\u043f\u0443\u0441\u043a \u0434\u0438\u0430\u043b\u043e\u0433\u0430\n\nhistory_chat = []\n\nhistory_user = []\n\nhistory_manager = []\n\n\n\nneeds_extractor = []\n\nbenefits_extractor = []\n\nobjection_detector = []\n\nresolved_objection_detector = []\n\ntariff_detector = []\n\n\n\nmain_answer = ''\n\nsummarized_dialog = ''\n\n\n\nwhile True:\n\n    start_time = time.time()  # \u041d\u0430\u0447\u0430\u043b\u043e \u0438\u0442\u0435\u0440\u0430\u0446\u0438\u0438\n\n    client_question = input(f'{bcolors.BGCYAN}\u0412\u043e\u043f\u0440\u043e\u0441 \u043a\u043b\u0438\u0435\u043d\u0442\u0430:{bcolors.ENDC} ')\n\n    history_user.append(client_question)\n\n    history_chat.append(f\"\u041a\u043b\u0438\u0435\u043d\u0442: {client_question}\")\n\n    if len(history_user) == 1: hello_word = sufler(history_user)  # \u0437\u0430\u043f\u043e\u043c\u043d\u0438\u043b\u0438 \u043f\u0440\u0438\u0432\u0435\u0442\u0441\u0442\u0432\u0438\u0435\n\n    if client_question.lower() in ['stop', '\u0441\u0442\u043e\u043f']:\n\n        break\n\n    without_hello = get_seller_answer(history_user, history_manager, history_chat)\n\n    if len(history_chat) == 1 and 'None' not in hello_word:\n\n        main_answer = f'{hello_word} \u043c\u0435\u043d\u044f \u0437\u043e\u0432\u0443\u0442 \u0412\u0430\u0441\u0438\u043b\u0438\u0439, \u044f \u043c\u0435\u043d\u0435\u0434\u0436\u0435\u0440 \u043e\u0442\u0434\u0435\u043b\u0430 \u043f\u0440\u043e\u0434\u0430\u0436 \u0423\u0418\u0418. ' + without_hello\n\n    else:\n\n        main_answer = without_hello\n\n\n\n #   print(f'{bcolors.BGGREEN}\u0412\u0430\u0441\u0438\u043b\u0438\u0439:{bcolors.ENDC}\\n {insert_newlines(remove_newlines(main_answer), 160)}')\n\n    print(f'{bcolors.BGGREEN}\u0412\u0430\u0441\u0438\u043b\u0438\u0439:{bcolors.ENDC} {textwrap.fill(remove_newlines(main_answer))}')\n\n\n\n    history_chat.append(f\"\u041c\u0435\u043d\u0435\u0434\u0436\u0435\u0440: {without_hello}\")\n\n    history_manager.append(without_hello) # \u043d\u0435 \u0431\u0443\u0434\u0435\u043c \u0412\u0430\u0441\u0438\u043b\u0438\u044f \u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0432 \u0438\u0441\u0442\u043e\u0440\u0438\u0438, \u0447\u0442\u043e\u0431\u044b \u043d\u0435 \u043f\u0443\u0442\u0430\u0442\u044c gpt \u043b\u0438\u0448\u043d\u0438\u043c\u0438 \u0438\u043c\u0435\u043d\u0430\u043c\u0438\n\n    end_time = time.time()  # \u041a\u043e\u043d\u0435\u0446 \u0438\u0442\u0435\u0440\u0430\u0446\u0438\u0438\n\n    print(f\"\u0412\u0440\u0435\u043c\u044f, \u0437\u0430\u0442\u0440\u0430\u0447\u0435\u043d\u043d\u043e\u0435 \u043d\u0430 \u0438\u0442\u0435\u0440\u0430\u0446\u0438\u044e: {end_time - start_time:.2f} \u0441\u0435\u043a\u0443\u043d\u0434\u044b\")\n\n\n\n# \u0417\u0430\u043f\u0443\u0441\u043a \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u044f\n\nfrom datetime import datetime\n\ntext_file = f'dialog_{datetime.now().strftime(\"%d.%m.%Y_%H.%M.%S\")}.txt'\n\nwith open(text_file, \"w\") as f:\n\n    f.write(str('\\n\\n'.join(history_chat)))", "metadata": {"subid": 8, "total": 9, "source": "https://colab.research.google.com/drive/1KrniwGByCdFu3FtrQ1JUASAaYwTJgU4N?usp=sharing"}}}]