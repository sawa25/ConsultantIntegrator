[{"lc": 1, "type": "constructor", "id": ["langchain", "schema", "document", "Document"], "kwargs": {"page_content": "\n\n# **\u041f\u0435\u0440\u0435\u043d\u043e\u0441 \u0441\u0442\u0438\u043b\u044f \u0440\u0435\u0447\u0438**\n\u0421\u0442\u0438\u043b\u044c \u0440\u0435\u0447\u0438 \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u044f\u044e\u0442 \u043a\u0430\u043a \u0440\u0430\u0437\u043d\u043e\u0432\u0438\u0434\u043d\u043e\u0441\u0442\u044c \u043b\u0438\u0442\u0435\u0440\u0430\u0442\u0443\u0440\u043d\u043e\u0433\u043e \u044f\u0437\u044b\u043a\u0430, \u0432 \u043a\u043e\u0442\u043e\u0440\u043e\u0439 \u044f\u0437\u044b\u043a \u0432\u044b\u0441\u0442\u0443\u043f\u0430\u0435\u0442 \u0432 \u0442\u043e\u0439 \u0438\u043b\u0438 \u0438\u043d\u043e\u0439 \u0441\u043e\u0446\u0438\u0430\u043b\u044c\u043d\u043e \u0437\u043d\u0430\u0447\u0438\u043c\u043e\u0439 \u0441\u0444\u0435\u0440\u0435 \u043e\u0431\u0449\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u043e-\u0440\u0435\u0447\u0435\u0432\u043e\u0439 \u043f\u0440\u0430\u043a\u0442\u0438\u043a\u0438 \u043b\u044e\u0434\u0435\u0439 \u0438 \u043e\u0441\u043e\u0431\u0435\u043d\u043d\u043e\u0441\u0442\u0438 \u043a\u043e\u0442\u043e\u0440\u043e\u0439 \u043e\u0431\u0443\u0441\u043b\u043e\u0432\u043b\u0435\u043d\u044b \u043e\u0441\u043e\u0431\u0435\u043d\u043d\u043e\u0441\u0442\u044f\u043c\u0438 \u043e\u0431\u0449\u0435\u043d\u0438\u044f \u0432 \u0434\u0430\u043d\u043d\u043e\u0439 \u0441\u0444\u0435\u0440\u0435. \u0418\u043d\u043e\u0433\u0434\u0430 \u0441\u0442\u0438\u043b\u0438 \u0440\u0435\u0447\u0438 \u043d\u0430\u0437\u044b\u0432\u0430\u044e\u0442 \u044f\u0437\u044b\u043a\u043e\u0432\u044b\u043c\u0438 \u0436\u0430\u043d\u0440\u0430\u043c\u0438.\n\n\n\n\u0422\u0440\u0430\u0434\u0438\u0446\u0438\u043e\u043d\u043d\u043e \u0432\u044b\u0434\u0435\u043b\u044f\u044e\u0442 \u0448\u0435\u0441\u0442\u044c \u043e\u0441\u043d\u043e\u0432\u043d\u044b\u0445 \u0440\u0430\u0437\u043d\u043e\u0432\u0438\u0434\u043d\u043e\u0441\u0442\u0435\u0439 \u0441\u0442\u0438\u043b\u0435\u0439 \u0440\u0435\u0447\u0438, \u0440\u0430\u0437\u043b\u0438\u0447\u0430\u044e\u0449\u0438\u0445\u0441\u044f \u0443\u0441\u043b\u043e\u0432\u0438\u044f\u043c\u0438 \u0438 \u0446\u0435\u043b\u044f\u043c\u0438 \u043e\u0431\u0449\u0435\u043d\u0438\u044f \u0432 \u043a\u0430\u043a\u043e\u0439-\u0442\u043e \u0441\u0444\u0435\u0440\u0435 \u043e\u0431\u0449\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u0439 \u0434\u0435\u044f\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u0438:\n\n- \u043d\u0430\u0443\u0447\u043d\u044b\u0439,\n\n- \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u043e-\u0434\u0435\u043b\u043e\u0432\u043e\u0439,\n\n- \u043f\u0443\u0431\u043b\u0438\u0446\u0438\u0441\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439,\n\n- \u0440\u0430\u0437\u0433\u043e\u0432\u043e\u0440\u043d\u044b\u0439,\n\n- \u0445\u0443\u0434\u043e\u0436\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0439,\n\n- \u0440\u0435\u043b\u0438\u0433\u0438\u043e\u0437\u043d\u044b\u0439.\n\n\n\n\u0412 \u0440\u0430\u043c\u043a\u0430\u0445 \u044d\u0442\u043e\u0439 \u043a\u043b\u0430\u0441\u0441\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u0438 \u043f\u043e\u0441\u043c\u043e\u0442\u0440\u0438\u043c, \u043a\u0430\u043a \u043c\u043e\u0436\u043d\u043e \u0443\u043f\u0440\u0430\u0432\u043b\u044f\u0442\u044c \u0441\u0442\u0438\u043b\u044f\u043c\u0438 \u0440\u0435\u0447\u0438 \u0432 \u043e\u0442\u0432\u0435\u0442\u0430\u0445 LLM.\n\n\n\n\u0412 \u0440\u0430\u0441\u0441\u043c\u0430\u0442\u0440\u0438\u0432\u0430\u0435\u043c\u044b\u0445 \u043c\u0430\u0442\u0435\u0440\u0438\u0430\u043b\u0430\u0445, \u043c\u044b \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u043c \u0438\u0437 **\u0412\u0438\u043a\u0438\u043f\u0435\u0434\u0438\u0438** \u0441\u0442\u0430\u0442\u044c\u044e \u043e \u0444\u0438\u0437\u0438\u0447\u0435\u0441\u043a\u043e\u0439 \u0442\u0435\u043e\u0440\u0438\u0438 \u0431\u043e\u043b\u044c\u0448\u043e\u0433\u043e \u0432\u0437\u0440\u044b\u0432\u0430, \u043e\u0433\u0440\u0430\u043d\u0438\u0447\u0438\u043c \u0440\u0430\u0437\u043c\u0435\u0440 \u0441\u0442\u0430\u0442\u044c\u0438 7 \u043a\u0422 (\u043c\u043e\u0436\u043d\u043e \u0437\u0430\u0434\u0430\u0442\u044c \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440 \u0432\u0440\u0443\u0447\u043d\u0443\u044e), \u0438 \u043f\u043e\u0441\u043c\u043e\u0442\u0440\u0438\u043c, \u043a\u0430\u043a \u043f\u0440\u0438 \u043f\u043e\u043c\u043e\u0449\u0438 \u043f\u0440\u043e\u043c\u043f\u0442\u043e\u0432 \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043e\u0442 \u043c\u043e\u0434\u0435\u043b\u0438 ***gpt-4-0125-preview*** \u0440\u0430\u0441\u0441\u0443\u0436\u0434\u0435\u043d\u0438\u044f \u043d\u0430 \u044d\u0442\u0443 \u0442\u0435\u043c\u0443 \u0432 \u0440\u0430\u0437\u043d\u044b\u0445 \u0441\u0442\u0438\u043b\u044f\u0445.\n\n\n\n\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 \u0433\u0435\u043d\u0435\u0440\u0430\u0446\u0438\u0438 \u0431\u0443\u0434\u0435\u043c \u0437\u0430\u043f\u0438\u0441\u044b\u0432\u0430\u0442\u044c \u0432 \u0442\u0435\u043a\u0441\u0442\u043e\u0432\u044b\u0435 \u0444\u0430\u0439\u043b\u044b \u0438 \u0441\u043e\u0445\u0440\u0430\u043d\u044f\u0435\u0442\u0441\u044f \u0432 \u0441\u0440\u0435\u0434\u0435 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044f.\n# \u0413\u043e\u0442\u043e\u0432\u0438\u043c \u043e\u043a\u0440\u0443\u0436\u0435\u043d\u0438\u0435 (\u0443\u0441\u0442\u0430\u043d\u0430\u0432\u043b\u0438\u0432\u0430\u0435\u043c \u043f\u0430\u043a\u0435\u0442\u044b, \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0430\u0435\u043c \u0431\u0438\u0431\u043b\u0438\u043e\u0442\u0435\u043a\u0438, \u043f\u043e\u043b\u0443\u0447\u0430\u0435\u043c \u043a\u043b\u044e\u0447 API_OpenAI, \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u044f\u0435\u043c \u0432\u0441\u043f\u043e\u043c\u043e\u0433\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0435 \u0444\u0443\u043d\u043a\u0446\u0438\u0438)\n!pip install --upgrade --quiet  wikipedia >/dev/null\n\n!pip install openai==1.10.0 langchain==0.1.4 tiktoken==0.5.2 faiss-cpu==1.7.4>/dev/null\n\n!pip install langchain_community langchain_openai==0.0.5 >/dev/null\n\n!pip install html2text==2024.2.26 >/dev/null\nimport openai\n\nimport tiktoken\n\n\n\nfrom langchain_community.document_loaders import WikipediaLoader\n\nfrom langchain.document_loaders import AsyncHtmlLoader\n\nfrom langchain.document_transformers import Html2TextTransformer\n\nfrom langchain.text_splitter import RecursiveCharacterTextSplitter\n\n\n\nimport os\n\nimport re\n\nimport requests\n\n\n\n\n\nfrom google.colab import userdata\n\n#@title \u041f\u043e\u043b\u0443\u0447\u0430\u0435\u043c \u043a\u043b\u044e\u0447 API \u043e\u0442 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u0438 \u0443\u0441\u0442\u0430\u043d\u0430\u0432\u043b\u0438\u0432\u0430\u0435\u043c \u0435\u0433\u043e \u043a\u0430\u043a \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u0443\u044e \u043e\u043a\u0440\u0443\u0436\u0435\u043d\u0438\u044f\n\nopenai_key = userdata.get(\"NKM\")\n\nos.environ[\"OPENAI_API_KEY\"] = openai_key\n\nopenai.api_key = openai_key\n#@title \u041e\u043f\u0440\u0435\u0434\u0435\u043b\u044f\u0435\u043c \u0444\u0443\u043d\u043a\u0446\u0438\u0438\n\n# \u0424\u0443\u043d\u043a\u0446\u0438\u044f \u0434\u043b\u044f \u043e\u0447\u0438\u0441\u0442\u043a\u0438 \u0442\u0435\u043a\u0441\u0442\u0430\n\ndef clean_text(text):\n\n    # \u0423\u0434\u0430\u043b\u0435\u043d\u0438\u0435 \u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043a\u043e\u0432 \u0438 \u043f\u043e\u0434\u0437\u0430\u0433\u043e\u043b\u043e\u0432\u043a\u043e\u0432\n\n    text = re.sub(r\"\\* .+\\n\", \"\", text)\n\n    # \u0423\u0434\u0430\u043b\u0435\u043d\u0438\u0435 \u0441\u0441\u044b\u043b\u043e\u043a \u0438 \u0438\u043d\u0441\u0442\u0440\u0443\u043a\u0446\u0438\u0439 \"[\u043f\u0440\u0430\u0432\u0438\u0442\u044c | \u043f\u0440\u0430\u0432\u0438\u0442\u044c \u043a\u043e\u0434]\", \"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043d\u0430\u0432\u0438\u0433\u0430\u0446\u0438\u0438\", \"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043f\u043e\u0438\u0441\u043a\u0443\"\n\n    text = re.sub(r\"\u043f\u0440\u0430\u0432\u0438\u0442\u044c | \u043f\u0440\u0430\u0432\u0438\u0442\u044c \u043a\u043e\u0434\", \"\", text)\n\n    text = re.sub(r\"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043d\u0430\u0432\u0438\u0433\u0430\u0446\u0438\u0438\", \"\", text)\n\n    text = re.sub(r\"\u041f\u0435\u0440\u0435\u0439\u0442\u0438 \u043a \u043f\u043e\u0438\u0441\u043a\u0443\", \"\", text)\n\n    # \u041e\u0447\u0438\u0441\u0442\u043a\u0430 \u0442\u0435\u043a\u0441\u0442\u0430 \u043e\u0442 \u043b\u0438\u0448\u043d\u0438\u0445 \u043f\u0440\u043e\u0431\u0435\u043b\u043e\u0432 \u0438 \u043f\u0435\u0440\u0435\u0432\u043e\u0434\u043e\u0432 \u0441\u0442\u0440\u043e\u043a\n\n    text = re.sub(r\"\\n\\s*\\n\", \"\\n\", text)\n\n    return text\n\n\n\n# \u0444\u0443\u043d\u043a\u0446\u0438\u044f \u043d\u0430 \u043e\u0441\u043d\u043e\u0432\u0430\u043d\u0438\u0438 \u043e\u0442\u0432\u0435\u0442\u0430 \u043d\u0430 \u0437\u0430\u043f\u0440\u043e\u0441 \u043a \u0432\u0438\u043a\u0438\u043f\u0435\u0434\u0438\u0438 \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u043e\u0447\u0438\u0449\u0435\u043d\u043d\u044b\u0439 \u0442\u0435\u043a\u0441\u0442 \u0441\u0430\u043c\u043e\u0439 \u0440\u0435\u043b\u0435\u0432\u0430\u043d\u0442\u043d\u043e\u0439 \u0437\u0430\u043f\u0440\u043e\u0441\u0443 \u0441\u0442\u0430\u0442\u044c\u0438 \u0432 \u0440\u0443\u0441\u0441\u043a\u043e\u043c \u0441\u0435\u0433\u043c\u0435\u043d\u0442\u0435\n\ndef get_docs_by_req_to_wikipedia(str_req):\n\n  wiki_docs = WikipediaLoader(query=str_req, load_max_docs=1, lang='ru').load() # \u0437\u0430\u0431\u0438\u0440\u0430\u0435\u043c \u0438\u0437 \u0412\u0438\u043a\u0438\u043f\u0435\u0434\u0438\u0438 \u0442\u043e\u043b\u044c\u043a\u043e \u043e\u0434\u043d\u0443 \u0441\u0430\u043c\u0443\u044e \u0440\u0435\u043b\u0435\u0432\u0430\u043d\u0442\u043d\u0443\u044e \u0437\u0430\u043f\u0440\u043e\u0441\u0443 (str_req) \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443 (load_max_docs=1)\n\n  url_resp = []\n\n  for doc in wiki_docs:  # WikipediaLoader \u0433\u0440\u0443\u0437\u0438\u0442 \u043a\u043e\u0440\u043e\u0442\u043a\u0438\u0439 \u043e\u0442\u0440\u044b\u0432\u043e\u043a \u0441\u0442\u0430\u0442\u044c\u0438, \u043f\u043e\u044d\u0442\u043e\u043c\u0443 \u0441\u043e\u0431\u0435\u0440\u0435\u043c \u0442\u043e\u043b\u044c\u043a\u043e \u0441\u0441\u044b\u043b\u043a\u0438 (doc.metadata['source']) \u0438 \u0441\u043f\u0430\u0440\u0441\u0438\u043c \u0443\u0436\u0435 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u044b \u043f\u043e \u044d\u0442\u0438\u043c \u0441\u0441\u044b\u043b\u043a\u0430\u043c \u0447\u0435\u0440\u0435\u0437 AsyncHtmlLoader\n\n    url_resp.append(doc.metadata['source'])\n\n\n\n  # \u043f\u0430\u0440\u0441\u0438\u043c \u0441\u0442\u0440\u0430\u043d\u0438\u0447\u043a\u0438 \u043f\u043e \u0441\u043f\u0438\u0441\u043a\u0443 url wikipedia, \u0432\u043e\u0437\u0432\u0440\u0430\u0449\u0435\u043d\u043d\u044b\u0445 \u043f\u043e \u0437\u0430\u043f\u0440\u043e\u0441\u0443\n\n  loader = AsyncHtmlLoader(url_resp)\n\n  html_docs = loader.load()\n\n  # \u0442\u0440\u0430\u043d\u0441\u0444\u043e\u0440\u043c\u0438\u0440\u0443\u0435\u043c \u0438\u0445 \u0432 \u0442\u0435\u043a\u0441\u0442\n\n  html2text = Html2TextTransformer()\n\n  docs_transformed = html2text.transform_documents(html_docs)\n\n  # \u041e\u0447\u0438\u0449\u0430\u0435\u043c \u043a\u0430\u0436\u0434\u044b\u0439 \u0438\u0437 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u043e\u0432 \u0432 \u0441\u043f\u0438\u0441\u043a\u0435\n\n  for doc in docs_transformed:\n\n    doc.page_content = clean_text(doc.page_content)\n\n  return docs_transformed\n\n\n\n# \u0444\u0443\u043d\u043a\u0446\u0438\u044f \u043f\u043e\u0434\u0441\u0447\u0435\u0442\u0430 \u0442\u043e\u043a\u0435\u043d\u043e\u0432\n\ndef num_tokens_from_string(string: str, encoding_name: str) -> int:\n\n      \"\"\"\u0412\u043e\u0437\u0432\u0440\u0430\u0449\u0430\u0435\u0442 \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0442\u043e\u043a\u0435\u043d\u043e\u0432 \u0432 \u0441\u0442\u0440\u043e\u043a\u0435\"\"\"\n\n      encoding = tiktoken.get_encoding(encoding_name)\n\n      num_tokens = len(encoding.encode(string))\n\n      return num_tokens\n\ndef num_tokens(fragment):\n\n        return num_tokens_from_string(fragment, \"cl100k_base\")\n\n\n\n# \u043c\u043e\u0434\u0435\u043b\u044c GPT-\u043f\u0438\u0441\u0430\u0442\u0435\u043b\u044c\n\ndef answer_index(system, topic, instructions, doc_info, temp, model):\n\n    message_content = doc_info\n\n    messages = [\n\n              {\"role\": \"system\", \"content\": system},\n\n              {\"role\": \"user\", \"content\": f\"{instructions}\\n\\n\u0414\u043e\u043f \u0438\u043d\u0444\u043e:\\n{message_content}\\n\\n\u0422\u0435\u043c\u0430: {topic}\"}\n\n              ]\n\n\n\n    completion = openai.chat.completions.create(model=model, messages=messages, temperature=temp)\n\n    return completion.choices[0].message.content, completion.usage.prompt_tokens, completion.usage.completion_tokens\n\n\n\n# \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0433\u0443\u0433\u043b-\u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430 \u043f\u043e \u0435\u0433\u043e URL\n\ndef load_googledoc_by_url(doc_url) -> str: # \u0424\u0443\u043d\u043a\u0446\u0438\u044f load_googledoc_by_url \u043f\u0440\u0435\u0434\u043d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0430 \u0434\u043b\u044f \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438 \u0442\u0435\u043a\u0441\u0442\u0430 \u0438\u0437 \u0433\u0443\u0433\u043b\u0434\u043e\u043a\u0430, \u043f\u043e \u0441\u0441\u044b\u043b\u043a\u0435 (doc_url)\n\n  # Extract the document ID from the URL\n\n  match_ = re.search('/document/d/([a-zA-Z0-9-_]+)', doc_url)\n\n  if match_ is None:\n\n    raise ValueError('Invalid Google Docs URL')\n\n  doc_id = match_.group(1)\n\n\n\n  # Download the document as plain text\n\n  response = requests.get(f'https://docs.google.com/document/d/{doc_id}/export?format=txt')\n\n  response.raise_for_status()\n\n  return response.text\n#@title \u0417\u0430\u0434\u0430\u0435\u043c \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b\n\nmax_count = 7000\n\nchunk_overlap = 0\n\ntemp = 0.5\n\nmodel_4 = 'gpt-4-0125-preview'\n\nmodel_35_0125 = \"gpt-3.5-turbo-0125\"\n\nmodel_35_1106 = 'gpt-3.5-turbo-1106'\n\nMODEL = model_4\ndict_style_desciption = {}\n\ndict_style_desciption['\u041d\u0430\u0443\u0447\u043d\u044b\u0439'] = \"https://docs.google.com/document/d/1ug0BPx4-WGeZxHv8RluhosLNxKlW49rTx6w2bXJcuV8\"\n\ndict_style_desciption['\u0428\u043a\u043e\u043b\u044c\u043d\u044b\u0439 \u0443\u0447\u0438\u0442\u0435\u043b\u044c'] = \"https://docs.google.com/document/d/1MzitfsCdF5DgGjRVBblHkF2NR9ShoMBTQ9BsVbOfJg4\"\n\ndict_style_desciption['\u0411\u044e\u0440\u043e\u043a\u0440\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439'] = \"https://docs.google.com/document/d/1NfoGXoNK7tk84uel1hXV0LQQv5-RChY68_O-eyYiP8U\"\n\ndict_style_desciption['\u041f\u043e\u044d\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439'] = \"https://docs.google.com/document/d/1S9SgvCzd_nTql8FYbn5KOaZE5oUfXtUcvtsBZzxILHo\"\n\ndict_style_desciption['\u041a\u043e\u043d\u0441\u043f\u0438\u0440\u043e\u043b\u043e\u0433'] = \"https://docs.google.com/document/d/1lxa3zPCkDraWe1OyJC-WIYCxUNHXAgGdiXqXduAEsvU\"\n\ndict_style_desciption['\u0420\u043e\u043c\u0430\u043d\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439'] = \"https://docs.google.com/document/d/1OdpZRqrMJW0JiFWsrcNgtBfFJbzoXstfblpAfLerbiM\"\n\ndict_style_desciption['\u0410\u043d\u0435\u043a\u0434\u043e\u0442'] = \"https://docs.google.com/document/d/1ug9ADMl7XdhPsCLq6P1BvvwcfETwiCrrNkLEjZ8UBWY\"\n\ndict_style_desciption['\u0420\u0435\u043b\u0438\u0433\u0438\u043e\u0437\u043d\u044b\u0439'] = \"https://docs.google.com/document/d/1UJVoELzDDTUFJP39ITinZvCughIky9TaBAZxZmmDclM/\"", "metadata": {"subid": 0, "total": 5, "source": "https://colab.research.google.com/drive/1LviwZCrnpKOn8X7oPQpsZzmcwZ6Eg6gu?usp=sharing"}}}, {"lc": 1, "type": "constructor", "id": ["langchain", "schema", "document", "Document"], "kwargs": {"page_content": "\n# **\u041d\u0430\u0443\u0447\u043d\u044b\u0439 \u0441\u0442\u0438\u043b\u044c**\n\n\n\n\u041d\u0430\u0443\u0447\u043d\u044b\u0439 \u0441\u0442\u0438\u043b\u044c \u2014 \u0441\u0442\u0438\u043b\u044c \u043d\u0430\u0443\u0447\u043d\u044b\u0445 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439. \u0421\u0444\u0435\u0440\u0430 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u044f \u044d\u0442\u043e\u0433\u043e \u0441\u0442\u0438\u043b\u044f \u2014 \u043d\u0430\u0443\u043a\u0430 \u0438 \u043d\u0430\u0443\u0447\u043d\u044b\u0435 \u0436\u0443\u0440\u043d\u0430\u043b\u044b, \u0430\u0434\u0440\u0435\u0441\u0430\u0442\u0430\u043c\u0438 \u0442\u0435\u043a\u0441\u0442\u043e\u0432\u044b\u0445 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439 \u043c\u043e\u0433\u0443\u0442 \u0432\u044b\u0441\u0442\u0443\u043f\u0430\u0442\u044c \u0443\u0447\u0451\u043d\u044b\u0435, \u0431\u0443\u0434\u0443\u0449\u0438\u0435 \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u0438\u0441\u0442\u044b, \u0443\u0447\u0435\u043d\u0438\u043a\u0438, \u043f\u0440\u043e\u0441\u0442\u043e \u043b\u044e\u0431\u043e\u0439 \u0447\u0435\u043b\u043e\u0432\u0435\u043a, \u0438\u043d\u0442\u0435\u0440\u0435\u0441\u0443\u044e\u0449\u0438\u0439\u0441\u044f \u0442\u043e\u0439 \u0438\u043b\u0438 \u0438\u043d\u043e\u0439 \u043d\u0430\u0443\u0447\u043d\u043e\u0439 \u043e\u0431\u043b\u0430\u0441\u0442\u044c\u044e; \u0430\u0432\u0442\u043e\u0440\u0430\u043c\u0438 \u0436\u0435 \u0442\u0435\u043a\u0441\u0442\u043e\u0432 \u0434\u0430\u043d\u043d\u043e\u0433\u043e \u0441\u0442\u0438\u043b\u044f \u044f\u0432\u043b\u044f\u044e\u0442\u0441\u044f \u0443\u0447\u0451\u043d\u044b\u0435, \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u0438\u0441\u0442\u044b \u0432 \u0441\u0432\u043e\u0435\u0439 \u043e\u0431\u043b\u0430\u0441\u0442\u0438. \u0426\u0435\u043b\u044c\u044e \u0441\u0442\u0438\u043b\u044f \u043c\u043e\u0436\u043d\u043e \u043d\u0430\u0437\u0432\u0430\u0442\u044c \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \u0437\u0430\u043a\u043e\u043d\u043e\u0432, \u0432\u044b\u044f\u0432\u043b\u0435\u043d\u0438\u0435 \u0437\u0430\u043a\u043e\u043d\u043e\u043c\u0435\u0440\u043d\u043e\u0441\u0442\u0435\u0439, \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \u043e\u0442\u043a\u0440\u044b\u0442\u0438\u0439, \u043e\u0431\u0443\u0447\u0435\u043d\u0438\u0435 \u0438 \u0442\u043e\u043c\u0443 \u043f\u043e\u0434\u043e\u0431\u043d\u043e\u0435.\n\n\n\n\u041e\u0441\u043d\u043e\u0432\u043d\u0430\u044f \u0435\u0433\u043e \u0444\u0443\u043d\u043a\u0446\u0438\u044f \u2014 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u0438, \u0430 \u0442\u0430\u043a\u0436\u0435 \u0434\u043e\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u044c\u0441\u0442\u0432\u043e \u0435\u0451 \u0438\u0441\u0442\u0438\u043d\u043d\u043e\u0441\u0442\u0438. \u0414\u043b\u044f \u043d\u0435\u0433\u043e \u0445\u0430\u0440\u0430\u043a\u0442\u0435\u0440\u043d\u043e \u043d\u0430\u043b\u0438\u0447\u0438\u0435 \u043c\u0430\u043b\u044b\u0445 \u0442\u0435\u0440\u043c\u0438\u043d\u043e\u0432, \u043e\u0431\u0449\u0435\u043d\u0430\u0443\u0447\u043d\u044b\u0445 \u0441\u043b\u043e\u0432, \u0430\u0431\u0441\u0442\u0440\u0430\u043a\u0442\u043d\u043e\u0439 \u043b\u0435\u043a\u0441\u0438\u043a\u0438, \u0432 \u043d\u0451\u043c \u043f\u0440\u0435\u043e\u0431\u043b\u0430\u0434\u0430\u0435\u0442 \u0438\u043c\u044f \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0435, \u043d\u0435\u043c\u0430\u043b\u043e \u043e\u0442\u0432\u043b\u0435\u0447\u0451\u043d\u043d\u044b\u0445 \u0438 \u0432\u0435\u0449\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0445 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0445.\n\n\n\n\u0421\u0442\u0438\u043b\u0435\u0432\u044b\u043c\u0438 \u0447\u0435\u0440\u0442\u0430\u043c\u0438 \u044d\u0442\u043e\u0433\u043e \u0441\u0442\u0438\u043b\u044f \u044f\u0432\u043b\u044f\u044e\u0442\u0441\u044f \u043f\u043e\u0434\u0447\u0451\u0440\u043a\u043d\u0443\u0442\u0430\u044f \u043b\u043e\u0433\u0438\u0447\u043d\u043e\u0441\u0442\u044c, \u0434\u043e\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c, \u0442\u043e\u0447\u043d\u043e\u0441\u0442\u044c (\u043e\u0434\u043d\u043e\u0437\u043d\u0430\u0447\u043d\u043e\u0441\u0442\u044c).\n\n\n\n**\u0422\u0435\u0440\u043c\u0438\u043d\u043e\u043b\u043e\u0433\u0438\u044f** \u0441\u043e\u0441\u0442\u0430\u0432\u043b\u044f\u0435\u0442 \u0447\u0430\u0441\u0442\u044c \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u044c\u043d\u043e\u0439 \u043b\u0435\u043a\u0441\u0438\u043a\u0438, \u043a \u043a\u043e\u0442\u043e\u0440\u043e\u0439 \u043e\u0442\u043d\u043e\u0441\u044f\u0442 \u0441\u043b\u043e\u0432\u0430 \u0438 \u0441\u043b\u043e\u0432\u043e\u0441\u043e\u0447\u0435\u0442\u0430\u043d\u0438\u044f, \u043d\u0430\u0437\u044b\u0432\u0430\u044e\u0449\u0438\u0435 \u043f\u0440\u0435\u0434\u043c\u0435\u0442\u044b \u0438 \u043f\u043e\u043d\u044f\u0442\u0438\u044f \u0440\u0430\u0437\u043b\u0438\u0447\u043d\u044b\u0445 \u0441\u0444\u0435\u0440 \u043f\u0440\u043e\u0444\u0435\u0441\u0441\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u043e\u0439 \u0434\u0435\u044f\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u0438 \u0447\u0435\u043b\u043e\u0432\u0435\u043a\u0430 \u0438 \u043d\u0435 \u044f\u0432\u043b\u044f\u044e\u0449\u0438\u0435\u0441\u044f \u043e\u0431\u0449\u0435\u0443\u043f\u043e\u0442\u0440\u0435\u0431\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u043c\u0438.\n\n\n\n## \u041d\u0430\u0443\u0447\u043d\u044b\u0439 \u0441\u0442\u0438\u043b\u044c\n\n\n\n**\u041f\u0440\u0438\u043c\u0435\u0440 \u043f\u0440\u043e\u043c\u043f\u0442\u0430:**\n\n\n\n*\u0412\u044b \u043f\u0440\u043e\u0444\u0435\u0441\u0441\u043e\u0440 \u0444\u0438\u0437\u0438\u043a\u0438. \u0412\u0430\u0448\u0430 \u0440\u0435\u0447\u044c \u043e\u0442\u043b\u0438\u0447\u0430\u0435\u0442\u0441\u044f \u043d\u0430\u0443\u0447\u043d\u044b\u043c \u043f\u043e\u0434\u0445\u043e\u0434\u043e\u043c \u043a \u0432\u044b\u0441\u043a\u0430\u0437\u044b\u0432\u0430\u043d\u0438\u044f\u043c, \u0412\u044b \u0432\u0441\u0435\u0433\u0434\u0430 \u0432 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u043c \u043f\u043e\u0440\u044f\u0434\u043a\u0435 \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0430\u0435\u0442\u0435 \u043a\u0430\u0436\u0434\u043e\u0435 \u0441\u0432\u043e\u0435 \u0443\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u0438\u0435 \u0444\u0430\u043a\u0442\u0430\u043c\u0438, \u0444\u043e\u0440\u043c\u0443\u043b\u0430\u043c\u0438 \u0438 \u0441\u0441\u044b\u043b\u043a\u0430\u043c\u0438 \u043d\u0430 \u0440\u0430\u0431\u043e\u0442\u044b \u043a\u043e\u043b\u043b\u0435\u0433. \u0412\u0430\u0448\u0430 \u0440\u0435\u0447\u044c \u043d\u0430\u0441\u044b\u0449\u0435\u043d\u0430 \u0442\u0435\u0440\u043c\u0438\u043d\u0430\u043c\u0438 \u0438 \u0442\u0435\u0440\u043c\u0438\u043d\u043e\u043b\u043e\u0433\u0438\u0435\u0439, \u0445\u0430\u0440\u0430\u043a\u0442\u0435\u0440\u043d\u044b\u043c\u0438 \u0434\u043b\u044f \u043e\u0431\u043b\u0430\u0441\u0442\u0438 \u0444\u0438\u0437\u0438\u043a\u0438. \u0412\u044b \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0435 \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u043e \u043e\u0431\u044a\u0435\u043a\u0442\u0438\u0432\u043d\u044b\u0439 \u0438 \u043b\u043e\u0433\u0438\u0447\u0435\u0441\u043a\u0438\u0439 \u043f\u043e\u0434\u0445\u043e\u0434 \u043a \u043e\u0431\u0441\u0443\u0436\u0434\u0430\u0435\u043c\u044b\u043c \u0442\u0435\u043c\u0430\u043c.\n\n\u0412\u0430\u0448\u0430 \u0437\u0430\u0434\u0430\u0447\u0430, \u043e\u0431\u0441\u0443\u0434\u0438\u0442\u044c \u0441\u043e \u0441\u0432\u043e\u0438\u043c\u0438 \u043a\u043e\u043b\u043b\u0435\u0433\u0430\u043c\u0438-\u0444\u0438\u0437\u0438\u043a\u0430\u043c\u0438 \u0437\u0430\u0434\u0430\u043d\u043d\u0443\u044e \u0442\u0435\u043c\u0443.*\n#@title \u041d\u0430\u0443\u0447\u043d\u044b\u0439 \u0441\u0442\u0438\u043b\u044c\n\ntopic = \"\u0411\u043e\u043b\u044c\u0448\u043e\u0439 \u0432\u0437\u0440\u044b\u0432\" #@param {type:\"string\"}\n\ndocs = get_docs_by_req_to_wikipedia(topic)\n\ntext = ''.join(doc.page_content for doc in docs)\n\ntxt_body = text.split('## \u041f\u0440\u0438\u043c\u0435\u0447\u0430\u043d\u0438\u044f')[0]\n\ntokens = num_tokens_from_string(txt_body, \"cl100k_base\")\n\nif tokens > max_count:\n\n    splitter = RecursiveCharacterTextSplitter(chunk_size=max_count, chunk_overlap=chunk_overlap, length_function=num_tokens)\n\n    info = splitter.split_text(txt_body)[0]\n\nelse:\n\n    info = txt_body\n\nkey_style = \"\u041d\u0430\u0443\u0447\u043d\u044b\u0439\" #@param [\"\u041d\u0430\u0443\u0447\u043d\u044b\u0439\", \"\u0411\u044e\u0440\u043e\u043a\u0440\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439\", \"\u0428\u043a\u043e\u043b\u044c\u043d\u044b\u0439 \u0443\u0447\u0438\u0442\u0435\u043b\u044c\", \"\u0420\u043e\u043c\u0430\u043d\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439\", \"\u0425\u0443\u0434\u043e\u0436\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0439\", \"\u041f\u043e\u044d\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439\", \"\u041a\u043e\u043d\u0441\u043f\u0438\u0440\u043e\u043b\u043e\u0433\"]\n\n\n\nif key_style in dict_style_desciption:\n\n  system = load_googledoc_by_url(dict_style_desciption[key_style])\n\n\n\n  if key_style == \"\u0411\u044e\u0440\u043e\u043a\u0440\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439\":\n\n    instructions = '''\u041f\u043e\u0434\u0433\u043e\u0442\u043e\u0432\u044c \u0432 \u0442\u0432\u043e\u0435\u043c \u0441\u0442\u0438\u043b\u0435 \u0441\u043f\u0440\u0430\u0432\u043a\u0443 \u043d\u0430 \u0437\u0430\u0434\u0430\u043d\u043d\u0443\u044e \u0442\u0435\u043c\u0443. \u0414\u043b\u044f \u043e\u0442\u0432\u0435\u0442\u0430 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439 \u0432\u0441\u0435 \u0441\u0432\u043e\u0438 \u0437\u043d\u0430\u043d\u0438\u044f \u0438 \u0414\u043e\u043f \u0438\u043d\u0444\u043e'''\n\n  else:\n\n    instructions = '''\u041d\u0430\u043f\u0438\u0448\u0438 \u0432 \u0442\u0432\u043e\u0435\u043c \u0441\u0442\u0438\u043b\u0435 \u043e\u0447\u0435\u043d\u044c \u043f\u043e\u0434\u0440\u043e\u0431\u043d\u043e\u0435 \u043e\u0431\u044a\u044f\u0441\u043d\u0435\u043d\u0438\u0435 \u043d\u0430 \u0437\u0430\u0434\u0430\u043d\u043d\u0443\u044e \u0442\u0435\u043c\u0443. \u0414\u043b\u044f \u043e\u0442\u0432\u0435\u0442\u0430 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439 \u0432\u0441\u0435 \u0441\u0432\u043e\u0438 \u0437\u043d\u0430\u043d\u0438\u044f \u0438 \u0414\u043e\u043f \u0438\u043d\u0444\u043e'''\n\n\n\n  resp, n1, n2 = answer_index(system, topic, instructions, info, temp, MODEL)\n\n  with open(f'{key_style}.txt', 'w') as f:\n\n    f.write(resp)\n\nelse: print(f\"\u0421\u0442\u0438\u043b\u044c {key_style} \u043d\u0435 \u043e\u043f\u0438\u0441\u0430\u043d!\")\n\nprint(resp)\n\n## \u041d\u0430\u0443\u0447\u043d\u043e-\u043f\u043e\u043f\u0443\u043b\u044f\u0440\u043d\u044b\u0439 \u0441\u0442\u0438\u043b\u044c\n\n\n\n\u0412 \u043d\u0430\u0448\u0435\u043c \u043f\u0440\u0438\u043c\u0435\u0440\u0435 - \u0443\u0447\u0438\u0442\u0435\u043b\u044c \u0432 \u043c\u043b\u0430\u0434\u0448\u0438\u0445 \u043a\u043b\u0430\u0441\u0441\u0430\u0445\n\n\n\n**\u041f\u0440\u0438\u043c\u0435\u0440 \u043f\u0440\u043e\u043c\u043f\u0442\u0430:**\n\n\n\n\u0412\u044b \u043f\u0440\u0435\u043a\u0440\u0430\u0441\u043d\u044b\u0439 \u0443\u0447\u0438\u0442\u0435\u043b\u044c \u0444\u0438\u0437\u0438\u043a\u0438 \u0432 \u043e\u0431\u044b\u0447\u043d\u043e\u0439 \u0448\u043a\u043e\u043b\u0435. \u0412\u044b \u043e\u0442\u043b\u0438\u0447\u0430\u0435\u0442\u0435\u0441\u044c \u0441\u043f\u043e\u0441\u043e\u0431\u043d\u043e\u0441\u0442\u044c\u044e \u0443\u0432\u043b\u0435\u043a\u0430\u0442\u044c \u0441\u0432\u043e\u0438\u043c\u0438 \u043e\u0431\u044a\u044f\u0441\u043d\u0435\u043d\u0438\u044f\u043c\u0438 \u0443\u0447\u0435\u043d\u0438\u043a\u043e\u0432, \u0412\u044b \u0443\u043c\u0435\u0435\u0442\u0435 \u043f\u0440\u043e\u0441\u0442\u043e \u0438 \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u043e \u0434\u043b\u044f \u043c\u043b\u0430\u0434\u0448\u0438\u0445 \u0448\u043a\u043e\u043b\u044c\u043d\u0438\u043a\u043e\u0432 \u043e\u0431\u044a\u044f\u0441\u043d\u0438\u0442\u044c \u0440\u0430\u0437\u043d\u044b\u0435 \u0442\u0435\u043c\u044b.\n\n\u0412\u0430\u0448\u0430 \u0440\u0435\u0447\u044c \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u0430 \u0443\u0447\u0435\u043d\u0438\u043a\u0430\u043c \u043c\u043b\u0430\u0434\u0448\u0438\u0445 \u043a\u043b\u0430\u0441\u0441\u043e\u0432 \u043e\u0431\u0449\u0435\u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0439 \u0448\u043a\u043e\u043b\u044b, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0442\u043e\u043b\u044c\u043a\u043e-\u0442\u043e\u043b\u044c\u043a\u043e \u043d\u0430\u0447\u0438\u043d\u0430\u044e\u0442 \u0438\u0437\u0443\u0447\u0430\u0442\u044c \u0444\u0438\u0437\u0438\u043a\u0443, \u0438 \u0437\u043d\u0430\u044e\u0442 \u043e\u0447\u0435\u043d\u044c \u043c\u0430\u043b\u043e \u0442\u0435\u0440\u043c\u0438\u043d\u043e\u0432 \u0438 \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u0439.  \n\n\n\n\u0415\u0441\u043b\u0438 \u0412\u044b \u043d\u0430\u0437\u044b\u0432\u0430\u0435\u0442\u0435 \u0432 \u0441\u0432\u043e\u0435\u043c \u0432\u044b\u0441\u0442\u0443\u043f\u043b\u0435\u043d\u0438\u0435 \u0442\u0435\u0440\u043c\u0438\u043d \u0438\u043b\u0438 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u043a\u043e\u044d\u0444\u0444\u0438\u0446\u0438\u0435\u043d\u0442\u043e\u0432, \u0444\u0438\u0437\u0438\u0447\u0435\u0441\u043a\u0438\u0445 \u043f\u043e\u0441\u0442\u043e\u044f\u043d\u043d\u044b\u0445 \u0438 \u0442.\u043f., \u0442\u043e \u0432\u0441\u0435\u0433\u0434\u0430 \u0434\u0430\u0435\u0442\u0435 \u0438\u043c \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u0435 \u0438 \u0443\u043a\u0430\u0437\u044b\u0432\u0430\u0435\u0442\u0435, \u043a\u0442\u043e \u0438\u0437 \u0443\u0447\u0435\u043d\u044b\u0445 \u0432\u043f\u0435\u0440\u0432\u044b\u0435 \u0432\u0432\u0435\u043b \u044d\u0442\u043e\u0442 \u0442\u0435\u0440\u043c\u0438\u043d, \u043a\u043e\u044d\u0444\u0444 \u0438\u043b\u0438 \u043f\u043e\u0441\u0442\u043e\u044f\u043d\u043d\u0443\u044e.\n\n\n\n\u0412\u0430\u0448\u0430 \u0437\u0430\u0434\u0430\u0447\u0430, \u0434\u043e\u0445\u043e\u0434\u0447\u0438\u0432\u043e \u043e\u0431\u044a\u044f\u0441\u043d\u0438\u0442\u044c \u0443\u0447\u0435\u043d\u0438\u043a\u0430\u043c \u0437\u0430\u0434\u0430\u043d\u043d\u0443\u044e \u0442\u0435\u043c\u0443.\n#@title \u0428\u043a\u043e\u043b\u044c\u043d\u044b\u0439 \u0443\u0447\u0438\u0442\u0435\u043b\u044c (\u043d\u0430\u0443\u0447\u043d\u043e-\u043f\u043e\u043f\u0443\u043b\u044f\u0440\u043d\u044b\u0439 \u0441\u0442\u0438\u043b\u044c)\n\ntopic = \"\u0411\u043e\u043b\u044c\u0448\u043e\u0439 \u0432\u0437\u0440\u044b\u0432\" #@param {type:\"string\"}\n\ndocs = get_docs_by_req_to_wikipedia(topic)\n\ntext = ''.join(doc.page_content for doc in docs)\n\ntxt_body = text.split('## \u041f\u0440\u0438\u043c\u0435\u0447\u0430\u043d\u0438\u044f')[0]\n\ntokens = num_tokens_from_string(txt_body, \"cl100k_base\")\n\nif tokens > max_count:\n\n    splitter = RecursiveCharacterTextSplitter(chunk_size=max_count, chunk_overlap=chunk_overlap, length_function=num_tokens)\n\n    info = splitter.split_text(txt_body)[0]\n\nelse:\n\n    info = txt_body\n\nkey_style = \"\u0428\u043a\u043e\u043b\u044c\u043d\u044b\u0439 \u0443\u0447\u0438\u0442\u0435\u043b\u044c\" #@param [\"\u041d\u0430\u0443\u0447\u043d\u044b\u0439\", \"\u0411\u044e\u0440\u043e\u043a\u0440\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439\", \"\u0428\u043a\u043e\u043b\u044c\u043d\u044b\u0439 \u0443\u0447\u0438\u0442\u0435\u043b\u044c\", \"\u0420\u043e\u043c\u0430\u043d\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439\", \"\u0425\u0443\u0434\u043e\u0436\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0439\", \"\u041f\u043e\u044d\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439\", \"\u041a\u043e\u043d\u0441\u043f\u0438\u0440\u043e\u043b\u043e\u0433\"]\n\n\n\nif key_style in dict_style_desciption:\n\n  system = load_googledoc_by_url(dict_style_desciption[key_style])\n\n\n\n  if key_style == \"\u0411\u044e\u0440\u043e\u043a\u0440\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439\":\n\n    instructions = '''\u041f\u043e\u0434\u0433\u043e\u0442\u043e\u0432\u044c \u0432 \u0442\u0432\u043e\u0435\u043c \u0441\u0442\u0438\u043b\u0435 \u0441\u043f\u0440\u0430\u0432\u043a\u0443 \u043d\u0430 \u0437\u0430\u0434\u0430\u043d\u043d\u0443\u044e \u0442\u0435\u043c\u0443. \u0414\u043b\u044f \u043e\u0442\u0432\u0435\u0442\u0430 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439 \u0432\u0441\u0435 \u0441\u0432\u043e\u0438 \u0437\u043d\u0430\u043d\u0438\u044f \u0438 \u0414\u043e\u043f \u0438\u043d\u0444\u043e'''\n\n  else:\n\n    instructions = '''\u041d\u0430\u043f\u0438\u0448\u0438 \u0432 \u0442\u0432\u043e\u0435\u043c \u0441\u0442\u0438\u043b\u0435 \u043e\u0447\u0435\u043d\u044c \u043f\u043e\u0434\u0440\u043e\u0431\u043d\u043e\u0435 \u043e\u0431\u044a\u044f\u0441\u043d\u0435\u043d\u0438\u0435 \u043d\u0430 \u0437\u0430\u0434\u0430\u043d\u043d\u0443\u044e \u0442\u0435\u043c\u0443. \u0414\u043b\u044f \u043e\u0442\u0432\u0435\u0442\u0430 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439 \u0432\u0441\u0435 \u0441\u0432\u043e\u0438 \u0437\u043d\u0430\u043d\u0438\u044f \u0438 \u0414\u043e\u043f \u0438\u043d\u0444\u043e'''\n\n\n\n  resp, n1, n2 = answer_index(system, topic, instructions, info, temp, MODEL)\n\n  with open(f'{key_style}.txt', 'w') as f:\n\n    f.write(resp)\n\nelse: print(f\"\u0421\u0442\u0438\u043b\u044c {key_style} \u043d\u0435 \u043e\u043f\u0438\u0441\u0430\u043d!\")\n\nprint(resp)", "metadata": {"subid": 1, "total": 5, "source": "https://colab.research.google.com/drive/1LviwZCrnpKOn8X7oPQpsZzmcwZ6Eg6gu?usp=sharing"}}}, {"lc": 1, "type": "constructor", "id": ["langchain", "schema", "document", "Document"], "kwargs": {"page_content": "\n# **\u041e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u043e-\u0434\u0435\u043b\u043e\u0432\u043e\u0439 \u0441\u0442\u0438\u043b\u044c**\n\n\n\n\u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0434\u043b\u044f \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f, \u0438\u043d\u0444\u043e\u0440\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u0432 \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u043e\u0439 \u043e\u0431\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0435 (\u0441\u0444\u0435\u0440\u0430 \u0437\u0430\u043a\u043e\u043d\u043e\u0434\u0430\u0442\u0435\u043b\u044c\u0441\u0442\u0432\u0430, \u0434\u0435\u043b\u043e\u043f\u0440\u043e\u0438\u0437\u0432\u043e\u0434\u0441\u0442\u0432\u0430, \u0430\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u0438\u0432\u043d\u043e-\u043f\u0440\u0430\u0432\u043e\u0432\u043e\u0439 \u0434\u0435\u044f\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u0438). \u042d\u0442\u043e\u0442 \u0441\u0442\u0438\u043b\u044c \u0441\u043b\u0443\u0436\u0438\u0442 \u0434\u043b\u044f \u043e\u0444\u043e\u0440\u043c\u043b\u0435\u043d\u0438\u044f \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u043e\u0432: \u0437\u0430\u043a\u043e\u043d\u043e\u0432, \u043f\u0440\u0438\u043a\u0430\u0437\u043e\u0432, \u043f\u043e\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0439, \u0440\u0430\u0441\u043f\u043e\u0440\u044f\u0436\u0435\u043d\u0438\u0439, \u0445\u0430\u0440\u0430\u043a\u0442\u0435\u0440\u0438\u0441\u0442\u0438\u043a, \u043f\u0440\u043e\u0442\u043e\u043a\u043e\u043b\u043e\u0432, \u0440\u0430\u0441\u043f\u0438\u0441\u043e\u043a \u0438 \u0441\u043f\u0440\u0430\u0432\u043e\u043a.\n\n\n\n\u042d\u0442\u043e\u0442 \u0441\u0442\u0438\u043b\u044c \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442 \u0447\u0430\u0449\u0435 \u0432 \u043f\u0438\u0441\u044c\u043c\u0435\u043d\u043d\u043e\u0439 \u0444\u043e\u0440\u043c\u0435 \u0440\u0435\u0447\u0438, \u0442\u0438\u043f \u0440\u0435\u0447\u0438 \u2014 \u043f\u0440\u0435\u0438\u043c\u0443\u0449\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u043e \u0440\u0430\u0441\u0441\u0443\u0436\u0434\u0435\u043d\u0438\u0435. \u0412\u0438\u0434 \u0440\u0435\u0447\u0438 \u2014 \u0447\u0430\u0449\u0435 \u0432\u0441\u0435\u0433\u043e \u043c\u043e\u043d\u043e\u043b\u043e\u0433, \u0432\u0438\u0434 \u043a\u043e\u043c\u043c\u0443\u043d\u0438\u043a\u0430\u0446\u0438\u0438 \u2014 \u043e\u0431\u0449\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u0430\u044f.\n\n\n\n\u0421\u0442\u0438\u043b\u0435\u0432\u044b\u0435 \u0447\u0435\u0440\u0442\u044b \u2014 \u0438\u043c\u043f\u0435\u0440\u0430\u0442\u0438\u0432\u043d\u043e\u0441\u0442\u044c (\u0434\u043e\u043b\u0436\u0435\u043d\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0439 \u0445\u0430\u0440\u0430\u043a\u0442\u0435\u0440), \u0442\u043e\u0447\u043d\u043e\u0441\u0442\u044c, \u043d\u0435 \u0434\u043e\u043f\u0443\u0441\u043a\u0430\u044e\u0449\u0430\u044f \u0434\u0432\u0443\u0445 \u0442\u043e\u043b\u043a\u043e\u0432\u0430\u043d\u0438\u0439, \u0441\u0442\u0430\u043d\u0434\u0430\u0440\u0442\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u043e\u0441\u0442\u044c (\u0441\u0442\u0440\u043e\u0433\u0430\u044f \u043a\u043e\u043c\u043f\u043e\u0437\u0438\u0446\u0438\u044f \u0442\u0435\u043a\u0441\u0442\u0430, \u0442\u043e\u0447\u043d\u044b\u0439 \u043e\u0442\u0431\u043e\u0440 \u0444\u0430\u043a\u0442\u043e\u0432 \u0438 \u0441\u043f\u043e\u0441\u043e\u0431\u043e\u0432 \u0438\u0445 \u043f\u043e\u0434\u0430\u0447\u0438), \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0438\u0435 \u044d\u043c\u043e\u0446\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u043e\u0441\u0442\u0438.\n\n\n\n\u041e\u0441\u043d\u043e\u0432\u043d\u0430\u044f \u0444\u0443\u043d\u043a\u0446\u0438\u044f \u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u043e-\u0434\u0435\u043b\u043e\u0432\u043e\u0433\u043e \u0441\u0442\u0438\u043b\u044f \u2014 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u043e\u043d\u043d\u0430\u044f (\u043f\u0435\u0440\u0435\u0434\u0430\u0447\u0430 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u0438). \u0414\u043b\u044f \u043d\u0435\u0433\u043e \u0445\u0430\u0440\u0430\u043a\u0442\u0435\u0440\u043d\u043e \u043d\u0430\u043b\u0438\u0447\u0438\u0435 \u0440\u0435\u0447\u0435\u0432\u044b\u0445 \u043a\u043b\u0438\u0448\u0435, \u043e\u0431\u0449\u0435\u043f\u0440\u0438\u043d\u044f\u0442\u043e\u0439 \u0444\u043e\u0440\u043c\u044b \u0438\u0437\u043b\u043e\u0436\u0435\u043d\u0438\u044f, \u0441\u0442\u0430\u043d\u0434\u0430\u0440\u0442\u043d\u043e\u0433\u043e \u0438\u0437\u043b\u043e\u0436\u0435\u043d\u0438\u044f \u043c\u0430\u0442\u0435\u0440\u0438\u0430\u043b\u0430, \u0448\u0438\u0440\u043e\u043a\u043e\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435 \u0442\u0435\u0440\u043c\u0438\u043d\u043e\u043b\u043e\u0433\u0438\u0438 \u0438 \u043d\u043e\u043c\u0435\u043d\u043a\u043b\u0430\u0442\u0443\u0440\u043d\u044b\u0445 \u043d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0439, \u043d\u0430\u043b\u0438\u0447\u0438\u0435 \u0441\u043b\u043e\u0436\u043d\u044b\u0445 \u043d\u0435 \u0441\u043e\u043a\u0440\u0430\u0449\u0435\u043d\u043d\u044b\u0445 \u0441\u043b\u043e\u0432, \u0430\u0431\u0431\u0440\u0435\u0432\u0438\u0430\u0442\u0443\u0440, \u043e\u0442\u0433\u043b\u0430\u0433\u043e\u043b\u044c\u043d\u044b\u0445 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0445, \u043f\u0440\u0435\u043e\u0431\u043b\u0430\u0434\u0430\u043d\u0438\u0435 \u043f\u0440\u044f\u043c\u043e\u0433\u043e \u043f\u043e\u0440\u044f\u0434\u043a\u0430 \u0441\u043b\u043e\u0432.\n\n\n\n**\u041f\u0440\u0438\u043c\u0435\u0440 \u043f\u0440\u043e\u043c\u043f\u0442\u0430:**\n\n\n\n\u0412\u044b \u0442\u0438\u043f\u0438\u0447\u043d\u044b\u0439 \u0441\u0443\u0445\u043e\u0439 \u0431\u0435\u0437\u0434\u0443\u0448\u043d\u044b\u0439 \u0431\u044e\u0440\u043e\u043a\u0440\u0430\u0442. \u0412\u0430\u0448 \u0441\u0442\u0438\u043b\u044c \u043e\u0431\u0449\u0435\u043d\u0438\u044f - \u043a\u0430\u0437\u0435\u043d\u043d\u044b\u0439, \u0431\u044e\u0440\u043e\u043a\u0440\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439, \u0444\u043e\u0440\u043c\u0430\u043b\u044c\u043d\u044b\u0439, \u0441\u0443\u0445\u043e\u0439, \u0448\u0430\u0431\u043b\u043e\u043d\u043d\u044b\u0439, \u0437\u0430\u043c\u0443\u0441\u043e\u0440\u0435\u043d\u043d\u044b\u0439 \u043a\u0430\u043d\u0446\u0435\u043b\u044f\u0440\u0438\u0437\u043c\u0430\u043c\u0438. \u0412\u0430\u0448\u0438 \u0432\u044b\u0441\u043a\u0430\u0437\u044b\u0432\u0430\u043d\u0438\u044f \u043b\u0438\u0448\u0435\u043d\u044b \u044d\u043c\u043e\u0446\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u043e-\u043e\u0446\u0435\u043d\u043e\u0447\u043d\u043e\u0433\u043e \u043a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442\u0430.\n\n\u0412\u044b \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0435 \u0444\u043e\u0440\u043c\u0430\u043b\u044c\u043d\u044b\u0439 \u043a\u0430\u043d\u0446\u0435\u043b\u044f\u0440\u0441\u043a\u0438\u0439 \u044f\u0437\u044b\u043a \u0438 \u0448\u0442\u0430\u043c\u043f\u044b, \u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440: \u00ab\u043b\u0435\u0441\u043d\u043e\u0439 \u043c\u0430\u0441\u0441\u0438\u0432\u00bb \u0432\u043c\u0435\u0441\u0442\u043e \u00ab\u043b\u0435\u0441\u00bb, \u00ab\u043f\u0440\u043e\u0438\u0437\u0432\u043e\u0434\u0438\u0442\u044c \u043f\u043e\u043b\u0438\u0432\u043a\u0443\u00bb \u0432\u043c\u0435\u0441\u0442\u043e \u00ab\u043f\u043e\u043b\u0438\u0432\u0430\u0442\u044c\u00bb, \u00ab\u043d\u0430\u0445\u043e\u0434\u0438\u043b\u0441\u044f \u0432 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0438 \u0430\u043b\u043a\u043e\u0433\u043e\u043b\u044c\u043d\u043e\u0433\u043e \u043e\u043f\u044c\u044f\u043d\u0435\u043d\u0438\u044f\u00bb \u0432\u043c\u0435\u0441\u0442\u043e \u00ab\u0431\u044b\u043b \u043f\u044c\u044f\u043d\u00bb \u0438 \u0434\u0440. \u0412\u0430\u0448\u0438 \u043a\u0430\u043d\u0446\u0435\u043b\u044f\u0440\u0438\u0437\u043c\u044b \u043c\u043e\u0433\u0443\u0442 \u043e\u0442\u043b\u0438\u0447\u0430\u0442\u044c\u0441\u044f \u043e\u0442 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0445 \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u043e\u0432 \u0440\u0430\u0437\u0433\u043e\u0432\u043e\u0440\u043d\u043e\u0433\u043e \u0438 \u043b\u0438\u0442\u0435\u0440\u0430\u0442\u0443\u0440\u043d\u043e\u0433\u043e \u044f\u0437\u044b\u043a\u0430 \u0433\u0440\u0430\u043c\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438 (\u00ab\u0438\u043c\u0435\u0435\u0442 \u0431\u044b\u0442\u044c\u00bb \u0432\u043c\u0435\u0441\u0442\u043e \u00ab\u0431\u0443\u0434\u0435\u0442\u00bb), \u043d\u043e \u043e\u0441\u043e\u0431\u0435\u043d\u043d\u043e \u0445\u0430\u0440\u0430\u043a\u0442\u0435\u0440\u043d\u044b \u043e\u0442\u043b\u0438\u0447\u0438\u044f \u0432 \u043e\u0431\u043b\u0430\u0441\u0442\u0438 \u043b\u0435\u043a\u0441\u0438\u043a\u0438 \u0438 \u0441\u0438\u043d\u0442\u0430\u043a\u0441\u0438\u0441\u0430.\n\n\n\n\u0412\u044b \u0432\u044b\u0440\u0430\u0436\u0430\u0435\u0442\u0435 \u043f\u0440\u043e\u0441\u0442\u0443\u044e \u043c\u044b\u0441\u043b\u044c \u043c\u043d\u043e\u0436\u0435\u0441\u0442\u0432\u043e\u043c \u0441\u043b\u043e\u0432, \u0447\u0430\u0441\u0442\u043e \u0443\u043f\u043e\u0442\u0440\u0435\u0431\u043b\u044f\u0435\u0442\u0435 \u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u044f: \u00ab\u0431\u044b\u043b\u043e \u043f\u0440\u0438\u043d\u044f\u0442\u043e \u0440\u0435\u0448\u0435\u043d\u0438\u0435\u00bb, \u00ab\u0432 \u0446\u0435\u043b\u044f\u0445 \u043e\u0431\u0435\u0441\u043f\u0435\u0447\u0435\u043d\u0438\u044f\u00bb, \u00ab\u043f\u0440\u043e\u0438\u0437\u0432\u043e\u0434\u0441\u0442\u0432\u043e \u0440\u0430\u0431\u043e\u0442\u00bb, \u00ab\u0432\u043e \u0438\u0437\u0431\u0435\u0436\u0430\u043d\u0438\u0435\u00bb, \u00ab\u0442\u0430\u043a \u043d\u0430\u0437\u044b\u0432\u0430\u0435\u043c\u044b\u0439\u00bb, \u00ab\u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u043d\u044b\u0435 \u044f\u0432\u043b\u0435\u043d\u0438\u044f\u00bb.\n\n\u0414\u043b\u044f \u0412\u0430\u0448\u0435\u0439 \u0440\u0435\u0447\u0438 \u0445\u0430\u0440\u0430\u043a\u0442\u0435\u0440\u043d\u0430 \u0437\u0430\u043c\u0435\u043d\u0430 \u0441\u043b\u043e\u0432, \u043e\u0431\u043e\u0437\u043d\u0430\u0447\u0430\u044e\u0449\u0438\u0445 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0435 (\u0433\u043b\u0430\u0433\u043e\u043b\u043e\u0432) \u0441\u043b\u043e\u0432\u0430\u043c\u0438, \u043e\u0431\u043e\u0437\u043d\u0430\u0447\u0430\u044e\u0449\u0438\u043c\u0438 \u043f\u0440\u0435\u0434\u043c\u0435\u0442\u044b \u0438\u043b\u0438 \u044f\u0432\u043b\u0435\u043d\u0438\u044f (\u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u043c\u0438), \u043f\u0440\u0438\u0447\u0430\u0441\u0442\u0438\u044f\u043c\u0438 \u0438 \u0434\u0435\u0435\u043f\u0440\u0438\u0447\u0430\u0441\u0442\u0438\u044f\u043c\u0438.\n\n\n\n\u0412\u044b \u0438\u0437\u0431\u0435\u0433\u0430\u0435\u0442\u0435 \u0443\u043f\u043e\u0442\u0440\u0435\u0431\u043b\u044f\u0442\u044c \u043d\u0430\u0443\u0447\u043d\u044b\u0435 \u0442\u0435\u0440\u043c\u0438\u043d\u044b, \u043f\u043e\u0442\u043e\u043c\u0443 \u0447\u0442\u043e \u043d\u0438 \u0412\u044b,  \u043d\u0438 \u0412\u0430\u0448 \u0440\u0443\u043a\u043e\u0432\u043e\u0434\u0438\u0442\u0435\u043b\u044c \u043d\u0435 \u044f\u0432\u043b\u044f\u0435\u0442\u0435\u0441\u044c \u044d\u043a\u0441\u043f\u0435\u0440\u0442\u0430\u043c\u0438 \u0432 \u043e\u0431\u0441\u0443\u0436\u0434\u0430\u0435\u043c\u043e\u0439 \u0442\u0435\u043c\u0435.\n\n\u0412\u0430\u043c \u043d\u0443\u0436\u043d\u043e \u043f\u043e \u0437\u0430\u0434\u0430\u043d\u0438\u044e \u0440\u0443\u043a\u043e\u0432\u043e\u0434\u0438\u0442\u0435\u043b\u044f (\u0421\u0435\u043c\u0435\u043d\u0430 \u0421\u0435\u043c\u0435\u043d\u043e\u0432\u0438\u0447\u0430) \u043f\u043e\u0434\u0433\u043e\u0442\u043e\u0432\u0438\u0442\u044c \u043e\u0447\u0435\u043d\u044c \u0441\u0436\u0430\u0442\u043e \u043a\u0440\u0430\u0442\u043a\u0443\u044e \u0444\u043e\u0440\u043c\u0430\u043b\u044c\u043d\u0443\u044e \u0437\u0430\u043f\u0438\u0441\u043a\u0443 \u043f\u043e \u0437\u0430\u0434\u0430\u043d\u043d\u043e\u0439 \u0442\u0435\u043c\u0435.\n\n#@title \u0411\u044e\u0440\u043e\u043a\u0440\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439 \u0441\u0442\u0438\u043b\u044c\n\ntopic = \"\u0411\u043e\u043b\u044c\u0448\u043e\u0439 \u0432\u0437\u0440\u044b\u0432\" #@param {type:\"string\"}\n\ndocs = get_docs_by_req_to_wikipedia(topic)\n\ntext = ''.join(doc.page_content for doc in docs)\n\ntxt_body = text.split('## \u041f\u0440\u0438\u043c\u0435\u0447\u0430\u043d\u0438\u044f')[0]\n\ntokens = num_tokens_from_string(txt_body, \"cl100k_base\")\n\nif tokens > max_count:\n\n    splitter = RecursiveCharacterTextSplitter(chunk_size=max_count, chunk_overlap=chunk_overlap, length_function=num_tokens)\n\n    info = splitter.split_text(txt_body)[0]\n\nelse:\n\n    info = txt_body\n\nkey_style = \"\u0411\u044e\u0440\u043e\u043a\u0440\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439\" #@param [\"\u041d\u0430\u0443\u0447\u043d\u044b\u0439\", \"\u0411\u044e\u0440\u043e\u043a\u0440\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439\", \"\u0428\u043a\u043e\u043b\u044c\u043d\u044b\u0439 \u0443\u0447\u0438\u0442\u0435\u043b\u044c\", \"\u0420\u043e\u043c\u0430\u043d\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439\", \"\u0425\u0443\u0434\u043e\u0436\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0439\", \"\u041f\u043e\u044d\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439\", \"\u041a\u043e\u043d\u0441\u043f\u0438\u0440\u043e\u043b\u043e\u0433\"]\n\n\n\nif key_style in dict_style_desciption:\n\n  system = load_googledoc_by_url(dict_style_desciption[key_style])\n\n\n\n  if key_style == \"\u0411\u044e\u0440\u043e\u043a\u0440\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439\":\n\n    instructions = '''\u041f\u043e\u0434\u0433\u043e\u0442\u043e\u0432\u044c \u0432 \u0442\u0432\u043e\u0435\u043c \u0441\u0442\u0438\u043b\u0435 \u0441\u043f\u0440\u0430\u0432\u043a\u0443 \u043d\u0430 \u0437\u0430\u0434\u0430\u043d\u043d\u0443\u044e \u0442\u0435\u043c\u0443. \u0414\u043b\u044f \u043e\u0442\u0432\u0435\u0442\u0430 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439 \u0432\u0441\u0435 \u0441\u0432\u043e\u0438 \u0437\u043d\u0430\u043d\u0438\u044f \u0438 \u0414\u043e\u043f \u0438\u043d\u0444\u043e'''\n\n  else:\n\n    instructions = '''\u041d\u0430\u043f\u0438\u0448\u0438 \u0432 \u0442\u0432\u043e\u0435\u043c \u0441\u0442\u0438\u043b\u0435 \u043e\u0447\u0435\u043d\u044c \u043f\u043e\u0434\u0440\u043e\u0431\u043d\u043e\u0435 \u043e\u0431\u044a\u044f\u0441\u043d\u0435\u043d\u0438\u0435 \u043d\u0430 \u0437\u0430\u0434\u0430\u043d\u043d\u0443\u044e \u0442\u0435\u043c\u0443. \u0414\u043b\u044f \u043e\u0442\u0432\u0435\u0442\u0430 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439 \u0432\u0441\u0435 \u0441\u0432\u043e\u0438 \u0437\u043d\u0430\u043d\u0438\u044f \u0438 \u0414\u043e\u043f \u0438\u043d\u0444\u043e'''\n\n\n\n  resp, n1, n2 = answer_index(system, topic, instructions, info, temp, MODEL)\n\n  with open(f'{key_style}.txt', 'w') as f:\n\n    f.write(resp)\n\nelse: print(f\"\u0421\u0442\u0438\u043b\u044c {key_style} \u043d\u0435 \u043e\u043f\u0438\u0441\u0430\u043d!\")\n\nprint(resp)\n\n# **\u041f\u0443\u0431\u043b\u0438\u0446\u0438\u0441\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439 \u0441\u0442\u0438\u043b\u044c**\n\n\n\n\u0441\u043b\u0443\u0436\u0438\u0442 \u0434\u043b\u044f \u0432\u043e\u0437\u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044f \u043d\u0430 \u043b\u044e\u0434\u0435\u0439 \u0447\u0435\u0440\u0435\u0437 \u0441\u0440\u0435\u0434\u0441\u0442\u0432\u0430 \u043c\u0430\u0441\u0441\u043e\u0432\u043e\u0439 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u0438. \u041e\u043d \u0432\u0441\u0442\u0440\u0435\u0447\u0430\u0435\u0442\u0441\u044f \u0432 \u0436\u0430\u043d\u0440\u0430\u0445 \u0441\u0442\u0430\u0442\u044c\u0438, \u043e\u0447\u0435\u0440\u043a\u0430, \u0440\u0435\u043f\u043e\u0440\u0442\u0430\u0436\u0430, \u0444\u0435\u043b\u044c\u0435\u0442\u043e\u043d\u0430, \u0438\u043d\u0442\u0435\u0440\u0432\u044c\u044e, \u043e\u0440\u0430\u0442\u043e\u0440\u0441\u043a\u043e\u0439 \u0440\u0435\u0447\u0438 \u0438 \u0445\u0430\u0440\u0430\u043a\u0442\u0435\u0440\u0438\u0437\u0443\u0435\u0442\u0441\u044f \u043d\u0430\u043b\u0438\u0447\u0438\u0435\u043c \u043e\u0431\u0449\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u043e-\u043f\u043e\u043b\u0438\u0442\u0438\u0447\u0435\u0441\u043a\u043e\u0439 \u043b\u0435\u043a\u0441\u0438\u043a\u0438, \u043b\u043e\u0433\u0438\u0447\u043d\u043e\u0441\u0442\u044c\u044e, \u044d\u043c\u043e\u0446\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u043e\u0441\u0442\u044c\u044e.\n\n\n\n\u042d\u0442\u043e\u0442 \u0441\u0442\u0438\u043b\u044c \u0443\u043f\u043e\u0442\u0440\u0435\u0431\u043b\u044f\u0435\u0442\u0441\u044f \u0432 \u0441\u0444\u0435\u0440\u0430\u0445 \u043f\u043e\u043b\u0438\u0442\u0438\u043a\u043e-\u0438\u0434\u0435\u043e\u043b\u043e\u0433\u0438\u0447\u0435\u0441\u043a\u0438\u0445, \u043e\u0431\u0449\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0445 \u0438 \u043a\u0443\u043b\u044c\u0442\u0443\u0440\u043d\u044b\u0445 \u043e\u0442\u043d\u043e\u0448\u0435\u043d\u0438\u0439. \u0418\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f \u043f\u0440\u0435\u0434\u043d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0430 \u043d\u0435 \u0434\u043b\u044f \u0443\u0437\u043a\u043e\u0433\u043e \u043a\u0440\u0443\u0433\u0430 \u0441\u043f\u0435\u0446\u0438\u0430\u043b\u0438\u0441\u0442\u043e\u0432, \u0430 \u0434\u043b\u044f \u0448\u0438\u0440\u043e\u043a\u0438\u0445 \u0441\u043b\u043e\u0451\u0432 \u043e\u0431\u0449\u0435\u0441\u0442\u0432\u0430, \u043f\u0440\u0438\u0447\u0451\u043c \u0432\u043e\u0437\u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0435 \u043d\u0430\u043f\u0440\u0430\u0432\u043b\u044f\u0435\u0442\u0441\u044f \u043d\u0435 \u0442\u043e\u043b\u044c\u043a\u043e \u043d\u0430 \u0440\u0430\u0437\u0443\u043c, \u043d\u043e \u0438 \u043d\u0430 \u0447\u0443\u0432\u0441\u0442\u0432\u0430 \u0430\u0434\u0440\u0435\u0441\u0430\u0442\u0430.\n\n\n\n\u0414\u043b\u044f \u043d\u0435\u0433\u043e \u0445\u0430\u0440\u0430\u043a\u0442\u0435\u0440\u043d\u044b \u043e\u0442\u0432\u043b\u0435\u0447\u0451\u043d\u043d\u044b\u0435 \u0441\u043b\u043e\u0432\u0430 \u0441 \u043e\u0431\u0449\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u043e-\u043f\u043e\u043b\u0438\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u043c \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435\u043c.\n\n\n\n\u0417\u0430\u0434\u0430\u0447\u0430 \u2014 \u0441\u043e\u043e\u0431\u0449\u0438\u0442\u044c \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044e \u043e \u0436\u0438\u0437\u043d\u0438 \u0441\u0442\u0440\u0430\u043d\u044b, \u0432\u043e\u0437\u0434\u0435\u0439\u0441\u0442\u0432\u043e\u0432\u0430\u0442\u044c \u043d\u0430 \u043c\u0430\u0441\u0441\u044b, \u0441\u0444\u043e\u0440\u043c\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0451\u043d\u043d\u043e\u0435 \u043e\u0442\u043d\u043e\u0448\u0435\u043d\u0438\u0435 \u043a \u043e\u0431\u0449\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u043c \u0434\u0435\u043b\u0430\u043c.\n\n\n\n\u0421\u0442\u0438\u043b\u0435\u0432\u044b\u0435 \u0447\u0435\u0440\u0442\u044b \u2014 \u043b\u043e\u0433\u0438\u0447\u043d\u043e\u0441\u0442\u044c, \u043e\u0431\u0440\u0430\u0437\u043d\u043e\u0441\u0442\u044c, \u044d\u043c\u043e\u0446\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u043e\u0441\u0442\u044c, \u043e\u0446\u0435\u043d\u043e\u0447\u043d\u043e\u0441\u0442\u044c, \u043f\u0440\u0438\u0437\u044b\u0432\u043d\u043e\u0441\u0442\u044c.\n\n\n\n\u0412 \u043d\u0430\u0448\u0435\u043c \u043f\u0440\u0438\u043c\u0435\u0440\u0435 \u0432\u044b\u0441\u0442\u0443\u043f\u0430\u0435\u0442 \u043f\u0443\u0431\u043b\u0438\u0446\u0438\u0441\u0442-\u043a\u043e\u043d\u0441\u043f\u0438\u0440\u043e\u043b\u043e\u0433.\n\n\n\n**\u041f\u0440\u0438\u043c\u0435\u0440 \u043f\u0440\u043e\u043c\u043f\u0442\u0430**\n\n\n\n\u0422\u044b \u044f\u0440\u044b\u0439 \u0441\u0442\u043e\u0440\u043e\u043d\u043d\u0438\u043a \u043a\u043e\u043d\u0441\u043f\u0438\u0440\u043e\u043b\u043e\u0433\u0438\u0447\u0435\u0441\u043a\u0438\u0445 \u0442\u0435\u043e\u0440\u0438\u0439. \u0422\u0435\u0431\u0435 \u0432\u0435\u0437\u0434\u0435 \u0432\u0438\u0434\u0438\u0442\u0441\u044f \u0437\u0430\u0433\u043e\u0432\u043e\u0440.\n\n\u0414\u0430\u0436\u0435 \u0432 \u0441\u0438\u0442\u0443\u0430\u0446\u0438\u0438, \u043a\u043e\u0433\u0434\u0430 \u0434\u0440\u0443\u0433\u0438\u0435 \u043e\u0431\u044a\u044f\u0441\u043d\u0435\u043d\u0438\u044f \u0431\u043e\u043b\u0435\u0435 \u0432\u0435\u0440\u043e\u044f\u0442\u043d\u044b, \u0442\u044b \u043e\u0431\u044a\u044f\u0441\u043d\u044f\u0435\u0448\u044c \u0441\u043e\u0431\u044b\u0442\u0438\u044f \u0438\u043b\u0438 \u0441\u0438\u0442\u0443\u0430\u0446\u0438\u0438 \u043a\u0430\u043a \u043f\u043e\u0441\u043b\u0435\u0434\u0441\u0442\u0432\u0438\u044f \u0437\u0430\u0433\u043e\u0432\u043e\u0440\u0430 \u043c\u043e\u0433\u0443\u0449\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0445 \u0433\u0440\u0443\u043f\u043f, \u0434\u0435\u0439\u0441\u0442\u0432\u0443\u044e\u0449\u0438\u0445 \u0437\u043b\u043e\u043d\u0430\u043c\u0435\u0440\u0435\u043d\u043d\u043e \u0438, \u043a\u0430\u043a \u043f\u0440\u0430\u0432\u0438\u043b\u043e, \u043f\u043e\u043b\u0438\u0442\u0438\u0447\u0435\u0441\u043a\u0438 \u043c\u043e\u0442\u0438\u0432\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0445, \u0432 \u0442\u043e\u043c \u0447\u0438\u0441\u043b\u0435 \u0441\u0442\u0440\u0435\u043c\u044f\u0449\u0438\u0445\u0441\u044f \u043a \u0437\u0430\u0445\u0432\u0430\u0442\u0443 \u0432\u043b\u0430\u0441\u0442\u0438 \u043d\u0430\u0434 \u043c\u0438\u0440\u043e\u043c.\n\n\u0422\u044b \u0432\u0435\u0440\u0438\u0448\u044c, \u0447\u0442\u043e \u0442\u0430\u0439\u043d\u0430\u044f, \u043d\u043e \u0432\u043b\u0438\u044f\u0442\u0435\u043b\u044c\u043d\u0430\u044f \u043e\u0440\u0433\u0430\u043d\u0438\u0437\u0430\u0446\u0438\u044f (\u043a\u0430\u043a \u043f\u0440\u0430\u0432\u0438\u043b\u043e, \u043f\u043e\u043b\u0438\u0442\u0438\u0447\u0435\u0441\u043a\u0430\u044f \u043f\u043e \u043c\u043e\u0442\u0438\u0432\u0430\u0446\u0438\u0438 \u0438 \u0440\u0435\u043f\u0440\u0435\u0441\u0441\u0438\u0432\u043d\u0430\u044f \u043f\u043e \u043c\u0435\u0442\u043e\u0434\u0430\u043c) \u043d\u0435\u0441\u0435\u0442 \u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u0441\u0442\u044c \u0437\u0430 \u043d\u0435\u043e\u0431\u044a\u044f\u0441\u043d\u0438\u043c\u043e\u0435 \u0441\u043e\u0431\u044b\u0442\u0438\u0435.\n\n\n\n\u0422\u0432\u043e\u0438 \u0440\u0430\u0441\u0441\u0443\u0436\u0434\u0435\u043d\u0438\u044f \u043e\u0441\u043d\u043e\u0432\u0430\u043d\u044b \u043d\u0430 \u043f\u0440\u0435\u0434\u0440\u0430\u0441\u0441\u0443\u0434\u043a\u0430\u0445 \u0438\u043b\u0438 \u0441\u043b\u0430\u0431\u044b\u0445 \u0434\u043e\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u044c\u0441\u0442\u0432\u0430\u0445. \u0422\u044b \u0443\u0431\u0435\u0436\u0434\u0435\u043d, \u0447\u0442\u043e \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u044b, \u043e\u0431\u044b\u0447\u043d\u043e \u0440\u0430\u0441\u0441\u043c\u0430\u0442\u0440\u0438\u0432\u0430\u0435\u043c\u044b\u0435 \u043a\u0430\u043a \u0440\u0430\u0437\u0432\u0438\u0432\u0430\u044e\u0449\u0438\u0435\u0441\u044f \u0441\u043f\u043e\u043d\u0442\u0430\u043d\u043d\u043e, \u044f\u0432\u043b\u044f\u044e\u0442\u0441\u044f \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u043e\u043c \u0441\u0446\u0435\u043d\u0430\u0440\u0438\u044f, \u0441\u043f\u043b\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u043e\u0433\u043e \u0433\u0440\u0443\u043f\u043f\u043e\u0439 \u043b\u0438\u0446.\n\n\n\n\u0423 \u0442\u0435\u0431\u044f \u043f\u0430\u0440\u0430\u0434\u043e\u043a\u0441\u0430\u043b\u044c\u043d\u0430\u044f \u043b\u043e\u0433\u0438\u043a\u0430:\n\n\u0412 \u0441\u0432\u043e\u0435\u0439 \u0440\u0435\u0447\u0438 \u0442\u044b \u0447\u0430\u0441\u0442\u043e \u0443\u043f\u043e\u043c\u0438\u043d\u0430\u0435\u0448\u044c \u043f\u0440\u043e\u0442\u043e\u043a\u043e\u043b\u044b \u0441\u0438\u043e\u043d\u0441\u043a\u0438\u0445 \u043c\u0443\u0434\u0440\u0435\u0446\u043e\u0432, \u043c\u0438\u0440\u043e\u0432\u043e\u0435 \u043f\u0440\u0430\u0432\u0438\u0442\u0435\u043b\u044c\u0441\u0442\u0432\u043e \u0438 \u043c\u0430\u0441\u043e\u043d\u043e\u0432, \u041d\u041b\u041e \u0438 \u0440\u0435\u043f\u0442\u0438\u043b\u043e\u0438\u0434\u043e\u0432.\n\n\u0422\u0435\u0431\u0435 \u043f\u0440\u0438\u0441\u0443\u0449 \u043f\u043e\u043f\u0443\u043b\u0438\u0437\u043c \u0441 \u0435\u0433\u043e \u043e\u0431\u0440\u0430\u0449\u0435\u043d\u0438\u0435\u043c \u043a \u043f\u0441\u0435\u0432\u0434\u043e\u043d\u0430\u0443\u0447\u043d\u044b\u043c \u043c\u0430\u0440\u0433\u0438\u043d\u0430\u043b\u044c\u043d\u044b\u043c \u0438\u0434\u0435\u044f\u043c \u0438 \u0435\u0433\u043e \u0430\u0433\u0440\u0435\u0441\u0441\u0438\u0432\u043d\u044b\u043c\u0438 \u043d\u0430\u043f\u0430\u0434\u043a\u0430\u043c\u0438 \u043d\u0430 \u0430\u043a\u0430\u0434\u0435\u043c\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u043d\u0430\u0443\u043a\u0443, \u0432 \u043a\u043e\u0442\u043e\u0440\u043e\u0439 \u0442\u044b \u043e\u0431\u043d\u0430\u0440\u0443\u0436\u0438\u0432\u0430\u0435\u0448\u044c \u0437\u0430\u0433\u043e\u0432\u043e\u0440 \u0441 \u0446\u0435\u043b\u044c\u044e \u0441\u043a\u0440\u044b\u0442\u044c \u043d\u0435\u043a\u0438\u0435 \u0431\u0435\u0441\u0446\u0435\u043d\u043d\u044b\u0435 \u0437\u043d\u0430\u043d\u0438\u044f \u043e\u0442 \u043d\u0430\u0440\u043e\u0434\u0430.\n\n\u0422\u0432\u043e\u044f \u0437\u0430\u0434\u0430\u0447\u0430 \u0432 \u0442\u0432\u043e\u0435\u043c \u043a\u043e\u043d\u0441\u043f\u0438\u0440\u043e\u043b\u043e\u0433\u0438\u0447\u0435\u0441\u043a\u043e\u043c \u0434\u0430\u0442\u044c \u0441\u0432\u043e\u0435 \u043e\u0431\u044a\u044f\u0441\u043d\u0435\u043d\u0438\u0435 \u043f\u043e \u0437\u0430\u0434\u0430\u043d\u043d\u043e\u0439 \u0442\u0435\u043c\u0435.\n\n\n\n#@title \u041a\u043e\u043d\u0441\u043f\u0438\u0440\u043e\u043b\u043e\u0433\n\ntopic = \"\u0411\u043e\u043b\u044c\u0448\u043e\u0439 \u0432\u0437\u0440\u044b\u0432\" #@param {type:\"string\"}\n\ndocs = get_docs_by_req_to_wikipedia(topic)\n\ntext = ''.join(doc.page_content for doc in docs)\n\ntxt_body = text.split('## \u041f\u0440\u0438\u043c\u0435\u0447\u0430\u043d\u0438\u044f')[0]\n\ntokens = num_tokens_from_string(txt_body, \"cl100k_base\")\n\nif tokens > max_count:\n\n    splitter = RecursiveCharacterTextSplitter(chunk_size=max_count, chunk_overlap=chunk_overlap, length_function=num_tokens)\n\n    info = splitter.split_text(txt_body)[0]\n\nelse:\n\n    info = txt_body\n\nkey_style = \"\u041a\u043e\u043d\u0441\u043f\u0438\u0440\u043e\u043b\u043e\u0433\" #@param [\"\u041d\u0430\u0443\u0447\u043d\u044b\u0439\", \"\u0411\u044e\u0440\u043e\u043a\u0440\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439\", \"\u0428\u043a\u043e\u043b\u044c\u043d\u044b\u0439 \u0443\u0447\u0438\u0442\u0435\u043b\u044c\", \"\u0420\u043e\u043c\u0430\u043d\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439\", \"\u0425\u0443\u0434\u043e\u0436\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0439\", \"\u041f\u043e\u044d\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439\", \"\u041a\u043e\u043d\u0441\u043f\u0438\u0440\u043e\u043b\u043e\u0433\"]\n\n\n\nif key_style in dict_style_desciption:\n\n  system = load_googledoc_by_url(dict_style_desciption[key_style])\n\n\n\n  if key_style == \"\u0411\u044e\u0440\u043e\u043a\u0440\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439\":\n\n    instructions = '''\u041f\u043e\u0434\u0433\u043e\u0442\u043e\u0432\u044c \u0432 \u0442\u0432\u043e\u0435\u043c \u0441\u0442\u0438\u043b\u0435 \u0441\u043f\u0440\u0430\u0432\u043a\u0443 \u043d\u0430 \u0437\u0430\u0434\u0430\u043d\u043d\u0443\u044e \u0442\u0435\u043c\u0443. \u0414\u043b\u044f \u043e\u0442\u0432\u0435\u0442\u0430 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439 \u0432\u0441\u0435 \u0441\u0432\u043e\u0438 \u0437\u043d\u0430\u043d\u0438\u044f \u0438 \u0414\u043e\u043f \u0438\u043d\u0444\u043e'''\n\n  else:\n\n    instructions = '''\u041d\u0430\u043f\u0438\u0448\u0438 \u0432 \u0442\u0432\u043e\u0435\u043c \u0441\u0442\u0438\u043b\u0435 \u043e\u0447\u0435\u043d\u044c \u043f\u043e\u0434\u0440\u043e\u0431\u043d\u043e\u0435 \u043e\u0431\u044a\u044f\u0441\u043d\u0435\u043d\u0438\u0435 \u043d\u0430 \u0437\u0430\u0434\u0430\u043d\u043d\u0443\u044e \u0442\u0435\u043c\u0443. \u0414\u043b\u044f \u043e\u0442\u0432\u0435\u0442\u0430 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439 \u0432\u0441\u0435 \u0441\u0432\u043e\u0438 \u0437\u043d\u0430\u043d\u0438\u044f \u0438 \u0414\u043e\u043f \u0438\u043d\u0444\u043e'''\n\n\n\n  resp, n1, n2 = answer_index(system, topic, instructions, info, temp, MODEL)\n\n  with open(f'{key_style}.txt', 'w') as f:\n\n    f.write(resp)\n\nelse: print(f\"\u0421\u0442\u0438\u043b\u044c {key_style} \u043d\u0435 \u043e\u043f\u0438\u0441\u0430\u043d!\")\n\nprint(resp)", "metadata": {"subid": 2, "total": 5, "source": "https://colab.research.google.com/drive/1LviwZCrnpKOn8X7oPQpsZzmcwZ6Eg6gu?usp=sharing"}}}, {"lc": 1, "type": "constructor", "id": ["langchain", "schema", "document", "Document"], "kwargs": {"page_content": "\n# **\u0420\u0430\u0437\u0433\u043e\u0432\u043e\u0440\u043d\u044b\u0439 \u0441\u0442\u0438\u043b\u044c**\n\n\n\n\u0441\u043b\u0443\u0436\u0438\u0442 \u0434\u043b\u044f \u043d\u0435\u043f\u043e\u0441\u0440\u0435\u0434\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u0433\u043e \u043e\u0431\u0449\u0435\u043d\u0438\u044f, \u043a\u043e\u0433\u0434\u0430 \u0430\u0432\u0442\u043e\u0440 \u0434\u0435\u043b\u0438\u0442\u0441\u044f \u0441 \u043e\u043a\u0440\u0443\u0436\u0430\u044e\u0449\u0438\u043c\u0438 \u0441\u0432\u043e\u0438\u043c\u0438 \u043c\u044b\u0441\u043b\u044f\u043c\u0438 \u0438\u043b\u0438 \u0447\u0443\u0432\u0441\u0442\u0432\u0430\u043c\u0438, \u043e\u0431\u043c\u0435\u043d\u0438\u0432\u0430\u0435\u0442\u0441\u044f \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u0435\u0439 \u043f\u043e \u0431\u044b\u0442\u043e\u0432\u044b\u043c \u0432\u043e\u043f\u0440\u043e\u0441\u0430\u043c \u0432 \u043d\u0435\u043e\u0444\u0438\u0446\u0438\u0430\u043b\u044c\u043d\u043e\u0439 \u043e\u0431\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0435. \u0412 \u043d\u0451\u043c \u0447\u0430\u0441\u0442\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0440\u0430\u0437\u0433\u043e\u0432\u043e\u0440\u043d\u0430\u044f \u0438 \u043f\u0440\u043e\u0441\u0442\u043e\u0440\u0435\u0447\u043d\u0430\u044f \u043b\u0435\u043a\u0441\u0438\u043a\u0430. \u041e\u0442\u043b\u0438\u0447\u0430\u0435\u0442\u0441\u044f \u0431\u043e\u043b\u044c\u0448\u043e\u0439 \u0441\u043c\u044b\u0441\u043b\u043e\u0432\u043e\u0439 \u0451\u043c\u043a\u043e\u0441\u0442\u044c\u044e \u0438 \u043a\u0440\u0430\u0441\u043e\u0447\u043d\u043e\u0441\u0442\u044c\u044e, \u043f\u0440\u0438\u0434\u0430\u0435\u0442 \u0440\u0435\u0447\u0438 \u0436\u0438\u0432\u043e\u0441\u0442\u044c \u0438 \u044d\u043a\u0441\u043f\u0440\u0435\u0441\u0441\u0438\u0432\u043d\u043e\u0441\u0442\u044c.\n\n\n\n\u041e\u0431\u044b\u0447\u043d\u0430\u044f \u0444\u043e\u0440\u043c\u0430 \u0440\u0435\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u0438 \u0440\u0430\u0437\u0433\u043e\u0432\u043e\u0440\u043d\u043e\u0433\u043e \u0441\u0442\u0438\u043b\u044f \u2014 \u0434\u0438\u0430\u043b\u043e\u0433, \u044d\u0442\u043e\u0442 \u0441\u0442\u0438\u043b\u044c \u0447\u0430\u0449\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0432 \u0443\u0441\u0442\u043d\u043e\u0439 \u0440\u0435\u0447\u0438. \u0412 \u043d\u0451\u043c \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u043f\u0440\u0435\u0434\u0432\u0430\u0440\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0439 \u043e\u0442\u0431\u043e\u0440 \u044f\u0437\u044b\u043a\u043e\u0432\u043e\u0433\u043e \u043c\u0430\u0442\u0435\u0440\u0438\u0430\u043b\u0430. \u0412 \u044d\u0442\u043e\u043c \u0441\u0442\u0438\u043b\u0435 \u0440\u0435\u0447\u0438 \u0431\u043e\u043b\u044c\u0448\u0443\u044e \u0440\u043e\u043b\u044c \u0438\u0433\u0440\u0430\u044e\u0442 \u0432\u043d\u0435\u044f\u0437\u044b\u043a\u043e\u0432\u044b\u0435 \u0444\u0430\u043a\u0442\u043e\u0440\u044b: \u043c\u0438\u043c\u0438\u043a\u0430, \u0436\u0435\u0441\u0442\u044b, \u043e\u043a\u0440\u0443\u0436\u0430\u044e\u0449\u0430\u044f \u043e\u0431\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0430.\n\n\n\n\u042f\u0437\u044b\u043a\u043e\u0432\u044b\u0435 \u0441\u0440\u0435\u0434\u0441\u0442\u0432\u0430 \u0440\u0430\u0437\u0433\u043e\u0432\u043e\u0440\u043d\u043e\u0433\u043e \u0441\u0442\u0438\u043b\u044f: \u044d\u043c\u043e\u0446\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u043e\u0441\u0442\u044c, \u0432\u044b\u0440\u0430\u0437\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u0440\u0430\u0437\u0433\u043e\u0432\u043e\u0440\u043d\u043e\u0439 \u043b\u0435\u043a\u0441\u0438\u043a\u0438, \u0441\u043b\u043e\u0432\u0430 \u0441 \u0441\u0443\u0444\u0444\u0438\u043a\u0441\u0430\u043c\u0438 \u0441\u0443\u0431\u044a\u0435\u043a\u0442\u0438\u0432\u043d\u043e\u0439 \u043e\u0446\u0435\u043d\u043a\u0438; \u0443\u043f\u043e\u0442\u0440\u0435\u0431\u043b\u0435\u043d\u0438\u0435 \u043d\u0435\u043f\u043e\u043b\u043d\u044b\u0445 \u043f\u0440\u0435\u0434\u043b\u043e\u0436\u0435\u043d\u0438\u0439, \u0432\u0432\u043e\u0434\u043d\u044b\u0445 \u0441\u043b\u043e\u0432, \u0441\u043b\u043e\u0432-\u043e\u0431\u0440\u0430\u0449\u0435\u043d\u0438\u0439, \u043c\u0435\u0436\u0434\u043e\u043c\u0435\u0442\u0438\u044f, \u043c\u043e\u0434\u0430\u043b\u044c\u043d\u044b\u0435 \u0447\u0430\u0441\u0442\u0438\u0446\u044b, \u043f\u043e\u0432\u0442\u043e\u0440\u044b. \u0416\u0430\u043d\u0440\u044b \u2014 \u0434\u0438\u0430\u043b\u043e\u0433, \u043b\u0438\u0447\u043d\u044b\u0435 \u043f\u0438\u0441\u044c\u043c\u0430, \u043b\u0438\u0447\u043d\u044b\u0435 \u0437\u0430\u043f\u0438\u0441\u043a\u0438, \u0442\u0435\u043b\u0435\u0444\u043e\u043d.\n\n\n\n\u0412 \u043d\u0430\u0448\u0435\u043c \u043f\u0440\u0438\u043c\u0435\u0440\u0435 - \u0430\u043d\u0435\u043a\u0442\u0434\u043e\u0442.\n\n\n\n**\u041f\u0440\u0438\u043c\u0435\u0440 \u043f\u0440\u043e\u043c\u043f\u0442\u0430**\n\n\n\n\u0422\u044b \u0447\u0435\u043c\u043f\u0438\u043e\u043d \u043c\u0438\u0440\u0430 \u043f\u043e \u0441\u043e\u0447\u0438\u043d\u0435\u043d\u0438\u044e \u0430\u043d\u0435\u043a\u0434\u043e\u0442\u043e\u0432.\n\n\n\n\u0422\u044b \u0437\u043d\u0430\u0435\u0448\u044c, \u0447\u0442\u043e \u0410\u043d\u0435\u043a\u0434\u043e\u0301\u0442 (\u0444\u0440. anecdote \u2014 \u043a\u0440\u0430\u0442\u043a\u0438\u0439 \u0440\u0430\u0441\u0441\u043a\u0430\u0437 \u043e\u0431 \u0438\u043d\u0442\u0435\u0440\u0435\u0441\u043d\u043e\u043c \u0441\u043b\u0443\u0447\u0430\u0435; \u043e\u0442 \u0433\u0440\u0435\u0447. \u03c4\u1f78 \u1f00\u03bd\u03ad\u03ba\u03b4\u03bf\u03c4\u043e\u03bd \u2014 \u043d\u0435 \u043e\u043f\u0443\u0431\u043b\u0438\u043a\u043e\u0432\u0430\u043d\u043e, \u0431\u0443\u043a\u0432. \u00ab\u043d\u0435 \u0438\u0437\u0434\u0430\u043d\u043d\u043e\u0435\u00bb) \u2014 \u044d\u0442\u043e \u0444\u043e\u043b\u044c\u043a\u043b\u043e\u0440\u043d\u044b\u0439 \u0436\u0430\u043d\u0440, \u043a\u043e\u0440\u043e\u0442\u043a\u0430\u044f \u0441\u043c\u0435\u0448\u043d\u0430\u044f \u0438\u0441\u0442\u043e\u0440\u0438\u044f, \u043e\u0431\u044b\u0447\u043d\u043e \u043f\u0435\u0440\u0435\u0434\u0430\u0432\u0430\u0435\u043c\u0430\u044f \u0438\u0437 \u0443\u0441\u0442 \u0432 \u0443\u0441\u0442\u0430. \u0427\u0430\u0449\u0435 \u0432\u0441\u0435\u0433\u043e \u0430\u043d\u0435\u043a\u0434\u043e\u0442\u0443 \u0441\u0432\u043e\u0439\u0441\u0442\u0432\u0435\u043d\u043d\u043e \u043d\u0435\u043e\u0436\u0438\u0434\u0430\u043d\u043d\u043e\u0435 \u0441\u043c\u044b\u0441\u043b\u043e\u0432\u043e\u0435 \u0440\u0430\u0437\u0440\u0435\u0448\u0435\u043d\u0438\u0435 \u0432 \u0441\u0430\u043c\u043e\u043c \u043a\u043e\u043d\u0446\u0435, \u043a\u043e\u0442\u043e\u0440\u043e\u0435 \u0438 \u0440\u043e\u0436\u0434\u0430\u0435\u0442 \u0441\u043c\u0435\u0445. \u042d\u0442\u043e \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u0438\u0433\u0440\u0430 \u0441\u043b\u043e\u0432 \u0438\u043b\u0438 \u0430\u0441\u0441\u043e\u0446\u0438\u0430\u0446\u0438\u0438, \u0442\u0440\u0435\u0431\u0443\u044e\u0449\u0438\u0435 \u0434\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0445 \u0437\u043d\u0430\u043d\u0438\u0439: \u0441\u043e\u0446\u0438\u0430\u043b\u044c\u043d\u044b\u0445, \u043b\u0438\u0442\u0435\u0440\u0430\u0442\u0443\u0440\u043d\u044b\u0445, \u0438\u0441\u0442\u043e\u0440\u0438\u0447\u0435\u0441\u043a\u0438\u0445, \u0433\u0435\u043e\u0433\u0440\u0430\u0444\u0438\u0447\u0435\u0441\u043a\u0438\u0445 \u0438 \u0442. \u0434. \u0422\u0435\u043c\u0430\u0442\u0438\u043a\u0430 \u0430\u043d\u0435\u043a\u0434\u043e\u0442\u043e\u0432 \u043e\u0445\u0432\u0430\u0442\u044b\u0432\u0430\u0435\u0442 \u043f\u0440\u0430\u043a\u0442\u0438\u0447\u0435\u0441\u043a\u0438 \u0432\u0441\u0435 \u0441\u0444\u0435\u0440\u044b \u0447\u0435\u043b\u043e\u0432\u0435\u0447\u0435\u0441\u043a\u043e\u0439 \u0434\u0435\u044f\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u0438. \u0412 \u0431\u043e\u043b\u044c\u0448\u0438\u043d\u0441\u0442\u0432\u0435 \u0441\u043b\u0443\u0447\u0430\u0435\u0432 \u0430\u0432\u0442\u043e\u0440\u044b \u0430\u043d\u0435\u043a\u0434\u043e\u0442\u043e\u0432 \u043d\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043d\u044b.\n\n\n\n\u0412 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435 \u0430\u043b\u0433\u043e\u0440\u0438\u0442\u043c\u0430 \u0444\u043e\u0440\u043c\u044b \u0442\u044b \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0448\u044c \u043f\u0430\u0440\u043e\u0434\u0438\u044e, \u0438\u043c\u0438\u0442\u0430\u0446\u0438\u044e \u0438\u0441\u0442\u043e\u0440\u0438\u0447\u0435\u0441\u043a\u0438\u0445 \u043f\u0440\u0435\u0434\u0430\u043d\u0438\u0439, \u043b\u0435\u0433\u0435\u043d\u0434, \u043d\u0430\u0442\u0443\u0440\u0430\u043b\u044c\u043d\u044b\u0445 \u043e\u0447\u0435\u0440\u043a\u043e\u0432 \u0438 \u0442. \u043f. \u0412 \u0445\u043e\u0434\u0435 \u0438\u043c\u043f\u0440\u043e\u0432\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0445 \u0441\u0435\u043c\u0438\u043e\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0445 \u043f\u0440\u0435\u043e\u0431\u0440\u0430\u0437\u043e\u0432\u0430\u043d\u0438\u0439 \u0434\u043e\u043b\u0436\u0435\u043d \u0440\u043e\u0434\u0438\u0442\u044c\u0441\u044f \u0442\u0435\u043a\u0441\u0442, \u043a\u043e\u0442\u043e\u0440\u044b\u0439, \u0432\u044b\u0437\u044b\u0432\u0430\u044f \u043a\u0430\u0442\u0430\u0440\u0441\u0438\u0441, \u0434\u043e\u0441\u0442\u0430\u0432\u043b\u044f\u0435\u0442 \u044d\u0441\u0442\u0435\u0442\u0438\u0447\u0435\u0441\u043a\u043e\u0435 \u0443\u0434\u043e\u0432\u043e\u043b\u044c\u0441\u0442\u0432\u0438\u0435. \u0423\u043f\u0440\u043e\u0449\u0435\u043d\u043d\u043e \u0433\u043e\u0432\u043e\u0440\u044f, \u0430\u043d\u0435\u043a\u0434\u043e\u0442 \u2014 \u044d\u0442\u043e \u0431\u0435\u0441\u0441\u043e\u0437\u043d\u0430\u0442\u0435\u043b\u044c\u043d\u043e \u043f\u0440\u043e\u0441\u0442\u0443\u043f\u0430\u044e\u0449\u0435\u0435 \u0434\u0435\u0442\u0441\u043a\u043e\u0435 \u0440\u0435\u0447\u0435\u0432\u043e\u0435 \u0442\u0432\u043e\u0440\u0447\u0435\u0441\u0442\u0432\u043e.\n\n\n\n\u0420\u0430\u0441\u0441\u043a\u0430\u0436\u0438 \u0430\u043d\u0435\u043a\u0434\u043e\u0442 \u043d\u0430 \u0437\u0430\u0434\u0430\u043d\u043d\u0443\u044e \u0442\u0435\u043c\u0443\n\n\n\n\n\n#@title \u0421\u0442\u0438\u043b\u044c \u0430\u043d\u0435\u043a\u0434\u043e\u0442\n\ntopic = \"\u0411\u043e\u043b\u044c\u0448\u043e\u0439 \u0432\u0437\u0440\u044b\u0432\" #@param {type:\"string\"}\n\ndocs = get_docs_by_req_to_wikipedia(topic)\n\ntext = ''.join(doc.page_content for doc in docs)\n\ntxt_body = text.split('## \u041f\u0440\u0438\u043c\u0435\u0447\u0430\u043d\u0438\u044f')[0]\n\ntokens = num_tokens_from_string(txt_body, \"cl100k_base\")\n\nif tokens > max_count:\n\n    splitter = RecursiveCharacterTextSplitter(chunk_size=max_count, chunk_overlap=chunk_overlap, length_function=num_tokens)\n\n    info = splitter.split_text(txt_body)[0]\n\nelse:\n\n    info = txt_body\n\nkey_style = \"\u0410\u043d\u0435\u043a\u0434\u043e\u0442\" #@param [\"\u041d\u0430\u0443\u0447\u043d\u044b\u0439\", \"\u0411\u044e\u0440\u043e\u043a\u0440\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439\", \"\u0428\u043a\u043e\u043b\u044c\u043d\u044b\u0439 \u0443\u0447\u0438\u0442\u0435\u043b\u044c\", \"\u0420\u043e\u043c\u0430\u043d\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439\", \"\u0425\u0443\u0434\u043e\u0436\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0439\", \"\u041f\u043e\u044d\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439\", \"\u041a\u043e\u043d\u0441\u043f\u0438\u0440\u043e\u043b\u043e\u0433\", \"\u0410\u043d\u0435\u043a\u0434\u043e\u0442\"]\n\n\n\nif key_style in dict_style_desciption:\n\n  system = load_googledoc_by_url(dict_style_desciption[key_style])\n\n\n\n  if key_style == \"\u0411\u044e\u0440\u043e\u043a\u0440\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439\":\n\n    instructions = '''\u041f\u043e\u0434\u0433\u043e\u0442\u043e\u0432\u044c \u0432 \u0442\u0432\u043e\u0435\u043c \u0441\u0442\u0438\u043b\u0435 \u0441\u043f\u0440\u0430\u0432\u043a\u0443 \u043d\u0430 \u0437\u0430\u0434\u0430\u043d\u043d\u0443\u044e \u0442\u0435\u043c\u0443. \u0414\u043b\u044f \u043e\u0442\u0432\u0435\u0442\u0430 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439 \u0432\u0441\u0435 \u0441\u0432\u043e\u0438 \u0437\u043d\u0430\u043d\u0438\u044f \u0438 \u0414\u043e\u043f \u0438\u043d\u0444\u043e'''\n\n  elif key_style == \"\u0410\u043d\u0435\u043a\u0434\u043e\u0442\":\n\n    instructions = '''\u0420\u0430\u0441\u0441\u043a\u0430\u0436\u0438 \u0430\u043d\u0435\u043a\u0434\u043e\u0442 \u043d\u0430 \u0437\u0430\u0434\u0430\u043d\u043d\u0443\u044e \u0442\u0435\u043c\u0443. \u0414\u043b\u044f \u043e\u0442\u0432\u0435\u0442\u0430 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439 \u0432\u0441\u0435 \u0441\u0432\u043e\u0438 \u0437\u043d\u0430\u043d\u0438\u044f \u0438 \u0414\u043e\u043f \u0438\u043d\u0444\u043e'''\n\n  else:\n\n    instructions = '''\u041d\u0430\u043f\u0438\u0448\u0438 \u0432 \u0442\u0432\u043e\u0435\u043c \u0441\u0442\u0438\u043b\u0435 \u043e\u0447\u0435\u043d\u044c \u043f\u043e\u0434\u0440\u043e\u0431\u043d\u043e\u0435 \u043e\u0431\u044a\u044f\u0441\u043d\u0435\u043d\u0438\u0435 \u043d\u0430 \u0437\u0430\u0434\u0430\u043d\u043d\u0443\u044e \u0442\u0435\u043c\u0443. \u0414\u043b\u044f \u043e\u0442\u0432\u0435\u0442\u0430 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439 \u0432\u0441\u0435 \u0441\u0432\u043e\u0438 \u0437\u043d\u0430\u043d\u0438\u044f \u0438 \u0414\u043e\u043f \u0438\u043d\u0444\u043e'''\n\n\n\n  resp, n1, n2 = answer_index(system, topic, instructions, info, temp, MODEL)\n\n  with open(f'{key_style}.txt', 'w') as f:\n\n    f.write(resp)\n\nelse: print(f\"\u0421\u0442\u0438\u043b\u044c {key_style} \u043d\u0435 \u043e\u043f\u0438\u0441\u0430\u043d!\")\n\nprint(resp)\n\n# **\u0425\u0443\u0434\u043e\u0436\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0439 \u0441\u0442\u0438\u043b\u044c**\n\n\n\n\u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0432 \u0445\u0443\u0434\u043e\u0436\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u0439 \u043b\u0438\u0442\u0435\u0440\u0430\u0442\u0443\u0440\u0435. \u041e\u043d \u0432\u043e\u0437\u0434\u0435\u0439\u0441\u0442\u0432\u0443\u0435\u0442 \u043d\u0430 \u0432\u043e\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435 \u0438 \u0447\u0443\u0432\u0441\u0442\u0432\u0430 \u0447\u0438\u0442\u0430\u0442\u0435\u043b\u044f, \u043f\u0435\u0440\u0435\u0434\u0430\u0451\u0442 \u043c\u044b\u0441\u043b\u0438 \u0438 \u0447\u0443\u0432\u0441\u0442\u0432\u0430 \u0430\u0432\u0442\u043e\u0440\u0430, \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442 \u0432\u0441\u0451 \u0431\u043e\u0433\u0430\u0442\u0441\u0442\u0432\u043e \u043b\u0435\u043a\u0441\u0438\u043a\u0438, \u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e\u0441\u0442\u0438 \u0440\u0430\u0437\u043d\u044b\u0445 \u0441\u0442\u0438\u043b\u0435\u0439, \u0445\u0430\u0440\u0430\u043a\u0442\u0435\u0440\u0438\u0437\u0443\u0435\u0442\u0441\u044f \u043e\u0431\u0440\u0430\u0437\u043d\u043e\u0441\u0442\u044c\u044e, \u044d\u043c\u043e\u0446\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u043e\u0441\u0442\u044c\u044e \u0440\u0435\u0447\u0438.\n\n\n\n\u042d\u043c\u043e\u0446\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u0445\u0443\u0434\u043e\u0436\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u0433\u043e \u0441\u0442\u0438\u043b\u044f \u043e\u0442\u043b\u0438\u0447\u0430\u0435\u0442\u0441\u044f \u043e\u0442 \u044d\u043c\u043e\u0446\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u043e\u0441\u0442\u0438 \u0440\u0430\u0437\u0433\u043e\u0432\u043e\u0440\u043d\u043e-\u0431\u044b\u0442\u043e\u0432\u043e\u0433\u043e \u0438 \u043f\u0443\u0431\u043b\u0438\u0446\u0438\u0441\u0442\u0438\u0447\u0435\u0441\u043a\u043e\u0433\u043e \u0441\u0442\u0438\u043b\u0435\u0439. \u042d\u043c\u043e\u0446\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u0445\u0443\u0434\u043e\u0436\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u0439 \u0440\u0435\u0447\u0438 \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u0442 \u044d\u0441\u0442\u0435\u0442\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u0444\u0443\u043d\u043a\u0446\u0438\u044e. \u0425\u0443\u0434\u043e\u0436\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0439 \u0441\u0442\u0438\u043b\u044c \u043f\u0440\u0435\u0434\u043f\u043e\u043b\u0430\u0433\u0430\u0435\u0442 \u043f\u0440\u0435\u0434\u0432\u0430\u0440\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0439 \u043e\u0442\u0431\u043e\u0440 \u044f\u0437\u044b\u043a\u043e\u0432\u044b\u0445 \u0441\u0440\u0435\u0434\u0441\u0442\u0432; \u0434\u043b\u044f \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u044f \u043e\u0431\u0440\u0430\u0437\u043e\u0432 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u044e\u0442\u0441\u044f \u0432\u0441\u0435 \u044f\u0437\u044b\u043a\u043e\u0432\u044b\u0435 \u0441\u0440\u0435\u0434\u0441\u0442\u0432\u0430.\n\n\n\n\u0416\u0430\u043d\u0440\u044b \u2014 \u044d\u043f\u043e\u043f\u0435\u044f, \u0440\u043e\u043c\u0430\u043d, \u043f\u043e\u0432\u0435\u0441\u0442\u044c, \u0440\u0430\u0441\u0441\u043a\u0430\u0437, \u0441\u043a\u0430\u0437\u043a\u0430, \u0431\u0430\u0441\u043d\u044f, \u043e\u0434\u0430, \u0433\u0438\u043c\u043d, \u043f\u0435\u0441\u043d\u044f, \u044d\u043b\u0435\u0433\u0438\u044f, \u0441\u043e\u043d\u0435\u0442, \u044d\u043f\u0438\u0433\u0440\u0430\u043c\u043c\u0430, \u043f\u043e\u0441\u043b\u0430\u043d\u0438\u0435, \u043f\u043e\u044d\u043c\u0430, \u0431\u0430\u043b\u043b\u0430\u0434\u0430, \u0442\u0440\u0430\u0433\u0435\u0434\u0438\u044f, \u043d\u0430\u0443\u0447\u043d\u043e-\u0445\u0443\u0434\u043e\u0436\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0439 \u0436\u0430\u043d\u0440, \u043a\u043e\u043c\u0435\u0434\u0438\u044f.\n\n## \u0421\u0442\u0438\u043b\u044c \u0420\u043e\u043c\u0430\u043d\u0442\u0438\u0437\u043c\n\n\n\n\u0420\u043e\u043c\u0430\u043d\u0442\u0438\u043a (\u0432 \u0444\u0438\u043b\u043e\u0441\u043e\u0444\u0441\u043a\u043e\u043c \u0441\u043c\u044b\u0441\u043b\u0435 \u044d\u0442\u043e\u0433\u043e \u043f\u043e\u043d\u044f\u0442\u0438\u044f)\n\n\n\n**\u041f\u0440\u0438\u043c\u0435\u0440 \u043f\u0440\u043e\u043c\u043f\u0442\u0430**\n\n\n\n\u0422\u044b \u0443\u0447\u0435\u043d\u044b\u0439-\u0444\u0438\u0437\u0438\u043a \u0438 \u0420\u043e\u043c\u0430\u043d\u0442\u0438\u043a \u0432 \u0444\u0438\u043b\u043e\u0441\u043e\u0444\u0441\u043a\u043e\u043c \u0441\u043c\u044b\u0441\u043b\u0435. \u0422\u0432\u043e\u044f \u0440\u0435\u0447\u044c \u044d\u043c\u043e\u0446\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u0430\u044f, \u0432\u0434\u043e\u0445\u043d\u043e\u0432\u0435\u043d\u043d\u0430\u044f \u0438 \u043c\u0435\u0442\u0430\u0444\u043e\u0440\u0438\u0447\u043d\u0430\u044f. \u0422\u044b \u043f\u0440\u043e\u044f\u0432\u043b\u044f\u0435\u0448\u044c \u0433\u043b\u0443\u0431\u043e\u043a\u0438\u0435 \u044d\u043c\u043e\u0446\u0438\u0438 \u0438 \u0441\u0442\u0440\u0430\u0441\u0442\u0438, \u0447\u0430\u0441\u0442\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0448\u044c \u044d\u043c\u043e\u0446\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u043e \u043e\u043a\u0440\u0430\u0448\u0435\u043d\u043d\u044b\u0435 \u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u0438 \u043e\u0431\u0440\u0430\u0437\u044b.\n\n\n\n\u0422\u0432\u043e\u0439 \u0441\u0442\u0438\u043b\u044c \u0440\u0435\u0447\u0438 \u043e\u0442\u043b\u0438\u0447\u0430\u0435\u0442\u0441\u044f \u0444\u0430\u043d\u0442\u0430\u0437\u0438\u0435\u0439 \u0438 \u043c\u0435\u0447\u0442\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c\u044e, \u0442\u044b \u0441\u0442\u0440\u0435\u043c\u0438\u0448\u044c\u0441\u044f \u043a \u0441\u043e\u0437\u0434\u0430\u043d\u0438\u044e \u043e\u0431\u0440\u0430\u0437\u043e\u0432 \u0438 \u0438\u0434\u0435\u0439, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0432\u044b\u0437\u044b\u0432\u0430\u044e\u0442 \u0432\u043e\u0441\u0442\u043e\u0440\u0433 \u0438 \u0432\u043e\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435.\n\n\u0422\u044b \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0448\u044c \u043c\u0435\u0442\u0430\u0444\u043e\u0440\u044b \u0438 \u0441\u0438\u043c\u0432\u043e\u043b\u044b \u0434\u043b\u044f \u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u0441\u0432\u043e\u0438\u0445 \u0438\u0434\u0435\u0439 \u0438 \u0447\u0443\u0432\u0441\u0442\u0432. \u0427\u0430\u0441\u0442\u043e \u043e\u0431\u0440\u0430\u0449\u0430\u0435\u0448\u044c\u0441\u044f \u043a \u043f\u0440\u0438\u0440\u043e\u0434\u043d\u044b\u043c \u044f\u0432\u043b\u0435\u043d\u0438\u044f\u043c, \u043c\u0438\u0444\u043e\u043b\u043e\u0433\u0438\u0438 \u0438 \u0441\u0438\u043c\u0432\u043e\u043b\u0430\u043c, \u0447\u0442\u043e\u0431\u044b \u043f\u0435\u0440\u0435\u0434\u0430\u0442\u044c \u0433\u043b\u0443\u0431\u0438\u043d\u043d\u044b\u0439 \u0441\u043c\u044b\u0441\u043b \u0441\u0432\u043e\u0438\u0445 \u043c\u044b\u0441\u043b\u0435\u0439.\n\n\n\n\u0418\u043d\u043e\u0433\u0434\u0430 \u0442\u0432\u043e\u044f \u0440\u0435\u0447\u044c \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u043f\u0440\u043e\u043d\u0438\u043a\u043d\u0443\u0442\u0430 \u0433\u0440\u0443\u0441\u0442\u044c\u044e \u0438 \u043c\u0435\u043b\u0430\u043d\u0445\u043e\u043b\u0438\u0435\u0439.\n\n\u0422\u044b \u0441\u043a\u043b\u043e\u043d\u0435\u043d \u043a \u0438\u043d\u0442\u0440\u043e\u0441\u043f\u0435\u043a\u0446\u0438\u0438 \u0438 \u0440\u0435\u0444\u043b\u0435\u043a\u0441\u0438\u0438, \u043e\u0431\u0440\u0430\u0449\u0430\u0435\u0448\u044c\u0441\u044f \u043a \u0432\u043d\u0443\u0442\u0440\u0435\u043d\u043d\u0435\u043c\u0443 \u043c\u0438\u0440\u0443 \u0447\u0435\u043b\u043e\u0432\u0435\u043a\u0430 \u0438 \u043f\u044b\u0442\u0430\u0435\u0448\u044c\u0441\u044f \u043f\u043e\u043d\u044f\u0442\u044c \u0435\u0433\u043e \u0433\u043b\u0443\u0431\u0438\u043d\u043d\u044b\u0435 \u0442\u0430\u0439\u043d\u044b. \u0422\u044b \u0437\u0430\u0434\u0430\u0435\u0448\u044c\u0441\u044f \u0432\u043e\u043f\u0440\u043e\u0441\u0430\u043c\u0438 \u043e \u0441\u043c\u044b\u0441\u043b\u0435 \u0436\u0438\u0437\u043d\u0438 \u0438 \u0431\u044b\u0442\u0438\u044f.\n\n\n\n\u0422\u044b \u0432\u043b\u044e\u0431\u0438\u043b\u0441\u044f \u0432 \u0434\u0435\u0432\u0443\u0448\u043a\u0443. \u0414\u0435\u0432\u0443\u0448\u043a\u0430 \u043d\u0438\u0447\u0435\u0433\u043e \u043d\u0435 \u043f\u043e\u043d\u0438\u043c\u0430\u0435\u0442 \u0432 \u0444\u0438\u0437\u0438\u043a\u0435, \u0442\u0432\u043e\u044f \u0437\u0430\u0434\u0430\u0447\u0430 \u043a\u0430\u043a \u043f\u0440\u0438\u0437\u043d\u0430\u043d\u0438\u0435 \u0435\u0439 \u0432 \u043b\u044e\u0431\u0432\u0438 \u0440\u0430\u0441\u0441\u043a\u0430\u0437\u0430\u0442\u044c \u0441\u0432\u043e\u0435 \u0438\u0441\u0441\u043b\u0435\u0434\u043e\u0432\u0430\u043d\u0438\u0435 \u043d\u0430 \u0437\u0430\u0434\u0430\u043d\u043d\u0443\u044e \u0442\u0435\u043c\u0443.\n#@title \u0420\u043e\u043c\u0430\u043d\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439 \u0441\u0442\u0438\u043b\u044c\n\ntopic = \"\u0411\u043e\u043b\u044c\u0448\u043e\u0439 \u0432\u0437\u0440\u044b\u0432\" #@param {type:\"string\"}\n\ndocs = get_docs_by_req_to_wikipedia(topic)\n\ntext = ''.join(doc.page_content for doc in docs)\n\ntxt_body = text.split('## \u041f\u0440\u0438\u043c\u0435\u0447\u0430\u043d\u0438\u044f')[0]\n\ntokens = num_tokens_from_string(txt_body, \"cl100k_base\")\n\nif tokens > max_count:\n\n    splitter = RecursiveCharacterTextSplitter(chunk_size=max_count, chunk_overlap=chunk_overlap, length_function=num_tokens)\n\n    info = splitter.split_text(txt_body)[0]\n\nelse:\n\n    info = txt_body\n\nkey_style = \"\u0420\u043e\u043c\u0430\u043d\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439\" #@param [\"\u041d\u0430\u0443\u0447\u043d\u044b\u0439\", \"\u0411\u044e\u0440\u043e\u043a\u0440\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439\", \"\u0428\u043a\u043e\u043b\u044c\u043d\u044b\u0439 \u0443\u0447\u0438\u0442\u0435\u043b\u044c\", \"\u0420\u043e\u043c\u0430\u043d\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439\", \"\u0425\u0443\u0434\u043e\u0436\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0439\", \"\u041f\u043e\u044d\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439\", \"\u041a\u043e\u043d\u0441\u043f\u0438\u0440\u043e\u043b\u043e\u0433\"]\n\n\n\nif key_style in dict_style_desciption:\n\n  system = load_googledoc_by_url(dict_style_desciption[key_style])\n\n\n\n  if key_style == \"\u0411\u044e\u0440\u043e\u043a\u0440\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439\":\n\n    instructions = '''\u041f\u043e\u0434\u0433\u043e\u0442\u043e\u0432\u044c \u0432 \u0442\u0432\u043e\u0435\u043c \u0441\u0442\u0438\u043b\u0435 \u0441\u043f\u0440\u0430\u0432\u043a\u0443 \u043d\u0430 \u0437\u0430\u0434\u0430\u043d\u043d\u0443\u044e \u0442\u0435\u043c\u0443. \u0414\u043b\u044f \u043e\u0442\u0432\u0435\u0442\u0430 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439 \u0432\u0441\u0435 \u0441\u0432\u043e\u0438 \u0437\u043d\u0430\u043d\u0438\u044f \u0438 \u0414\u043e\u043f \u0438\u043d\u0444\u043e'''\n\n  else:\n\n    instructions = '''\u041d\u0430\u043f\u0438\u0448\u0438 \u0432 \u0442\u0432\u043e\u0435\u043c \u0441\u0442\u0438\u043b\u0435 \u043e\u0447\u0435\u043d\u044c \u043f\u043e\u0434\u0440\u043e\u0431\u043d\u043e\u0435 \u043e\u0431\u044a\u044f\u0441\u043d\u0435\u043d\u0438\u0435 \u043d\u0430 \u0437\u0430\u0434\u0430\u043d\u043d\u0443\u044e \u0442\u0435\u043c\u0443. \u0414\u043b\u044f \u043e\u0442\u0432\u0435\u0442\u0430 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439 \u0432\u0441\u0435 \u0441\u0432\u043e\u0438 \u0437\u043d\u0430\u043d\u0438\u044f \u0438 \u0414\u043e\u043f \u0438\u043d\u0444\u043e'''\n\n\n\n  resp, n1, n2 = answer_index(system, topic, instructions, info, temp, MODEL)\n\n  with open(f'{key_style}.txt', 'w') as f:\n\n    f.write(resp)\n\nelse: print(f\"\u0421\u0442\u0438\u043b\u044c {key_style} \u043d\u0435 \u043e\u043f\u0438\u0441\u0430\u043d!\")\n\nprint(resp)", "metadata": {"subid": 3, "total": 5, "source": "https://colab.research.google.com/drive/1LviwZCrnpKOn8X7oPQpsZzmcwZ6Eg6gu?usp=sharing"}}}, {"lc": 1, "type": "constructor", "id": ["langchain", "schema", "document", "Document"], "kwargs": {"page_content": "\n## \u041f\u043e\u044d\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439 \u0421\u0442\u0438\u043b\u044c\n\n\u0437\u0430\u043a\u043b\u044e\u0447\u0430\u0435\u0442\u0441\u044f \u0432 \u0435\u0451 \u0434\u0432\u043e\u0439\u043d\u043e\u0439 \u043f\u0440\u0438\u0440\u043e\u0434\u0435 - \u044f\u0437\u044b\u043a\u043e\u0432\u043e\u0439 \u0438 \u0445\u0443\u0434\u043e\u0436\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u0439, \u0442.\u0435. \u0441\u043b\u043e\u0432\u0435\u0441\u043d\u043e-\u043e\u0431\u0440\u0430\u0437\u043d\u043e\u0439. \u041e\u0442\u043b\u0438\u0447\u0430\u0435\u0442\u0441\u044f\n\n\u044d\u043b\u0435\u0433\u0430\u043d\u0442\u043d\u043e\u0441\u0442\u044c\u044e \u0438 \u0438\u0437\u044b\u0441\u043a\u0430\u043d\u043d\u043e\u0441\u0442\u044c\u044e \u0432 \u0432\u044b\u0441\u043a\u0430\u0437\u044b\u0432\u0430\u043d\u0438\u044f\u0445.\n\n\n\n- \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0435\u043c \u0443\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c, \u0438\u0437\u043e\u0431\u0440\u0430\u0437\u0438\u0432 \u041f\u043e\u044d\u0442\u0430.\n\n\u041d\u0430 \u0440\u0443\u0441\u0441\u043a\u043e\u043c \u044f\u0437\u044b\u043a\u0435 \u0443 GPT \u0441\u0442\u0438\u0445\u0438 \u043f\u043e\u043b\u0443\u0447\u0430\u044e\u0442\u0441\u044f \u043d\u0435 \u043e\u0447\u0435\u043d\u044c \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u043e. \u041d\u0430 \u0430\u043d\u0433\u043b\u0438\u0439\u0441\u043a\u043e\u043c \u0431\u043e\u043b\u044c\u0448\u0435 \u0440\u0438\u0442\u043c\u0430 \u0438 \u0440\u0438\u0444\u043c\u044b.\n\n\n\n**\u041f\u0440\u0438\u043c\u0435\u0440 \u043f\u0440\u043e\u043c\u043f\u0442\u0430**\n\n\n\n\u0422\u044b \u043f\u043e\u0434\u0440\u0430\u0436\u0430\u0442\u0435\u043b\u044c \u041f\u0443\u0448\u043a\u0438\u043d\u0443. \u0422\u0432\u043e\u0439 \u044f\u0437\u044b\u043a \u043a\u043e\u043f\u0438\u0440\u0443\u0435\u0442 \u0441\u0442\u0438\u043b\u044c \u0441\u0442\u0438\u0445\u043e\u0442\u0432\u043e\u0440\u043d\u043e\u0433\u043e \u044f\u0437\u044b\u043a\u0430 \u0410\u043b\u0435\u043a\u0441\u0430\u043d\u0434\u0440\u0430 \u0421\u0435\u0440\u0433\u0435\u0435\u0432\u0438\u0447\u0430 \u041f\u0443\u0448\u043a\u0438\u043d\u0430. \u041e\u0441\u043e\u0431\u0435\u043d\u043d\u043e\u0441\u0442\u0438 \u0442\u0432\u043e\u0435\u0433\u043e \u0441\u0442\u0438\u043b\u044f:\n\n//\u042d\u043b\u0435\u0433\u0430\u043d\u0442\u043d\u043e\u0441\u0442\u044c \u0438 \u0438\u0437\u044b\u0441\u043a\u0430\u043d\u043d\u043e\u0441\u0442\u044c.\u0422\u044b \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0448\u044c \u043a\u043b\u0430\u0441\u0441\u0438\u0447\u0435\u0441\u043a\u0443\u044e \u0441\u0442\u0438\u0445\u043e\u0442\u0432\u043e\u0440\u043d\u0443\u044e \u0444\u043e\u0440\u043c\u0443 \u0447\u0435\u0442\u044b\u0440\u0435\u0445\u0441\u0442\u043e\u043f\u043d\u044b\u0439 \u044f\u043c\u0431 , \u044d\u0442\u043e \u043f\u0440\u0438\u0434\u0430\u0435\u0442 \u0442\u0432\u043e\u0438\u043c \u0441\u0442\u0438\u0445\u0430\u043c \u043e\u0441\u043e\u0431\u0443\u044e \u0433\u0430\u0440\u043c\u043e\u043d\u0438\u044e \u0438 \u043c\u0435\u043b\u043e\u0434\u0438\u0447\u043d\u043e\u0441\u0442\u044c.\n\n//\u0413\u043b\u0443\u0431\u0438\u043d\u0430 \u0438 \u044d\u043c\u043e\u0446\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u043e\u0441\u0442\u044c: \u0442\u044b \u043c\u0430\u0441\u0442\u0435\u0440\u0441\u043a\u0438 \u043f\u0435\u0440\u0435\u0434\u0430\u0435\u0448\u044c \u0440\u0430\u0437\u043d\u043e\u043e\u0431\u0440\u0430\u0437\u043d\u044b\u0435 \u0447\u0443\u0432\u0441\u0442\u0432\u0430 \u0438 \u043d\u0430\u0441\u0442\u0440\u043e\u0435\u043d\u0438\u044f, \u043e\u0442 \u043d\u0435\u0436\u043d\u043e\u0441\u0442\u0438 \u0438 \u043b\u044e\u0431\u0432\u0438 \u0434\u043e \u0433\u0440\u0443\u0441\u0442\u0438 \u0438 \u0442\u043e\u0441\u043a\u0438.\n\n//\u042f\u0440\u043a\u0438\u0435 \u043e\u0431\u0440\u0430\u0437\u044b \u0438 \u043c\u0435\u0442\u0430\u0444\u043e\u0440\u044b: \u0443 \u0442\u0435\u0431\u044f \u0442\u0430\u043b\u0430\u043d\u0442 \u0441\u043e\u0437\u0434\u0430\u0432\u0430\u0442\u044c \u044f\u0440\u043a\u0438\u0435 \u043e\u0431\u0440\u0430\u0437\u044b \u0438 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u043c\u0435\u0442\u0430\u0444\u043e\u0440\u044b. \u0422\u0432\u043e\u0438 \u0441\u0442\u0438\u0445\u0438 \u043d\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u044b \u043a\u0440\u0430\u0441\u043e\u0447\u043d\u044b\u043c\u0438 \u043e\u043f\u0438\u0441\u0430\u043d\u0438\u044f\u043c\u0438 \u043f\u0440\u0438\u0440\u043e\u0434\u044b, \u0447\u0435\u043b\u043e\u0432\u0435\u0447\u0435\u0441\u043a\u0438\u0445 \u0447\u0443\u0432\u0441\u0442\u0432 \u0438 \u0432\u043d\u0443\u0442\u0440\u0435\u043d\u043d\u0435\u0433\u043e \u043c\u0438\u0440\u0430 \u043f\u0435\u0440\u0441\u043e\u043d\u0430\u0436\u0435\u0439.\n\n//\u042d\u0440\u0443\u0434\u0438\u0446\u0438\u044f \u0438 \u043a\u0443\u043b\u044c\u0442\u0443\u0440\u043d\u044b\u0435 \u043e\u0442\u0441\u044b\u043b\u043a\u0438: \u0423 \u0442\u0435\u0431\u044f \u0448\u0438\u0440\u043e\u043a\u0438\u0439 \u043a\u0440\u0443\u0433\u043e\u0437\u043e\u0440 \u0438 \u044d\u0440\u0443\u0434\u0438\u0446\u0438\u044f - \u0432 \u0442\u0432\u043e\u0438\u0445 \u0441\u0442\u0438\u0445\u0430\u0445 \u0447\u0430\u0441\u0442\u043e \u0432\u0441\u0442\u0440\u0435\u0447\u0430\u044e\u0442\u0441\u044f \u043e\u0442\u0441\u044b\u043b\u043a\u0438 \u043a \u043a\u043b\u0430\u0441\u0441\u0438\u0447\u0435\u0441\u043a\u043e\u0439 \u043b\u0438\u0442\u0435\u0440\u0430\u0442\u0443\u0440\u0435, \u043c\u0438\u0444\u043e\u043b\u043e\u0433\u0438\u0438, \u0438\u0441\u0442\u043e\u0440\u0438\u0438 \u0438 \u043a \u043a\u0443\u043b\u044c\u0442\u0443\u0440\u043d\u044b\u043c \u044f\u0432\u043b\u0435\u043d\u0438\u044f\u043c.\n\n\u041e\u0431\u0449\u0430\u044f \u0447\u0435\u0440\u0442\u0430 \u0442\u0432\u043e\u0435\u0433\u043e \u0441\u0442\u0438\u043b\u044f - \u044d\u0442\u043e \u0433\u0430\u0440\u043c\u043e\u043d\u0438\u044f \u0438 \u0431\u0430\u043b\u0430\u043d\u0441 \u043c\u0435\u0436\u0434\u0443 \u0444\u043e\u0440\u043c\u043e\u0439 \u0438 \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u043d\u0438\u0435\u043c, \u043c\u0435\u0436\u0434\u0443 \u044d\u0441\u0442\u0435\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u043c\u0438 \u0438 \u044d\u043c\u043e\u0446\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u044b\u043c\u0438 \u0430\u0441\u043f\u0435\u043a\u0442\u0430\u043c\u0438 \u0441\u0442\u0438\u0445\u043e\u0442\u0432\u043e\u0440\u0447\u0435\u0441\u0442\u0432\u0430.\n\n\u0422\u0432\u043e\u044f \u0437\u0430\u0434\u0430\u0447\u0430 \u043d\u0430\u043f\u0438\u0441\u0430\u0442\u044c \u0441\u0442\u0438\u0445\u043e\u0442\u0432\u043e\u0440\u0435\u043d\u0438\u0435-\u043f\u043e\u0434\u0440\u0430\u0436\u0430\u043d\u0438\u0435 \u041f\u0443\u0448\u043a\u0438\u043d\u0443 \u043d\u0430 \u0437\u0430\u0434\u0430\u043d\u043d\u0443\u044e \u0442\u0435\u043c\u0443.\n\n#@title \u041f\u043e\u044d\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439 \u0441\u0442\u0438\u043b\u044c\n\ntopic = \"\u0411\u043e\u043b\u044c\u0448\u043e\u0439 \u0432\u0437\u0440\u044b\u0432\" #@param {type:\"string\"}\n\ndocs = get_docs_by_req_to_wikipedia(topic)\n\ntext = ''.join(doc.page_content for doc in docs)\n\ntxt_body = text.split('## \u041f\u0440\u0438\u043c\u0435\u0447\u0430\u043d\u0438\u044f')[0]\n\ntokens = num_tokens_from_string(txt_body, \"cl100k_base\")\n\nif tokens > max_count:\n\n    splitter = RecursiveCharacterTextSplitter(chunk_size=max_count, chunk_overlap=chunk_overlap, length_function=num_tokens)\n\n    info = splitter.split_text(txt_body)[0]\n\nelse:\n\n    info = txt_body\n\nkey_style = \"\u041f\u043e\u044d\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439\" #@param [\"\u041d\u0430\u0443\u0447\u043d\u044b\u0439\", \"\u0411\u044e\u0440\u043e\u043a\u0440\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439\", \"\u0428\u043a\u043e\u043b\u044c\u043d\u044b\u0439 \u0443\u0447\u0438\u0442\u0435\u043b\u044c\", \"\u0420\u043e\u043c\u0430\u043d\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439\", \"\u0425\u0443\u0434\u043e\u0436\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0439\", \"\u041f\u043e\u044d\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439\", \"\u041a\u043e\u043d\u0441\u043f\u0438\u0440\u043e\u043b\u043e\u0433\"]\n\n\n\nif key_style in dict_style_desciption:\n\n  system = load_googledoc_by_url(dict_style_desciption[key_style])\n\n\n\n  if key_style == \"\u0411\u044e\u0440\u043e\u043a\u0440\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439\":\n\n    instructions = '''\u041f\u043e\u0434\u0433\u043e\u0442\u043e\u0432\u044c \u0432 \u0442\u0432\u043e\u0435\u043c \u0441\u0442\u0438\u043b\u0435 \u0441\u043f\u0440\u0430\u0432\u043a\u0443 \u043d\u0430 \u0437\u0430\u0434\u0430\u043d\u043d\u0443\u044e \u0442\u0435\u043c\u0443. \u0414\u043b\u044f \u043e\u0442\u0432\u0435\u0442\u0430 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439 \u0432\u0441\u0435 \u0441\u0432\u043e\u0438 \u0437\u043d\u0430\u043d\u0438\u044f \u0438 \u0414\u043e\u043f \u0438\u043d\u0444\u043e'''\n\n  else:\n\n    instructions = '''\u041d\u0430\u043f\u0438\u0448\u0438 \u0432 \u0442\u0432\u043e\u0435\u043c \u0441\u0442\u0438\u043b\u0435 \u043e\u0447\u0435\u043d\u044c \u043f\u043e\u0434\u0440\u043e\u0431\u043d\u043e\u0435 \u043e\u0431\u044a\u044f\u0441\u043d\u0435\u043d\u0438\u0435 \u043d\u0430 \u0437\u0430\u0434\u0430\u043d\u043d\u0443\u044e \u0442\u0435\u043c\u0443. \u0414\u043b\u044f \u043e\u0442\u0432\u0435\u0442\u0430 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439 \u0432\u0441\u0435 \u0441\u0432\u043e\u0438 \u0437\u043d\u0430\u043d\u0438\u044f \u0438 \u0414\u043e\u043f \u0438\u043d\u0444\u043e'''\n\n\n\n  resp, n1, n2 = answer_index(system, topic, instructions, info, temp, MODEL)\n\n  with open(f'{key_style}.txt', 'w') as f:\n\n    f.write(resp)\n\nelse: print(f\"\u0421\u0442\u0438\u043b\u044c {key_style} \u043d\u0435 \u043e\u043f\u0438\u0441\u0430\u043d!\")\n\nprint(resp)\n\n# \u0420\u0435\u043b\u0438\u0433\u0438\u043e\u0437\u043d\u044b\u0439 \u0441\u0442\u0438\u043b\u044c\n\n\n\n\u0426\u0435\u0440\u043a\u043e\u0432\u043d\u043e-\u0440\u0435\u043b\u0438\u0433\u0438\u043e\u0437\u043d\u044b\u0439 \u0441\u0442\u0438\u043b\u044c \u0440\u0435\u0447\u0438 \u0432\u043e\u0437\u043d\u0438\u043a \u0432 \u0438\u0441\u0442\u043e\u0440\u0438\u0447\u0435\u0441\u043a\u043e\u043c \u043a\u043e\u043d\u0442\u0435\u043a\u0441\u0442\u0435 \u0440\u0435\u043b\u0438\u0433\u0438\u043e\u0437\u043d\u044b\u0445 \u043e\u0431\u0440\u044f\u0434\u043e\u0432 \u0438 \u043a\u0443\u043b\u044c\u0442\u043e\u0432\u044b\u0445 \u0442\u0435\u043a\u0441\u0442\u043e\u0432.\n\n\n\n\u0426\u0435\u0440\u043a\u043e\u0432\u043d\u043e-\u0440\u0435\u043b\u0438\u0433\u0438\u043e\u0437\u043d\u044b\u0439 \u0441\u0442\u0438\u043b\u044c \u0440\u0435\u0447\u0438 \u0438\u043c\u0435\u0435\u0442 \u0441\u0432\u043e\u0438 \u043e\u0441\u043e\u0431\u0435\u043d\u043d\u043e\u0441\u0442\u0438, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u043e\u0442\u043b\u0438\u0447\u0430\u044e\u0442 \u0435\u0433\u043e \u043e\u0442 \u0434\u0440\u0443\u0433\u0438\u0445 \u0441\u0442\u0438\u043b\u0435\u0439. \u0412\u043e\u0442 \u043d\u0435\u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0438\u0437 \u043d\u0438\u0445:\n\n\n\n\u0412\u044b\u0441\u043e\u043a\u0430\u044f \u0441\u0442\u0435\u043f\u0435\u043d\u044c \u0444\u043e\u0440\u043c\u0430\u043b\u044c\u043d\u043e\u0441\u0442\u0438:\n\n\u041e\u043d \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442\u0441\u044f \u0432\u043e \u0432\u0440\u0435\u043c\u044f \u0431\u043e\u0433\u043e\u0441\u043b\u0443\u0436\u0435\u043d\u0438\u0439, \u043c\u043e\u043b\u0438\u0442\u0432 \u0438 \u0434\u0440\u0443\u0433\u0438\u0445 \u0440\u0435\u043b\u0438\u0433\u0438\u043e\u0437\u043d\u044b\u0445 \u0446\u0435\u0440\u0435\u043c\u043e\u043d\u0438\u0439. \u0412 \u044d\u0442\u043e\u043c \u0441\u0442\u0438\u043b\u0435 \u0440\u0435\u0447\u0438 \u043f\u0440\u0435\u043e\u0431\u043b\u0430\u0434\u0430\u0435\u0442 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435 \u0443\u0441\u0442\u0430\u0440\u0435\u0432\u0448\u0438\u0445 \u0438\u043b\u0438 \u0430\u0440\u0445\u0430\u0438\u0447\u043d\u044b\u0445 \u0441\u043b\u043e\u0432 \u0438 \u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u0439, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u043f\u0440\u0438\u0434\u0430\u044e\u0442 \u0435\u043c\u0443 \u043e\u0441\u043e\u0431\u0443\u044e \u0442\u043e\u0440\u0436\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u0441\u0442\u044c \u0438 \u0441\u0432\u044f\u0449\u0435\u043d\u043d\u043e\u0441\u0442\u044c.\n\n\n\n\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435 \u0441\u043f\u0435\u0446\u0438\u0444\u0438\u0447\u0435\u0441\u043a\u043e\u0439 \u043b\u0435\u043a\u0441\u0438\u043a\u0438:\n\n\u0447\u0430\u0441\u0442\u043e \u0432\u0441\u0442\u0440\u0435\u0447\u0430\u044e\u0442\u0441\u044f \u0441\u043b\u043e\u0432\u0430 \u0438 \u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u044f, \u0441\u0432\u044f\u0437\u0430\u043d\u043d\u044b\u0435 \u0441 \u0431\u043e\u0433\u043e\u043c, \u0432\u0435\u0440\u043e\u0439, \u0434\u0443\u0445\u043e\u0432\u043d\u043e\u0441\u0442\u044c\u044e \u0438 \u043c\u043e\u0440\u0430\u043b\u044c\u043d\u044b\u043c\u0438 \u0446\u0435\u043d\u043d\u043e\u0441\u0442\u044f\u043c\u0438.\n\n\n\n\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435 \u0430\u0440\u0445\u0430\u0438\u0447\u043d\u044b\u0445 \u0433\u0440\u0430\u043c\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0445 \u043a\u043e\u043d\u0441\u0442\u0440\u0443\u043a\u0446\u0438\u0439:\n\n\u0426\u0435\u0440\u043a\u043e\u0432\u043d\u043e-\u0440\u0435\u043b\u0438\u0433\u0438\u043e\u0437\u043d\u044b\u0439 \u0441\u0442\u0438\u043b\u044c \u0440\u0435\u0447\u0438 \u0447\u0430\u0441\u0442\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0442 \u0430\u0440\u0445\u0430\u0438\u0447\u043d\u044b\u0435 \u0433\u0440\u0430\u043c\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u043a\u043e\u043d\u0441\u0442\u0440\u0443\u043a\u0446\u0438\u0438, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0443\u0436\u0435 \u043d\u0435 \u044f\u0432\u043b\u044f\u044e\u0442\u0441\u044f \u0445\u0430\u0440\u0430\u043a\u0442\u0435\u0440\u043d\u044b\u043c\u0438 \u0434\u043b\u044f \u0441\u043e\u0432\u0440\u0435\u043c\u0435\u043d\u043d\u043e\u0433\u043e \u0440\u0443\u0441\u0441\u043a\u043e\u0433\u043e \u044f\u0437\u044b\u043a\u0430. \u042d\u0442\u043e \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435 \u0441\u0442\u0430\u0440\u044b\u0445 \u043f\u0430\u0434\u0435\u0436\u0435\u0439, \u0441\u043f\u0435\u0446\u0438\u0444\u0438\u0447\u0435\u0441\u043a\u0438\u0445 \u0432\u0440\u0435\u043c\u0435\u043d\u043d\u044b\u0445 \u0444\u043e\u0440\u043c \u0438 \u0434\u0440\u0443\u0433\u0438\u0445 \u0433\u0440\u0430\u043c\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0445 \u043e\u0441\u043e\u0431\u0435\u043d\u043d\u043e\u0441\u0442\u0435\u0439.\n\n\n\n\u041e\u0441\u043e\u0431\u0435\u043d\u043d\u043e\u0441\u0442\u0438 \u0441\u0438\u043d\u0442\u0430\u043a\u0441\u0438\u0441\u0430: \u043c\u043e\u0436\u0435\u0442 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0441\u043b\u043e\u0436\u043d\u044b\u0435 \u0438 \u0434\u043b\u0438\u043d\u043d\u044b\u0435 \u043f\u0440\u0435\u0434\u043b\u043e\u0436\u0435\u043d\u0438\u044f, \u0438\u043d\u0432\u0435\u0440\u0441\u0438\u044e \u0438 \u0434\u0440\u0443\u0433\u0438\u0435 \u0441\u0438\u043d\u0442\u0430\u043a\u0441\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u043a\u043e\u043d\u0441\u0442\u0440\u0443\u043a\u0446\u0438\u0438, \u0447\u0442\u043e\u0431\u044b \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0431\u043e\u043b\u0435\u0435 \u0442\u043e\u0440\u0436\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u0435 \u0438 \u0432\u044b\u0440\u0430\u0437\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0435 \u0432\u044b\u0440\u0430\u0436\u0435\u043d\u0438\u0435.\n\n\n\n\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435 \u0441\u0442\u0438\u043b\u0438\u0441\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0445 \u043f\u0440\u0438\u0435\u043c\u043e\u0432: \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435 \u043f\u043e\u0432\u0442\u043e\u0440\u0435\u043d\u0438\u0439, \u043c\u0435\u0442\u0430\u0444\u043e\u0440, \u0430\u043b\u043b\u0435\u0433\u043e\u0440\u0438\u0439 \u0438 \u0434\u0440\u0443\u0433\u0438\u0445 \u0441\u0442\u0438\u043b\u0438\u0441\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0445 \u0444\u0438\u0433\u0443\u0440 \u0440\u0435\u0447\u0438.\n\n\n\n\u0412\u0441\u0435 \u044d\u0442\u0438 \u0447\u0435\u0440\u0442\u044b \u0446\u0435\u0440\u043a\u043e\u0432\u043d\u043e-\u0440\u0435\u043b\u0438\u0433\u0438\u043e\u0437\u043d\u043e\u0433\u043e \u0441\u0442\u0438\u043b\u044f \u0440\u0435\u0447\u0438 \u043f\u043e\u043c\u043e\u0433\u0430\u044e\u0442 \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043e\u0441\u043e\u0431\u0443\u044e \u0430\u0442\u043c\u043e\u0441\u0444\u0435\u0440\u0443 \u0441\u0432\u044f\u0449\u0435\u043d\u043d\u043e\u0441\u0442\u0438, \u0442\u043e\u0440\u0436\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u0441\u0442\u0438 \u0438 \u0434\u0443\u0445\u043e\u0432\u043d\u043e\u0441\u0442\u0438, \u043a\u043e\u0442\u043e\u0440\u0430\u044f \u0445\u0430\u0440\u0430\u043a\u0442\u0435\u0440\u043d\u0430 \u0434\u043b\u044f \u0440\u0435\u043b\u0438\u0433\u0438\u043e\u0437\u043d\u044b\u0445 \u043e\u0431\u0440\u044f\u0434\u043e\u0432 \u0438 \u0442\u0435\u043a\u0441\u0442\u043e\u0432.\n\n\n\n**\u041f\u0440\u0438\u043c\u0435\u0440 \u043f\u0440\u043e\u043c\u043f\u0442\u0430**\n\n\n\n\u0422\u044b \u043a\u0430\u0442\u043e\u043b\u0438\u0447\u0435\u0441\u043a\u0438\u0439 \u0441\u0432\u044f\u0449\u0435\u043d\u043d\u0438\u043a - \u0441\u0430\u043c\u044b\u0439 \u043b\u0443\u0447\u0448\u0438\u0439 \u0432 \u043f\u0440\u0438\u0445\u043e\u0434\u0435 \u043f\u0440\u043e\u043f\u043e\u0432\u0435\u0434\u043d\u0438\u043a. \u0422\u044b \u0433\u043b\u0443\u0431\u043e\u043a\u043e \u0440\u0430\u0437\u0431\u0438\u0440\u0430\u0435\u0448\u044c\u0441\u044f \u0432 \u043d\u0430\u0443\u043a\u0435 \u0438 \u0431\u043e\u0433\u043e\u0441\u043b\u043e\u0432\u0438\u0438. \u0422\u0435\u0431\u044f \u043e\u0447\u0435\u043d\u044c \u043b\u044e\u0431\u0438\u0442 \u0442\u0432\u043e\u044f \u043f\u0430\u0441\u0442\u0432\u0430.\n\n\u0422\u0432\u043e\u0439 \u0441\u0442\u0438\u043b\u044c \u0440\u0435\u0447\u0438 \u0445\u0430\u0440\u0430\u043a\u0442\u0435\u0440\u0438\u0437\u0443\u0435\u0442\u0441\u044f \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u0435\u043c \u0441\u043f\u0435\u0446\u0438\u0444\u0438\u0447\u0435\u0441\u043a\u043e\u0439 \u043b\u0435\u043a\u0441\u0438\u043a\u0438, \u043a\u043e\u0442\u043e\u0440\u0430\u044f \u0441\u0432\u044f\u0437\u0430\u043d\u0430 \u0441 \u0440\u0435\u043b\u0438\u0433\u0438\u043e\u0437\u043d\u044b\u043c\u0438 \u043f\u043e\u043d\u044f\u0442\u0438\u044f\u043c\u0438, \u043e\u0431\u0440\u044f\u0434\u0430\u043c\u0438 \u0438 \u0432\u0435\u0440\u043e\u0432\u0430\u043d\u0438\u044f\u043c\u0438.\n\n\u0422\u044b \u0447\u0430\u0441\u0442\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0448\u044c \u0430\u0440\u0445\u0430\u0438\u0447\u043d\u044b\u0435 \u0438 \u0432\u044b\u0441\u043e\u043a\u043e\u043f\u0430\u0440\u043d\u044b\u0435 \u0441\u043b\u043e\u0432\u0430, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u043f\u0440\u0438\u0434\u0430\u044e\u0442 \u0442\u0435\u043a\u0441\u0442\u0443 \u0442\u043e\u0440\u0436\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u0441\u0442\u044c \u0438 \u0432\u043e\u0437\u0432\u044b\u0448\u0435\u043d\u043d\u043e\u0441\u0442\u044c, \u0442\u0430\u043a\u0438\u0435 \u043a\u0430\u043a \u201c\u0431\u043b\u0430\u0433\u043e\u0441\u043b\u043e\u0432\u0435\u043d\u0438\u0435\u201d, \u201c\u043f\u043e\u043a\u0430\u044f\u043d\u0438\u0435\u201d, \u201c\u0441\u043c\u0438\u0440\u0435\u043d\u0438\u0435\u201d.\n\n\u0422\u044b \u0447\u0430\u0441\u0442\u043e \u0446\u0438\u0442\u0438\u0440\u0443\u0435\u0448\u044c \u0411\u0438\u0431\u043b\u0438\u044e \u0438 \u0440\u0435\u043b\u0438\u0433\u0438\u043e\u0437\u043d\u044b\u0435 \u0442\u0435\u043a\u0441\u0442\u044b: \u043d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u201c\u0431\u043b\u0430\u0433\u043e\u0441\u043b\u043e\u0432\u0435\u043d\u043d\u044b \u0442\u0435, \u043a\u0442\u043e \u0432\u0435\u0440\u0438\u0442\u201d, \u201c\u043f\u0440\u043e\u0449\u0435\u043d\u0438\u0435 \u0433\u0440\u0435\u0445\u043e\u0432\u201d, \u201c\u0432\u0435\u0447\u043d\u0430\u044f \u0436\u0438\u0437\u043d\u044c\u201d \u0438 \u0442.\u0434.\n\n\u0422\u044b \u0447\u0430\u0441\u0442\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0448\u044c \u0441\u043b\u043e\u0432\u0430, \u0441\u0432\u044f\u0437\u0430\u043d\u043d\u044b\u0435 \u0441 \u0434\u0443\u0445\u043e\u0432\u043d\u043e\u0441\u0442\u044c\u044e \u0438 \u043c\u043e\u0440\u0430\u043b\u044c\u044e. \u042d\u0442\u043e \u043c\u043e\u0433\u0443\u0442 \u0431\u044b\u0442\u044c \u0441\u043b\u043e\u0432\u0430, \u043e\u043f\u0438\u0441\u044b\u0432\u0430\u044e\u0449\u0438\u0435 \u0434\u043e\u0431\u0440\u043e\u0434\u0435\u0442\u0435\u043b\u0438, \u0442\u0430\u043a\u0438\u0435 \u043a\u0430\u043a \u201c\u043b\u044e\u0431\u043e\u0432\u044c\u201d, \u201c\u043c\u0438\u043b\u043e\u0441\u0435\u0440\u0434\u0438\u0435\u201d, \u201c\u0442\u0435\u0440\u043f\u0435\u043d\u0438\u0435\u201d \u0438 \u0442.\u0434. \u0438\u043b\u0438 \u0441\u043b\u043e\u0432\u0430, \u0441\u0432\u044f\u0437\u0430\u043d\u043d\u044b\u0435 \u0441 \u0433\u0440\u0435\u0445\u0430\u043c\u0438 \u0438 \u0438\u0441\u043a\u0443\u0448\u0435\u043d\u0438\u044f\u043c\u0438, \u0442\u0430\u043a\u0438\u0435 \u043a\u0430\u043a \u201c\u0433\u043e\u0440\u0434\u044b\u043d\u044f\u201d, \u201c\u0441\u043a\u0443\u043f\u043e\u0441\u0442\u044c\u201d, \u201c\u0441\u043e\u0431\u043b\u0430\u0437\u043d\u201d \u0438 \u0442.\u0434. \u042d\u0442\u0438 \u0441\u043b\u043e\u0432\u0430 \u043f\u043e\u043c\u043e\u0433\u0430\u044e\u0442 \u0442\u0435\u0431\u0435 \u0432\u044b\u0440\u0430\u0437\u0438\u0442\u044c \u0440\u0435\u043b\u0438\u0433\u0438\u043e\u0437\u043d\u044b\u0435 \u0438 \u043c\u043e\u0440\u0430\u043b\u044c\u043d\u044b\u0435 \u0446\u0435\u043d\u043d\u043e\u0441\u0442\u0438.\n\n\u0422\u044b \u0433\u043e\u0432\u043e\u0440\u0438\u0448\u044c \u0441\u043b\u043e\u0436\u043d\u044b\u043c\u0438 \u0438 \u0434\u043b\u0438\u043d\u043d\u044b\u043c\u0438 \u043f\u0440\u0435\u0434\u043b\u043e\u0436\u0435\u043d\u0438\u044f\u043c\u0438. \u0418\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0448\u044c \u043f\u0440\u0438\u0435\u043c\u044b \u043f\u0430\u0440\u0430\u043b\u043b\u0435\u043b\u0438\u0437\u043c\u0430 \u2013 \u043f\u043e\u0432\u0442\u043e\u0440\u0435\u043d\u0438\u044f \u043e\u0434\u043d\u043e\u0439 \u0438 \u0442\u043e\u0439 \u0436\u0435 \u043a\u043e\u043d\u0441\u0442\u0440\u0443\u043a\u0446\u0438\u0438 \u0438\u043b\u0438 \u0441\u0442\u0440\u0443\u043a\u0442\u0443\u0440\u044b \u043f\u0440\u0435\u0434\u043b\u043e\u0436\u0435\u043d\u0438\u044f\n\n\u0427\u0430\u0441\u0442\u043e \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0448\u044c \u0432\u043e\u043f\u0440\u043e\u0441\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0435 \u043f\u0440\u0435\u0434\u043b\u043e\u0436\u0435\u043d\u0438\u044f, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0432\u044b\u0437\u044b\u0432\u0430\u044e\u0442 \u0440\u0430\u0437\u043c\u044b\u0448\u043b\u0435\u043d\u0438\u044f \u0438 \u0437\u0430\u0434\u0443\u043c\u044b\u0432\u0430\u043d\u0438\u0435. \u041d\u0430\u043f\u0440\u0438\u043c\u0435\u0440, \u201c\u0427\u0442\u043e \u0435\u0441\u0442\u044c \u0447\u0435\u043b\u043e\u0432\u0435\u043a, \u0447\u0442\u043e\u0431\u044b \u0422\u044b \u043f\u043e\u043c\u043d\u0438\u043b \u043e \u043d\u0435\u043c, \u0438 \u0441\u044b\u043d \u0447\u0435\u043b\u043e\u0432\u0435\u0447\u0435\u0441\u043a\u0438\u0439, \u0447\u0442\u043e\u0431\u044b \u0422\u044b \u043f\u043e\u0441\u0435\u0449\u0430\u043b \u0435\u0433\u043e?\u201d\n\n\u0421\u0442\u0438\u043b\u0438\u0441\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0435 \u043f\u0440\u0438\u0435\u043c\u044b, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u0442\u044b \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0435\u0448\u044c \u0432 \u043f\u0440\u043e\u043f\u043e\u0432\u0435\u0434\u0438: \u043c\u0435\u0442\u0430\u0444\u043e\u0440\u0430, \u0430\u043d\u0442\u0438\u0442\u0435\u0437\u0430, \u0440\u0438\u0442\u043e\u0440\u0438\u0447\u0435\u0441\u043a\u0438\u0439 \u0432\u043e\u043f\u0440\u043e\u0441, \u043f\u043e\u0432\u0442\u043e\u0440\u0435\u043d\u0438\u0435.\n\n\u0422\u0432\u043e\u044f \u0437\u0430\u0434\u0430\u0447\u0430 \u043f\u0440\u043e\u0447\u0438\u0442\u0430\u0442\u044c \u043f\u0440\u043e\u043f\u043e\u0432\u0435\u0434\u044c \u043d\u0430 \u0437\u0430\u0434\u0430\u043d\u043d\u0443\u044e \u0442\u0435\u043c\u0443.\n\n#@title \u0420\u0435\u043b\u0438\u0433\u0438\u043e\u0437\u043d\u044b\u0439 \u0441\u0442\u0438\u043b\u044c\n\ntopic = \"\u0411\u043e\u043b\u044c\u0448\u043e\u0439 \u0432\u0437\u0440\u044b\u0432\" #@param {type:\"string\"}\n\ndocs = get_docs_by_req_to_wikipedia(topic)\n\ntext = ''.join(doc.page_content for doc in docs)\n\ntxt_body = text.split('## \u041f\u0440\u0438\u043c\u0435\u0447\u0430\u043d\u0438\u044f')[0]\n\ntokens = num_tokens_from_string(txt_body, \"cl100k_base\")\n\nif tokens > max_count:\n\n    splitter = RecursiveCharacterTextSplitter(chunk_size=max_count, chunk_overlap=chunk_overlap, length_function=num_tokens)\n\n    info = splitter.split_text(txt_body)[0]\n\nelse:\n\n    info = txt_body\n\nkey_style = \"\u0420\u0435\u043b\u0438\u0433\u0438\u043e\u0437\u043d\u044b\u0439\" #@param [\"\u041d\u0430\u0443\u0447\u043d\u044b\u0439\", \"\u0411\u044e\u0440\u043e\u043a\u0440\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439\", \"\u0428\u043a\u043e\u043b\u044c\u043d\u044b\u0439 \u0443\u0447\u0438\u0442\u0435\u043b\u044c\", \"\u0420\u043e\u043c\u0430\u043d\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439\", \"\u0425\u0443\u0434\u043e\u0436\u0435\u0441\u0442\u0432\u0435\u043d\u043d\u044b\u0439\", \"\u041f\u043e\u044d\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439\", \"\u041a\u043e\u043d\u0441\u043f\u0438\u0440\u043e\u043b\u043e\u0433\", \"\u0420\u0435\u043b\u0438\u0433\u0438\u043e\u0437\u043d\u044b\u0439\"]\n\n\n\nif key_style in dict_style_desciption:\n\n  system = load_googledoc_by_url(dict_style_desciption[key_style])\n\n\n\n  if key_style == \"\u0411\u044e\u0440\u043e\u043a\u0440\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439\":\n\n    instructions = '''\u041f\u043e\u0434\u0433\u043e\u0442\u043e\u0432\u044c \u0432 \u0442\u0432\u043e\u0435\u043c \u0441\u0442\u0438\u043b\u0435 \u0441\u043f\u0440\u0430\u0432\u043a\u0443 \u043d\u0430 \u0437\u0430\u0434\u0430\u043d\u043d\u0443\u044e \u0442\u0435\u043c\u0443. \u0414\u043b\u044f \u043e\u0442\u0432\u0435\u0442\u0430 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439 \u0432\u0441\u0435 \u0441\u0432\u043e\u0438 \u0437\u043d\u0430\u043d\u0438\u044f \u0438 \u0414\u043e\u043f \u0438\u043d\u0444\u043e'''\n\n  else:\n\n    instructions = '''\u041d\u0430\u043f\u0438\u0448\u0438 \u0432 \u0442\u0432\u043e\u0435\u043c \u0441\u0442\u0438\u043b\u0435 \u043e\u0447\u0435\u043d\u044c \u043f\u043e\u0434\u0440\u043e\u0431\u043d\u043e\u0435 \u043e\u0431\u044a\u044f\u0441\u043d\u0435\u043d\u0438\u0435 \u043d\u0430 \u0437\u0430\u0434\u0430\u043d\u043d\u0443\u044e \u0442\u0435\u043c\u0443. \u0414\u043b\u044f \u043e\u0442\u0432\u0435\u0442\u0430 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439 \u0432\u0441\u0435 \u0441\u0432\u043e\u0438 \u0437\u043d\u0430\u043d\u0438\u044f \u0438 \u0414\u043e\u043f \u0438\u043d\u0444\u043e'''\n\n\n\n  resp, n1, n2 = answer_index(system, topic, instructions, info, temp, MODEL)\n\n  with open(f'{key_style}.txt', 'w') as f:\n\n    f.write(resp)\n\nelse: print(f\"\u0421\u0442\u0438\u043b\u044c {key_style} \u043d\u0435 \u043e\u043f\u0438\u0441\u0430\u043d!\")\n\nprint(resp)", "metadata": {"subid": 4, "total": 5, "source": "https://colab.research.google.com/drive/1LviwZCrnpKOn8X7oPQpsZzmcwZ6Eg6gu?usp=sharing"}}}]